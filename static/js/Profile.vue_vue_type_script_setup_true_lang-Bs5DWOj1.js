var R=(F,g,u)=>new Promise((w,f)=>{var m=s=>{try{o(u.next(s))}catch(c){f(c)}},b=s=>{try{o(u.throw(s))}catch(c){f(c)}},o=s=>s.done?w(s.value):Promise.resolve(s.value).then(m,b);o((u=u.apply(F,g)).next())});import{f as N}from"./mock-DvpSEM2I.js";import{d as j,m as D,eV as E,a as r,b as $,j as A,g as I,f as l,w as t,u as y,h as U,X as L,s as H,l as p,r as O,aI as T,H as k}from"./index-ChQ6eMdI.js";import{R as X}from"./index-Cr78zUtZ.js";import{U as G}from"./upload-line-1kVVw6qq.js";const J={class:"dialog-footer"},ee=j({name:"Profile",__name:"Profile",setup(F){const g=p(""),u=p(),w=p(),f=p(),m=p(!1),b=p(),o=O({avatar:"",nickname:"",email:"",phone:"",description:""}),s=O({nickname:[{required:!0,message:"昵称必填",trigger:"blur"}]});function c(a,e){const d=[{value:"@qq.com"},{value:"@126.com"},{value:"@163.com"}];let V=[],i=[];d.map(v=>i.push({value:a.split("@")[0]+v.value})),V=a?i.filter(v=>v.value.toLowerCase().indexOf(a.toLowerCase())===0):i,e(V)}const h=a=>{const e=new FileReader;e.onload=d=>{g.value=d.target.result,m.value=!0},e.readAsDataURL(a.raw)},C=()=>{w.value.hidePopover(),f.value.clearFiles(),m.value=!1},B=({blob:a})=>u.value=a,P=()=>{const a=T({files:new File([u.value],"avatar")});N(a).then(({code:e})=>{e===0?(k("更新头像成功",{type:"success"}),C()):k("更新头像失败")}).catch(e=>{k(`提交异常 ${e}`,{type:"error"})})},S=a=>R(null,null,function*(){yield a.validate((e,d)=>{e&&k("更新信息成功",{type:"success"})})});return D(()=>R(null,null,function*(){const{code:a,data:e}=yield E();a===0&&Object.assign(o,e)})),(a,e)=>{const d=r("el-avatar"),V=r("IconifyIconOffline"),i=r("el-button"),v=r("el-upload"),_=r("el-form-item"),x=r("el-input"),q=r("el-autocomplete"),z=r("el-form"),M=r("el-dialog");return $(),A("div",{class:H(["min-w-[180px]",y(L)()?"max-w-[100%]":"max-w-[70%]"])},[e[10]||(e[10]=I("h3",{class:"my-8!"},"个人信息",-1)),l(z,{ref_key:"userInfoFormRef",ref:b,"label-position":"top",rules:s,model:o},{default:t(()=>[l(_,{label:"头像"},{default:t(()=>[l(d,{size:80,src:o.avatar},null,8,["src"]),l(v,{ref_key:"uploadRef",ref:f,accept:"image/*",action:"#",limit:1,"auto-upload":!1,"show-file-list":!1,"on-change":h},{default:t(()=>[l(i,{plain:"",class:"ml-4!"},{default:t(()=>[l(V,{icon:y(G)},null,8,["icon"]),e[6]||(e[6]=I("span",{class:"ml-2"},"更新头像",-1))]),_:1})]),_:1},512)]),_:1}),l(_,{label:"昵称",prop:"nickname"},{default:t(()=>[l(x,{modelValue:o.nickname,"onUpdate:modelValue":e[0]||(e[0]=n=>o.nickname=n),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),l(_,{label:"邮箱",prop:"email"},{default:t(()=>[l(q,{modelValue:o.email,"onUpdate:modelValue":e[1]||(e[1]=n=>o.email=n),"fetch-suggestions":c,"trigger-on-focus":!1,placeholder:"请输入邮箱",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),l(_,{label:"联系电话"},{default:t(()=>[l(x,{modelValue:o.phone,"onUpdate:modelValue":e[2]||(e[2]=n=>o.phone=n),placeholder:"请输入联系电话",clearable:""},null,8,["modelValue"])]),_:1}),l(_,{label:"简介"},{default:t(()=>[l(x,{modelValue:o.description,"onUpdate:modelValue":e[3]||(e[3]=n=>o.description=n),placeholder:"请输入简介",type:"textarea",autosize:{minRows:6,maxRows:8},maxlength:"56","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(i,{type:"primary",onClick:e[4]||(e[4]=n=>S(b.value))},{default:t(()=>[...e[7]||(e[7]=[U(" 更新信息 ",-1)])]),_:1})]),_:1},8,["rules","model"]),l(M,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=n=>m.value=n),width:"40%",title:"编辑头像","destroy-on-close":"",closeOnClickModal:!1,"before-close":C,fullscreen:y(L)()},{footer:t(()=>[I("div",J,[l(i,{bg:"",text:"",onClick:C},{default:t(()=>[...e[8]||(e[8]=[U("取消",-1)])]),_:1}),l(i,{bg:"",text:"",type:"primary",onClick:P},{default:t(()=>[...e[9]||(e[9]=[U(" 确定 ",-1)])]),_:1})])]),default:t(()=>[l(y(X),{ref_key:"cropRef",ref:w,imgSrc:g.value,onCropper:B},null,8,["imgSrc"])]),_:1},8,["modelValue","fullscreen"])],2)}}});export{ee as _};
