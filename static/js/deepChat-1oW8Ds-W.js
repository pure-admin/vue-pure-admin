function zi(a,i){if(a==null)return{};var t,e,n=Wi(a,i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);for(e=0;e<r.length;e++)t=r[e],i.indexOf(t)===-1&&{}.propertyIsEnumerable.call(a,t)&&(n[t]=a[t])}return n}function Wi(a,i){if(a==null)return{};var t={};for(var e in a)if({}.hasOwnProperty.call(a,e)){if(i.indexOf(e)!==-1)continue;t[e]=a[e]}return t}function Gi(a,i,t,e){var n=Tr(Et(a.prototype),i,t);return typeof n=="function"?function(r){return n.apply(t,r)}:n}function Tr(){return Tr=typeof Reflect!="undefined"&&Reflect.get?Reflect.get.bind():function(a,i,t){var e=Ki(a,i);if(e){var n=Object.getOwnPropertyDescriptor(e,i);return n.get?n.get.call(arguments.length<3?a:t):n.value}},Tr.apply(null,arguments)}function Ki(a,i){for(;!{}.hasOwnProperty.call(a,i)&&(a=Et(a))!==null;);return a}function qt(a,i){var t=typeof Symbol!="undefined"&&a[Symbol.iterator]||a["@@iterator"];if(!t){if(Array.isArray(a)||(t=Jr(a))||i){t&&(a=t);var e=0,n=function(){};return{s:n,n:(function(l){function u(){return l.apply(this,arguments)}return u.toString=function(){return l.toString()},u})(function(){return e>=a.length?{done:!0}:{done:!1,value:a[e++]}}),e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r,s=!0,o=!1;return{s:function(){t=t.call(a)},n:function(){var u=t.next();return s=u.done,u},e:function(u){o=!0,r=u},f:function(){try{s||t.return==null||t.return()}finally{if(o)throw r}}}}function Ar(a){var i=typeof Map=="function"?new Map:void 0;return Ar=function(e){if(e===null||!$i(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(i!==void 0){if(i.has(e))return i.get(e);i.set(e,n)}function n(){return Vi(e,arguments,Et(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),An(n,e)},Ar(a)}function Vi(a,i,t){if(Zr())return Reflect.construct.apply(null,arguments);var e=[null];e.push.apply(e,i);var n=new(a.bind.apply(a,e));return t&&An(n,t.prototype),n}function $i(a){try{return Function.toString.call(a).indexOf("[native code]")!==-1}catch(i){return typeof a=="function"}}function wt(a,i){return Zi(a)||Ji(a,i)||Jr(a,i)||Xi()}function Xi(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ji(a,i){var t=a==null?null:typeof Symbol!="undefined"&&a[Symbol.iterator]||a["@@iterator"];if(t!=null){var e,n,r,s,o=[],l=!0,u=!1;try{if(r=(t=t.call(a)).next,i===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(e=r.call(t)).done)&&(o.push(e.value),o.length!==i);l=!0);}catch(c){u=!0,n=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw n}}return o}}function Zi(a){if(Array.isArray(a))return a}function _t(a){return eo(a)||Qi(a)||Jr(a)||Yi()}function Yi(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jr(a,i){if(a){if(typeof a=="string")return Mr(a,i);var t={}.toString.call(a).slice(8,-1);return t==="Object"&&a.constructor&&(t=a.constructor.name),t==="Map"||t==="Set"?Array.from(a):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Mr(a,i):void 0}}function Qi(a){if(typeof Symbol!="undefined"&&a[Symbol.iterator]!=null||a["@@iterator"]!=null)return Array.from(a)}function eo(a){if(Array.isArray(a))return Mr(a)}function Mr(a,i){(i==null||i>a.length)&&(i=a.length);for(var t=0,e=Array(i);t<i;t++)e[t]=a[t];return e}function F(a,i,t){return i=Et(i),to(a,Zr()?Reflect.construct(i,t||[],Et(a).constructor):i.apply(a,t))}function to(a,i){if(i&&(R(i)=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zt(a)}function zt(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Zr(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(i){}return(Zr=function(){return!!a})()}function Et(a){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Et(a)}function D(a,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(i&&i.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),i&&An(a,i)}function An(a,i){return An=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},An(a,i)}function v(){var a,i,t=typeof Symbol=="function"?Symbol:{},e=t.iterator||"@@iterator",n=t.toStringTag||"@@toStringTag";function r(p,g,m,b){var k=g&&g.prototype instanceof o?g:o,A=Object.create(k.prototype);return Ve(A,"_invoke",(function(I,x,U){var j,J,G,he=0,se=U||[],ne=!1,q={p:0,n:0,v:a,a:Ie,f:Ie.bind(a,4),d:function(Fe,be){return j=Fe,J=0,G=a,q.n=be,s}};function Ie(ce,Fe){for(J=ce,G=Fe,i=0;!ne&&he&&!be&&i<se.length;i++){var be,Ke=se[i],gr=q.p,Bn=Ke[2];ce>3?(be=Bn===Fe)&&(G=Ke[(J=Ke[4])?5:(J=3,3)],Ke[4]=Ke[5]=a):Ke[0]<=gr&&((be=ce<2&&gr<Ke[1])?(J=0,q.v=Fe,q.n=Ke[1]):gr<Bn&&(be=ce<3||Ke[0]>Fe||Fe>Bn)&&(Ke[4]=ce,Ke[5]=Fe,q.n=Bn,J=0))}if(be||ce>1)return s;throw ne=!0,Fe}return function(ce,Fe,be){if(he>1)throw TypeError("Generator is already running");for(ne&&Fe===1&&Ie(Fe,be),J=Fe,G=be;(i=J<2?a:G)||!ne;){j||(J?J<3?(J>1&&(q.n=-1),Ie(J,G)):q.n=G:q.v=G);try{if(he=2,j){if(J||(ce="next"),i=j[ce]){if(!(i=i.call(j,G)))throw TypeError("iterator result is not an object");if(!i.done)return i;G=i.value,J<2&&(J=0)}else J===1&&(i=j.return)&&i.call(j),J<2&&(G=TypeError("The iterator does not provide a '"+ce+"' method"),J=1);j=a}else if((i=(ne=q.n<0)?G:I.call(x,q))!==s)break}catch(Ke){j=a,J=1,G=Ke}finally{he=1}}return{value:i,done:ne}}})(p,m,b),!0),A}var s={};function o(){}function l(){}function u(){}i=Object.getPrototypeOf;var c=[][e]?i(i([][e]())):(Ve(i={},e,function(){return this}),i),d=u.prototype=o.prototype=Object.create(c);function h(p){return Object.setPrototypeOf?Object.setPrototypeOf(p,u):(p.__proto__=u,Ve(p,n,"GeneratorFunction")),p.prototype=Object.create(d),p}return l.prototype=u,Ve(d,"constructor",u),Ve(u,"constructor",l),l.displayName="GeneratorFunction",Ve(u,n,"GeneratorFunction"),Ve(d),Ve(d,n,"Generator"),Ve(d,e,function(){return this}),Ve(d,"toString",function(){return"[object Generator]"}),(v=function(){return{w:r,m:h}})()}function Ve(a,i,t,e){var n=Object.defineProperty;try{n({},"",{})}catch(r){n=0}Ve=function(s,o,l,u){function c(d,h){Ve(s,d,function(p){return this._invoke(d,h,p)})}o?n?n(s,o,{value:l,enumerable:!u,configurable:!u,writable:!u}):s[o]=l:(c("next",0),c("throw",1),c("return",2))},Ve(a,i,t,e)}function _a(a,i,t,e,n,r,s){try{var o=a[r](s),l=o.value}catch(u){return void t(u)}o.done?i(l):Promise.resolve(l).then(e,n)}function w(a){return function(){var i=this,t=arguments;return new Promise(function(e,n){var r=a.apply(i,t);function s(l){_a(r,e,n,s,o,"next",l)}function o(l){_a(r,e,n,s,o,"throw",l)}s(void 0)})}}function ka(a,i){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(a);i&&(e=e.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),t.push.apply(t,e)}return t}function ie(a){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?ka(Object(t),!0).forEach(function(e){f(a,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):ka(Object(t)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))})}return a}function f(a,i,t){return(i=Yr(i))in a?Object.defineProperty(a,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[i]=t,a}function R(a){"@babel/helpers - typeof";return R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},R(a)}function E(a,i){if(!(a instanceof i))throw new TypeError("Cannot call a class as a function")}function Sa(a,i){for(var t=0;t<i.length;t++){var e=i[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(a,Yr(e.key),e)}}function C(a,i,t){return i&&Sa(a.prototype,i),t&&Sa(a,t),Object.defineProperty(a,"prototype",{writable:!1}),a}function Yr(a){var i=no(a,"string");return R(i)=="symbol"?i:i+""}function no(a,i){if(R(a)!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var e=t.call(a,i);if(R(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(a)}var S="classList",M="style",ro="unset",ao="html-wrapper",B=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div";return document.createElement(i)},so=(function(){function a(){E(this,a)}return C(a,null,[{key:"render",value:function(t,e){var n=B();n.id="error-view",n.innerText=e,t.replaceChildren(n)}}])})(),io=(function(){function a(){E(this,a)}return C(a,null,[{key:"onLoad",value:function(t){t.innerHTML='<div id="loading-validate-key-property"></div>'}},{key:"createElements",value:function(){var t=B();return t.id="validate-property-key-view",t}},{key:"render",value:function(t,e,n){var r=a.createElements(),s={onSuccess:e,onFail:so.render.bind(this,t,"Your 'key' has failed authentication"),onLoad:a.onLoad.bind(this,r)};n.key&&n.verifyKey(n.key,s),t.replaceChildren(r)}}])})(),ye="service",y="text",V="html",_="error",ue="https://deepchat.dev/docs/",me="ai",Z="user",rt="assistant",er="error-message-text",On="deep-chat-outer-container-role-",wa="empty-message",yr="deep-chat-top-message",Ea="deep-chat-middle-message",br="deep-chat-bottom-message",N="src",z="type",ve="file",T="files",le="image",pe="images",je="camera",Ut="gifs",ee="audio",et="microphone",As="mixedFiles",Ct="any",Ms="file-message",pt="start",Is="end",Rs="messages",Ca="0",Ta="1",P="role",L=function(i){return JSON.parse(JSON.stringify(i))};function Aa(a){return a.charAt(0).toUpperCase()+a.slice(1)}function oo(a){return a&&JSON.stringify(a)}function Qr(a,i,t,e){var n=`
`.concat(Aa(i)," message: ").concat(JSON.stringify(a),` 
`),r=t?"".concat(Aa(i)," message after interceptor: ").concat(oo(e),` 
`):"";return n+r}function lo(a,i,t,e){return"".concat(Qr(a,i,t,e),"Make sure the ").concat(i," message is using the Response format: ").concat(ue,`connect/#Response 
You can also augment it using the responseInterceptor property: `).concat(ue,"interceptors#responseInterceptor")}function uo(a,i,t){var e="response";return"".concat(Qr(a,e,i,t),"Make sure the ").concat(e,' message is using the {text: string} format, e.g: {text: "Model Response"}')}function co(a,i){var t="request";return"".concat(Qr(a,t,i),"Make sure the ").concat(t,' message is using the {body: {text: string}} format, e.g: {body: {text: "Model Response"}}')}function ho(a){return"".concat(a," failed - please wait for chat view to render before calling this property.")}var jt=lo,po=co,fo=uo,Ma=ho,we="Invalid API Key",He="Failed to connect",qe="Request settings have not been set up",sr="No file was added",ea="Image was not found",Ps="Multi-response arrays are not supported for streaming",xs=`Make sure the events are using {text: string} or {html: string} format.
You can also augment them using the responseInterceptor property: `.concat(ue,"interceptors#responseInterceptor"),mo="Cannot mix {text: string} and {html: string} responses.",vo=`No valid stream events were sent.
`.concat(xs),go="Readable Stream connection error.",vt="Please define a `function_handler` property inside the service config.",Tt="Function tool response must be an array or contain a text property",Bs="Failed to fetch history",Wt="inside-start",tt="inside-end",De="outside-start",Re="outside-end",Je="dropup-menu",O="default",Ne="hover",de="click",re="active",ae="disabled",Me=(function(){function a(){E(this,a)}return C(a,null,[{key:"unsetStyle",value:function(t,e){var n=Object.keys(e).reduce(function(r,s){return r[s]="",r},{});Object.assign(t[M],n)}},{key:"unsetActivityCSSMouseStates",value:function(t,e){e[de]&&a.unsetStyle(t,e[de]),e[Ne]&&a.unsetStyle(t,e[Ne])}},{key:"unsetAllCSSMouseStates",value:function(t,e){a.unsetActivityCSSMouseStates(t,e),e[O]&&a.unsetStyle(t,e[O])}},{key:"processStateful",value:function(t){var e=t[O]||{},n=Object.assign(L(e),t==null?void 0:t[Ne]),r=Object.assign(L(n),t==null?void 0:t[de]);return f(f(f({},O,e),Ne,n),de,r)}},{key:"mergeStatefulStyles",value:function(t){var e=f(f(f({},O,{}),Ne,{}),de,{});return t.forEach(function(n){e[O]=Object.assign(e[O],n[O]),e[Ne]=Object.assign(e[Ne],n[Ne]),e[de]=Object.assign(e[de],n[de])}),e}},{key:"overwriteDefaultWithAlreadyApplied",value:function(t,e){Object.keys(t[O]||[]).forEach(function(n){var r,s=n;e[M][s]&&(r=t[O])!=null&&r[s]&&(t[O][n]=e[M][s])})}},{key:"applyToStyleIfNotDefined",value:function(t,e){for(var n in e){var r=e[n];t[n]===""&&r&&(t[n]=r)}}}])})(),Ir=(function(){function a(){E(this,a)}return C(a,null,[{key:"attemptAppendStyleSheetToHead",value:function(t){if(!(t.fontFamily&&t.fontFamily!==a.DEFAULT_FONT_FAMILY)){var e=document.getElementsByTagName("head")[0];if(!Array.from(e.getElementsByTagName("link")).some(function(r){return r.getAttribute("href")===a.FONT_URL})){var n=B("link");n.rel="stylesheet",n.href=a.FONT_URL,e.appendChild(n)}}}}])})();Ir.FONT_URL="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",Ir.DEFAULT_FONT_FAMILY="'Inter', sans-serif, Avenir, Helvetica, Arial";var Os=Ir,Ls=(function(){function a(){E(this,a)}return C(a,null,[{key:"apply",value:function(t,e){if(e)try{a.applyStyleSheet(t,e)}catch(n){a.addStyleElement(t,e)}}},{key:"applyStyleSheet",value:function(t,e){var n=new CSSStyleSheet;n.replaceSync(t),e.adoptedStyleSheets.push(n)}},{key:"addStyleElement",value:function(t,e){var n=B("style");n.innerHTML=t,e.appendChild(n)}},{key:"applyDefaultStyleToComponent",value:function(t,e){e&&Me.applyToStyleIfNotDefined(t,e),Me.applyToStyleIfNotDefined(t,a.DEFAULT_COMPONENT_STYLE)}}])})();Ls.DEFAULT_COMPONENT_STYLE={height:"350px",width:"320px",borderTop:"1px solid #cacaca",borderRight:"1px solid #cacaca",borderLeft:"1px solid #cacaca",borderBottom:"1px solid #cacaca",fontFamily:Os.DEFAULT_FONT_FAMILY,fontSize:"0.9rem",backgroundColor:"white",position:"relative",overflow:"hidden"};var _r=Ls,Fs=(function(){function a(){E(this,a)}return C(a,null,[{key:"buildElement",value:function(){var t=B();t[S].add("tooltip");var e=B("span");return e[S].add("tooltip-text"),t.appendChild(e),t}},{key:"tryCreateConfig",value:function(t,e){if(e)return typeof e=="boolean"?f({},y,t):f(f(f({},y,e[y]||t),"timeout",e.timeout||0),"style",e[M])}},{key:"traverseParentUntilContainer",value:function(t){for(var e=t;e.parentElement;)e=e.parentElement;return e}},{key:"setPosition",value:function(t,e){var n=e.getRootNode().host.getBoundingClientRect(),r=t.getBoundingClientRect(),s=e.getBoundingClientRect().width/2,o=r.left+r.width/2;e[M].left="".concat(o-s-n.left,"px"),e[M].top="".concat(r.top-36-n.top,"px");var l=e.getBoundingClientRect();l.left<n.left?e[M].left="".concat(a.OVERFLOW_NEW_POSITION_PX,"px"):l.right>n.right&&(e[M].left="".concat(n.width-l.width-a.OVERFLOW_NEW_POSITION_PX,"px"))}},{key:"display",value:function(t,e,n){return n||(n=a.traverseParentUntilContainer(t).nextSibling),e[y]&&(n.children[0].textContent=e[y]),{timeout:setTimeout(function(){n[M].visibility="visible",a.setPosition(t,n),e[M]&&Object.assign(n[M],e[M])},e.timeout||0),element:n}}},{key:"hide",value:function(t,e){clearTimeout(t.timeout),t.element[M].visibility="hidden",e[M]&&Me.unsetStyle(t.element,e[M]),t.element[M].left="",t.element[M].top=""}}])})();Fs.OVERFLOW_NEW_POSITION_PX=4;var ut=Fs,qn=C(function a(){E(this,a)});qn.IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),qn.IS_CHROMIUM=window.chrome,qn.IS_MOBILE=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);var Ye=qn,Ae=(function(a){return a.ESCAPE="Escape",a.ENTER="Enter",a.TAB="Tab",a.ARROW_UP="ArrowUp",a.ARROW_DOWN="ArrowDown",a.ARROW_RIGHT="ArrowRight",a.ARROW_LEFT="ArrowLeft",a.BACKSPACE="Backspace",a.DELETE="Delete",a.META="Meta",a.CONTROL="Control",a})(Ae||{}),Ds=(function(){function a(){E(this,a)}return C(a,null,[{key:"add",value:function(t,e,n,r){n!==void 0&&t.addEventListener("keydown",a.onKeyDown.bind(this,n)),t.oninput=a.onInput.bind(this,n,r),t.addEventListener("paste",function(s){var o;s.preventDefault(),(o=s.clipboardData)!=null&&o[T].length&&e.addFilesToAnyType(Array.from(s.clipboardData[T]))})}},{key:"onKeyDown",value:function(t,e){var n=e.target.textContent;n&&n.length>=t&&!a.PERMITTED_KEYS.has(e.key)&&!a.isKeyCombinationPermitted(e)&&e.preventDefault()}},{key:"isKeyCombinationPermitted",value:function(t){return t.key==="a"?t.ctrlKey||t.metaKey:!1}},{key:"onInput",value:function(t,e,n){var r=n.target,s=r.textContent||"";t!==void 0&&s.length>t&&(r.textContent=s.substring(0,t),Mn.focusEndOfInput(r)),e==null||e()}}])})();Ds.PERMITTED_KEYS=new Set([Ae.BACKSPACE,Ae.DELETE,Ae.ARROW_RIGHT,Ae.ARROW_LEFT,Ae.ARROW_DOWN,Ae.ARROW_UP,Ae.META,Ae.CONTROL,Ae.ENTER]);var yo=Ds,bo=(function(){function a(){E(this,a)}return C(a,null,[{key:"sanitizePastedTextContent",value:function(t){var e,n;t.preventDefault();var r=(e=t.clipboardData)==null?void 0:e.getData("text/plain");r&&((n=document.execCommand)==null||n.call(document,"insertText",!1,r))}}])})(),Ns=(function(){function a(i,t,e,n){var r=this;E(this,a);var s,o,l,u;this._isComposing=!1;var c=a.processConfig(t,i.textInput);this.elementRef=a.createContainerElement((s=c==null?void 0:c.styles)==null?void 0:s.container),this._config=c,this.inputElementRef=this.createInputElement((o=i.defaultInput)==null?void 0:o[y],n),a.addFilesToAnyType(e,(l=i.defaultInput)==null?void 0:l[T]),this.elementRef.appendChild(this.inputElementRef),i.setPlaceholderText=this.setPlaceholderText.bind(this),i.setPlaceholderText(((u=this._config.placeholder)==null?void 0:u[y])||"Ask me anything!"),this._browserStorage=n,setTimeout(function(){yo.add(r.inputElementRef,e,r._config.characterLimit,i._validationHandler),r._onInput=t.onInput})}return C(a,[{key:"clear",value:function(){var t,e,n,r=window.scrollY;this.inputElementRef[S].contains("text-input-".concat(ae))||(Object.assign(this.inputElementRef[M],(t=this._config.placeholder)==null?void 0:t[M]),this.inputElementRef.textContent="",Mn.focusEndOfInput(this.inputElementRef),(e=this._onInput)==null||e.call(this,!1),(n=this._browserStorage)==null||n.addInputText("")),Ye.IS_CHROMIUM&&window.scrollTo({top:r})}},{key:"createInputElement",value:function(t,e){var n,r,s,o,l=B();return l.id=a.TEXT_INPUT_ID,l[S].add("text-input-styling"),l[P]="textbox",typeof t=="string"?l.innerText=t:e!=null&&e.trackInputText&&(l.innerText=e.get().inputText||""),Ye.IS_MOBILE&&l.setAttribute("tabindex","0"),Ye.IS_CHROMIUM&&a.preventAutomaticScrollUpOnNewLine(l),typeof this._config[ae]=="boolean"&&this._config[ae]===!0?(l.contentEditable="false",l[S].add("text-input-".concat(ae)),l.setAttribute("aria-".concat(ae),"true")):(l.contentEditable="true",l.removeAttribute("aria-".concat(ae)),this.addEventListeners(l)),Object.assign(l[M],(n=this._config.styles)==null?void 0:n[y]),Object.assign(l[M],(r=this._config.placeholder)==null?void 0:r[M]),(o=(s=this._config.placeholder)==null?void 0:s[M])!=null&&o.color||l.setAttribute("textcolor",""),l}},{key:"removePlaceholderStyle",value:function(){var t,e,n,r;!this.inputElementRef[S].contains("text-input-".concat(ae))&&(t=this._config.placeholder)!=null&&t[M]&&(Me.unsetStyle(this.inputElementRef,(e=this._config.placeholder)==null?void 0:e[M]),Object.assign(this.inputElementRef[M],(r=(n=this._config)==null?void 0:n.styles)==null?void 0:r[y]))}},{key:"addEventListeners",value:function(t){var e=this,n,r;(n=this._config.styles)!=null&&n.focus&&(t.onfocus=function(){var s;return Object.assign(e.elementRef[M],(s=e._config.styles)==null?void 0:s.focus)},t.onblur=this.onBlur.bind(this,this._config.styles.focus,(r=this._config.styles)==null?void 0:r.container)),t.addEventListener("keydown",this.onKeydown.bind(this)),t.addEventListener("input",this.onInput.bind(this)),t.addEventListener("paste",bo.sanitizePastedTextContent),t.addEventListener("compositionstart",function(){return e._isComposing=!0}),t.addEventListener("compositionend",function(){return e._isComposing=!1})}},{key:"onBlur",value:function(t,e){Me.unsetStyle(this.elementRef,t),e&&Object.assign(this.elementRef[M],e)}},{key:"onKeydown",value:function(t){var e;t.key===Ae.ENTER&&!Ye.IS_MOBILE&&!this._isComposing&&!t.ctrlKey&&!t.shiftKey&&(t.preventDefault(),(e=this.submit)==null||e.call(this))}},{key:"onInput",value:function(){var t,e;this.isTextInputEmpty()?Object.assign(this.inputElementRef[M],(t=this._config.placeholder)==null?void 0:t[M]):this.removePlaceholderStyle(),(e=this._onInput)==null||e.call(this,!0)}},{key:"setPlaceholderText",value:function(t){this.inputElementRef.setAttribute("deep-chat-placeholder-text",t),this.inputElementRef.setAttribute("aria-label",t)}},{key:"isTextInputEmpty",value:function(){return this.inputElementRef.textContent===""}}],[{key:"processConfig",value:function(t,e){var n,r,s,o;return e!=null||(e={}),(n=e[ae])!==null&&n!==void 0||(e[ae]=t.isTextInputDisabled),(r=e.placeholder)!==null&&r!==void 0||(e.placeholder={}),(s=(o=e.placeholder)[y])!==null&&s!==void 0||(o[y]=t.textInputPlaceholderText),e}},{key:"createContainerElement",value:function(t){var e=B();return e.id="text-input-container",Object.assign(e[M],t),e}},{key:"preventAutomaticScrollUpOnNewLine",value:function(t){var e;t.addEventListener("keydown",function(){e=window.scrollY}),t.addEventListener("input",function(){e!==window.scrollY&&window.scrollTo({top:e})})}},{key:"addFilesToAnyType",value:function(t,e){e&&t.addFilesToAnyType(Array.from(e).map(function(n){return n}))}}])})();Ns.TEXT_INPUT_ID="text-input";var Us=Ns,Mn=(function(){function a(){E(this,a)}return C(a,null,[{key:"focusEndOfInput",value:function(t){var e=document.createRange();e.selectNodeContents(t),e.collapse(!1);var n=window.getSelection();n==null||n.removeAllRanges(),n==null||n.addRange(e),(Ye.IS_MOBILE||Ye.IS_SAFARI)&&t.focus()}},{key:"focusFromParentElement",value:function(t){var e=t.querySelector("#".concat(Us.TEXT_INPUT_ID));e&&a.focusEndOfInput(e)}}])})(),js="Authentication",ke="Authorization",_o="authorization",ir="Unauthorized",ta="Authorization header",gt="Invalid",xn="Incorrect",Oe="authentication_error",Qe="invalid_request_error",te="Content-Type",ko="content-type",fe="application/json",Q="object",na="completed",Be="Bearer ",Se="GET",Te="POST",ra="Upload an audio file",zn="function_call",kt="input_audio",ze="image_url",Hs=(function(){function a(){E(this,a)}return C(a,null,[{key:"addElements",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];n.forEach(function(s){return t.appendChild(s)})}},{key:"isScrollbarAtBottomOfElement",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a.CODE_SNIPPET_GENERATION_JUMP,n=t.scrollHeight,r=t.clientHeight,s=t.scrollTop,o=n-r;return s>=o-e}},{key:"cloneElement",value:function(t){var e=t.cloneNode(!0);return t.parentNode.replaceChild(e,t),e}},{key:"scrollToBottom",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2?arguments[2]:void 0;t.scrollButton&&t.scrollButton.hiddenElements.size>0&&t.scrollButton.clearHidden(),n?t.elementRef.scrollTo({left:0,top:n.offsetTop}):e?t.elementRef.scrollTo({left:0,top:t.elementRef.scrollHeight,behavior:"smooth"}):t.elementRef.scrollTop=t.elementRef.scrollHeight}},{key:"scrollToTop",value:function(t){t.scrollTop=0}},{key:"isVisibleInParent",value:function(t,e){var n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return n.bottom>r.top&&n.top<r.bottom}},{key:"waitForScrollEnd",value:function(t,e){var n=-1,r=0,s=function(){var l=t.scrollTop;if(l===n){if(r++,r>2){e();return}}else r=0,n=l;requestAnimationFrame(s)};requestAnimationFrame(s)}},{key:"assignButtonEvents",value:function(t,e){t.onclick=e,t.onkeydown=function(n){n.key===Ae.ENTER&&setTimeout(e)}}}])})();Hs.CODE_SNIPPET_GENERATION_JUMP=1;var oe=Hs,qs=(function(){function a(){E(this,a)}return C(a,null,[{key:"speak",value:function(t,e){if(!e.audio&&window.SpeechSynthesisUtterance){var n=new SpeechSynthesisUtterance(t);Object.assign(n,e),speechSynthesis.speak(n)}}},{key:"processConfig",value:function(t,e){var n={};setTimeout(function(){if(R(t)=="object"&&(t.audio&&(n.audio=t.audio),t.lang&&(n.lang=t.lang),t.pitch&&(n.pitch=t.pitch),t.rate&&(n.rate=t.rate),t.volume&&(n.volume=t.volume),t.voiceName)){var r=window.speechSynthesis.getVoices().find(function(s){var o;return s.name.toLocaleLowerCase()===((o=t.voiceName)==null?void 0:o.toLocaleLowerCase())});r&&(n.voice=r)}e(n)},a.LOAD_VOICES_MS)}}])})();qs.LOAD_VOICES_MS=200;var Wn=qs,Rr=(function(){function a(){E(this,a)}return C(a,null,[{key:"colorToHex",value:function(t){var e=B();return e[M].color=t,document.body.appendChild(e),"#".concat(window.getComputedStyle(e).color.match(/\d+/g).map(function(n){return parseInt(n).toString(16).padStart(2,"0")}).join(""))}},{key:"setDots",value:function(t,e){var n,r;if((r=(n=e==null?void 0:e.styles)==null?void 0:n.bubble)!=null&&r.color){var s=a.colorToHex(e.styles.bubble.color);t[M].setProperty("--loading-message-color",s),t[M].setProperty("--loading-message-color-fade","".concat(s,"33"))}else t[M].setProperty("--loading-message-color","#848484"),t[M].setProperty("--loading-message-color-fade","#55555533")}},{key:"setRing",value:function(t,e){var n=e||{},r=n.color,s=n.width,o=n.height,l=n.margin,u=n.border;if(r){var c=a.colorToHex(r);t[M].setProperty("--loading-history-color",c)}else t[M].setProperty("--loading-history-color","#dbdbdb");t[M].setProperty("--loading-history-height",o||"57px"),t[M].setProperty("--loading-history-width",s||"57px"),t[M].setProperty("--loading-history-margin",l||"7px"),t[M].setProperty("--loading-history-border",u||"6px solid")}}])})();Rr.BUBBLE_CLASS="deep-chat-loading-message-bubble",Rr.DOTS_CONTAINER_CLASS="deep-chat-loading-message-dots-container";var dt=Rr,_e=(function(){function a(){E(this,a)}return C(a,null,[{key:"checkForContainerStyles",value:function(t,e){var n=t.containerStyle;n&&(Object.assign(e[M],n),console[_]("The containerStyle property".concat(Xe,"1.3.14.")),console[_]("".concat(yt,"the style property instead: ").concat(ue,"styles#style")))}},{key:"handleResponseProperty",value:function(t){return console[_]("The {result: ....} response object type".concat(Xe,"1.3.0.")),console[_]("".concat(yt,"the new response object: ").concat(ue,"connect#Response")),t.result}},{key:"processHistory",value:function(t){var e=t.initialMessages;if(e)return console[_]("The initialMessages property".concat(Xe,"2.0.0.")),console[_]("".concat(yt,"the history property instead: ").concat(ue,"messages/#history")),e}},{key:"processHistoryFile",value:function(t){var e=t[ve];e&&(console[_]("The file property in MessageContent".concat(Xe,"1.3.17.")),console[_]("".concat(yt,"the files array property: ").concat(ue,"messages/#MessageContent")),t[T]=[e])}},{key:"processValidateInput",value:function(t){var e=t.validateMessageBeforeSending;if(e)return console[_]("The validateMessageBeforeSending property".concat(Xe,"1.3.24.")),console[_]("".concat(yt,"validateInput: ").concat(ue,"interceptors#validateInput")),e}},{key:"processSubmitUserMessage",value:function(t){return console[_]("The submitUserMessage(text: string) argument string type".concat(Xe,"1.4.4.")),console[_]("".concat(yt,"the new argument type: ").concat(ue,"methods#submitUserMessage")),f({},y,t)}},{key:"flagHTMLUpdateClass",value:function(t){var e;(e=t.children[0])!=null&&e[S].contains("deep-chat-update-message")&&(console[_]('The "deep-chat-update-message" html class'.concat(Xe,"1.4.4.")),console[_]("".concat(yt,"using {..., overwrite: true} object: ").concat(ue,"connect#Response")))}},{key:"processConnect",value:function(t){var e=t;e.request&&(e.connect?Object.assign(e.connect,e.request):e.connect=e.request,console[_]("The request property".concat(Xe,"2.0.0.")),console[_]("".concat(Ln,"connect object: ").concat(ue,"connect#connect-1")))}},{key:"checkForStream",value:function(t){var e=t.stream;if(e)return console[_]("The stream property".concat(Ra,"the connect object in version 2.0.0.")),console[_]("".concat(Ln,"connect object: ").concat(ue,"connect#connect-1")),e}},{key:"fireOnNewMessage",value:function(t,e){var n,r=t;r.onNewMessage&&(console[_]("The onNewMessage event".concat(Xe,"2.0.0.")),console[_]("".concat(Ln,"onMessage event: ").concat(ue,"events#onMessage")),(n=r.onNewMessage)==null||n.call(r,e)),t.dispatchEvent(new CustomEvent("new-message",{detail:e}))}},{key:"processFileConfigConnect",value:function(t){var e=t;e.request&&(console[_]("The request property in file configuration".concat(Xe,"2.0.0.")),console[_]("Please use the connect property instead: ".concat(ue,"files")),e.connect||(e.connect=e.request))}},{key:"processMessageStyles",value:function(t){if(t){var e=L(t),n=e.loading;return n&&(n.outerContainer||n.innerContainer||n.bubble||n.media)&&(console[_]("The loading message styles are defined using LoadingMessageStyles interface".concat(Nt,"2.1.0.")),console[_]("Check it out here: ".concat(ue,"messages/styles#LoadingMessageStyles")),e.loading={message:{styles:n}}),e}}},{key:"processDemo",value:function(t){return typeof t=="boolean"||t.displayLoadingBubble&&(console[_]("The demo displayLoadingBubble property".concat(Xe,"2.1.0.")),console[_]("Please use displayLoading instead: ".concat(ue,"modes#demo")),t.displayLoading={message:!0}),t}},{key:"processCohere",value:function(t){var e=t,n="".concat(Ln,"official documentation: ").concat(ue,"directConnection/Cohere");return e.chat&&(console[_]("Cohere chat property".concat(Xe,"2.2.3.")),console[_](n),delete e.chat),e.textGeneration?(console[_]("Cohere textGeneration".concat(Ia,"2.2.3.")),console[_](n),delete e.textGeneration,!1):e.summarization?(console[_]("Cohere summarization".concat(Ia,"2.2.3.")),console[_](n),delete e.summarization,!1):!0}},{key:"processStreamHTMLWrappers",value:function(t){if(!(!t||R(t)!==Q)){var e=t.htmlWrappers;if(e)return console[_]("The htmlWrappers property".concat(Ra,"Deep Chat's base").concat(Nt,"2.3.0.")),console[_]("Check it out here: ".concat(ue,"messages/HTML#htmlWrappers")),e}}},{key:"processFocusMode",value:function(t){return!t||typeof t=="boolean"||t.scroll&&(console[_]("The scroll property in focusMode has been changed to smoothScroll".concat(Nt,"2.3.0.")),console[_]("Check it out here: ".concat(ue,"modes#focusMode")),t.smoothScroll=!0),t}},{key:"processPosition",value:function(t){if(!t)return t;var e="Position names have been updated".concat(Nt,"2.3.1.");return t==="inside-left"?(console[_](e),Wt):t==="inside-right"?(console[_](e),tt):t==="outside-left"?(console[_](e),De):t==="outside-right"?(console[_](e),Re):t}},{key:"processBrowserStorage",value:function(t){var e=t.get();e&&Array.isArray(e)&&t.addMessages(e)}}])})(),Nt=" since version ",Xe=" is deprecated ".concat(Nt),yt="Please change to using ",Ln="Please see the ",Ia=" is not supported ".concat(Nt),Ra=" has been moved to ",or=(function(){function a(){E(this,a)}return C(a,null,[{key:"mouseUp",value:function(t,e){Me.unsetAllCSSMouseStates(t,e),Object.assign(t[M],e[O]),Object.assign(t[M],e[Ne])}},{key:"mouseDown",value:function(t,e){Object.assign(t[M],e[de])}},{key:"mouseLeave",value:function(t,e){Me.unsetAllCSSMouseStates(t,e),Object.assign(t[M],e[O])}},{key:"mouseEnter",value:function(t,e){Object.assign(t[M],e[Ne])}},{key:"add",value:function(t,e){t.addEventListener("mouseenter",a.mouseEnter.bind(this,t,e)),t.addEventListener("mouseleave",a.mouseLeave.bind(this,t,e)),t.addEventListener("mousedown",a.mouseDown.bind(this,t,e)),t.addEventListener("mouseup",a.mouseUp.bind(this,t,e))}}])})(),So="deep-chat-temporary-message",wo="deep-chat-suggestion-button",Pr={"deep-chat-button":{styles:f(f(f({},O,{backgroundColor:"white",padding:"5px",paddingLeft:"7px",paddingRight:"7px",border:"1px solid #c2c2c2",borderRadius:"6px",cursor:"pointer"}),Ne,{backgroundColor:"#fafafa"}),de,{backgroundColor:"#f1f1f1"})}},Pa=Object.keys(Pr),Ht=(function(){function a(){E(this,a)}return C(a,null,[{key:"applySuggestionEvent",value:function(t,e){setTimeout(function(){e.addEventListener(de,function(){var n,r;(r=t.submitUserMessage)==null||r.call(t,f({},y,((n=e.textContent)==null?void 0:n.trim())||""))})})}},{key:"isElementTemporary",value:function(t){var e;return t?(e=t.bubbleElement.children[0])==null?void 0:e[S].contains(So):!1}},{key:"doesElementContainDeepChatClass",value:function(t){return Pa.find(function(e){return t[S].contains(e)})}},{key:"applyEvents",value:function(t,e){var n=Pr[e].events;Object.keys(n||[]).forEach(function(r){t.addEventListener(r,n==null?void 0:n[r])})}},{key:"getProcessedStyles",value:function(t,e,n){var r=Array.from(e[S]).reduce(function(u,c){var d,h=(d=t[c])==null?void 0:d.styles;return h&&t[c].styles&&u.push(h),u},[]),s=Pr[n].styles;if(s){var o=L(s);o[O]&&Me.overwriteDefaultWithAlreadyApplied(o,e),r.unshift(o)}var l=Me.mergeStatefulStyles(r);return Me.processStateful(l)}},{key:"applyDeepChatUtilities",value:function(t,e,n){Pa.forEach(function(s){var o=n.getElementsByClassName(s);Array.from(o||[]).forEach(function(l){var u=a.getProcessedStyles(e,l,s);Le.applyStylesToElement(l,u),a.applyEvents(l,s)})});var r=n.getElementsByClassName(wo);Array.from(r).forEach(function(s){return a.applySuggestionEvent(t,s)})}}])})(),Le=(function(){function a(){E(this,a)}return C(a,null,[{key:"applyStylesToElement",value:function(t,e){var n=Me.processStateful(e);or.add(t,n),Object.assign(t[M],n[O])}},{key:"applyEventsToElement",value:function(t,e){Object.keys(e).forEach(function(n){var r=e[n];r&&t.addEventListener(n,r)})}},{key:"applyClassUtilitiesToElement",value:function(t,e){var n=e.events,r=e.styles;n&&a.applyEventsToElement(t,n),r&&!Ht.doesElementContainDeepChatClass(t)&&a.applyStylesToElement(t,r)}},{key:"applyCustomClassUtilities",value:function(t,e){Object.keys(t).forEach(function(n){var r=e.getElementsByClassName(n);Array.from(r).forEach(function(s){t[n]&&a.applyClassUtilitiesToElement(s,t[n])})})}},{key:"apply",value:function(t,e){Ht.applyDeepChatUtilities(t,t.htmlClassUtilities,e),a.applyCustomClassUtilities(t.htmlClassUtilities,e)}},{key:"traverseNodes",value:function(t,e){t.nodeType===Node.ELEMENT_NODE&&e.push(t.outerHTML),t.childNodes.forEach(function(n){a.traverseNodes(n,e)})}},{key:"splitHTML",value:function(t){var e=new DOMParser().parseFromString(t,"text/html"),n=[];return e.body.childNodes.forEach(function(r){a.traverseNodes(r,n)}),n}},{key:"isTemporaryBasedOnHTML",value:function(t){var e=B();return e.innerHTML=t,Ht.isElementTemporary({outerContainer:e,bubbleElement:e,innerContainer:e})}},{key:"replaceElementWithNewClone",value:function(t,e){var n,r=(e||t).cloneNode(!0);return(n=t.parentNode)==null||n.replaceChild(r,t),r}},{key:"tryAddWrapper",value:function(t,e,n,r){if(e&&r){var s=(n==null?void 0:n[r])||(n==null?void 0:n[O]);if(s)return t.innerHTML=s,{contentEl:a.getTargetWrapper(t),wrapper:!0}}return{contentEl:t,wrapper:!1}}},{key:"getTargetWrapper",value:function(t){return t.getElementsByClassName(ao)[0]||t}}])})(),zs=(function(){function a(){E(this,a)}return C(a,null,[{key:"createElements",value:function(t,e,n,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,o=t.createMessageElementsOnOrientation("",n,r,s);o.bubbleElement[S].add(a.HTML_BUBBLE_CLASS);var l=Le.tryAddWrapper(o.bubbleElement,e,t._customWrappers,n),u=l.contentEl;return u.innerHTML=e,o}},{key:"overwriteElements",value:function(t,e,n){n.bubbleElement.innerHTML=e,Le.apply(t,n.outerContainer),_e.flagHTMLUpdateClass(n.bubbleElement)}},{key:"overwrite",value:function(t,e,n,r){var s=t.messageToElements,o=ge.overwriteMessage(s,r,e,n,V,a.HTML_BUBBLE_CLASS);return o&&a.overwriteElements(t,e,o),o}},{key:"create",value:function(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s,o=a.createElements(t,e,n,r);return ge.fillEmptyMessageElement(o.bubbleElement,e),Le.apply(t,o.outerContainer),_e.flagHTMLUpdateClass(o.bubbleElement),t.applyCustomStyles(o,n,!1,(s=t.messageStyles)==null?void 0:s[V]),o}},{key:"add",value:function(t,e,n,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(r!=null&&r.status){var o=this.overwrite(t,e,n,t.messageElementRefs);if(o)return o;r.status=!1}if(!(s&&t.messageElementRefs.length>0&&Le.isTemporaryBasedOnHTML(e))){var l=a.create(t,e,n,s);return s||t.appendOuterContainerElemet(l.outerContainer),l}}}])})();zs.HTML_BUBBLE_CLASS="html-message";var ft=zs,Eo=(function(){function a(){E(this,a)}return C(a,null,[{key:"katex",value:function(t,e,n){var r=(n||{}).delimiter||"$";if(r.length!==1)throw new Error("invalid delimiter");var s=function(c,d){var h;return((h=window.katex)==null?void 0:h.renderToString(c,ie({displayMode:d,throwOnError:!1,output:"mathml"},t)))||""},o=function(c,d,h){var p=!1,g=c.bMarks[d]+c.tShift[d],m=c.eMarks[d];if(g+1>m)return!1;var b=c[N].charAt(g);if(b!==r)return!1;var k=g;g=c.skipChars(g,b);var A=g-k;if(A!==2)return!1;for(var I=d;++I,!(I>=h||(g=k=c.bMarks[I]+c.tShift[I],m=c.eMarks[I],g<m&&c.tShift[I]<c.blkIndent));)if(c[N].charAt(g)===r&&!(c.tShift[I]-c.blkIndent>=4)&&(g=c.skipChars(g,b),!(g-k<A)&&(g=c.skipSpaces(g),!(g<m)))){p=!0;break}A=c.tShift[d],c.line=I+(p?1:0);var x=c.getLines(d+1,I,A,!0).replace(/[ \n]+/g," ").trim();return c.tokens.push({type:"katex",params:null,content:x,lines:[d,c.line],level:c.level,block:!0}),!0},l=function(c,d){var h=c.pos,p=c.posMax,g=h;if(c[N].charAt(g)!==r)return!1;for(++g;g<p&&c[N].charAt(g)===r;)++g;var m=c[N].slice(h,g);if(m.length>2)return!1;for(var b=g,k=0;g<p;){var A=c[N].charAt(g);if(A==="{"&&(g===0||c[N].charAt(g-1)!=="\\"))k+=1;else if(A==="}"&&(g===0||c[N].charAt(g-1)!=="\\")){if(k-=1,k<0)return!1}else if(A===r&&k===0){for(var I=g,x=g+1;x<p&&c[N].charAt(x)===r;)++x;if(x-I===m.length){if(!d){var U=c[N].slice(b,I).replace(/[ \n]+/g," ").trim();c.push({type:"katex",content:U,block:m.length>1,level:c.level})}return c.pos=x,!0}}g+=1}return d||(c.pending+=m),c.pos+=m.length,!0};e.inline.ruler.push("katex",l,n),e.block.ruler.push("katex",o,n),e.renderer.rules.katex=function(u,c){return s(u[c].content,u[c].block)},e.renderer.rules.katex.delimiter=r}}])})(),Fn;function Ws(a){return Fn=Fn||document.createElement("textarea"),Fn.innerHTML="&"+a+";",Fn.value}var Co=Object.prototype.hasOwnProperty;function To(a,i){return a?Co.call(a,i):!1}function Gs(a){var i=[].slice.call(arguments,1);return i.forEach(function(t){if(t){if(R(t)!="object")throw new TypeError(t+"must be object");Object.keys(t).forEach(function(e){a[e]=t[e]})}}),a}var Ao=/\\([\\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function In(a){return a.indexOf("\\")<0?a:a.replace(Ao,"$1")}function Ks(a){return!(a>=55296&&a<=57343||a>=64976&&a<=65007||(a&65535)===65535||(a&65535)===65534||a>=0&&a<=8||a===11||a>=14&&a<=31||a>=127&&a<=159||a>1114111)}function xr(a){if(a>65535){a-=65536;var i=55296+(a>>10),t=56320+(a&1023);return String.fromCharCode(i,t)}return String.fromCharCode(a)}var Mo=/&([a-z#][a-z0-9]{1,31});/gi,Io=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;function Ro(a,i){var t=0,e=Ws(i);return i!==e?e:i.charCodeAt(0)===35&&Io.test(i)&&(t=i[1].toLowerCase()==="x"?parseInt(i.slice(2),16):parseInt(i.slice(1),10),Ks(t))?xr(t):a}function At(a){return a.indexOf("&")<0?a:a.replace(Mo,Ro)}var Po=/[&<>"]/,xo=/[&<>"]/g,Bo={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function Oo(a){return Bo[a]}function We(a){return Po.test(a)?a.replace(xo,Oo):a}var H={};H.blockquote_open=function(){return`<blockquote>
`};H.blockquote_close=function(a,i){return"</blockquote>"+It(a,i)};H.code=function(a,i){return a[i].block?"<pre><code>"+We(a[i].content)+"</code></pre>"+It(a,i):"<code>"+We(a[i].content)+"</code>"};H.fence=function(a,i,t,e,n){var r=a[i],s="",o=t.langPrefix,l="",u,c,d;if(r.params){if(u=r.params.split(/\s+/g),c=u.join(" "),To(n.rules.fence_custom,u[0]))return n.rules.fence_custom[u[0]](a,i,t,e,n);l=We(At(In(c))),s=' class="'+o+l+'"'}return t.highlight?d=t.highlight.apply(t.highlight,[r.content].concat(u))||We(r.content):d=We(r.content),"<pre><code"+s+">"+d+"</code></pre>"+It(a,i)};H.fence_custom={};H.heading_open=function(a,i){return"<h"+a[i].hLevel+">"};H.heading_close=function(a,i){return"</h"+a[i].hLevel+`>
`};H.hr=function(a,i,t){return(t.xhtmlOut?"<hr />":"<hr>")+It(a,i)};H.bullet_list_open=function(){return`<ul>
`};H.bullet_list_close=function(a,i){return"</ul>"+It(a,i)};H.list_item_open=function(){return"<li>"};H.list_item_close=function(){return`</li>
`};H.ordered_list_open=function(a,i){var t=a[i],e=t.order>1?' start="'+t.order+'"':"";return"<ol"+e+`>
`};H.ordered_list_close=function(a,i){return"</ol>"+It(a,i)};H.paragraph_open=function(a,i){return a[i].tight?"":"<p>"};H.paragraph_close=function(a,i){var t=!(a[i].tight&&i&&a[i-1].type==="inline"&&!a[i-1].content);return(a[i].tight?"":"</p>")+(t?It(a,i):"")};H.link_open=function(a,i,t){var e=a[i].title?' title="'+We(At(a[i].title))+'"':"",n=t.linkTarget?' target="'+t.linkTarget+'"':"";return'<a href="'+We(a[i].href)+'"'+e+n+">"};H.link_close=function(){return"</a>"};H.image=function(a,i,t){var e=' src="'+We(a[i].src)+'"',n=a[i].title?' title="'+We(At(a[i].title))+'"':"",r=' alt="'+(a[i].alt?We(At(In(a[i].alt))):"")+'"',s=t.xhtmlOut?" /":"";return"<img"+e+r+n+s+">"};H.table_open=function(){return`<table>
`};H.table_close=function(){return`</table>
`};H.thead_open=function(){return`<thead>
`};H.thead_close=function(){return`</thead>
`};H.tbody_open=function(){return`<tbody>
`};H.tbody_close=function(){return`</tbody>
`};H.tr_open=function(){return"<tr>"};H.tr_close=function(){return`</tr>
`};H.th_open=function(a,i){var t=a[i];return"<th"+(t.align?' style="text-align:'+t.align+'"':"")+">"};H.th_close=function(){return"</th>"};H.td_open=function(a,i){var t=a[i];return"<td"+(t.align?' style="text-align:'+t.align+'"':"")+">"};H.td_close=function(){return"</td>"};H.strong_open=function(){return"<strong>"};H.strong_close=function(){return"</strong>"};H.em_open=function(){return"<em>"};H.em_close=function(){return"</em>"};H.del_open=function(){return"<del>"};H.del_close=function(){return"</del>"};H.ins_open=function(){return"<ins>"};H.ins_close=function(){return"</ins>"};H.mark_open=function(){return"<mark>"};H.mark_close=function(){return"</mark>"};H.sub=function(a,i){return"<sub>"+We(a[i].content)+"</sub>"};H.sup=function(a,i){return"<sup>"+We(a[i].content)+"</sup>"};H.hardbreak=function(a,i,t){return t.xhtmlOut?`<br />
`:`<br>
`};H.softbreak=function(a,i,t){return t.breaks?t.xhtmlOut?`<br />
`:`<br>
`:`
`};H.text=function(a,i){return We(a[i].content)};H.htmlblock=function(a,i){return a[i].content};H.htmltag=function(a,i){return a[i].content};H.abbr_open=function(a,i){return'<abbr title="'+We(At(a[i].title))+'">'};H.abbr_close=function(){return"</abbr>"};H.footnote_ref=function(a,i){var t=Number(a[i].id+1).toString(),e="fnref"+t;return a[i].subId>0&&(e+=":"+a[i].subId),'<sup class="footnote-ref"><a href="#fn'+t+'" id="'+e+'">['+t+"]</a></sup>"};H.footnote_block_open=function(a,i,t){var e=t.xhtmlOut?`<hr class="footnotes-sep" />
`:`<hr class="footnotes-sep">
`;return e+`<section class="footnotes">
<ol class="footnotes-list">
`};H.footnote_block_close=function(){return`</ol>
</section>
`};H.footnote_open=function(a,i){var t=Number(a[i].id+1).toString();return'<li id="fn'+t+'"  class="footnote-item">'};H.footnote_close=function(){return`</li>
`};H.footnote_anchor=function(a,i){var t=Number(a[i].id+1).toString(),e="fnref"+t;return a[i].subId>0&&(e+=":"+a[i].subId),' <a href="#'+e+'" class="footnote-backref">â†©</a>'};H.dl_open=function(){return`<dl>
`};H.dt_open=function(){return"<dt>"};H.dd_open=function(){return"<dd>"};H.dl_close=function(){return`</dl>
`};H.dt_close=function(){return`</dt>
`};H.dd_close=function(){return`</dd>
`};function Vs(a,i){return++i>=a.length-2?i:a[i].type==="paragraph_open"&&a[i].tight&&a[i+1].type==="inline"&&a[i+1].content.length===0&&a[i+2].type==="paragraph_close"&&a[i+2].tight?Vs(a,i+2):i}var It=H.getBreak=function(a,i){return i=Vs(a,i),i<a.length&&a[i].type==="list_item_close"?"":`
`};function aa(){this.rules=Gs({},H),this.getBreak=H.getBreak}aa.prototype.renderInline=function(a,i,t){for(var e=this.rules,n=a.length,r=0,s="";n--;)s+=e[a[r].type](a,r++,i,t,this);return s};aa.prototype.render=function(a,i,t){for(var e=this.rules,n=a.length,r=-1,s="";++r<n;)a[r].type==="inline"?s+=this.renderInline(a[r].children,i,t):s+=e[a[r].type](a,r,i,t,this);return s};function $e(){this.__rules__=[],this.__cache__=null}$e.prototype.__find__=function(a){for(var i=this.__rules__.length,t=-1;i--;)if(this.__rules__[++t].name===a)return t;return-1};$e.prototype.__compile__=function(){var a=this,i=[""];a.__rules__.forEach(function(t){t.enabled&&t.alt.forEach(function(e){i.indexOf(e)<0&&i.push(e)})}),a.__cache__={},i.forEach(function(t){a.__cache__[t]=[],a.__rules__.forEach(function(e){e.enabled&&(t&&e.alt.indexOf(t)<0||a.__cache__[t].push(e.fn))})})};$e.prototype.at=function(a,i,t){var e=this.__find__(a),n=t||{};if(e===-1)throw new Error("Parser rule not found: "+a);this.__rules__[e].fn=i,this.__rules__[e].alt=n.alt||[],this.__cache__=null};$e.prototype.before=function(a,i,t,e){var n=this.__find__(a),r=e||{};if(n===-1)throw new Error("Parser rule not found: "+a);this.__rules__.splice(n,0,{name:i,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null};$e.prototype.after=function(a,i,t,e){var n=this.__find__(a),r=e||{};if(n===-1)throw new Error("Parser rule not found: "+a);this.__rules__.splice(n+1,0,{name:i,enabled:!0,fn:t,alt:r.alt||[]}),this.__cache__=null};$e.prototype.push=function(a,i,t){var e=t||{};this.__rules__.push({name:a,enabled:!0,fn:i,alt:e.alt||[]}),this.__cache__=null};$e.prototype.enable=function(a,i){a=Array.isArray(a)?a:[a],i&&this.__rules__.forEach(function(t){t.enabled=!1}),a.forEach(function(t){var e=this.__find__(t);if(e<0)throw new Error("Rules manager: invalid rule name "+t);this.__rules__[e].enabled=!0},this),this.__cache__=null};$e.prototype.disable=function(a){a=Array.isArray(a)?a:[a],a.forEach(function(i){var t=this.__find__(i);if(t<0)throw new Error("Rules manager: invalid rule name "+i);this.__rules__[t].enabled=!1},this),this.__cache__=null};$e.prototype.getRules=function(a){return this.__cache__===null&&this.__compile__(),this.__cache__[a]||[]};function Lo(a){a.inlineMode?a.tokens.push({type:"inline",content:a.src.replace(/\n/g," ").trim(),level:0,lines:[0,1],children:[]}):a.block.parse(a.src,a.options,a.env,a.tokens)}function Rt(a,i,t,e,n){this.src=a,this.env=e,this.options=t,this.parser=i,this.tokens=n,this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache=[],this.isInLabel=!1,this.linkLevel=0,this.linkContent="",this.labelUnmatchedScopes=0}Rt.prototype.pushPending=function(){this.tokens.push({type:"text",content:this.pending,level:this.pendingLevel}),this.pending=""};Rt.prototype.push=function(a){this.pending&&this.pushPending(),this.tokens.push(a),this.pendingLevel=this.level};Rt.prototype.cacheSet=function(a,i){for(var t=this.cache.length;t<=a;t++)this.cache.push(0);this.cache[a]=i};Rt.prototype.cacheGet=function(a){return a<this.cache.length?this.cache[a]:0};function Rn(a,i){var t,e,n,r=-1,s=a.posMax,o=a.pos,l=a.isInLabel;if(a.isInLabel)return-1;if(a.labelUnmatchedScopes)return a.labelUnmatchedScopes--,-1;for(a.pos=i+1,a.isInLabel=!0,t=1;a.pos<s;){if(n=a.src.charCodeAt(a.pos),n===91)t++;else if(n===93&&(t--,t===0)){e=!0;break}a.parser.skipToken(a)}return e?(r=a.pos,a.labelUnmatchedScopes=0):a.labelUnmatchedScopes=t-1,a.pos=o,a.isInLabel=l,r}function Fo(a,i,t,e){var n,r,s,o,l,u;if(a.charCodeAt(0)!==42||a.charCodeAt(1)!==91||a.indexOf("]:")===-1||(n=new Rt(a,i,t,e,[]),r=Rn(n,1),r<0||a.charCodeAt(r+1)!==58))return-1;for(o=n.posMax,s=r+2;s<o&&n.src.charCodeAt(s)!==10;s++);return l=a.slice(2,r),u=a.slice(r+2,s).trim(),u.length===0?-1:(e.abbreviations||(e.abbreviations={}),R(e.abbreviations[":"+l])>"u"&&(e.abbreviations[":"+l]=u),s)}function Do(a){var i=a.tokens,t,e,n,r;if(!a.inlineMode){for(t=1,e=i.length-1;t<e;t++)if(i[t-1].type==="paragraph_open"&&i[t].type==="inline"&&i[t+1].type==="paragraph_close"){for(n=i[t].content;n.length&&(r=Fo(n,a.inline,a.options,a.env),!(r<0));)n=n.slice(r).trim();i[t].content=n,n.length||(i[t-1].tight=!0,i[t+1].tight=!0)}}}function Br(a){var i=At(a);try{i=decodeURI(i)}catch(t){}return encodeURI(i)}function $s(a,i){var t,e,n,r=i,s=a.posMax;if(a.src.charCodeAt(i)===60){for(i++;i<s;){if(t=a.src.charCodeAt(i),t===10)return!1;if(t===62)return n=Br(In(a.src.slice(r+1,i))),a.parser.validateLink(n)?(a.pos=i+1,a.linkContent=n,!0):!1;if(t===92&&i+1<s){i+=2;continue}i++}return!1}for(e=0;i<s&&(t=a.src.charCodeAt(i),!(t===32||t<32||t===127));){if(t===92&&i+1<s){i+=2;continue}if(t===40&&(e++,e>1)||t===41&&(e--,e<0))break;i++}return r===i||(n=In(a.src.slice(r,i)),!a.parser.validateLink(n))?!1:(a.linkContent=n,a.pos=i,!0)}function Xs(a,i){var t,e=i,n=a.posMax,r=a.src.charCodeAt(i);if(r!==34&&r!==39&&r!==40)return!1;for(i++,r===40&&(r=41);i<n;){if(t=a.src.charCodeAt(i),t===r)return a.pos=i+1,a.linkContent=In(a.src.slice(e+1,i)),!0;if(t===92&&i+1<n){i+=2;continue}i++}return!1}function Js(a){return a.trim().replace(/\s+/g," ").toUpperCase()}function No(a,i,t,e){var n,r,s,o,l,u,c,d,h;if(a.charCodeAt(0)!==91||a.indexOf("]:")===-1||(n=new Rt(a,i,t,e,[]),r=Rn(n,0),r<0||a.charCodeAt(r+1)!==58))return-1;for(o=n.posMax,s=r+2;s<o&&(l=n.src.charCodeAt(s),!(l!==32&&l!==10));s++);if(!$s(n,s))return-1;for(c=n.linkContent,s=n.pos,u=s,s=s+1;s<o&&(l=n.src.charCodeAt(s),!(l!==32&&l!==10));s++);for(s<o&&u!==s&&Xs(n,s)?(d=n.linkContent,s=n.pos):(d="",s=u);s<o&&n.src.charCodeAt(s)===32;)s++;return s<o&&n.src.charCodeAt(s)!==10?-1:(h=Js(a.slice(1,r)),R(e.references[h])>"u"&&(e.references[h]={title:d,href:c}),s)}function Uo(a){var i=a.tokens,t,e,n,r;if(a.env.references=a.env.references||{},!a.inlineMode){for(t=1,e=i.length-1;t<e;t++)if(i[t].type==="inline"&&i[t-1].type==="paragraph_open"&&i[t+1].type==="paragraph_close"){for(n=i[t].content;n.length&&(r=No(n,a.inline,a.options,a.env),!(r<0));)n=n.slice(r).trim();i[t].content=n,n.length||(i[t-1].tight=!0,i[t+1].tight=!0)}}}function jo(a){var i=a.tokens,t,e,n;for(e=0,n=i.length;e<n;e++)t=i[e],t.type==="inline"&&a.inline.parse(t.content,a.options,a.env,t.children)}function Ho(a){var i,t,e,n,r,s,o,l,u,c=0,d=!1,h={};if(a.env.footnotes&&(a.tokens=a.tokens.filter(function(p){return p.type==="footnote_reference_open"?(d=!0,l=[],u=p.label,!1):p.type==="footnote_reference_close"?(d=!1,h[":"+u]=l,!1):(d&&l.push(p),!d)}),!!a.env.footnotes.list)){for(s=a.env.footnotes.list,a.tokens.push({type:"footnote_block_open",level:c++}),i=0,t=s.length;i<t;i++){for(a.tokens.push({type:"footnote_open",id:i,level:c++}),s[i].tokens?(o=[],o.push({type:"paragraph_open",tight:!1,level:c++}),o.push({type:"inline",content:"",level:c,children:s[i].tokens}),o.push({type:"paragraph_close",tight:!1,level:--c})):s[i].label&&(o=h[":"+s[i].label]),a.tokens=a.tokens.concat(o),a.tokens[a.tokens.length-1].type==="paragraph_close"?r=a.tokens.pop():r=null,n=s[i].count>0?s[i].count:1,e=0;e<n;e++)a.tokens.push({type:"footnote_anchor",id:i,subId:e,level:c});r&&a.tokens.push(r),a.tokens.push({type:"footnote_close",level:--c})}a.tokens.push({type:"footnote_block_close",level:--c})}}var xa=` 
()[]'".,!?-`;function kr(a){return a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}function qo(a){var i,t,e,n,r,s,o,l,u,c,d,h,p=a.tokens;if(a.env.abbreviations){for(a.env.abbrRegExp||(h="(^|["+xa.split("").map(kr).join("")+"])("+Object.keys(a.env.abbreviations).map(function(g){return g.substr(1)}).sort(function(g,m){return m.length-g.length}).map(kr).join("|")+")($|["+xa.split("").map(kr).join("")+"])",a.env.abbrRegExp=new RegExp(h,"g")),c=a.env.abbrRegExp,t=0,e=p.length;t<e;t++)if(p[t].type==="inline"){for(n=p[t].children,i=n.length-1;i>=0;i--)if(r=n[i],r.type==="text"){for(l=0,s=r.content,c.lastIndex=0,u=r.level,o=[];d=c.exec(s);)c.lastIndex>l&&o.push({type:"text",content:s.slice(l,d.index+d[1].length),level:u}),o.push({type:"abbr_open",title:a.env.abbreviations[":"+d[2]],level:u++}),o.push({type:"text",content:d[2],level:u}),o.push({type:"abbr_close",level:--u}),l=c.lastIndex-d[3].length;o.length&&(l<s.length&&o.push({type:"text",content:s.slice(l),level:u}),p[t].children=n=[].concat(n.slice(0,i),o,n.slice(i+1)))}}}}var zo=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,Wo=/\((c|tm|r|p)\)/ig,Go={c:"Â©",r:"Â®",p:"Â§",tm:"â„¢"};function Ko(a){return a.indexOf("(")<0?a:a.replace(Wo,function(i,t){return Go[t.toLowerCase()]})}function Vo(a){var i,t,e,n,r;if(a.options.typographer){for(r=a.tokens.length-1;r>=0;r--)if(a.tokens[r].type==="inline")for(n=a.tokens[r].children,i=n.length-1;i>=0;i--)t=n[i],t.type==="text"&&(e=t.content,e=Ko(e),zo.test(e)&&(e=e.replace(/\+-/g,"Â±").replace(/\.{2,}/g,"â€¦").replace(/([?!])â€¦/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/mg,"$1â€”$2").replace(/(^|\s)--(\s|$)/mg,"$1â€“$2").replace(/(^|[^-\s])--([^-\s]|$)/mg,"$1â€“$2")),t.content=e)}}var $o=/['"]/,Ba=/['"]/g,Xo=/[-\s()\[\]]/,Oa="â€™";function La(a,i){return i<0||i>=a.length?!1:!Xo.test(a[i])}function Ot(a,i,t){return a.substr(0,i)+t+a.substr(i+1)}function Jo(a){var i,t,e,n,r,s,o,l,u,c,d,h,p,g,m,b,k;if(a.options.typographer){for(k=[],m=a.tokens.length-1;m>=0;m--)if(a.tokens[m].type==="inline"){for(b=a.tokens[m].children,k.length=0,i=0;i<b.length;i++)if(t=b[i],!(t.type!=="text"||$o.test(t.text))){for(o=b[i].level,p=k.length-1;p>=0&&!(k[p].level<=o);p--);k.length=p+1,e=t.content,r=0,s=e.length;e:for(;r<s&&(Ba.lastIndex=r,n=Ba.exec(e),!!n);){if(l=!La(e,n.index-1),r=n.index+1,g=n[0]==="'",u=!La(e,r),!u&&!l){g&&(t.content=Ot(t.content,n.index,Oa));continue}if(d=!u,h=!l,h){for(p=k.length-1;p>=0&&(c=k[p],!(k[p].level<o));p--)if(c.single===g&&k[p].level===o){c=k[p],g?(b[c.token].content=Ot(b[c.token].content,c.pos,a.options.quotes[2]),t.content=Ot(t.content,n.index,a.options.quotes[3])):(b[c.token].content=Ot(b[c.token].content,c.pos,a.options.quotes[0]),t.content=Ot(t.content,n.index,a.options.quotes[1])),k.length=p;continue e}}d?k.push({token:i,pos:n.index,single:g,level:o}):h&&g&&(t.content=Ot(t.content,n.index,Oa))}}}}}var Sr=[["block",Lo],["abbr",Do],["references",Uo],["inline",jo],["footnote_tail",Ho],["abbr2",qo],["replacements",Vo],["smartquotes",Jo]];function Zs(){this.options={},this.ruler=new $e;for(var a=0;a<Sr.length;a++)this.ruler.push(Sr[a][0],Sr[a][1])}Zs.prototype.process=function(a){var i,t,e;for(e=this.ruler.getRules(""),i=0,t=e.length;i<t;i++)e[i](a)};function Pt(a,i,t,e,n){var r,s,o,l,u,c,d;for(this.src=a,this.parser=i,this.options=t,this.env=e,this.tokens=n,this.bMarks=[],this.eMarks=[],this.tShift=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.parentType="root",this.ddIndent=-1,this.level=0,this.result="",s=this.src,c=0,d=!1,o=l=c=0,u=s.length;l<u;l++){if(r=s.charCodeAt(l),!d)if(r===32){c++;continue}else d=!0;(r===10||l===u-1)&&(r!==10&&l++,this.bMarks.push(o),this.eMarks.push(l),this.tShift.push(c),d=!1,c=0,o=l+1)}this.bMarks.push(s.length),this.eMarks.push(s.length),this.tShift.push(0),this.lineMax=this.bMarks.length-1}Pt.prototype.isEmpty=function(a){return this.bMarks[a]+this.tShift[a]>=this.eMarks[a]};Pt.prototype.skipEmptyLines=function(a){for(var i=this.lineMax;a<i&&!(this.bMarks[a]+this.tShift[a]<this.eMarks[a]);a++);return a};Pt.prototype.skipSpaces=function(a){for(var i=this.src.length;a<i&&this.src.charCodeAt(a)===32;a++);return a};Pt.prototype.skipChars=function(a,i){for(var t=this.src.length;a<t&&this.src.charCodeAt(a)===i;a++);return a};Pt.prototype.skipCharsBack=function(a,i,t){if(a<=t)return a;for(;a>t;)if(i!==this.src.charCodeAt(--a))return a+1;return a};Pt.prototype.getLines=function(a,i,t,e){var n,r,s,o,l,u=a;if(a>=i)return"";if(u+1===i)return r=this.bMarks[u]+Math.min(this.tShift[u],t),s=e?this.eMarks[u]+1:this.eMarks[u],this.src.slice(r,s);for(o=new Array(i-a),n=0;u<i;u++,n++)l=this.tShift[u],l>t&&(l=t),l<0&&(l=0),r=this.bMarks[u]+l,u+1<i||e?s=this.eMarks[u]+1:s=this.eMarks[u],o[n]=this.src.slice(r,s);return o.join("")};function Zo(a,i,t){var e,n;if(a.tShift[i]-a.blkIndent<4)return!1;for(n=e=i+1;e<t;){if(a.isEmpty(e)){e++;continue}if(a.tShift[e]-a.blkIndent>=4){e++,n=e;continue}break}return a.line=e,a.tokens.push({type:"code",content:a.getLines(i,n,4+a.blkIndent,!0),block:!0,lines:[i,a.line],level:a.level}),!0}function Yo(a,i,t,e){var n,r,s,o,l,u=!1,c=a.bMarks[i]+a.tShift[i],d=a.eMarks[i];if(c+3>d||(n=a.src.charCodeAt(c),n!==126&&n!==96)||(l=c,c=a.skipChars(c,n),r=c-l,r<3)||(s=a.src.slice(c,d).trim(),s.indexOf("`")>=0))return!1;if(e)return!0;for(o=i;o++,!(o>=t||(c=l=a.bMarks[o]+a.tShift[o],d=a.eMarks[o],c<d&&a.tShift[o]<a.blkIndent));)if(a.src.charCodeAt(c)===n&&!(a.tShift[o]-a.blkIndent>=4)&&(c=a.skipChars(c,n),!(c-l<r)&&(c=a.skipSpaces(c),!(c<d)))){u=!0;break}return r=a.tShift[i],a.line=o+(u?1:0),a.tokens.push({type:"fence",params:s,content:a.getLines(i+1,o,r,!0),lines:[i,a.line],level:a.level}),!0}function Qo(a,i,t,e){var n,r,s,o,l,u,c,d,h,p,g,m=a.bMarks[i]+a.tShift[i],b=a.eMarks[i];if(m>b||a.src.charCodeAt(m++)!==62||a.level>=a.options.maxNesting)return!1;if(e)return!0;for(a.src.charCodeAt(m)===32&&m++,l=a.blkIndent,a.blkIndent=0,o=[a.bMarks[i]],a.bMarks[i]=m,m=m<b?a.skipSpaces(m):m,r=m>=b,s=[a.tShift[i]],a.tShift[i]=m-a.bMarks[i],d=a.parser.ruler.getRules("blockquote"),n=i+1;n<t&&(m=a.bMarks[n]+a.tShift[n],b=a.eMarks[n],!(m>=b));n++){if(a.src.charCodeAt(m++)===62){a.src.charCodeAt(m)===32&&m++,o.push(a.bMarks[n]),a.bMarks[n]=m,m=m<b?a.skipSpaces(m):m,r=m>=b,s.push(a.tShift[n]),a.tShift[n]=m-a.bMarks[n];continue}if(r)break;for(g=!1,h=0,p=d.length;h<p;h++)if(d[h](a,n,t,!0)){g=!0;break}if(g)break;o.push(a.bMarks[n]),s.push(a.tShift[n]),a.tShift[n]=-1337}for(u=a.parentType,a.parentType="blockquote",a.tokens.push({type:"blockquote_open",lines:c=[i,0],level:a.level++}),a.parser.tokenize(a,i,n),a.tokens.push({type:"blockquote_close",level:--a.level}),a.parentType=u,c[1]=a.line,h=0;h<s.length;h++)a.bMarks[h+i]=o[h],a.tShift[h+i]=s[h];return a.blkIndent=l,!0}function el(a,i,t,e){var n,r,s,o=a.bMarks[i],l=a.eMarks[i];if(o+=a.tShift[i],o>l||(n=a.src.charCodeAt(o++),n!==42&&n!==45&&n!==95))return!1;for(r=1;o<l;){if(s=a.src.charCodeAt(o++),s!==n&&s!==32)return!1;s===n&&r++}return r<3?!1:(e||(a.line=i+1,a.tokens.push({type:"hr",lines:[i,a.line],level:a.level})),!0)}function Fa(a,i){var t,e,n;return e=a.bMarks[i]+a.tShift[i],n=a.eMarks[i],e>=n||(t=a.src.charCodeAt(e++),t!==42&&t!==45&&t!==43)||e<n&&a.src.charCodeAt(e)!==32?-1:e}function Da(a,i){var t,e=a.bMarks[i]+a.tShift[i],n=a.eMarks[i];if(e+1>=n||(t=a.src.charCodeAt(e++),t<48||t>57))return-1;for(;;){if(e>=n)return-1;if(t=a.src.charCodeAt(e++),!(t>=48&&t<=57)){if(t===41||t===46)break;return-1}}return e<n&&a.src.charCodeAt(e)!==32?-1:e}function tl(a,i){var t,e,n=a.level+2;for(t=i+2,e=a.tokens.length-2;t<e;t++)a.tokens[t].level===n&&a.tokens[t].type==="paragraph_open"&&(a.tokens[t+2].tight=!0,a.tokens[t].tight=!0,t+=2)}function nl(a,i,t,e){var n,r,s,o,l,u,c,d,h,p,g,m,b,k,A,I,x,U,j=!0,J,G,he,se;if((d=Da(a,i))>=0)b=!0;else if((d=Fa(a,i))>=0)b=!1;else return!1;if(a.level>=a.options.maxNesting)return!1;if(m=a.src.charCodeAt(d-1),e)return!0;for(A=a.tokens.length,b?(c=a.bMarks[i]+a.tShift[i],g=Number(a.src.substr(c,d-c-1)),a.tokens.push({type:"ordered_list_open",order:g,lines:x=[i,0],level:a.level++})):a.tokens.push({type:"bullet_list_open",lines:x=[i,0],level:a.level++}),n=i,I=!1,J=a.parser.ruler.getRules("list");n<t&&(k=a.skipSpaces(d),h=a.eMarks[n],k>=h?p=1:p=k-d,p>4&&(p=1),p<1&&(p=1),r=d-a.bMarks[n]+p,a.tokens.push({type:"list_item_open",lines:U=[i,0],level:a.level++}),o=a.blkIndent,l=a.tight,s=a.tShift[i],u=a.parentType,a.tShift[i]=k-a.bMarks[i],a.blkIndent=r,a.tight=!0,a.parentType="list",a.parser.tokenize(a,i,t,!0),(!a.tight||I)&&(j=!1),I=a.line-i>1&&a.isEmpty(a.line-1),a.blkIndent=o,a.tShift[i]=s,a.tight=l,a.parentType=u,a.tokens.push({type:"list_item_close",level:--a.level}),n=i=a.line,U[1]=n,k=a.bMarks[i],!(n>=t||a.isEmpty(n)||a.tShift[n]<a.blkIndent));){for(se=!1,G=0,he=J.length;G<he;G++)if(J[G](a,n,t,!0)){se=!0;break}if(se)break;if(b){if(d=Da(a,n),d<0)break}else if(d=Fa(a,n),d<0)break;if(m!==a.src.charCodeAt(d-1))break}return a.tokens.push({type:b?"ordered_list_close":"bullet_list_close",level:--a.level}),x[1]=n,a.line=n,j&&tl(a,A),!0}function rl(a,i,t,e){var n,r,s,o,l,u=a.bMarks[i]+a.tShift[i],c=a.eMarks[i];if(u+4>c||a.src.charCodeAt(u)!==91||a.src.charCodeAt(u+1)!==94||a.level>=a.options.maxNesting)return!1;for(o=u+2;o<c;o++){if(a.src.charCodeAt(o)===32)return!1;if(a.src.charCodeAt(o)===93)break}return o===u+2||o+1>=c||a.src.charCodeAt(++o)!==58?!1:(e||(o++,a.env.footnotes||(a.env.footnotes={}),a.env.footnotes.refs||(a.env.footnotes.refs={}),l=a.src.slice(u+2,o-2),a.env.footnotes.refs[":"+l]=-1,a.tokens.push({type:"footnote_reference_open",label:l,level:a.level++}),n=a.bMarks[i],r=a.tShift[i],s=a.parentType,a.tShift[i]=a.skipSpaces(o)-o,a.bMarks[i]=o,a.blkIndent+=4,a.parentType="footnote",a.tShift[i]<a.blkIndent&&(a.tShift[i]+=a.blkIndent,a.bMarks[i]-=a.blkIndent),a.parser.tokenize(a,i,t,!0),a.parentType=s,a.blkIndent-=4,a.tShift[i]=r,a.bMarks[i]=n,a.tokens.push({type:"footnote_reference_close",level:--a.level})),!0)}function al(a,i,t,e){var n,r,s,o=a.bMarks[i]+a.tShift[i],l=a.eMarks[i];if(o>=l||(n=a.src.charCodeAt(o),n!==35||o>=l))return!1;for(r=1,n=a.src.charCodeAt(++o);n===35&&o<l&&r<=6;)r++,n=a.src.charCodeAt(++o);return r>6||o<l&&n!==32?!1:(e||(l=a.skipCharsBack(l,32,o),s=a.skipCharsBack(l,35,o),s>o&&a.src.charCodeAt(s-1)===32&&(l=s),a.line=i+1,a.tokens.push({type:"heading_open",hLevel:r,lines:[i,a.line],level:a.level}),o<l&&a.tokens.push({type:"inline",content:a.src.slice(o,l).trim(),level:a.level+1,lines:[i,a.line],children:[]}),a.tokens.push({type:"heading_close",hLevel:r,level:a.level})),!0)}function sl(a,i,t){var e,n,r,s=i+1;return s>=t||a.tShift[s]<a.blkIndent||a.tShift[s]-a.blkIndent>3||(n=a.bMarks[s]+a.tShift[s],r=a.eMarks[s],n>=r)||(e=a.src.charCodeAt(n),e!==45&&e!==61)||(n=a.skipChars(n,e),n=a.skipSpaces(n),n<r)?!1:(n=a.bMarks[i]+a.tShift[i],a.line=s+1,a.tokens.push({type:"heading_open",hLevel:e===61?1:2,lines:[i,a.line],level:a.level}),a.tokens.push({type:"inline",content:a.src.slice(n,a.eMarks[i]).trim(),level:a.level+1,lines:[i,a.line-1],children:[]}),a.tokens.push({type:"heading_close",hLevel:e===61?1:2,level:a.level}),!0)}var Ys={};["article","aside","button","blockquote","body","canvas","caption","col","colgroup","dd","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","li","map","object","ol","output","p","pre","progress","script","section","style","table","tbody","td","textarea","tfoot","th","tr","thead","ul","video"].forEach(function(a){Ys[a]=!0});var il=/^<([a-zA-Z]{1,15})[\s\/>]/,ol=/^<\/([a-zA-Z]{1,15})[\s>]/;function ll(a){var i=a|32;return i>=97&&i<=122}function ul(a,i,t,e){var n,r,s,o=a.bMarks[i],l=a.eMarks[i],u=a.tShift[i];if(o+=u,!a.options.html||u>3||o+2>=l||a.src.charCodeAt(o)!==60)return!1;if(n=a.src.charCodeAt(o+1),n===33||n===63){if(e)return!0}else if(n===47||ll(n)){if(n===47){if(r=a.src.slice(o,l).match(ol),!r)return!1}else if(r=a.src.slice(o,l).match(il),!r)return!1;if(Ys[r[1].toLowerCase()]!==!0)return!1;if(e)return!0}else return!1;for(s=i+1;s<a.lineMax&&!a.isEmpty(s);)s++;return a.line=s,a.tokens.push({type:"htmlblock",level:a.level,lines:[i,a.line],content:a.getLines(i,s,0,!0)}),!0}function wr(a,i){var t=a.bMarks[i]+a.blkIndent,e=a.eMarks[i];return a.src.substr(t,e-t)}function cl(a,i,t,e){var n,r,s,o,l,u,c,d,h,p,g;if(i+2>t||(l=i+1,a.tShift[l]<a.blkIndent)||(s=a.bMarks[l]+a.tShift[l],s>=a.eMarks[l])||(n=a.src.charCodeAt(s),n!==124&&n!==45&&n!==58)||(r=wr(a,i+1),!/^[-:| ]+$/.test(r))||(u=r.split("|"),u<=2))return!1;for(d=[],o=0;o<u.length;o++){if(h=u[o].trim(),!h){if(o===0||o===u.length-1)continue;return!1}if(!/^:?-+:?$/.test(h))return!1;h.charCodeAt(h.length-1)===58?d.push(h.charCodeAt(0)===58?"center":"right"):h.charCodeAt(0)===58?d.push("left"):d.push("")}if(r=wr(a,i).trim(),r.indexOf("|")===-1||(u=r.replace(/^\||\|$/g,"").split("|"),d.length!==u.length))return!1;if(e)return!0;for(a.tokens.push({type:"table_open",lines:p=[i,0],level:a.level++}),a.tokens.push({type:"thead_open",lines:[i,i+1],level:a.level++}),a.tokens.push({type:"tr_open",lines:[i,i+1],level:a.level++}),o=0;o<u.length;o++)a.tokens.push({type:"th_open",align:d[o],lines:[i,i+1],level:a.level++}),a.tokens.push({type:"inline",content:u[o].trim(),lines:[i,i+1],level:a.level,children:[]}),a.tokens.push({type:"th_close",level:--a.level});for(a.tokens.push({type:"tr_close",level:--a.level}),a.tokens.push({type:"thead_close",level:--a.level}),a.tokens.push({type:"tbody_open",lines:g=[i+2,0],level:a.level++}),l=i+2;l<t&&!(a.tShift[l]<a.blkIndent||(r=wr(a,l).trim(),r.indexOf("|")===-1));l++){for(u=r.replace(/^\||\|$/g,"").split("|"),a.tokens.push({type:"tr_open",level:a.level++}),o=0;o<u.length;o++)a.tokens.push({type:"td_open",align:d[o],level:a.level++}),c=u[o].substring(u[o].charCodeAt(0)===124?1:0,u[o].charCodeAt(u[o].length-1)===124?u[o].length-1:u[o].length).trim(),a.tokens.push({type:"inline",content:c,level:a.level,children:[]}),a.tokens.push({type:"td_close",level:--a.level});a.tokens.push({type:"tr_close",level:--a.level})}return a.tokens.push({type:"tbody_close",level:--a.level}),a.tokens.push({type:"table_close",level:--a.level}),p[1]=g[1]=l,a.line=l,!0}function Dn(a,i){var t,e,n=a.bMarks[i]+a.tShift[i],r=a.eMarks[i];return n>=r||(e=a.src.charCodeAt(n++),e!==126&&e!==58)||(t=a.skipSpaces(n),n===t)||t>=r?-1:t}function dl(a,i){var t,e,n=a.level+2;for(t=i+2,e=a.tokens.length-2;t<e;t++)a.tokens[t].level===n&&a.tokens[t].type==="paragraph_open"&&(a.tokens[t+2].tight=!0,a.tokens[t].tight=!0,t+=2)}function hl(a,i,t,e){var n,r,s,o,l,u,c,d,h,p,g,m,b,k;if(e)return a.ddIndent<0?!1:Dn(a,i)>=0;if(c=i+1,a.isEmpty(c)&&++c>t||a.tShift[c]<a.blkIndent||(n=Dn(a,c),n<0)||a.level>=a.options.maxNesting)return!1;u=a.tokens.length,a.tokens.push({type:"dl_open",lines:l=[i,0],level:a.level++}),s=i,r=c;e:for(;;){for(k=!0,b=!1,a.tokens.push({type:"dt_open",lines:[s,s],level:a.level++}),a.tokens.push({type:"inline",content:a.getLines(s,s+1,a.blkIndent,!1).trim(),level:a.level+1,lines:[s,s],children:[]}),a.tokens.push({type:"dt_close",level:--a.level});;){if(a.tokens.push({type:"dd_open",lines:o=[c,0],level:a.level++}),m=a.tight,h=a.ddIndent,d=a.blkIndent,g=a.tShift[r],p=a.parentType,a.blkIndent=a.ddIndent=a.tShift[r]+2,a.tShift[r]=n-a.bMarks[r],a.tight=!0,a.parentType="deflist",a.parser.tokenize(a,r,t,!0),(!a.tight||b)&&(k=!1),b=a.line-r>1&&a.isEmpty(a.line-1),a.tShift[r]=g,a.tight=m,a.parentType=p,a.blkIndent=d,a.ddIndent=h,a.tokens.push({type:"dd_close",level:--a.level}),o[1]=c=a.line,c>=t||a.tShift[c]<a.blkIndent)break e;if(n=Dn(a,c),n<0)break;r=c}if(c>=t||(s=c,a.isEmpty(s))||a.tShift[s]<a.blkIndent||(r=s+1,r>=t)||(a.isEmpty(r)&&r++,r>=t)||a.tShift[r]<a.blkIndent||(n=Dn(a,r),n<0))break}return a.tokens.push({type:"dl_close",level:--a.level}),l[1]=c,a.line=c,k&&dl(a,u),!0}function pl(a,i){var t,e,n,r,s,o=i+1,l;if(t=a.lineMax,o<t&&!a.isEmpty(o)){for(l=a.parser.ruler.getRules("paragraph");o<t&&!a.isEmpty(o);o++)if(!(a.tShift[o]-a.blkIndent>3)){for(n=!1,r=0,s=l.length;r<s;r++)if(l[r](a,o,t,!0)){n=!0;break}if(n)break}}return e=a.getLines(i,o,a.blkIndent,!1).trim(),a.line=o,e.length&&(a.tokens.push({type:"paragraph_open",tight:!1,lines:[i,a.line],level:a.level}),a.tokens.push({type:"inline",content:e,level:a.level+1,lines:[i,a.line],children:[]}),a.tokens.push({type:"paragraph_close",tight:!1,level:a.level})),!0}var Nn=[["code",Zo],["fences",Yo,["paragraph","blockquote","list"]],["blockquote",Qo,["paragraph","blockquote","list"]],["hr",el,["paragraph","blockquote","list"]],["list",nl,["paragraph","blockquote"]],["footnote",rl,["paragraph"]],["heading",al,["paragraph","blockquote"]],["lheading",sl],["htmlblock",ul,["paragraph","blockquote"]],["table",cl,["paragraph"]],["deflist",hl,["paragraph"]],["paragraph",pl]];function sa(){this.ruler=new $e;for(var a=0;a<Nn.length;a++)this.ruler.push(Nn[a][0],Nn[a][1],{alt:(Nn[a][2]||[]).slice()})}sa.prototype.tokenize=function(a,i,t){for(var e=this.ruler.getRules(""),n=e.length,r=i,s=!1,o,l;r<t&&(a.line=r=a.skipEmptyLines(r),!(r>=t||a.tShift[r]<a.blkIndent));){for(l=0;l<n&&(o=e[l](a,r,t,!1),!o);l++);if(a.tight=!s,a.isEmpty(a.line-1)&&(s=!0),r=a.line,r<t&&a.isEmpty(r)){if(s=!0,r++,r<t&&a.parentType==="list"&&a.isEmpty(r))break;a.line=r}}};var fl=/[\n\t]/g,ml=/\r[\n\u0085]|[\u2424\u2028\u0085]/g,vl=/\u00a0/g;sa.prototype.parse=function(a,i,t,e){var n,r=0,s=0;if(!a)return[];a=a.replace(vl," "),a=a.replace(ml,`
`),a.indexOf("	")>=0&&(a=a.replace(fl,function(o,l){var u;return a.charCodeAt(l)===10?(r=l+1,s=0,o):(u="    ".slice((l-r-s)%4),s=l-r+1,u)})),n=new Pt(a,this,i,t,e),this.tokenize(n,n.line,n.lineMax)};function gl(a){switch(a){case 10:case 92:case 96:case 42:case 95:case 94:case 91:case 93:case 33:case 38:case 60:case 62:case 123:case 125:case 36:case 37:case 64:case 126:case 43:case 61:case 58:return!0;default:return!1}}function yl(a,i){for(var t=a.pos;t<a.posMax&&!gl(a.src.charCodeAt(t));)t++;return t===a.pos?!1:(i||(a.pending+=a.src.slice(a.pos,t)),a.pos=t,!0)}function bl(a,i){var t,e,n=a.pos;if(a.src.charCodeAt(n)!==10)return!1;if(t=a.pending.length-1,e=a.posMax,!i)if(t>=0&&a.pending.charCodeAt(t)===32)if(t>=1&&a.pending.charCodeAt(t-1)===32){for(var r=t-2;r>=0;r--)if(a.pending.charCodeAt(r)!==32){a.pending=a.pending.substring(0,r+1);break}a.push({type:"hardbreak",level:a.level})}else a.pending=a.pending.slice(0,-1),a.push({type:"softbreak",level:a.level});else a.push({type:"softbreak",level:a.level});for(n++;n<e&&a.src.charCodeAt(n)===32;)n++;return a.pos=n,!0}var ia=[];for(var Na=0;Na<256;Na++)ia.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(a){ia[a.charCodeAt(0)]=1});function _l(a,i){var t,e=a.pos,n=a.posMax;if(a.src.charCodeAt(e)!==92)return!1;if(e++,e<n){if(t=a.src.charCodeAt(e),t<256&&ia[t]!==0)return i||(a.pending+=a.src[e]),a.pos+=2,!0;if(t===10){for(i||a.push({type:"hardbreak",level:a.level}),e++;e<n&&a.src.charCodeAt(e)===32;)e++;return a.pos=e,!0}}return i||(a.pending+="\\"),a.pos++,!0}function kl(a,i){var t,e,n,r,s,o=a.pos,l=a.src.charCodeAt(o);if(l!==96)return!1;for(t=o,o++,e=a.posMax;o<e&&a.src.charCodeAt(o)===96;)o++;for(n=a.src.slice(t,o),r=s=o;(r=a.src.indexOf("`",s))!==-1;){for(s=r+1;s<e&&a.src.charCodeAt(s)===96;)s++;if(s-r===n.length)return i||a.push({type:"code",content:a.src.slice(o,r).replace(/[ \n]+/g," ").trim(),block:!1,level:a.level}),a.pos=s,!0}return i||(a.pending+=n),a.pos+=n.length,!0}function Sl(a,i){var t,e,n,r=a.posMax,s=a.pos,o,l;if(a.src.charCodeAt(s)!==126||i||s+4>=r||a.src.charCodeAt(s+1)!==126||a.level>=a.options.maxNesting||(o=s>0?a.src.charCodeAt(s-1):-1,l=a.src.charCodeAt(s+2),o===126)||l===126||l===32||l===10)return!1;for(e=s+2;e<r&&a.src.charCodeAt(e)===126;)e++;if(e>s+3)return a.pos+=e-s,i||(a.pending+=a.src.slice(s,e)),!0;for(a.pos=s+2,n=1;a.pos+1<r;){if(a.src.charCodeAt(a.pos)===126&&a.src.charCodeAt(a.pos+1)===126&&(o=a.src.charCodeAt(a.pos-1),l=a.pos+2<r?a.src.charCodeAt(a.pos+2):-1,l!==126&&o!==126&&(o!==32&&o!==10?n--:l!==32&&l!==10&&n++,n<=0))){t=!0;break}a.parser.skipToken(a)}return t?(a.posMax=a.pos,a.pos=s+2,i||(a.push({type:"del_open",level:a.level++}),a.parser.tokenize(a),a.push({type:"del_close",level:--a.level})),a.pos=a.posMax+2,a.posMax=r,!0):(a.pos=s,!1)}function wl(a,i){var t,e,n,r=a.posMax,s=a.pos,o,l;if(a.src.charCodeAt(s)!==43||i||s+4>=r||a.src.charCodeAt(s+1)!==43||a.level>=a.options.maxNesting||(o=s>0?a.src.charCodeAt(s-1):-1,l=a.src.charCodeAt(s+2),o===43)||l===43||l===32||l===10)return!1;for(e=s+2;e<r&&a.src.charCodeAt(e)===43;)e++;if(e!==s+2)return a.pos+=e-s,i||(a.pending+=a.src.slice(s,e)),!0;for(a.pos=s+2,n=1;a.pos+1<r;){if(a.src.charCodeAt(a.pos)===43&&a.src.charCodeAt(a.pos+1)===43&&(o=a.src.charCodeAt(a.pos-1),l=a.pos+2<r?a.src.charCodeAt(a.pos+2):-1,l!==43&&o!==43&&(o!==32&&o!==10?n--:l!==32&&l!==10&&n++,n<=0))){t=!0;break}a.parser.skipToken(a)}return t?(a.posMax=a.pos,a.pos=s+2,i||(a.push({type:"ins_open",level:a.level++}),a.parser.tokenize(a),a.push({type:"ins_close",level:--a.level})),a.pos=a.posMax+2,a.posMax=r,!0):(a.pos=s,!1)}function El(a,i){var t,e,n,r=a.posMax,s=a.pos,o,l;if(a.src.charCodeAt(s)!==61||i||s+4>=r||a.src.charCodeAt(s+1)!==61||a.level>=a.options.maxNesting||(o=s>0?a.src.charCodeAt(s-1):-1,l=a.src.charCodeAt(s+2),o===61)||l===61||l===32||l===10)return!1;for(e=s+2;e<r&&a.src.charCodeAt(e)===61;)e++;if(e!==s+2)return a.pos+=e-s,i||(a.pending+=a.src.slice(s,e)),!0;for(a.pos=s+2,n=1;a.pos+1<r;){if(a.src.charCodeAt(a.pos)===61&&a.src.charCodeAt(a.pos+1)===61&&(o=a.src.charCodeAt(a.pos-1),l=a.pos+2<r?a.src.charCodeAt(a.pos+2):-1,l!==61&&o!==61&&(o!==32&&o!==10?n--:l!==32&&l!==10&&n++,n<=0))){t=!0;break}a.parser.skipToken(a)}return t?(a.posMax=a.pos,a.pos=s+2,i||(a.push({type:"mark_open",level:a.level++}),a.parser.tokenize(a),a.push({type:"mark_close",level:--a.level})),a.pos=a.posMax+2,a.posMax=r,!0):(a.pos=s,!1)}function Ua(a){return a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122}function ja(a,i){var t=i,e,n,r,s=!0,o=!0,l=a.posMax,u=a.src.charCodeAt(i);for(e=i>0?a.src.charCodeAt(i-1):-1;t<l&&a.src.charCodeAt(t)===u;)t++;return t>=l&&(s=!1),r=t-i,r>=4?s=o=!1:(n=t<l?a.src.charCodeAt(t):-1,(n===32||n===10)&&(s=!1),(e===32||e===10)&&(o=!1),u===95&&(Ua(e)&&(s=!1),Ua(n)&&(o=!1))),{can_open:s,can_close:o,delims:r}}function Cl(a,i){var t,e,n,r,s,o,l,u=a.posMax,c=a.pos,d=a.src.charCodeAt(c);if(d!==95&&d!==42||i)return!1;if(l=ja(a,c),t=l.delims,!l.can_open)return a.pos+=t,i||(a.pending+=a.src.slice(c,a.pos)),!0;if(a.level>=a.options.maxNesting)return!1;for(a.pos=c+t,o=[t];a.pos<u;){if(a.src.charCodeAt(a.pos)===d){if(l=ja(a,a.pos),e=l.delims,l.can_close){for(r=o.pop(),s=e;r!==s;){if(s<r){o.push(r-s);break}if(s-=r,o.length===0)break;a.pos+=r,r=o.pop()}if(o.length===0){t=r,n=!0;break}a.pos+=e;continue}l.can_open&&o.push(e),a.pos+=e;continue}a.parser.skipToken(a)}return n?(a.posMax=a.pos,a.pos=c+t,i||((t===2||t===3)&&a.push({type:"strong_open",level:a.level++}),(t===1||t===3)&&a.push({type:"em_open",level:a.level++}),a.parser.tokenize(a),(t===1||t===3)&&a.push({type:"em_close",level:--a.level}),(t===2||t===3)&&a.push({type:"strong_close",level:--a.level})),a.pos=a.posMax+t,a.posMax=u,!0):(a.pos=c,!1)}var Tl=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function Al(a,i){var t,e,n=a.posMax,r=a.pos;if(a.src.charCodeAt(r)!==126||i||r+2>=n||a.level>=a.options.maxNesting)return!1;for(a.pos=r+1;a.pos<n;){if(a.src.charCodeAt(a.pos)===126){t=!0;break}a.parser.skipToken(a)}return!t||r+1===a.pos||(e=a.src.slice(r+1,a.pos),e.match(/(^|[^\\])(\\\\)*\s/))?(a.pos=r,!1):(a.posMax=a.pos,a.pos=r+1,i||a.push({type:"sub",level:a.level,content:e.replace(Tl,"$1")}),a.pos=a.posMax+1,a.posMax=n,!0)}var Ml=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function Il(a,i){var t,e,n=a.posMax,r=a.pos;if(a.src.charCodeAt(r)!==94||i||r+2>=n||a.level>=a.options.maxNesting)return!1;for(a.pos=r+1;a.pos<n;){if(a.src.charCodeAt(a.pos)===94){t=!0;break}a.parser.skipToken(a)}return!t||r+1===a.pos||(e=a.src.slice(r+1,a.pos),e.match(/(^|[^\\])(\\\\)*\s/))?(a.pos=r,!1):(a.posMax=a.pos,a.pos=r+1,i||a.push({type:"sup",level:a.level,content:e.replace(Ml,"$1")}),a.pos=a.posMax+1,a.posMax=n,!0)}function Rl(a,i){var t,e,n,r,s,o,l,u,c=!1,d=a.pos,h=a.posMax,p=a.pos,g=a.src.charCodeAt(p);if(g===33&&(c=!0,g=a.src.charCodeAt(++p)),g!==91||a.level>=a.options.maxNesting||(t=p+1,e=Rn(a,p),e<0))return!1;if(o=e+1,o<h&&a.src.charCodeAt(o)===40){for(o++;o<h&&(u=a.src.charCodeAt(o),!(u!==32&&u!==10));o++);if(o>=h)return!1;for(p=o,$s(a,o)?(r=a.linkContent,o=a.pos):r="",p=o;o<h&&(u=a.src.charCodeAt(o),!(u!==32&&u!==10));o++);if(o<h&&p!==o&&Xs(a,o))for(s=a.linkContent,o=a.pos;o<h&&(u=a.src.charCodeAt(o),!(u!==32&&u!==10));o++);else s="";if(o>=h||a.src.charCodeAt(o)!==41)return a.pos=d,!1;o++}else{if(a.linkLevel>0)return!1;for(;o<h&&(u=a.src.charCodeAt(o),!(u!==32&&u!==10));o++);if(o<h&&a.src.charCodeAt(o)===91&&(p=o+1,o=Rn(a,o),o>=0?n=a.src.slice(p,o++):o=p-1),n||(R(n)>"u"&&(o=e+1),n=a.src.slice(t,e)),l=a.env.references[Js(n)],!l)return a.pos=d,!1;r=l.href,s=l.title}return i||(a.pos=t,a.posMax=e,c?a.push({type:"image",src:r,title:s,alt:a.src.substr(t,e-t),level:a.level}):(a.push({type:"link_open",href:r,title:s,level:a.level++}),a.linkLevel++,a.parser.tokenize(a),a.linkLevel--,a.push({type:"link_close",level:--a.level}))),a.pos=o,a.posMax=h,!0}function Pl(a,i){var t,e,n,r,s=a.posMax,o=a.pos;return o+2>=s||a.src.charCodeAt(o)!==94||a.src.charCodeAt(o+1)!==91||a.level>=a.options.maxNesting||(t=o+2,e=Rn(a,o+1),e<0)?!1:(i||(a.env.footnotes||(a.env.footnotes={}),a.env.footnotes.list||(a.env.footnotes.list=[]),n=a.env.footnotes.list.length,a.pos=t,a.posMax=e,a.push({type:"footnote_ref",id:n,level:a.level}),a.linkLevel++,r=a.tokens.length,a.parser.tokenize(a),a.env.footnotes.list[n]={tokens:a.tokens.splice(r)},a.linkLevel--),a.pos=e+1,a.posMax=s,!0)}function xl(a,i){var t,e,n,r,s=a.posMax,o=a.pos;if(o+3>s||!a.env.footnotes||!a.env.footnotes.refs||a.src.charCodeAt(o)!==91||a.src.charCodeAt(o+1)!==94||a.level>=a.options.maxNesting)return!1;for(e=o+2;e<s;e++){if(a.src.charCodeAt(e)===32||a.src.charCodeAt(e)===10)return!1;if(a.src.charCodeAt(e)===93)break}return e===o+2||e>=s||(e++,t=a.src.slice(o+2,e-1),R(a.env.footnotes.refs[":"+t])>"u")?!1:(i||(a.env.footnotes.list||(a.env.footnotes.list=[]),a.env.footnotes.refs[":"+t]<0?(n=a.env.footnotes.list.length,a.env.footnotes.list[n]={label:t,count:0},a.env.footnotes.refs[":"+t]=n):n=a.env.footnotes.refs[":"+t],r=a.env.footnotes.list[n].count,a.env.footnotes.list[n].count++,a.push({type:"footnote_ref",id:n,subId:r,level:a.level})),a.pos=e,a.posMax=s,!0)}var Bl=["coap","doi","javascript","aaa","aaas","about","acap","cap","cid","crid","data","dav","dict","dns","file","ftp","geo","go","gopher","h323","http","https","iax","icap","im","imap","info","ipp","iris","iris.beep","iris.xpc","iris.xpcs","iris.lwz","ldap","mailto","mid","msrp","msrps","mtqp","mupdate","news","nfs","ni","nih","nntp","opaquelocktoken","pop","pres","rtsp","service","session","shttp","sieve","sip","sips","sms","snmp","soap.beep","soap.beeps","tag","tel","telnet","tftp","thismessage","tn3270","tip","tv","urn","vemmi","ws","wss","xcon","xcon-userid","xmlrpc.beep","xmlrpc.beeps","xmpp","z39.50r","z39.50s","adiumxtra","afp","afs","aim","apt","attachment","aw","beshare","bitcoin","bolo","callto","chrome","chrome-extension","com-eventbrite-attendee","content","cvs","dlna-playsingle","dlna-playcontainer","dtn","dvb","ed2k","facetime","feed","finger","fish","gg","git","gizmoproject","gtalk","hcp","icon","ipn","irc","irc6","ircs","itms","jar","jms","keyparc","lastfm","ldaps","magnet","maps","market","message","mms","ms-help","msnim","mumble","mvn","notes","oid","palm","paparazzi","platform","proxy","psyc","query","res","resource","rmi","rsync","rtmp","secondlife","sftp","sgn","skype","smb","soldat","spotify","ssh","steam","svn","teamspeak","things","udp","unreal","ut2004","ventrilo","view-source","webcal","wtai","wyciwyg","xfire","xri","ymsgr"],Ol=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,Ll=/^<([a-zA-Z.\-]{1,25}):([^<>\x00-\x20]*)>/;function Fl(a,i){var t,e,n,r,s,o=a.pos;return a.src.charCodeAt(o)!==60||(t=a.src.slice(o),t.indexOf(">")<0)?!1:(e=t.match(Ll),e?Bl.indexOf(e[1].toLowerCase())<0||(r=e[0].slice(1,-1),s=Br(r),!a.parser.validateLink(r))?!1:(i||(a.push({type:"link_open",href:s,level:a.level}),a.push({type:"text",content:r,level:a.level+1}),a.push({type:"link_close",level:a.level})),a.pos+=e[0].length,!0):(n=t.match(Ol),n?(r=n[0].slice(1,-1),s=Br("mailto:"+r),a.parser.validateLink(s)?(i||(a.push({type:"link_open",href:s,level:a.level}),a.push({type:"text",content:r,level:a.level+1}),a.push({type:"link_close",level:a.level})),a.pos+=n[0].length,!0):!1):!1))}function lr(a,i){return a=a.source,i=i||"",function t(e,n){return e?(n=n.source||n,a=a.replace(e,n),t):new RegExp(a,i)}}var Dl=/[a-zA-Z_:][a-zA-Z0-9:._-]*/,Nl=/[^"'=<>`\x00-\x20]+/,Ul=/'[^']*'/,jl=/"[^"]*"/,Hl=lr(/(?:unquoted|single_quoted|double_quoted)/)("unquoted",Nl)("single_quoted",Ul)("double_quoted",jl)(),ql=lr(/(?:\s+attr_name(?:\s*=\s*attr_value)?)/)("attr_name",Dl)("attr_value",Hl)(),zl=lr(/<[A-Za-z][A-Za-z0-9]*attribute*\s*\/?>/)("attribute",ql)(),Wl=/<\/[A-Za-z][A-Za-z0-9]*\s*>/,Gl=/<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->/,Kl=/<[?].*?[?]>/,Vl=/<![A-Z]+\s+[^>]*>/,$l=/<!\[CDATA\[[\s\S]*?\]\]>/,Xl=lr(/^(?:open_tag|close_tag|comment|processing|declaration|cdata)/)("open_tag",zl)("close_tag",Wl)("comment",Gl)("processing",Kl)("declaration",Vl)("cdata",$l)();function Jl(a){var i=a|32;return i>=97&&i<=122}function Zl(a,i){var t,e,n,r=a.pos;return!a.options.html||(n=a.posMax,a.src.charCodeAt(r)!==60||r+2>=n)||(t=a.src.charCodeAt(r+1),t!==33&&t!==63&&t!==47&&!Jl(t))||(e=a.src.slice(r).match(Xl),!e)?!1:(i||a.push({type:"htmltag",content:a.src.slice(r,r+e[0].length),level:a.level}),a.pos+=e[0].length,!0)}var Yl=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i,Ql=/^&([a-z][a-z0-9]{1,31});/i;function eu(a,i){var t,e,n,r=a.pos,s=a.posMax;if(a.src.charCodeAt(r)!==38)return!1;if(r+1<s){if(t=a.src.charCodeAt(r+1),t===35){if(n=a.src.slice(r).match(Yl),n)return i||(e=n[1][0].toLowerCase()==="x"?parseInt(n[1].slice(1),16):parseInt(n[1],10),a.pending+=Ks(e)?xr(e):xr(65533)),a.pos+=n[0].length,!0}else if(n=a.src.slice(r).match(Ql),n){var o=Ws(n[1]);if(n[1]!==o)return i||(a.pending+=o),a.pos+=n[0].length,!0}}return i||(a.pending+="&"),a.pos++,!0}var Er=[["text",yl],["newline",bl],["escape",_l],["backticks",kl],["del",Sl],["ins",wl],["mark",El],["emphasis",Cl],["sub",Al],["sup",Il],["links",Rl],["footnote_inline",Pl],["footnote_ref",xl],["autolink",Fl],["htmltag",Zl],["entity",eu]];function ur(){this.ruler=new $e;for(var a=0;a<Er.length;a++)this.ruler.push(Er[a][0],Er[a][1]);this.validateLink=tu}ur.prototype.skipToken=function(a){var i=this.ruler.getRules(""),t=i.length,e=a.pos,n,r;if((r=a.cacheGet(e))>0){a.pos=r;return}for(n=0;n<t;n++)if(i[n](a,!0)){a.cacheSet(e,a.pos);return}a.pos++,a.cacheSet(e,a.pos)};ur.prototype.tokenize=function(a){for(var i=this.ruler.getRules(""),t=i.length,e=a.posMax,n,r;a.pos<e;){for(r=0;r<t&&(n=i[r](a,!1),!n);r++);if(n){if(a.pos>=e)break;continue}a.pending+=a.src[a.pos++]}a.pending&&a.pushPending()};ur.prototype.parse=function(a,i,t,e){var n=new Rt(a,this,i,t,e);this.tokenize(n)};function tu(a){var i=["vbscript","javascript","file","data"],t=a.trim().toLowerCase();return t=At(t),!(t.indexOf(":")!==-1&&i.indexOf(t.split(":")[0])!==-1)}var nu={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"â€œâ€â€˜â€™",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","replacements","smartquotes","references","abbr2","footnote_tail"]},block:{rules:["blockquote","code","fences","footnote","heading","hr","htmlblock","lheading","list","paragraph","table"]},inline:{rules:["autolink","backticks","del","emphasis","entity","escape","footnote_ref","htmltag","links","newline","text"]}}},ru={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"â€œâ€â€˜â€™",highlight:null,maxNesting:20},components:{core:{},block:{},inline:{}}},au={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"â€œâ€â€˜â€™",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","abbr2"]},block:{rules:["blockquote","code","fences","heading","hr","htmlblock","lheading","list","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","htmltag","links","newline","text"]}}},su={default:nu,full:ru,commonmark:au};function Qs(a,i,t){this.src=i,this.env=t,this.options=a.options,this.tokens=[],this.inlineMode=!1,this.inline=a.inline,this.block=a.block,this.renderer=a.renderer,this.typographer=a.typographer}function at(a,i){typeof a!="string"&&(i=a,a="default"),i&&i.linkify!=null&&console.warn(`linkify option is removed. Use linkify plugin instead:

import Remarkable from 'remarkable';
import linkify from 'remarkable/linkify';
new Remarkable().use(linkify)
`),this.inline=new ur,this.block=new sa,this.core=new Zs,this.renderer=new aa,this.ruler=new $e,this.options={},this.configure(su[a]),this.set(i||{})}at.prototype.set=function(a){Gs(this.options,a)};at.prototype.configure=function(a){var i=this;if(!a)throw new Error("Wrong `remarkable` preset, check name/content");a.options&&i.set(a.options),a.components&&Object.keys(a.components).forEach(function(t){a.components[t].rules&&i[t].ruler.enable(a.components[t].rules,!0)})};at.prototype.use=function(a,i){return a(this,i),this};at.prototype.parse=function(a,i){var t=new Qs(this,a,i);return this.core.process(t),t.tokens};at.prototype.render=function(a,i){return i=i||{},this.renderer.render(this.parse(a,i),this.options,i)};at.prototype.parseInline=function(a,i){var t=new Qs(this,a,i);return t.inlineMode=!0,this.core.process(t),t.tokens};at.prototype.renderInline=function(a,i){return i=i||{},this.renderer.render(this.parseInline(a,i),this.options,i)};var ei=(function(){function a(){E(this,a)}return C(a,null,[{key:"addPlugins",value:function(t,e){var n=window.remarkable_plugins;if(n&&n.forEach(function(o){t.use(o.plugin,o.options)}),e!=null&&e.math){window.katex||(console.warn("window.katex not found, use chatElementRef.refreshMessages to re-render messages"),console.warn("See https://deepchat.dev/examples/externalModules"));var r=R(e.math)=="object"?e.math.delimiter:"",s=R(e.math)=="object"&&e.math.options?e.math.options:{};t.use(Eo.katex.bind(this,s),{delimiter:r})}}},{key:"instantiate",value:function(t){if(t)return new at(ie(ie({},a.DEFAULT_PROPERTIES),t));if(window.hljs){var e=window.hljs;return new at({highlight:function(r,s){if(s&&e.getLanguage(s))try{return e.highlight(r,{language:s}).value}catch(o){console[_]("failed to setup the highlight dependency")}try{return e.highlightAuto(r).value}catch(o){console[_]("failed to automatically highlight messages")}return""},html:!1,xhtmlOut:!1,breaks:!0,langPrefix:"language-",linkTarget:"_blank",typographer:!0})}else return new at(a.DEFAULT_PROPERTIES)}},{key:"createNew",value:function(t){var e=a.instantiate(t);return a.addPlugins(e,t),e.inline.validateLink=function(){return!0},e}}])})();ei.DEFAULT_PROPERTIES={breaks:!0,linkTarget:"_blank"};var Or=ei,iu=(function(){function a(i){E(this,a),this.storageKey="deep-chat-storage",this.maxMessages=1e3,this.trackInputText=!1,this.trackScrollHeight=!1,R(i)=="object"&&(i.key&&(this.storageKey=i.key),i.maxMessages&&(this.maxMessages=i.maxMessages),i.inputText!==void 0&&(this.trackInputText=i.inputText),i.scrollHeight!==void 0&&(this.trackScrollHeight=i.scrollHeight),i.clear=this.clear.bind(this),_e.processBrowserStorage(this))}return C(a,[{key:"get",value:function(){var t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):{messages:[]}}},{key:"set",value:function(t,e,n){var r={messages:t,inputText:e,scrollHeight:n};localStorage.setItem(this.storageKey,JSON.stringify(r))}},{key:"addMessages",value:function(t){var e=t.length-this.maxMessages;e<0&&(e=0);var n=t.slice(e,t.length),r=this.trackInputText||this.trackScrollHeight?localStorage.getItem(this.storageKey):void 0,s=r?JSON.parse(r):void 0;this.set(n,this.trackInputText?s==null?void 0:s.inputText:void 0,this.trackScrollHeight?s==null?void 0:s.scrollHeight:void 0)}},{key:"addInputText",value:function(t){if(this.trackInputText){var e=localStorage.getItem(this.storageKey),n=e?JSON.parse(e):void 0;this.set((n==null?void 0:n.messages)||[],t,this.trackScrollHeight?n==null?void 0:n.scrollHeight:void 0)}}},{key:"addScrollHeight",value:function(t){if(this.trackScrollHeight){var e=localStorage.getItem(this.storageKey),n=e?JSON.parse(e):void 0;this.set((n==null?void 0:n.messages)||[],this.trackInputText?n==null?void 0:n.inputText:void 0,t)}}},{key:"clear",value:function(){localStorage.removeItem(this.storageKey)}}])})(),Gn=(function(){function a(){E(this,a)}return C(a,null,[{key:"applyCustomStylesToElements",value:function(t,e,n){if(n&&(Object.assign(t.outerContainer[M],n.outerContainer),Object.assign(t.innerContainer[M],n.innerContainer),Object.assign(t.bubbleElement[M],n.bubble),e)){var r=t.bubbleElement.children[0],s=r.tagName.toLocaleLowerCase()!=="a"?r:r.children[0];Object.assign(s[M],n.media)}}},{key:"applySideStyles",value:function(t,e,n,r){r&&(a.applyCustomStylesToElements(t,n,r.shared),e===Z?a.applyCustomStylesToElements(t,n,r.user):(a.applyCustomStylesToElements(t,n,r.ai),a.applyCustomStylesToElements(t,n,r[e])))}},{key:"isElementsStyles",value:function(t){return!!(t.outerContainer||t.innerContainer||t.bubble||t.media)}},{key:"applyCustomStyles",value:function(t,e,n,r,s){var o;s&&t[O]!==s?a.isElementsStyles(s)?(a.applyCustomStylesToElements(e,r,(o=t[O])==null?void 0:o.shared),a.applyCustomStylesToElements(e,r,s)):(a.applySideStyles(e,n,r,t[O]),a.applySideStyles(e,n,r,s)):a.applySideStyles(e,n,r,t[O])}},{key:"extractParticularSharedStyles",value:function(t,e){if(e!=null&&e.shared){var n=e.shared,r={outerContainer:{},innerContainer:{},bubble:{},media:{}};return t.forEach(function(s){var o,l,u,c;r.outerContainer[s]=((o=n.outerContainer)==null?void 0:o[s])||"",r.innerContainer[s]=((l=n.innerContainer)==null?void 0:l[s])||"",r.bubble[s]=((u=n.bubble)==null?void 0:u[s])||"",r.media[s]=((c=n.media)==null?void 0:c[s])||""}),r}}}])})(),Ze=(function(){function a(){E(this,a)}return C(a,null,[{key:"setElementProps",value:function(t,e,n,r){var s;n!=="loading"&&(t.applyCustomStyles(e,r,!0,(s=t.messageStyles)==null?void 0:s[n]),e.bubbleElement[S].add(Ms))}},{key:"addMessage",value:function(t,e,n,r,s){a.setElementProps(t,e,n,r),s||t.appendOuterContainerElemet(e.outerContainer)}},{key:"wrapInLink",value:function(t,e,n){var r=B("a");return r.href=e,r.download=n||ve,r.target="_blank",r.appendChild(t),r}},{key:"isNonLinkableDataUrl",value:function(t,e){return!e.startsWith("data")||t===le?!1:t===Ct&&e.startsWith("data:text/javascript")||!e.startsWith("data:image")&&!e.startsWith("data:application")}},{key:"processContent",value:function(t,e,n,r){return!n||a.isNonLinkableDataUrl(t,n)?e:a.wrapInLink(e,n,r)}},{key:"waitToLoadThenScroll",value:function(t){setTimeout(function(){t()},60)}},{key:"scrollDownOnImageLoad",value:function(t,e){if(t.startsWith("data"))a.waitToLoadThenScroll(e);else try{fetch(t,{mode:"no-cors"}).catch(function(){}).finally(function(){a.waitToLoadThenScroll(e)})}catch(n){e()}}},{key:"reAddFileRefToObject",value:function(t,e){var n;(n=t[T])==null||n.forEach(function(r,s){var o;r.ref&&(o=e[T])!=null&&o[s]&&(e[T][s].ref=r.ref)})}},{key:"removeFileRef",value:function(t){var e=ie({},t);return delete e.ref,e}},{key:"isAudioFile",value:function(t){var e=/\.(mp3|ogg|wav|aac|webm|4a)$/i,n=t.type,r=t.src;return n===ee||(r==null?void 0:r.startsWith("data:audio"))||r&&e.test(r)}},{key:"isImageFile",value:function(t){var e=t.type,n=t.src;return e===le||(n==null?void 0:n.startsWith("data:image"))||n&&a.isImageFileExtension(n)}},{key:"isImageFileExtension",value:function(t){return/\.(jpg|jpeg|png|gif|bmp)$/i.test(t)}}])})(),Mt=(function(){function a(){E(this,a)}return C(a,null,[{key:"onMessage",value:function(t,e,n){var r,s=L({message:e,isHistory:n,isInitial:n});Ze.reAddFileRefToObject(e,s.message),(r=t.onMessage)==null||r.call(t,s),t.dispatchEvent(new CustomEvent("message",{detail:s})),_e.fireOnNewMessage(t,s)}},{key:"onClearMessages",value:function(t){var e;(e=t.onClearMessages)==null||e.call(t),t.dispatchEvent(new CustomEvent("clear-messages"))}},{key:"onRender",value:function(t){var e;(e=t.onComponentRender)==null||e.call(t,t),t.dispatchEvent(new CustomEvent("render",{detail:t}))}},{key:"onInput",value:function(t,e,n){var r,s,o=L({content:e,isUser:n});e[T]&&Ze.reAddFileRefToObject(f({},T,(r=e[T])==null?void 0:r.map(function(l){return{ref:l}})),o.content),(s=t.onInput)==null||s.call(t,o),t.dispatchEvent(new CustomEvent("input",{detail:o}))}},{key:"onError",value:function(t,e){var n;(n=t.onError)==null||n.call(t,e),t.dispatchEvent(new CustomEvent(_,{detail:e}))}}])})(),Kn=(function(){function a(){E(this,a)}return C(a,null,[{key:"generateLoadingRingElement",value:function(){var t=B();return t[S].add("loading-history"),t.appendChild(B()),t.appendChild(B()),t.appendChild(B()),t.appendChild(B()),t}},{key:"apply",value:function(t,e,n){dt.setRing(e.bubbleElement,n==null?void 0:n.bubble),n!=null&&n.bubble&&(n=L(n),delete n.bubble),t.applyCustomStyles(e,"history",!1,n)}},{key:"addLoadHistoryMessage",value:function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r,s,o,l,u,c,d,h;t.bubbleElement[S].add(a.CLASS);var p=n?a.FULL_VIEW_CLASS:a.SMALL_CLASS;t.outerContainer[S].add(p);var g=n?(l=(o=(s=(r=e.messageStyles)==null?void 0:r.loading)==null?void 0:s.history)==null?void 0:o.full)==null?void 0:l.styles:(h=(d=(c=(u=e.messageStyles)==null?void 0:u.loading)==null?void 0:c.history)==null?void 0:d.small)==null?void 0:h.styles;a.apply(e,t,g);var m=e.elementRef;n&&e.elementRef.id!==Rs&&(m=e.elementRef.parentElement),m==null||m.prepend(t.outerContainer)}},{key:"createDefaultElements",value:function(t){var e=t.createMessageElements("",me),n=e.bubbleElement,r=a.generateLoadingRingElement();return n.appendChild(r),e}},{key:"addMessage",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n,r,s,o,l=(o=(s=(r=(n=t.messageStyles)==null?void 0:n.loading)==null?void 0:r.history)==null?void 0:s.full)==null?void 0:o[V],u=l?ft.createElements(t,l,me,!0,!0):a.createDefaultElements(t);return a.addLoadHistoryMessage(u,t,e),ge.softRemRoleElements(u.innerContainer,t.avatar,t.name),u}},{key:"tryChangeViewToSmall",value:function(t,e){var n,r,s,o,l,u,c,d;if(e!=null&&e.outerContainer[S].contains(a.FULL_VIEW_CLASS)){e.outerContainer[S].replace(a.FULL_VIEW_CLASS,a.SMALL_CLASS);var h=(o=(s=(r=(n=t.messageStyles)==null?void 0:n.loading)==null?void 0:r.history)==null?void 0:s.small)==null?void 0:o.styles;h&&a.apply(t,e,h);var p=(d=(c=(u=(l=t.messageStyles)==null?void 0:l.loading)==null?void 0:u.history)==null?void 0:c.small)==null?void 0:d[V];return p&&(e.bubbleElement.innerHTML=p),!0}return!1}},{key:"changeFullViewToSmall",value:function(t){var e=t.messageElementRefs[t.messageElementRefs.length-1];a.tryChangeViewToSmall(t,e)||a.tryChangeViewToSmall(t,t.messageElementRefs[0])}}])})();Kn.CLASS="loading-history-message",Kn.FULL_VIEW_CLASS="loading-history-message-full-view",Kn.SMALL_CLASS="loading-history-message-small";var St=Kn,ti=(function(){function a(){E(this,a)}return C(a,null,[{key:"setFade",value:function(t,e){t[M].transitionDuration=typeof e=="number"?"".concat(e,"ms"):"".concat(a.DEFAULT_FADE_MS,"ms")}},{key:"fadeAnimation",value:(function(){var i=w(v().m(function e(n,r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:return n[M].opacity="0",s=typeof r=="number"?r:a.DEFAULT_FADE_MS,o.n=1,new Promise(function(l){setTimeout(function(){return l()},s)});case 1:n[M].opacity="1";case 2:return o.a(2)}},e)}));function t(e,n){return i.apply(this,arguments)}return t})()}])})();ti.DEFAULT_FADE_MS=500;var ni=ti,ou=(function(){function a(i,t,e){if(E(this,a),this.hiddenElements=new Set,this.isScrollButton=!1,this.isScrollingToBottom=!1,this._messages=i,t){var n,r={};R(t)=="object"&&(r=L(t),r.onUpdate=t.onUpdate),(n=r.styles)!==null&&n!==void 0||(r.styles={});var s="fit-content";r.styles.default=ie({borderRadius:"10px",width:s,height:s},r.styles.default),this.hiddenMessagesConfig=r,this.io=this.initIntersectionObserver(this._messages.elementRef)}if(e){var o,l=R(e)=="object"?L(e):{};(o=l.styles)!==null&&o!==void 0||(l.styles={}),l.styles.default=ie({borderRadius:"50%",width:"1.4rem",height:"1.4rem"},l.styles.default),this.scrollButtonConfig=l}this.element=this.createElement(),this._messages.elementRef.appendChild(this.element)}return C(a,[{key:"initIntersectionObserver",value:function(t){var e=this;return new IntersectionObserver(function(n){n.forEach(function(r){var s;r.isIntersecting&&e.hiddenElements.has(r.target)&&(e.hiddenElements.delete(r.target),(s=e.io)==null||s.unobserve(r.target),e.updateHiddenElement())})},{root:t,threshold:.1})}},{key:"createElement",value:function(){var t=this,e=B();return e.id="scroll-button",oe.assignButtonEvents(e,function(){var n,r,s,o=t.isScrollButton?(n=t.scrollButtonConfig)==null?void 0:n.smoothScroll:(r=t.hiddenMessagesConfig)==null?void 0:r.smoothScroll,l=typeof o=="boolean"?o:!0;if(t.isScrollButton||((s=t.hiddenMessagesConfig)==null?void 0:s.clickScroll)==="last")oe.scrollToBottom(t._messages,l),l&&t.element&&(a.hideElement(t.element),t.isScrollingToBottom=!0,oe.waitForScrollEnd(t._messages.elementRef,function(){t.isScrollingToBottom=!1}));else{var u=t.hiddenElements.values().next().value;u&&t._messages.elementRef.scrollTo({left:0,top:u.offsetTop,behavior:l?"smooth":"auto"})}}),Le.apply(this._messages,e),e}},{key:"assignStyles",value:function(t){if(this.element){Object.assign(this.element[M],t[O]);var e=Me.processStateful(t);or.add(this.element,e)}}},{key:"updateHiddenElement",value:function(){var t,e;if(this.element){this.isScrollButton=!1;var n=this.hiddenElements.size;if(n===0){a.hideElement(this.element);return}var r="".concat(n," new message").concat(n===1?"":"s");if((t=this.hiddenMessagesConfig)!=null&&t.onUpdate){var s=this.hiddenMessagesConfig.onUpdate(r,n);this.element.innerHTML=s,Le.apply(this._messages,this.element)}else this.element.innerHTML=r;(e=this.hiddenMessagesConfig)!=null&&e.styles&&this.assignStyles(this.hiddenMessagesConfig.styles),a.displayElement(this.element)}}},{key:"updateHidden",value:function(){var t,e;if(!this.isScrollingToBottom)if(this.hiddenMessagesConfig){var n=(t=this._messages.getFirstMessageContentEl())==null?void 0:t.outerContainer;n&&!oe.isVisibleInParent(n,this._messages.elementRef)&&(this.hiddenElements.add(n),(e=this.io)==null||e.observe(n),this.updateHiddenElement())}else this.updateScroll()}},{key:"clearHidden",value:function(){var t=this;this.hiddenElements.forEach(function(e){var n;return(n=t.io)==null?void 0:n.unobserve(e)}),this.hiddenElements.clear(),this.updateHiddenElement()}},{key:"displayScroll",value:function(){var t,e;this.element&&this.element[M].opacity!==Ta&&(a.displayElement(this.element),this.element.innerHTML=((t=this.scrollButtonConfig)==null?void 0:t.content)||'<span style="font-size: 1.2rem; user-select: none;">&darr;</span>',(e=this.scrollButtonConfig)!=null&&e.styles&&this.assignStyles(this.scrollButtonConfig.styles))}},{key:"updateScroll",value:function(){var t;this.isScrollingToBottom||!this.scrollButtonConfig||(oe.isScrollbarAtBottomOfElement(this._messages.elementRef,((t=this.scrollButtonConfig)==null?void 0:t.scrollDelta)||80)?this.element&&this.element[M].opacity!==Ca&&a.hideElement(this.element):(this.displayScroll(),this.isScrollButton=!0))}}],[{key:"displayElement",value:function(t){t[M].opacity=Ta,t[M].pointerEvents="auto"}},{key:"hideElement",value:function(t){t[M].opacity=Ca,t[M].pointerEvents="none"}}])})(),Ha="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3csvg%20fill='%23000000'%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%2032%2032'%20xml:space='preserve'%3e%3cpath%20d='M23,30.36H9c-2.404,0-4.36-1.956-4.36-4.36V15c0-2.404,1.956-4.36,4.36-4.36h3.659%20c0.167-1.566,1.415-2.813,2.981-2.981V5.333c-1.131-0.174-2-1.154-2-2.333c0-1.301,1.059-2.36,2.36-2.36%20c1.302,0,2.36,1.059,2.36,2.36c0,1.179-0.869,2.159-2,2.333V7.66c1.566,0.167,2.814,1.415,2.981,2.981H23%20c2.404,0,4.36,1.956,4.36,4.36v11C27.36,28.404,25.404,30.36,23,30.36z%20M9,11.36c-2.007,0-3.64,1.633-3.64,3.64v11%20c0,2.007,1.633,3.64,3.64,3.64h14c2.007,0,3.64-1.633,3.64-3.64V15c0-2.007-1.633-3.64-3.64-3.64H9z%20M13.384,10.64h5.231%20C18.439,9.354,17.334,8.36,16,8.36C14.667,8.36,13.561,9.354,13.384,10.64z%20M16,1.36c-0.904,0-1.64,0.736-1.64,1.64%20S15.096,4.64,16,4.64c0.904,0,1.64-0.736,1.64-1.64S16.904,1.36,16,1.36z%20M20,27.36h-8c-1.301,0-2.36-1.059-2.36-2.36%20s1.059-2.36,2.36-2.36h8c1.302,0,2.36,1.059,2.36,2.36S21.302,27.36,20,27.36z%20M12,23.36c-0.904,0-1.64,0.735-1.64,1.64%20s0.736,1.64,1.64,1.64h8c0.904,0,1.64-0.735,1.64-1.64s-0.735-1.64-1.64-1.64H12z%20M31,23.86h-2c-0.199,0-0.36-0.161-0.36-0.36V15%20c0-0.199,0.161-0.36,0.36-0.36h2c0.199,0,0.36,0.161,0.36,0.36v8.5C31.36,23.699,31.199,23.86,31,23.86z%20M29.36,23.14h1.279v-7.78%20H29.36V23.14z%20M3,23.86H1c-0.199,0-0.36-0.161-0.36-0.36V15c0-0.199,0.161-0.36,0.36-0.36h2c0.199,0,0.36,0.161,0.36,0.36v8.5%20C3.36,23.699,3.199,23.86,3,23.86z%20M1.36,23.14h1.28v-7.78H1.36V23.14z%20M20,20.36c-1.302,0-2.36-1.059-2.36-2.36%20s1.059-2.36,2.36-2.36s2.36,1.059,2.36,2.36C22.36,19.302,21.302,20.36,20,20.36z%20M20,16.36c-0.904,0-1.64,0.736-1.64,1.64%20s0.735,1.64,1.64,1.64s1.64-0.735,1.64-1.64S20.904,16.36,20,16.36z%20M12,20.36c-1.301,0-2.36-1.059-2.36-2.36s1.059-2.36,2.36-2.36%20s2.36,1.059,2.36,2.36C14.36,19.302,13.301,20.36,12,20.36z%20M12,16.36c-0.904,0-1.64,0.736-1.64,1.64s0.736,1.64,1.64,1.64%20s1.64-0.735,1.64-1.64S12.904,16.36,12,16.36z'/%3e%3crect%20style='fill:none;'%20width='32'%20height='32'/%3e%3c/svg%3e",Lr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6CAMAAAC/MqoPAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAADNQTFRF////9vX18vLy/Pz86enp4+Li2tnZ1tbWzczM+fn57Ozs4N/f09LS0M/P5uXl7+/v3dzcwtncCAAAAAFiS0dEAIgFHUgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAAZNSURBVHja7d3bdtsqEABQYABZSLH9/3+ZpnUsIcF5iOM6PfElNoMHMfPQdq3GmL0GkLhEUqLaUExnOtOZznSmM53pTGc605nOdKYznelMZzrTmV4LXSqllKyJDkob26xWq8Zae/iH0QoWTm9d1xur4WuypQJtTd+5dqn0VjcxzNO5/57mEBvdLo8Oron6aseWOjYOFkVvjQs3DmgyONMuht52EfztP+4hdu0i6LCO808/M8c1lE/fuPGej41uUzgdtoO/75N+2ELJ9I3b3//hPXbiMenm3pR/Jt4USgcLBIp4Bh10gqKVhvLo0klCxeSky96nKcj3siw6pJIL4XsoiQ7apyvMY/V3HHrSRioLopvEhSpTCn2TPEuwKYMOIX0tAxRBf/Hpa+lfSqBv9gi1FPsNfTrMAiVmIE/vJhz61FGnQxRIEYE4vfNYdN8Rp6MlHaHotHTn8ejekaZPAjEmyvQWdZFTtYTpXqCGJ0zvcek9Yfoel76nS0ffv1NMp1ca+pkgyfRCGind4L7OWWc605l+cxjsyhqy9AGbPpClc1/nvl5VX0c/3Alk6RU3+Am7shNZ+h6bvidLr7jBB+zKBrL0irOOudmIUDzTmf5gIP+iEuXtRuTVaEmY/oZLfyNMrzjryPc0gerMTdpVg0tvjJUU6bLPcGOoUv46SLL6Wi8yhLf06C7TUyekI0efRaaYqdFltkeNpPumRPSMDxgBYvSM035FrKAmH72hRW99PrpvSdEHkTEGUvSsK3yKVDkuJ92RohcZaehzzirPpOg+J92Tolfc4Cumx5xVXpGiZ34+ICX6W84qv5GiR5NPbiIpOv6BCoSvSkTX+eiaGP092zINvBOj4x8mSf9FqejvNo/cvpOji19ZbmviL0GPLsYMFzgzCor0+Bv/ePDvSJKOb9dJ5UlnbnEHiHgzv6cdTpJOWuc/u3FEucLDOL75xGtBiefrcwgoC9NDSH/jkH6pAuXmBqPQ9HSUPVdZBH1GGOrMXAQdYxcKZfxAoK+KKBKFLosoEoX+u4giUehz8jlcnAuhp78I46yDYNAd+QLR6K+pr+yvxdBTHyVDubQh0UfSxaHSd0lbvNkVRE87JGOtc+PQd2QLQ6fHhJkKsSh6yg13tO08JPprsgrrXWH0dJd2vH1MLPprot4eXoujpzrdhngiD40ek2y92lggPcnWa8qN1Yz0BFuvZhRl0uOfR0v4Ewuli/Bg4Qr3lArqGdndQ3UPO1EunXYwnelMZzrTmc50pjOd6UxnOtOZznSmM53pTGf6kuj6oedFKV0s3fX6sX1S3bsi6a4PD7+/YAqYeBw6pIB/4qEgOqxdSPbGiim4NRRCbzs3Jj0L4UfXtQXQVRfn5IdA/Bw7RZzurEV6EtdsLeGXkIPuA+K1UoVeA0l62zmN/LqfSSft9KkepmoRuvi3nd5uKNFB9zbbXEANqdr941XO0NJx2v2jdJenpf+/3bvn0ts16ph+sd6hX7dPo2+2cZzE02Ia43bzDHqr+2Evnhz74ZHU30ffbKOeng1/NPV30Ns1gYQnSP2P6e65Pfxc6h02XZqXQCjhJ6kPL6bFo4NrGvAU4UII4SE2P1vQuZkuOxckVfehisF1MjUddN/MZBN+kvq5uf0O/xa66gyNS9ktMWlz44rO1Z8C19i5FPdHzPamXn+F3hryPfxMr78+4F+kq22kO6Rf6fUQt+puuustyWv4rbG3l/duztFB96GYoe1cTBdXMr+nw9qVM6ZfxOvzezff0nXi/ZOndvrR6Zvpm0c3h6nhdb+5iS7tsIim/qXZD9+97/Jf+rpZ5BET1ayv0GUzLhEuhBBjIy/RdVPgndutIRt9nt7p5cKFEEJ3Z+jQFDZL+XnMDXxHB73gxn5s9Kc3d3/pFciFkN/QTSXHJpX5l66gDrkQoP6hL3xsPw39la4qOiV8tH78XeSbue6N9mvWa6J/ybpc1CT1Wnh5Qq9meP8IOKH3ddH7E/ri1iYux/SXDrXR4UiPdck/wUpU+FtPf6/orja6O9KL3l56LOvVxe5Ib2qjN0d6Vbex4ghWlU3bPqI90If66MNng680FNpbJijH6kCvaF3uMzQ3+IrpFerV4Y9dffQdN3im10ivbuImhD3Qq5u4HdZkua8znelMZ/pS4z9CPVKkxowNxgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wMy0yN1QxNTo0NToxNSswMDowMN1xSg4AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDMtMjdUMTU6NDU6MTUrMDA6MDCsLPKyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==",ri=(function(){function a(i){E(this,a),this.className=i}return C(a,[{key:"getAvatarContainer",value:function(t){return t.getElementsByClassName(this.className)[0]}},{key:"tryHide",value:function(t){var e;(e=this.getAvatarContainer(t)[M]).visibility||(e.visibility="hidden")}},{key:"tryReveal",value:function(t){this.getAvatarContainer(t)[M].visibility=""}},{key:"trySoftRem",value:function(t){this.getAvatarContainer(t)[S].add("role-hidden")}}])})(),lu=(function(a){function i(t){var e;return E(this,i),e=F(this,i,["avatar-container"]),e._avatars=t,e}return D(i,a),C(i,[{key:"addBesideBubble",value:function(e,n){var r=typeof this._avatars=="boolean"?void 0:this._avatars,s=this.createAvatar(n,r),o=this.getPosition(n,r);s[S].add(o===pt?"start-item-position":"end-item-position"),e.insertAdjacentElement(o===pt?"beforebegin":"afterend",s)}},{key:"createAvatar",value:function(e,n){var r,s,o,l,u,c=B("img");e===Z?(c[N]=((r=n==null?void 0:n[Z])==null?void 0:r[N])||((s=n==null?void 0:n[O])==null?void 0:s[N])||Lr,c.onerror=i.errorFallback.bind(this,Lr)):(c[N]=((o=n==null?void 0:n[e])==null?void 0:o[N])||((l=n==null?void 0:n[me])==null?void 0:l[N])||((u=n==null?void 0:n[O])==null?void 0:u[N])||Ha,c.onerror=i.errorFallback.bind(this,Ha)),c[S].add("avatar"),c.alt="".concat(e," avatar");var d=B();return d[S].add(this.className),d.appendChild(c),n&&i.applyCustomStyles(d,c,n,e),d}},{key:"getPosition",value:function(e,n){var r,s,o,l,u,c,d=_e.processPosition((s=(r=n==null?void 0:n[e])==null?void 0:r.styles)==null?void 0:s.position);return e!==Z&&(d!=null||(d=(l=(o=n==null?void 0:n.ai)==null?void 0:o.styles)==null?void 0:l.position)),d!=null||(d=(c=(u=n==null?void 0:n[O])==null?void 0:u.styles)==null?void 0:c.position),d!=null||(d=e===Z?Is:pt),d}}],[{key:"errorFallback",value:function(e,n){var r=n.target;r.onerror=null,r[N]=e}},{key:"applyCustomStylesToElements",value:function(e,n,r){Object.assign(e[M],r.container),Object.assign(n[M],r.avatar)}},{key:"applyCustomStyles",value:function(e,n,r,s){var o,l,u,c;if((o=r[O])!=null&&o.styles&&i.applyCustomStylesToElements(e,n,r[O].styles),s===Z)(l=r.user)!=null&&l.styles&&i.applyCustomStylesToElements(e,n,r.user.styles);else{(u=r.ai)!=null&&u.styles&&i.applyCustomStylesToElements(e,n,r.ai.styles);var d=(c=r[s])==null?void 0:c.styles;d&&i.applyCustomStylesToElements(e,n,d)}}}])})(ri),uu=(function(a){function i(t){var e;return E(this,i),e=F(this,i,["name"]),e._names=t,e}return D(i,a),C(i,[{key:"addBesideBubble",value:function(e,n){var r=typeof this._names=="boolean"?{}:this._names,s=this.createName(n,r),o=i.getPosition(n,r);s[S].add(o===pt?"start-item-position":"end-item-position"),e.insertAdjacentElement(o===pt?"beforebegin":"afterend",s)}},{key:"createName",value:function(e,n){var r=B();return r[S].add(this.className),r.textContent=i.getNameText(e,n),i.applyStyle(r,e,n),r}}],[{key:"getPosition",value:function(e,n){var r,s,o,l=_e.processPosition((r=n==null?void 0:n[e])==null?void 0:r.position);return e!==Z&&(l!=null||(l=(s=n==null?void 0:n[me])==null?void 0:s.position)),l!=null||(l=(o=n==null?void 0:n[O])==null?void 0:o.position),l!=null||(l=e===Z?Is:pt),l}},{key:"applyStyle",value:function(e,n,r){var s,o,l,u;Object.assign(e[M],(s=r[O])==null?void 0:s[M]),n===Z?Object.assign(e[M],(o=r[Z])==null?void 0:o[M]):(Object.assign(e[M],(l=r[me])==null?void 0:l[M]),Object.assign(e[M],(u=r[n])==null?void 0:u[M]))}},{key:"getNameText",value:function(e,n){var r,s,o,l,u,c;return e===Z?((r=n[Z])==null?void 0:r[y])||((s=n[O])==null?void 0:s[y])||"User":e===me?((o=n[me])==null?void 0:o[y])||((l=n[O])==null?void 0:l[y])||"AI":((u=n[e])==null?void 0:u[y])||((c=n[O])==null?void 0:c[y])||e}}])})(ri),Vn=(function(){function a(i){var t=this;E(this,a);var e,n,r,s;this.messageElementRefs=[],this.htmlClassUtilities={},this.messageToElements=[],this.maxVisibleMessages=4e3,this.autoScrollAllowed=!0,this.elementRef=a.createContainerElement(),this.messageStyles=_e.processMessageStyles(i.messageStyles),this._remarkable=Or.createNew(i.remarkable),this._applyHTMLToRemarkable=(e=i.remarkable)==null?void 0:e.applyHTML,i.avatars&&(this.avatar=new lu(i.avatars)),i.names&&(this.name=new uu(i.names)),i.browserStorage&&(this.browserStorage=new iu(i.browserStorage)),this._onMessage=Mt.onMessage.bind(this,i),i.htmlClassUtilities&&(this.htmlClassUtilities=i.htmlClassUtilities),(i.hiddenMessages||i.scrollButton)&&(this.scrollButton=new ou(this,i.hiddenMessages,i.scrollButton)),this.focusMode=_e.processFocusMode(i.focusMode),this.focusMode||(this._lastGroupMessagesElement=B(),this.elementRef.appendChild(this._lastGroupMessagesElement),i.upwardsMode&&(this.elementRef=this._lastGroupMessagesElement)),typeof this.focusMode!="boolean"&&(n=this.focusMode)!=null&&n.fade&&ni.setFade(this.elementRef,this.focusMode.fade),this._customWrappers=i.htmlWrappers||_e.processStreamHTMLWrappers((r=i.connect)==null?void 0:r.stream),typeof this.focusMode!="boolean"&&((s=this.focusMode)==null?void 0:s.streamAutoScroll)===!1&&(this.autoScrollAllowed=!1),i.maxVisibleMessages&&(this.maxVisibleMessages=i.maxVisibleMessages),setTimeout(function(){t.submitUserMessage=i.submitUserMessage})}return C(a,[{key:"addNewTextMessage",value:function(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(n!=null&&n.status){var s=this.overwriteText(e,t,this.messageElementRefs);if(s)return s;n.status=!1}var o=r?this.createAndPrependNewMessageElement(t,e,r):this.createAndAppendNewMessageElement(t,e);return o.bubbleElement[S].add(a.TEXT_BUBBLE_CLASS),this.applyCustomStyles(o,e,!1),ge.fillEmptyMessageElement(o.bubbleElement,t),o}},{key:"overwriteText",value:function(t,e,n){var r=ge.overwriteMessage(this.messageToElements,n,e,t,"text",a.TEXT_BUBBLE_CLASS);return r&&this.renderText(r.bubbleElement,e,t),r}},{key:"createAndAppendNewMessageElement",value:function(t,e){var n=this.createNewMessageElement(t,e);return this.appendOuterContainerElemet(n.outerContainer,this.focusMode?e:void 0),n}},{key:"createNewGroupElementFocusMode",value:function(){var t;(t=this._lastGroupMessagesElement)==null||t[S].remove(a.LAST_GROUP_MESSAGES_ACTIVE);var e=B();(this.messageToElements.length>1||this.messageToElements.length===1&&this.messageToElements[0][0][P]!==Z)&&e[S].add(a.LAST_GROUP_MESSAGES_ACTIVE),this._lastGroupMessagesElement=e}},{key:"appendOuterContainerElemet",value:function(t,e){var n;this.focusMode&&(e===Z||!this._lastGroupMessagesElement)&&this.createNewGroupElementFocusMode(),(n=this._lastGroupMessagesElement)==null||n.appendChild(t),this._lastGroupMessagesElement&&(this.focusMode||!this.elementRef.contains(this._lastGroupMessagesElement))&&this.elementRef.appendChild(this._lastGroupMessagesElement)}},{key:"createAndPrependNewMessageElement",value:function(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s,o=this.createNewMessageElement(t,e,n,r);if(n&&(s=this.elementRef.firstChild)!=null&&s[S].contains(a.INTRO_CLASS)){this.elementRef.firstChild.insertAdjacentElement("afterend",o.outerContainer);var l=this.messageElementRefs[0];this.messageElementRefs[0]=this.messageElementRefs[1],this.messageElementRefs[1]=l}else this.elementRef.insertBefore(o.outerContainer,this.elementRef.firstChild);return o}},{key:"createMessageElementsOnOrientation",value:function(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return n?this.createAndPrependNewMessageElement(t,e,n,r):this.createNewMessageElement(t,e,n,r)}},{key:"getNumberOfContentMessages",value:function(){var t,e,n=this.messageElementRefs.length;return(e=(t=this.messageElementRefs[n-1])==null?void 0:t.bubbleElement)!=null&&e[S].contains(dt.BUBBLE_CLASS)?n-1:n}},{key:"createNewMessageElement",value:function(t,e){var n=this,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o;!s&&this.getNumberOfContentMessages()>=this.maxVisibleMessages&&setTimeout(function(){return n.removeFirstMessage()}),s||(o=this._introPanel)==null||o.hide();var l=this.messageElementRefs[this.messageElementRefs.length-1];return St.changeFullViewToSmall(this),!r&&a.isTemporaryElement(l)&&(this.revealRoleElementsIfTempRemoved(l,e),this.removeLastMessage()),this.createMessageElements(t,e,r)}},{key:"revealRoleElementsIfTempRemoved",value:function(t,e){if((this.avatar||this.name)&&Ht.isElementTemporary(t)){var n=this.messageElementRefs[this.messageElementRefs.length-2];n&&this.messageToElements.length>0&&!t.bubbleElement[S].contains(ge.getRoleClass(e))&&ge.revealRoleElements(n.innerContainer,this.avatar,this.name)}}},{key:"createElements",value:function(t,e){var n=a.createBaseElements(e),r=n.outerContainer,s=n.innerContainer,o=n.bubbleElement;return r.appendChild(s),this.addInnerContainerElements(o,t,e),n}},{key:"createMessageElements",value:function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=this.createElements(t,e);return ge.updateRefArr(this.messageElementRefs,r,n),ge.classifyRoleMessages(this.messageElementRefs,e),r}},{key:"addInnerContainerElements",value:function(t,e,n){var r=this.messageElementRefs[this.messageElementRefs.length-1];return ge.areOuterContainerClassRolesSame(n,r)&&!this.isLastMessageError()&&ge.hideRoleElements(r.innerContainer,this.avatar,this.name),t[S].add("message-bubble",ge.getRoleClass(n),n===Z?"user-message-text":"ai-message-text"),this.renderText(t,e,n),ge.addRoleElements(t,n,this.avatar,this.name),{bubbleElement:t}}},{key:"applyCustomStyles",value:function(t,e,n,r){t&&this.messageStyles&&Gn.applyCustomStyles(this.messageStyles,t,e,n,r)}},{key:"removeMessage",value:function(t){t.outerContainer.remove();var e=this.messageElementRefs.findIndex(function(n){return n===t});this.messageElementRefs.splice(e,1)}},{key:"removeFirstMessage",value:function(){this.messageElementRefs[0].outerContainer.remove(),this.messageElementRefs.shift()}},{key:"removeLastMessage",value:function(){this.messageElementRefs[this.messageElementRefs.length-1].outerContainer.remove(),this.messageElementRefs.pop()}},{key:"isLastMessageError",value:function(){var t;return(t=ge.getLastMessageBubbleElement(this.elementRef))==null?void 0:t[S].contains(er)}},{key:"sendClientUpdate",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n;(n=this._onMessage)==null||n.call(this,t,e)}},{key:"renderText",value:function(t,e,n){var r=Le.tryAddWrapper(t,e,this._customWrappers,n),s=r.contentEl,o=r.wrapper;o&&Le.apply(this,t),s.innerHTML=this._remarkable.render(e),this._applyHTMLToRemarkable&&Le.apply(this,s),s.innerText.trim().length===0&&s.children.length>0&&s.children[0].tagName!=="P"&&(s.innerText=e)}},{key:"refreshTextMessages",value:function(t){var e=this;this._remarkable=Or.createNew(t),this.messageToElements.forEach(function(n){n[1][y]&&n[0][y]&&e.renderText(n[1][y].bubbleElement,n[0][y],n[0][P])})}},{key:"getFirstMessageContentEl",value:function(){var t=this.messageToElements[this.messageToElements.length-1][1],e=t.text,n=t.html,r=t.files;return e||n||(r==null?void 0:r[0])}},{key:"scrollToFirstElement",value:function(t,e){var n;if(t===Z){var r=typeof this.focusMode!="boolean"&&((n=this.focusMode)==null?void 0:n.smoothScroll);oe.scrollToBottom(this,r)}else if(e&&this.autoScrollAllowed){var s=this.getFirstMessageContentEl();oe.scrollToBottom(this,!1,s==null?void 0:s.outerContainer)}}}],[{key:"createContainerElement",value:function(){var t=B();return t.id=Rs,t}},{key:"isTemporaryElement",value:function(t){return a.isLoadingMessage(t)||Ht.isElementTemporary(t)}},{key:"createBaseElements",value:function(t){var e=B(),n=B();n[S].add("inner-message-container"),e.appendChild(n),e[S].add("outer-message-container"),e[S].add(ge.buildRoleOuterContainerClass(t));var r=B();return r[S].add("message-bubble"),n.appendChild(r),{outerContainer:e,innerContainer:n,bubbleElement:r}}},{key:"createMessageContent",value:function(t){var e=t.text,n=t.files,r=t.html,s=t.custom,o=t._sessionId,l=t.role,u=f({},P,l||me);return e&&(u[y]=e),n&&(u[T]=n),r&&(u[V]=r),!e&&!n&&!r&&(u[y]=""),s&&(u.custom=s),o&&(u._sessionId=o),u}},{key:"isLoadingMessage",value:function(t){return t==null?void 0:t.bubbleElement[S].contains(dt.BUBBLE_CLASS)}}])})();Vn.TEXT_BUBBLE_CLASS="text-message",Vn.INTRO_CLASS="deep-chat-intro",Vn.LAST_GROUP_MESSAGES_ACTIVE="deep-chat-last-group-messages-active";var nt=Vn,ge=(function(){function a(){E(this,a)}return C(a,null,[{key:"getLastElementsByClass",value:function(t,e,n){for(var r=function(){var u=t[o];if(u.bubbleElement[S].contains(e[0])&&!e.slice(1).find(function(c){return!u.bubbleElement[S].contains(c)}))if(n){if(!n.find(function(c){return u.bubbleElement[S].contains(c)}))return{v:u}}else return{v:u}},s,o=t.length-1;o>=0;o-=1)if(s=r(),s)return s.v}},{key:"getLastMessage",value:function(t,e,n){for(var r=t.length-1;r>=0;r-=1)if(t[r][0][P]===e)if(n){if(t[r][0][n])return t[r][0]}else return t[r][0]}},{key:"getLastTextToElement",value:function(t,e){for(var n=t.length-1;n>=0;n-=1)if(t[n][0]===e)return t[n]}},{key:"overwriteMessage",value:function(t,e,n,r,s,o){var l=a.getLastElementsByClass(e,[a.getRoleClass(r),o],[dt.BUBBLE_CLASS]),u=a.getLastMessage(t,r,s);return u&&(u[s]=n),l}},{key:"getRoleClass",value:function(t){return"".concat(t,"-message")}},{key:"fillEmptyMessageElement",value:function(t,e){e.trim().length===0&&(t[S].add(wa),t.innerHTML='<div style="color:#00000000">.</div>')}},{key:"unfillEmptyMessageElement",value:function(t,e){t[S].contains(wa)&&e.trim().length>0&&t.replaceChildren()}},{key:"getLastMessageBubbleElement",value:function(t){var e,n,r;return Array.from(((r=(n=(e=a.getLastMessageElement(t))==null?void 0:e.children)==null?void 0:n[0])==null?void 0:r.children)||[]).find(function(s){return s[S].contains("message-bubble")})}},{key:"getLastMessageElement",value:function(t){var e,n=(e=t.children[t.children.length-1])==null?void 0:e.children;return n==null?void 0:n[n.length-1]}},{key:"addRoleElements",value:function(t,e,n,r){n==null||n.addBesideBubble(t,e),r==null||r.addBesideBubble(t,e)}},{key:"hideRoleElements",value:function(t,e,n){e==null||e.tryHide(t),n==null||n.tryHide(t)}},{key:"revealRoleElements",value:function(t,e,n){e==null||e.tryReveal(t),n==null||n.tryReveal(t)}},{key:"softRemRoleElements",value:function(t,e,n){e==null||e.trySoftRem(t),n==null||n.trySoftRem(t)}},{key:"updateRefArr",value:function(t,e,n){n?t.unshift(e):t.push(e)}},{key:"buildRoleOuterContainerClass",value:function(t){return"".concat(On).concat(t)}},{key:"addNewPositionClasses",value:function(t,e){var n;t.outerContainer[S].remove(yr,Ea,br),(n=t.outerContainer[S]).add.apply(n,_t(e))}},{key:"getNumberOfElements",value:function(t){var e=0;return t[y]!==void 0&&(e+=1),t[V]!==void 0&&(e+=1),t[T]&&(e+=t[T].length),e}},{key:"filterdMessageElements",value:function(t,e){return t.filter(function(n){return n.bubbleElement[S].contains(e)})}},{key:"findMessageElements",value:function(t,e){return t.find(function(n){return n.bubbleElement[S].contains(e)})}},{key:"generateMessageBodyElements",value:function(t,e){var n={};return t[y]&&(n[y]=a.findMessageElements(e,nt.TEXT_BUBBLE_CLASS)),t[V]&&(n[V]=a.findMessageElements(e,ft.HTML_BUBBLE_CLASS)),t[T]&&(n[T]=a.filterdMessageElements(e,Ms)),n}},{key:"generateMessageBody",value:function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=a.getNumberOfElements(t),s=n?e.slice(0,r):e.slice(e.length-r);return a.generateMessageBodyElements(t,s)}},{key:"classifyRoleMessages",value:function(t,e){for(var n=e?a.buildRoleOuterContainerClass(e):void 0,r=t.length-1;r>=0;r-=1)if(e||(n=Array.from(t[r].outerContainer[S]).find(function(h){return h.startsWith(On)})),!!n){var s=t[r],o=s.outerContainer[S].contains(n),l=t[r-1],u=t[r+1],c=l==null?void 0:l.outerContainer[S].contains(n),d=u==null?void 0:u.outerContainer[S].contains(n);if(o)!c&&d?a.addNewPositionClasses(s,[yr]):c&&d?a.addNewPositionClasses(s,[Ea]):c&&!d?a.addNewPositionClasses(s,[br]):!c&&!d&&a.addNewPositionClasses(s,[yr,br]);else if(e)break}}},{key:"areOuterContainerClassRolesSame",value:function(t,e){return e?Array.from(e.outerContainer[S]).find(function(n){return n.startsWith(On)})===a.buildRoleOuterContainerClass(t):!1}},{key:"resetAllRoleElements",value:function(t,e,n){if(!(!e&&!n)){var r="";t.forEach(function(s,o){s.bubbleElement[S].contains(er)||a.revealRoleElements(s.innerContainer,e,n);var l=Array.from(s.outerContainer[S]).find(function(u){return u.startsWith(On)});r===l&&a.hideRoleElements(t[o-1].innerContainer,e,n),r=l})}}},{key:"deepCloneMessagesWithReferences",value:function(t){return t.map(function(e){return a.processMessageContent(e)})}},{key:"processMessageContent",value:function(t){if(t==null||R(t)!==Q)return t;if(Array.isArray(t))return t.map(function(n){return a.processMessageContent(n)});var e={};return Object.entries(t).forEach(function(n){var r=wt(n,2),s=r[0],o=r[1];s==="ref"&&o instanceof File||s==="custom"?e[s]=o:o!==null&&R(o)===Q?e[s]=a.processMessageContent(o):e[s]=o}),e}}])})(),Fr=(function(){function a(i,t){E(this,a),this._fileAdded=!1,this._streamType="",this._hasStreamEnded=!1,this._partialContent="",this._messages=i,R(t)=="object"&&(this._partialRender=t.partialRender)}return C(a,[{key:"upsertStreamedMessage",value:function(t){if(!this._hasStreamEnded){if((t==null?void 0:t[y])===void 0&&(t==null?void 0:t[V])===void 0)return console[_](xs);var e=(t==null?void 0:t[y])||(t==null?void 0:t[V])||"",n=oe.isScrollbarAtBottomOfElement(this._messages.elementRef),r=(t==null?void 0:t[y])!==void 0?y:V;if(!this._elements&&!this._message)this.setInitialState(r,e,t==null?void 0:t[P]);else{if(this._streamType!==r)return console[_](mo);t!=null&&t[P]&&(t==null?void 0:t[P])!==this._activeMessageRole?(this.finaliseStreamedMessage(!1),this.setInitialState(r,e,t==null?void 0:t[P])):this.updateBasedOnType(e,r,t==null?void 0:t.overwrite)}t!=null&&t._sessionId&&(this._sessionId=t==null?void 0:t._sessionId),t!=null&&t.custom&&this._message&&(this._message.custom=t.custom),n&&oe.scrollToBottom(this._messages)}}},{key:"setInitialState",value:function(t,e,n){var r,s,o;this._streamType=t,this._targetWrapper=void 0,this._fileAdded=!1,this._partialContent="",this._partialBubble=void 0,n!=null||(n=me);var l=((r=this._messages._customWrappers)==null?void 0:r[n])||((s=this._messages._customWrappers)==null?void 0:s[O]),u=l?"":e;this._elements=t===y?this._messages.addNewTextMessage(u,n):ft.add(this._messages,u,n),this._elements&&(this._elements.bubbleElement[S].add(a.MESSAGE_CLASS),this._activeMessageRole=n,this._message=f(f({},P,this._activeMessageRole),t,u),this._messages.messageToElements.push([this._message,f({},t,this._elements)]),l&&this.setTargetWrapperIfNeeded(this._elements,e,this._streamType,l),(o=this._messages.scrollButton)==null||o.updateHidden())}},{key:"setTargetWrapperIfNeeded",value:function(t,e,n,r){t.bubbleElement.innerHTML=r,this._targetWrapper=Le.getTargetWrapper(t.bubbleElement),this._elements&&Le.apply(this._messages,this._elements.bubbleElement),this.updateBasedOnType(e,n)}},{key:"updateBasedOnType",value:function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r,s=this._targetWrapper||((r=this._elements)==null?void 0:r.bubbleElement);this._partialRender||ge.unfillEmptyMessageElement(s,t),(e===y?this.updateText:this.updateHTML).bind(this)(t,s,n)}},{key:"updateText",value:function(t,e,n){this._message&&(this._message[y]=n?t:this._message[y]+t,this._partialRender&&this.isNewPartialRenderParagraph(e,n)&&this.partialRenderNewParagraph(e),this._partialBubble?this.updatePartialRenderBubble(t):this._messages.renderText(e,this._message[y]))}},{key:"containsPartialRenderMark",value:function(t){var e=t.indexOf(a.PARTIAL_RENDER_MARK);return e===-1?!1:!t.substring(e+a.PARTIAL_RENDER_MARK.length).startsWith("---")}},{key:"isNewPartialRenderParagraph",value:function(t,e){var n;if(e)return t.innerHTML="",!0;var r=this._streamType;if(!this._partialBubble){var s=(n=this._message)==null?void 0:n[r];return!!s&&this.containsPartialRenderMark(s)}return!!this._partialContent&&this.containsPartialRenderMark(this._partialContent)}},{key:"partialRenderNewParagraph",value:function(t){this._partialContent="",this._partialBubble=B(),this._partialBubble[S].add("partial-render-message"),t.appendChild(this._partialBubble)}},{key:"updatePartialRenderBubble",value:function(t){this._partialContent+=t,this._streamType===y?this._messages.renderText(this._partialBubble,this._partialContent):this._partialBubble.innerHTML=this._partialContent}},{key:"updateHTML",value:function(t,e,n){if(this._message)if(this._message[V]=n?t:(this._message[V]||"")+t,this._partialRender&&this.isNewPartialRenderParagraph(e,n)&&this.partialRenderNewParagraph(e),this._partialBubble)this.updatePartialRenderBubble(t);else if(n)e.innerHTML=t;else{var r=B("span");r.innerHTML=t,e.appendChild(r)}}},{key:"finaliseStreamedMessage",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e,n;if(!this._endStreamAfterOperation&&!(this._fileAdded&&!this._elements)){if(!this._elements)throw Error(vo);this._message&&(e=this._elements.bubbleElement)!=null&&e[S].contains(a.MESSAGE_CLASS)&&(this._streamType===y?this._messages.textToSpeech&&Wn.speak(this._message[y]||"",this._messages.textToSpeech):this._streamType===V&&this._elements&&Le.apply(this._messages,this._elements.outerContainer),this._elements.bubbleElement[S].remove(a.MESSAGE_CLASS),this._message&&(this._sessionId&&(this._message._sessionId=this._sessionId),this._messages.sendClientUpdate(nt.createMessageContent(this._message),!1),(n=this._messages.browserStorage)==null||n.addMessages(this._messages.messageToElements.map(function(r){var s=wt(r,1),o=s[0];return o}))),this._hasStreamEnded=t)}}},{key:"markFileAdded",value:function(){this._fileAdded=!0}},{key:"endStreamAfterFileDownloaded",value:(function(){var i=w(v().m(function e(n,r){var s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:return this._endStreamAfterOperation=!0,u.n=1,r();case 1:s=u.v,o=s.text,l=s.files,o&&this.updateBasedOnType(o,y,!0),this._endStreamAfterOperation=!1,this.finaliseStreamedMessage(),l&&n.addNewMessage(f({},T,l));case 2:return u.a(2)}},e,this)}));function t(e,n){return i.apply(this,arguments)}return t})()}])})();Fr.MESSAGE_CLASS="streamed-message",Fr.PARTIAL_RENDER_MARK=`

`;var ot=Fr,Y=(function(){function a(){E(this,a)}return C(a,null,[{key:"tempRemoveContentHeader",value:(function(){var i=w(v().m(function e(n,r,s){var o,l,u;return v().w(function(c){for(;;)switch(c.p=c.n){case 0:if(n!=null&&n.headers){c.n=1;break}throw new Error(qe);case 1:return o=n.headers[te],delete n.headers[te],c.p=2,c.n=3,r(s);case 3:l=c.v,c.n=5;break;case 4:throw c.p=4,u=c.v,n.headers[te]=o,u;case 5:return c.a(2,(n.headers[te]=o,l))}},e,null,[[2,4]])}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"displayError",value:function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"Service error, please try again.";if(console[_](e),R(e)===Q)return e instanceof Error?t.addNewErrorMessage(ye,e.message):Array.isArray(e)||typeof e[_]=="string"?t.addNewErrorMessage(ye,e):Object.keys(e).length===0?t.addNewErrorMessage(ye,n):t.addNewErrorMessage(ye,JSON.stringify(e));t.addNewErrorMessage(ye,e)}},{key:"fetch",value:(function(i){function t(e,n,r,s){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t})(function(i,t,e,n){var r,s,o={method:((r=i.connectSettings)==null?void 0:r.method)||Te,headers:t};return o.method!==Se&&(o.body=e?JSON.stringify(n):n),i.connectSettings.credentials&&(o.credentials=i.connectSettings.credentials),fetch(((s=i.connectSettings)==null?void 0:s.url)||i.url||"",o)})},{key:"processResponseByType",value:function(t){var e=t.headers.get("content-type");return e!=null&&e.includes(fe)?t.json():e!=null&&e.includes("text/plain")||!e?t:t.blob()}},{key:"processRequestInterceptor",value:(function(){var i=w(v().m(function e(n,r){var s,o,l,u,c;return v().w(function(d){for(;;)switch(d.n){case 0:return d.n=1,(s=n.requestInterceptor)==null?void 0:s.call(n,r);case 1:if(c=d.v,c){d.n=2;break}c=r;case 2:return o=c,l=o,u=o,d.a(2,{body:l.body,headers:l.headers,error:u[_]})}},e)}));function t(e,n){return i.apply(this,arguments)}return t})()},{key:"validateResponseFormat",value:function(t,e){if(!t)return!1;var n=Array.isArray(t)?t:[t];return e&&n.length>1?(console[_](Ps),!1):!n.find(function(r){return R(r)!="object"||!(typeof r[_]=="string"||typeof r[y]=="string"||typeof r[V]=="string"||Array.isArray(r[T]))})}},{key:"onInterceptorError",value:function(t,e,n){t.addNewErrorMessage(ye,e),n==null||n()}},{key:"basicResponseProcessing",value:(function(){var i=w(v().m(function e(n,r){var s,o,l,u,c,d,h,p,g,m,b=arguments,k;return v().w(function(A){for(;;)switch(A.n){case 0:if(s=b.length>2&&b[2]!==void 0?b[2]:{},o=s.io,l=s.displayError,u=l===void 0?!0:l,c=s.useRI,d=c===void 0?!0:c,o!=null&&o.extractResultData){A.n=1;break}return A.a(2,r);case 1:return h=d?o.deepChat.responseInterceptor:void 0,A.n=2,h==null?void 0:h(r);case 2:if(k=A.v,k){A.n=3;break}k=r;case 3:return p=k,A.n=4,o.extractResultData(p);case 4:if(g=A.v,!(!g||R(g)!="object"&&!Array.isArray(g))){A.n=5;break}return u&&(m=jt(r,"response",!!h,p),a.displayError(n,m)),A.a(2);case 5:return A.a(2,g)}},e)}));function t(e,n){return i.apply(this,arguments)}return t})()}])})();function cu(a,i){return Dr.apply(this,arguments)}function Dr(){return Dr=w(v().m(function a(i,t){var e,n;return v().w(function(r){for(;;)switch(r.n){case 0:e=i.getReader();case 1:return r.n=2,e.read();case 2:if((n=r.v).done){r.n=4;break}t(n.value);case 3:r.n=1;break;case 4:return r.a(2)}},a)})),Dr.apply(this,arguments)}function du(a){var i,t,e,n=!1;return function(r){i===void 0?(i=r,t=0,e=-1):i=pu(i,r);for(var s=i.length,o=0;t<s;){n&&(i[t]===10&&(o=++t),n=!1);for(var l=-1;t<s&&l===-1;++t)switch(i[t]){case 58:e===-1&&(e=t-o);break;case 13:n=!0;case 10:l=t;break}if(l===-1)break;a(i.subarray(o,l),e),o=t,e=-1}o===s?i=void 0:o!==0&&(i=i.subarray(o),t-=o)}}function hu(a,i,t){var e=qa(),n=new TextDecoder;return function(r,s){if(r.length===0)t==null||t(e),e=qa();else if(s>0){var o=n.decode(r.subarray(0,s)),l=s+(r[s+1]===32?2:1),u=n.decode(r.subarray(l));switch(o){case"data":e.data=e.data?e.data+`
`+u:u;break;case"event":e.event=u;break;case"id":a(e.id=u);break;case"retry":var c=parseInt(u,10);isNaN(c)||i(e.retry=c);break}}}}function pu(a,i){var t=new Uint8Array(a.length+i.length);return t.set(a),t.set(i,a.length),t}function qa(){return{data:"",event:"",id:"",retry:void 0}}var fu=function(i,t){var e={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.indexOf(n)<0&&(e[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(i);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(i,n[r])&&(e[n[r]]=i[n[r]]);return e},Nr="text/event-stream",mu=1e3,za="last-event-id";function vu(a,i){var t=i.signal,e=i.headers,n=i.onopen,r=i.onmessage,s=i.onclose,o=i.onerror,l=i.openWhenHidden,u=i.fetch,c=fu(i,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise(function(d,h){var p=Object.assign({},e);p.accept||(p.accept=Nr);var g;function m(){g.abort(),document.hidden||U()}l||document.addEventListener("visibilitychange",m);var b=mu,k=0;function A(){document.removeEventListener("visibilitychange",m),window.clearTimeout(k),g.abort()}t==null||t.addEventListener("abort",function(){A(),d()});var I=u!=null?u:window.fetch,x=n!=null?n:gu;function U(){return j.apply(this,arguments)}function j(){return j=w(v().m(function J(){var G,he,se,ne;return v().w(function(q){for(;;)switch(q.p=q.n){case 0:return g=new AbortController,q.p=1,q.n=2,I(a,Object.assign(Object.assign({},c),{headers:p,signal:g.signal}));case 2:return he=q.v,q.n=3,x(he);case 3:return q.n=4,cu(he.body,du(hu(function(Ie){Ie?p[za]=Ie:delete p[za]},function(Ie){b=Ie},r)));case 4:s==null||s(),A(),d(),q.n=6;break;case 5:if(q.p=5,ne=q.v,!g.signal.aborted)try{se=(G=o==null?void 0:o(ne))!==null&&G!==void 0?G:b,window.clearTimeout(k),k=window.setTimeout(U,se)}catch(Ie){A(),h(Ie)}case 6:return q.a(2)}},J,null,[[1,5]])})),j.apply(this,arguments)}U()})}function gu(a){var i=a.headers.get("content-type");if(!(i!=null&&i.startsWith(Nr)))throw new Error("Expected content-type to be ".concat(Nr,", Actual: ").concat(i))}var Ce=(function(){function a(){E(this,a)}return C(a,null,[{key:"request",value:(function(){var i=w(v().m(function e(n,r,s){var o,l,u,c,d,h,p,g,m,b,k,A,I,x,U=arguments;return v().w(function(j){for(;;)switch(j.n){case 0:return o=U.length>3&&U[3]!==void 0?U[3]:!0,l=U.length>4&&U[4]!==void 0?U[4]:!1,g={body:r,headers:(u=n.connectSettings)==null?void 0:u.headers},j.n=1,Y.processRequestInterceptor(n.deepChat,g);case 1:if(m=j.v,b=m.body,k=m.headers,A=m.error,!A){j.n=2;break}return j.a(2,Y.onInterceptorError(s,A,n.streamHandlers.onClose));case 2:if(!((c=n.connectSettings)!=null&&c.handler)){j.n=3;break}return j.a(2,oa.stream(n,b,s));case 3:if(((d=n.connectSettings)==null?void 0:d.url)!==ct.URL){j.n=4;break}return j.a(2,ct.requestStream(s,n));case 4:return I=new ot(s,n.stream),x={method:((h=n.connectSettings)==null?void 0:h.method)||Te,headers:k,credentials:(p=n.connectSettings)==null?void 0:p.credentials,body:o?JSON.stringify(b):b},j.a(2,(R(n.stream)=="object"&&n.stream.readable?a.handleReadableStream(n,s,I,x,l,b):a.handleEventStream(n,s,I,x,l,b),I))}},e)}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"handleReadableStream",value:function(t,e,n,r,s,o){var l,u=t.streamHandlers,c=u.onOpen,d=u.onClose,h=!1;fetch(((l=t.connectSettings)==null?void 0:l.url)||t.url||"",r).then((function(){var p=w(v().m(function g(m){var b,k,A,I,x,U,j,J,G,he,se,ne;return v().w(function(q){for(;;)switch(q.n){case 0:if(m.body){q.n=1;break}throw new Error(go);case 1:A=m.body.getReader(),I=new TextDecoder,c(),x=!1;case 2:if(!(!x&&!h)){q.n=8;break}return q.n=3,A.read();case 3:if(U=q.v,j=U.value,J=U.done,x=J,!x){q.n=4;break}a.handleClose(t,n,d,s),q.n=7;break;case 4:return G=I.decode(j,{stream:!0}),q.n=5,(k=(b=t.deepChat).responseInterceptor)==null?void 0:k.call(b,G);case 5:if(ne=q.v,ne){q.n=6;break}ne=G;case 6:he=ne,se=R(he)=="object"?he:f({},y,G),a.handleMessage(t,e,n,se,o);case 7:q.n=2;break;case 8:return q.a(2)}},g)}));return function(g){return p.apply(this,arguments)}})()).catch(function(p){a.handleError(t,e,p)}),t.streamHandlers.onAbort=function(){n.finaliseStreamedMessage(),t.streamHandlers.onClose(),h=!0}}},{key:"handleEventStream",value:function(t,e,n,r,s,o){var l,u=t.streamHandlers,c=u.onOpen,d=u.onClose,h=new AbortController;t.streamHandlers.onAbort=function(){n.finaliseStreamedMessage(),t.streamHandlers.onClose(),h.abort()},vu(((l=t.connectSettings)==null?void 0:l.url)||t.url||"",ie(ie({},r),{},{openWhenHidden:!0,onopen:function(g){return w(v().m(function m(){return v().w(function(b){for(;;)switch(b.n){case 0:if(!g.ok){b.n=1;break}return b.a(2,c());case 1:return b.n=2,Y.processResponseByType(g);case 2:throw b.v;case 3:return b.a(2)}},m)}))()},onmessage:function(g){return w(v().m(function m(){var b,k,A,I,x;return v().w(function(U){for(;;)switch(U.n){case 0:if(JSON.stringify(g.data)===JSON.stringify("[DONE]")){U.n=3;break}try{A=JSON.parse(g.data)}catch(j){A={}}return U.n=1,(k=(b=t.deepChat).responseInterceptor)==null?void 0:k.call(b,A);case 1:if(x=U.v,x){U.n=2;break}x=A;case 2:I=x,a.handleMessage(t,e,n,I,o);case 3:return U.a(2)}},m)}))()},onerror:function(g){throw d(),g},onclose:function(){a.handleClose(t,n,d,s)},signal:h.signal})).catch(function(p){a.handleError(t,e,p)})}},{key:"handleMessage",value:function(t,e,n,r,s){var o;(o=t.extractResultData)==null||o.call(t,r,s).then(function(l){a.upsertContent(e,n.upsertStreamedMessage.bind(n),n,l),e.removeError()}).catch(function(l){e.isLastMessageError()||Y.displayError(e,l)})}},{key:"handleError",value:function(t,e,n){var r;e.isLastMessageError()||(r=t.extractResultData)==null||r.call(t,n).then(function(){Y.displayError(e,n)}).catch(function(s){Y.displayError(e,s)})}},{key:"handleClose",value:function(t,e,n,r){if(t.asyncCallInProgress){t.asyncCallInProgress=!1;return}try{e.finaliseStreamedMessage(),n()}catch(s){if(!r)throw s}}},{key:"simulate",value:(function(){var i=w(v().m(function e(n,r,s,o){var l,u,c,d,h;return v().w(function(p){for(;;)switch(p.n){case 0:return p.n=1,Y.basicResponseProcessing(n,s,{io:o,useRI:!1});case 1:if(p.v){p.n=2;break}return p.a(2,r.onClose());case 2:if(Array.isArray(s)&&(s=s[0]),s[V]&&(r.onOpen(),l=Le.splitHTML(s[V]),l.length===0&&(l=s[V].split("")),u=new ot(n,o==null?void 0:o.stream),a.populateMessages(n,l,u,r,V,0,o)),!s[T]){p.n=4;break}return p.n=3,Y.basicResponseProcessing(n,f({},T,s[T]),{io:o});case 3:c=p.v,n.addNewMessage(ie({sendUpdate:!1},c)),!s[V]&&!s[y]&&(new ot(n,o==null?void 0:o.stream).finaliseStreamedMessage(),r.onClose());case 4:s[y]&&(r.onOpen(),d=s[y].split(""),h=new ot(n,o==null?void 0:o.stream),a.populateMessages(n,d,h,r,y,0,o)),s[_]&&(Y.displayError(n,s[_]),r.onClose()),r.onAbort=function(){r.onClose()};case 5:return p.a(2)}},e)}));function t(e,n,r,s){return i.apply(this,arguments)}return t})()},{key:"populateMessages",value:(function(){var i=w(v().m(function e(n,r,s,o,l,u,c){var d,h,p,g;return v().w(function(m){for(;;)switch(m.p=m.n){case 0:if(d=r[u],!d){m.n=5;break}return m.p=1,m.n=2,Y.basicResponseProcessing(n,f({},l,d),{io:c});case 2:h=m.v,a.upsertContent(n,s.upsertStreamedMessage.bind(s),s,h),n.removeError(),m.n=4;break;case 3:m.p=3,g=m.v,n.isLastMessageError()||Y.displayError(n,g);case 4:p=setTimeout(function(){a.populateMessages(n,r,s,o,l,u+1,c)},o.simulationInterim||6),o.onAbort=function(){a.abort(p,s,o.onClose)},m.n=6;break;case 5:s.finaliseStreamedMessage(),o.onClose();case 6:return m.a(2)}},e,null,[[1,3]])}));function t(e,n,r,s,o,l,u){return i.apply(this,arguments)}return t})()},{key:"isSimulation",value:function(t){return R(t)=="object"&&!!t.simulation}},{key:"isSimulatable",value:function(t,e){return a.isSimulation(t)&&e&&(e[y]||e[V])}},{key:"abort",value:function(t,e,n){clearTimeout(t),e.finaliseStreamedMessage(),n()}},{key:"upsertContent",value:function(t,e,n,r){if(r&&Array.isArray(r)&&(r=r[0]),r!=null&&r[y]||r!=null&&r[V]){var s=e(r);n!=null||(n=s||void 0)}if(r!=null&&r[T]&&(t.addNewMessage(f({},T,r[T])),n==null||n.markFileAdded()),r!=null&&r[_])throw r[_]}}])})(),ai=(function(){function a(){E(this,a)}return C(a,null,[{key:"generateResponse",value:function(t){var e=t[t.length-1][0];if(e[T]&&e[T].length>0){if(e[T].length>1)return"These are interesting files!";var n=e[T][0];return n[N]&&n[N].startsWith("data:image/gif")?"That is a nice gif!":n.type===le?"That is a nice image!":n.type===ee?"I like the sound of that!":"That is an interesting file!"}if(e[y]){if(e[y].charAt(e[y].length-1)==="?")return"I'm sorry but I can't answer that question...";if(e[y].includes("updog"))return"What's updog?"}return"Hi there! This is a demo response!"}},{key:"getCustomResponse",value:function(t,e){return typeof t=="function"?t(e):t}},{key:"getResponse",value:function(t){var e=t.customDemoResponse,n=t.messageToElements;return e?a.getCustomResponse(e,n[n.length-1][0]):f({},y,a.generateResponse(n))}},{key:"request",value:function(t,e){var n=a.getResponse(e);setTimeout(w(v().m(function r(){var s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,Y.basicResponseProcessing(e,n,{io:t});case 1:if(s=u.v,s){u.n=2;break}return u.a(2,t.completionsHandlers.onFinish());case 2:o=Array.isArray(s)?s:[s],l=o.find(function(c){return typeof c[_]=="string"}),l?(e.addNewErrorMessage(ye,l[_]),t.completionsHandlers.onFinish()):Ce.isSimulatable(t.stream,s)?Ce.simulate(e,t.streamHandlers,s):(o.forEach(function(c){return e.addNewMessage(c)}),t.completionsHandlers.onFinish());case 3:return u.a(2)}},r)})),400)}},{key:"requestStream",value:function(t,e){setTimeout(function(){var n=a.getResponse(t);Ce.simulate(t,e.streamHandlers,n,e)},400)}}])})();ai.URL="deep-chat-demo";var ct=ai,Pn=(function(){function a(){E(this,a)}return C(a,null,[{key:"setup",value:function(t){t.permittedErrorPrefixes=["Connection error","Error in server message"],t.websocket="pending"}},{key:"isElementPresentInDOM",value:function(t){return t.getRootNode({composed:!0})instanceof Document}},{key:"createConnection",value:function(t,e){if(a.isElementPresentInDOM(t.deepChat)){var n=t.connectSettings.websocket;if(n){if(t.connectSettings.handler)return oa.websocket(t,e);try{var r=typeof n!="boolean"?n:void 0,s=new WebSocket(t.connectSettings.url||"",r);t.websocket=s,t.websocket.onopen=function(){var o,l;e.removeError(),t.websocket&&R(t.websocket)===Q&&a.assignListeners(t,s,e),(l=(o=t.deepChat)._validationHandler)==null||l.call(o)},t.websocket.onerror=function(o){console[_](o),a.retryConnection(t,e)}}catch(o){console[_](o),a.retryConnection(t,e)}}}}},{key:"retryConnection",value:function(t,e){var n,r;(r=(n=t.deepChat)._validationHandler)==null||r.call(n),a.isElementPresentInDOM(t.deepChat)&&(t.websocket="pending",e.isLastMessageError()||e.addNewErrorMessage(ye,"Connection error"),setTimeout(function(){a.createConnection(t,e)},5e3))}},{key:"assignListeners",value:function(t,e,n){var r=this,s={};e.onmessage=(function(){var o=w(v().m(function l(u){var c,d,h,p,g,m,b;return v().w(function(k){for(;;)switch(k.p=k.n){case 0:if(!t.extractResultData){k.n=8;break}return k.p=1,c=JSON.parse(u.data),k.n=2,Y.basicResponseProcessing(n,c,{io:t,displayError:!1});case 2:if(d=k.v,d){k.n=3;break}throw Error(jt(c,"server",!!t.deepChat.responseInterceptor,d));case 3:if(!Ce.isSimulation(t.stream)){k.n=4;break}h=a.stream.bind(r,t,n,s),p=s[c[P]||me],Ce.upsertContent(n,h,p,d),k.n=6;break;case 4:if(g=Array.isArray(d)?d:[d],m=g.find(function(A){return typeof A[_]=="string"}),!m){k.n=5;break}throw m[_];case 5:g.forEach(function(A){return n.addNewMessage(A)});case 6:k.n=8;break;case 7:k.p=7,b=k.v,Y.displayError(n,b,"Error in server message");case 8:return k.a(2)}},l,null,[[1,7]])}));return function(l){return o.apply(this,arguments)}})(),e.onclose=function(){var o,l;console[_]("Connection closed"),n.isLastMessageError()||n.addNewErrorMessage(ye,"Connection error"),t.stream&&((l=(o=t.streamHandlers).onAbort)==null||l.call(o)),a.createConnection(t,n)}}},{key:"sendWebsocket",value:(function(){var i=w(v().m(function e(n,r,s){var o,l,u,c,d,h,p,g,m,b=arguments;return v().w(function(k){for(;;)switch(k.n){case 0:if(o=b.length>3&&b[3]!==void 0?b[3]:!0,((l=n.connectSettings)==null?void 0:l.url)!==ct.URL){k.n=1;break}return k.a(2,ct.request(n,s));case 1:if(c=n.websocket,!(!c||c==="pending")){k.n=2;break}return k.a(2);case 2:return d={body:r,headers:(u=n.connectSettings)==null?void 0:u.headers},k.n=3,Y.processRequestInterceptor(n.deepChat,d);case 3:if(h=k.v,p=h.body,g=h.error,!g){k.n=4;break}return k.a(2,s.addNewErrorMessage(ye,g));case 4:if(a.isWebSocket(c)){k.n=5;break}return k.a(2,c.newUserMessage.listener(p));case 5:m=o?JSON.stringify(p):p,c.readyState===void 0||c.readyState!==c.OPEN?(console[_]("Connection is not open"),s.isLastMessageError()||s.addNewErrorMessage(ye,"Connection error")):(c.send(JSON.stringify(m)),n.completionsHandlers.onFinish());case 6:return k.a(2)}},e)}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"canSendMessage",value:function(t){return t?t==="pending"?!1:a.isWebSocket(t)?t.readyState!==void 0&&t.readyState===t.OPEN:t.isOpen:!0}},{key:"isWebSocket",value:function(t){return t.send!==void 0}},{key:"stream",value:function(t,e,n,r){if(r){var s=t.stream.simulation;if(typeof s=="string"){var o,l=r[P]||me,u=n[l];r[y]===s||r[V]===s?(u==null||u.finaliseStreamedMessage(),delete n[l]):((o=n[l])!==null&&o!==void 0||(n[l]=new ot(e,t.stream)),n[l].upsertStreamedMessage(r))}else Ce.simulate(e,t.streamHandlers,r)}}}])})(),oa=(function(){function a(){E(this,a)}return C(a,null,[{key:"request",value:(function(){var i=w(v().m(function e(n,r,s){var o,l,u,c,d;return v().w(function(h){for(;;)switch(h.n){case 0:u=!0,c=(function(){var p=w(v().m(function g(m){var b,k,A;return v().w(function(I){for(;;)switch(I.n){case 0:if(u){I.n=1;break}return I.a(2);case 1:return u=!1,I.n=2,Y.basicResponseProcessing(s,m,{io:n,displayError:!1});case 2:b=I.v,b?(k=Array.isArray(b)?b:[b],A=k.find(function(x){return typeof x[_]=="string"}),A?(console[_](A[_]),s.addNewErrorMessage(ye,A[_]),n.completionsHandlers.onFinish()):Ce.isSimulatable(n.stream,b)?Ce.simulate(s,n.streamHandlers,b):(k.forEach(function(x){return s.addNewMessage(x)}),n.completionsHandlers.onFinish())):(console[_](jt(m,"server",!!n.deepChat.responseInterceptor,b)),s.addNewErrorMessage(ye,"Error in server message"),n.completionsHandlers.onFinish());case 3:return I.a(2)}},g)}));return function(m){return p.apply(this,arguments)}})(),d=a.generateOptionalSignals(),(l=(o=n.connectSettings).handler)==null||l.call(o,r,ie(ie({},d),{},{onResponse:c}));case 1:return h.a(2)}},e)}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"attemptToFinaliseStream",value:function(t,e){try{var n=e.messageElementRefs[e.messageElementRefs.length-1];nt.isLoadingMessage(n)?e.removeLastMessage():t.finaliseStreamedMessage()}catch(r){console[_](r),e.addNewErrorMessage(ye,r)}}},{key:"stream",value:function(t,e,n){var r,s,o=!0,l=!1,u=new ot(n,t.stream),c=function(){l||!o||(t.streamHandlers.onOpen(),l=!0)},d=function(){o&&(a.attemptToFinaliseStream(u,n),t.streamHandlers.onClose(),o=!1)},h=(function(){var g=w(v().m(function m(b){var k,A;return v().w(function(I){for(;;)switch(I.n){case 0:if(o){I.n=1;break}return I.a(2);case 1:return I.n=2,Y.basicResponseProcessing(n,b,{io:t,displayError:!1});case 2:k=I.v,k?k[_]?(a.streamError(k[_],u,t,n),o=!1):Ce.upsertContent(n,u.upsertStreamedMessage.bind(u),u,k):(A=jt(b,"server",!!t.deepChat.responseInterceptor,k),a.streamError(A,u,t,n),o=!1);case 3:return I.a(2)}},m)}));return function(b){return g.apply(this,arguments)}})();t.streamHandlers.onAbort=function(){a.attemptToFinaliseStream(u,n),t.streamHandlers.onClose(),o=!1};var p=a.generateOptionalSignals();(s=(r=t.connectSettings).handler)==null||s.call(r,e,ie(ie({},p),{},{onOpen:c,onResponse:h,onClose:d,stopClicked:t.streamHandlers.stopClicked}))}},{key:"streamError",value:function(t,e,n,r){console[_](t),e.finaliseStreamedMessage(),r.addNewErrorMessage(ye,t),n.streamHandlers.onClose()}},{key:"websocket",value:function(t,e){var n=this,r,s,o={isOpen:!1,newUserMessage:{listener:function(){}},roleToStream:{}};t.websocket=o;var l=function(){e.removeError(),o.isOpen=!0},u=function(){o.isOpen=!1},c=(function(){var h=w(v().m(function p(g){var m,b,k,A,I,x;return v().w(function(U){for(;;)switch(U.n){case 0:return U.n=1,Y.basicResponseProcessing(e,g,{io:t,displayError:!1});case 1:m=U.v,m?(b=Array.isArray(m)?m:[m],k=b.find(function(j){return typeof j[_]=="string"}),k?(console[_](k[_]),e.isLastMessageError()||e.addNewErrorMessage(ye,k[_])):Ce.isSimulation(t.stream)?(A=m,I=Pn.stream.bind(n,t,e,o.roleToStream),x=o.roleToStream[A[P]||me],Ce.upsertContent(e,I,x,A)):b.forEach(function(j){return e.addNewMessage(j)})):(console[_](jt(g,"server",!!t.deepChat.responseInterceptor,m)),e.addNewErrorMessage(ye,"Error in server message"));case 2:return U.a(2)}},p)}));return function(g){return h.apply(this,arguments)}})(),d=a.generateOptionalSignals();(s=(r=t.connectSettings).handler)==null||s.call(r,void 0,ie(ie({},d),{},{onOpen:l,onResponse:c,onClose:u,newUserMessage:o.newUserMessage}))}},{key:"generateOptionalSignals",value:function(){return{onClose:function(){},onOpen:function(){},stopClicked:{listener:function(){}},newUserMessage:{listener:function(){}}}}}])})(),xe=(function(){function a(){E(this,a)}return C(a,null,[{key:"request",value:(function(){var i=w(v().m(function e(n,r,s){var o,l,u,c,d,h,p,g,m,b,k,A=arguments;return v().w(function(I){for(;;)switch(I.n){case 0:return o=A.length>3&&A[3]!==void 0?A[3]:!0,d={body:r,headers:(l=n.connectSettings)==null?void 0:l.headers},I.n=1,Y.processRequestInterceptor(n.deepChat,d);case 1:if(h=I.v,p=h.body,g=h.headers,m=h.error,b=n.completionsHandlers.onFinish,!m){I.n=2;break}return I.a(2,Y.onInterceptorError(s,m,b));case 2:if(!((u=n.connectSettings)!=null&&u.handler)){I.n=3;break}return I.a(2,oa.request(n,p,s));case 3:if(((c=n.connectSettings)==null?void 0:c.url)!==ct.URL){I.n=4;break}return I.a(2,ct.request(n,s));case 4:k=!0,Y.fetch(n,g,o,p).then(function(x){return k=!!x.ok,x}).then(function(x){return Y.processResponseByType(x)}).then((function(){var x=w(v().m(function U(j){var J,G,he,se,ne;return v().w(function(q){for(;;)switch(q.n){case 0:if(n.extractResultData){q.n=1;break}return q.a(2);case 1:return q.n=2,(G=(J=n.deepChat).responseInterceptor)==null?void 0:G.call(J,j);case 2:if(ne=q.v,ne){q.n=3;break}ne=j;case 3:return he=ne,q.n=4,n.extractResultData(he,p);case 4:if(se=q.v,k){q.n=5;break}throw j;case 5:if(!(!se||R(se)!==Q&&!Array.isArray(se))){q.n=6;break}throw Error(jt(j,"response",!!n.deepChat.responseInterceptor,he));case 6:if(!se[_]){q.n=7;break}throw se[_];case 7:if(!n.asyncCallInProgress){q.n=8;break}return n.asyncCallInProgress=!1,q.a(2);case 8:Ce.isSimulatable(n.stream,se)?Ce.simulate(s,n.streamHandlers,se):((Array.isArray(se)?se:[se]).forEach(function(Ie){return s.addNewMessage(Ie)}),b());case 9:return q.a(2)}},U)}));return function(U){return x.apply(this,arguments)}})()).catch(function(x){Y.displayError(s,x),b()});case 5:return I.a(2)}},e)}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"executePollRequest",value:function(t,e,n,r){var s=t.completionsHandlers.onFinish;fetch(e,n).then(function(o){return o.json()}).then((function(){var o=w(v().m(function l(u){var c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(t.extractPollResultData){m.n=1;break}return m.a(2);case 1:return p=t,m.n=2,(d=(c=t.deepChat).responseInterceptor)==null?void 0:d.call(c,u);case 2:if(g=m.v,g){m.n=3;break}g=u;case 3:return m.n=4,p.extractPollResultData.call(p,g);case 4:h=m.v,h.timeoutMS?setTimeout(function(){a.executePollRequest(t,e,n,r)},h.timeoutMS):Ce.isSimulatable(t.stream,h)?Ce.simulate(r,t.streamHandlers,h):(r.addNewMessage(h),s());case 5:return m.a(2)}},l)}));return function(l){return o.apply(this,arguments)}})()).catch(function(o){Y.displayError(r,o),s()})}},{key:"poll",value:(function(){var i=w(v().m(function e(n,r,s){var o,l,u,c,d,h,p,g,m,b,k,A,I,x=arguments;return v().w(function(U){for(;;)switch(U.n){case 0:return o=x.length>3&&x[3]!==void 0?x[3]:!0,d={body:r,headers:(l=n.connectSettings)==null?void 0:l.headers},U.n=1,Y.processRequestInterceptor(n.deepChat,d);case 1:if(h=U.v,p=h.body,g=h.headers,m=h.error,!m){U.n=2;break}return U.a(2,Y.onInterceptorError(s,m));case 2:b=((u=n.connectSettings)==null?void 0:u.url)||n.url||"",k=((c=n.connectSettings)==null?void 0:c.method)||Te,A=o?JSON.stringify(p):p,I={method:k,body:A,headers:g},n.connectSettings.credentials&&(I.credentials=n.connectSettings.credentials),a.executePollRequest(n,b,I,s);case 3:return U.a(2)}},e)}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"verifyKey",value:function(t,e,n,r,s,o,l,u,c){if(t==="")return o(we);l(),fetch(e,{method:r,headers:n,body:c||null}).then(function(d){return Y.processResponseByType(d)}).then(function(d){u(d,t,s,o)}).catch(function(d){o(He),console[_](d)})}}])})(),la=(function(){function a(){E(this,a)}return C(a,null,[{key:"getCharacterLimitMessages",value:function(t,e){var n;if(e===-1)return t;var r=0,s=t.length-1;for(s;s>=0;s-=1){var o=(n=t[s])==null?void 0:n[y];if(o!==void 0&&(r+=o.length,r>e)){t[s][y]=o.substring(0,o.length-(r-e));break}}return t.slice(Math.max(s,0))}},{key:"getMaxMessages",value:function(t,e){return t.slice(Math.max(t.length-e,0))}},{key:"processMessages",value:function(t,e,n){return e!==void 0?e>0&&(t=a.getMaxMessages(t,e)):t=[t[t.length-1]],t=L(t),n===void 0?t:a.getCharacterLimitMessages(t,n)}}])})(),si=(function(){function a(i,t,e){E(this,a),this._isLoading=!1,this._isPaginationComplete=!1,this._index=0,this._messages=t,e.fetchHistory&&this.fetchHistory(e.fetchHistory),this.setupInitialHistory(i)}return C(a,[{key:"fetchHistory",value:(function(){var i=w(v().m(function e(n){var r=this,s,o;return v().w(function(l){for(;;)switch(l.n){case 0:return s=St.addMessage(this._messages),l.n=1,n();case 1:o=l.v,this._messages.removeMessage(s),a.displayIntroMessages(this._messages.messageElementRefs),o.forEach(function(u){return r._messages.addAnyMessage(u,!0)}),setTimeout(function(){return oe.scrollToBottom(r._messages)},0);case 2:return l.a(2)}},e,this)}));function t(e){return i.apply(this,arguments)}return t})()},{key:"scrollToPreloadFirstEl",value:function(t,e){this._messages.elementRef.scrollTop=e+t.offsetTop-40}},{key:"processLoadedHistory",value:function(t){var e=this,n,r=this._messages,s=r.messageElementRefs,o=r.messageToElements,l=r.elementRef,u=(n=s.find(function(d){return!d.outerContainer[S].contains(nt.INTRO_CLASS)}))==null?void 0:n.outerContainer,c=l.scrollTop;t==null||t.reverse().map(function(d){var h=e._messages.addAnyMessage(ie(ie({},d),{},{sendUpdate:!0}),!0,!0);if(h){var p=ge.generateMessageBody(h,s,!0);o.unshift([h,p])}return h}).filter(function(d){return!!d}).reverse().forEach(function(d){return e._messages.sendClientUpdate(d,!0)}),u&&(this._messages.messageElementRefs.length>=this._messages.maxVisibleMessages?setTimeout(function(){return e.scrollToPreloadFirstEl(u,c)}):this.scrollToPreloadFirstEl(u,c))}},{key:"populateMessages",value:function(t,e){this._messages.removeMessage(t),this._isPaginationComplete=e.findIndex(function(u){return!u})<0;var n=e.filter(function(u){return!!u});this.processLoadedHistory(n);var r=this._messages,s=r.messageElementRefs,o=r.avatar,l=r.name;ge.resetAllRoleElements(s,o,l)}},{key:"loadHistoryOnScroll",value:(function(){var i=w(v().m(function e(n){var r=this;return v().w(function(s){for(;;)switch(s.n){case 0:this._messages.elementRef.onscroll=w(v().m(function o(){var l,u,c;return v().w(function(d){for(;;)switch(d.p=d.n){case 0:if(!(!r._isLoading&&!r._isPaginationComplete&&r._messages.elementRef.scrollTop===0)){d.n=4;break}return r._isLoading=!0,l=St.addMessage(r._messages,!1),d.p=1,d.n=2,n(r._index++);case 2:u=d.v,r.populateMessages(l,u),r._isLoading=!1,d.n=4;break;case 3:d.p=3,c=d.v,r._messages.removeMessage(l),r._isPaginationComplete=!0,r._messages.addNewErrorMessage(ye,a.FAILED_ERROR_MESSAGE,!0),console[_](c);case 4:return d.a(2)}},o,null,[[1,3]])}));case 1:return s.a(2)}},e,this)}));function t(e){return i.apply(this,arguments)}return t})()},{key:"populateInitialHistory",value:function(t){var e=this;t.forEach(function(n){_e.processHistoryFile(n),e._messages.addAnyMessage(n,!0)})}},{key:"loadInitialHistory",value:(function(){var i=w(v().m(function e(n){var r,s,o,l;return v().w(function(u){for(;;)switch(u.p=u.n){case 0:return this._isLoading=!0,r=St.addMessage(this._messages),u.p=1,u.n=2,n(this._index++);case 2:s=u.v,o=this._messages.elementRef.scrollTop,this.populateMessages(r,s),this.restoreScrollOrScrollToBottom(o===0),u.n=4;break;case 3:u.p=3,l=u.v,this._messages.removeMessage(r),this._isPaginationComplete=!0,this._messages.addNewErrorMessage(ye,a.FAILED_ERROR_MESSAGE,!0),console[_](l);case 4:a.displayIntroMessages(this._messages.messageElementRefs),this._isLoading=!1;case 5:return u.a(2)}},e,this,[[1,3]])}));function t(e){return i.apply(this,arguments)}return t})()},{key:"setupInitialHistory",value:(function(){var i=w(v().m(function e(n){var r,s,o;return v().w(function(l){for(;;)switch(l.n){case 0:n.loadHistory&&this.loadInitialHistory(n.loadHistory),s=(r=this._messages.browserStorage)==null?void 0:r.get(),o=n.history||_e.processHistory(n)||(s==null?void 0:s.messages),o&&(this.populateInitialHistory(o),this.restoreScrollOrScrollToBottom(!0),this._index+=1);case 1:return l.a(2)}},e,this)}));function t(e){return i.apply(this,arguments)}return t})()},{key:"restoreScrollOrScrollToBottom",value:function(t){var e=this,n,r,s,o=(r=(n=this._messages.browserStorage)==null?void 0:n.get())==null?void 0:r.scrollHeight;o!==void 0&&(s=this._messages.browserStorage)!=null&&s.trackScrollHeight?setTimeout(function(){e._messages.elementRef.scrollTop=o},0):t&&setTimeout(function(){return oe.scrollToBottom(e._messages)},0)}}],[{key:"addErrorPrefix",value:function(t){var e;(e=t.permittedErrorPrefixes)!==null&&e!==void 0||(t.permittedErrorPrefixes=[]),t.permittedErrorPrefixes.push(a.FAILED_ERROR_MESSAGE)}},{key:"displayIntroMessages",value:function(t){for(var e=0;e<t.length;e+=1){var n=t[0];if(n.outerContainer[S].contains(nt.INTRO_CLASS))n.outerContainer[M].display="";else break}}}])})();si.FAILED_ERROR_MESSAGE="Failed to load history";var ua=si,yu=(function(){function a(){E(this,a)}return C(a,null,[{key:"parseConfig",value:function(t,e,n){var r,s={files:t};if(R(n)=="object"){_e.processFileConfigConnect(n);var o=n.files,l=n.connect,u=n.button;o&&(o.infoModal&&(s[T].infoModal=o.infoModal,(r=o.infoModal)!=null&&r.textMarkDown&&(s.infoModalTextMarkUp=e.render(o.infoModal.textMarkDown))),o.acceptedFormats&&(s[T].acceptedFormats=o.acceptedFormats),o.maxNumberOfFiles&&(s[T].maxNumberOfFiles=o.maxNumberOfFiles)),s.button=u,l&&Object.keys(l).length>0&&(s.connect=l)}return s}},{key:"processMixedFiles",value:function(t,e,n){if(n){var r={acceptedFormats:""};t.fileTypes.mixedFiles=a.parseConfig(r,e,n)}}},{key:"processMicrophone",value:function(t,e,n,r){var s,o,l,u,c,d,h,p,g=ie({acceptedFormats:"audio/*"},((l=t.fileTypes[ee])==null?void 0:l[T])||{});n&&(navigator.mediaDevices.getUserMedia!==void 0?(t.recordAudio=a.parseConfig(g,e,n),R(n)=="object"&&n[T]&&((s=(u=t.recordAudio)[T])!==null&&s!==void 0||(u[T]={}),t.recordAudio[T].format=(c=n[T])==null?void 0:c.format,t.recordAudio[T].maxDurationSeconds=(d=n[T])==null?void 0:d.maxDurationSeconds,(h=t.fileTypes[ee])!=null&&h[T]&&((o=(p=t.fileTypes[ee][T]).maxNumberOfFiles)!==null&&o!==void 0||(p.maxNumberOfFiles=n[T].maxNumberOfFiles)))):r||(t.fileTypes[ee]=a.parseConfig(g,e,n)))}},{key:"processAudioConfig",value:function(t,e,n,r){if(!(!n&&!r)){var s=ie({acceptedFormats:"audio/*"},(r==null?void 0:r[T])||{});t.fileTypes[ee]=a.parseConfig(s,e,n)}}},{key:"processGifConfig",value:function(t,e,n,r){if(!(!n&&!r)){var s=ie({acceptedFormats:"image/gif"},(r==null?void 0:r[T])||{});t.fileTypes[Ut]=a.parseConfig(s,e,n)}}},{key:"processCamera",value:function(t,e,n,r){var s,o,l,u,c,d=ie({acceptedFormats:"image/*"},((o=t.fileTypes[pe])==null?void 0:o[T])||{});n&&(navigator.mediaDevices.getUserMedia!==void 0?(t[je]=a.parseConfig(d,e,n),R(n)=="object"&&(t[je].modalContainerStyle=n.modalContainerStyle,n[T]&&((s=(l=t[je])[T])!==null&&s!==void 0||(l[T]={}),t[je][T].format=(u=n[T])==null?void 0:u.format,t[je][T].dimensions=(c=n[T])==null?void 0:c.dimensions))):r||(t.fileTypes[pe]=a.parseConfig(d,e,n)))}},{key:"processImagesConfig",value:function(t,e,n,r){if(!(!n&&!r)){var s=ie({acceptedFormats:"image/*"},(r==null?void 0:r[T])||{});t.fileTypes[pe]=a.parseConfig(s,e,n)}}},{key:"populateDefaultFileIO",value:function(t,e){var n,r,s,o,l;t&&((n=t[T])!==null&&n!==void 0||(t[T]={}),(r=(o=t[T]).acceptedFormats)!==null&&r!==void 0||(o.acceptedFormats=e),(s=(l=t[T]).maxNumberOfFiles)!==null&&s!==void 0||(l.maxNumberOfFiles=1))}},{key:"set",value:function(t,e,n){a.populateDefaultFileIO(n==null?void 0:n[ee],".4a,.mp3,.webm,.mp4,.mpga,.wav,.mpeg,.m4a"),a.populateDefaultFileIO(n==null?void 0:n[pe],".png,.jpg");var r=Or.createNew(t.remarkable);a.processImagesConfig(e,r,t[pe],n==null?void 0:n[pe]),a.processCamera(e,r,t[je],t[pe]),a.processGifConfig(e,r,t[Ut],n==null?void 0:n[Ut]),a.processAudioConfig(e,r,t[ee],n==null?void 0:n[ee]),a.processMicrophone(e,r,t[et],t[ee]),a.processMixedFiles(e,r,t[As])}}])})(),tr=(function(){function a(i,t,e){var n;E(this,a);var r,s,o,l,u;this.rawBody={},this.validateKeyProperty=!1,this.canSendMessage=a.canSendMessage,this.connectSettings={},this.fileTypes={},this.completionsHandlers={},this.streamHandlers={},this.deepChat=i,this.demo=e,Object.assign(this.rawBody,(r=i.connect)==null?void 0:r.additionalBodyProps),this.totalMessagesMaxCharLength=(s=i==null?void 0:i.requestBodyLimits)==null?void 0:s.totalMessagesMaxCharLength,this.maxMessages=(o=i==null?void 0:i.requestBodyLimits)==null?void 0:o.maxMessages,yu.set(i,this,t),i.connect&&(this.connectSettings=i.connect),this.demo&&((n=(l=this.connectSettings).url)!==null&&n!==void 0||(l.url=ct.URL)),this.connectSettings.websocket&&Pn.setup(this),this.stream=((u=this.deepChat.connect)==null?void 0:u.stream)||_e.checkForStream(this.deepChat),i.loadHistory&&ua.addErrorPrefix(this)}return C(a,[{key:"verifyKey",value:function(t,e){}},{key:"getServiceIOByType",value:function(t){if(t.type.startsWith(ee)&&this.fileTypes[ee])return this.fileTypes[ee];if(t.type.startsWith(le)){if(this.fileTypes[Ut]&&t.type.endsWith("/gif"))return this.fileTypes[Ut];if(this.fileTypes[pe])return this.fileTypes[pe];if(this[je])return this[je]}return this.fileTypes[As]}},{key:"request",value:(function(){var i=w(v().m(function e(n,r){var s,o=arguments;return v().w(function(l){for(;;)if(l.n===0)return s=o.length>2&&o[2]!==void 0?o[2]:!0,l.a(2,this.stream&&!Ce.isSimulation(this.stream)?Ce.request(this,n,r,s):xe.request(this,n,r,s))},e,this)}));function t(e,n){return i.apply(this,arguments)}return t})()},{key:"callAPIWithText",value:(function(){var i=w(v().m(function e(n,r){var s,o,l,u,c,d,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:return h=ie({messages:r},this.rawBody),p=!1,(l=this.connectSettings.headers)!=null&&l[te]||((s=(u=this.connectSettings).headers)!==null&&s!==void 0||(u.headers={}),(o=(c=this.connectSettings.headers)[te])!==null&&o!==void 0||(c[te]=fe),p=!0),g.n=1,this.request(h,n);case 1:p&&((d=this.connectSettings.headers)==null||delete d[te]);case 2:return g.a(2)}},e,this)}));function t(e,n){return i.apply(this,arguments)}return t})()},{key:"callApiWithFiles",value:(function(){var i=w(v().m(function e(n,r,s){var o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:return o=a.createCustomFormDataBody(this.rawBody,r,s),l=this.connectSettings,u=this.getServiceIOByType(s[0]),this.connectSettings=(u==null?void 0:u.connect)||this.connectSettings,c.n=1,this.request(o,n,!1);case 1:this.connectSettings=l;case 2:return c.a(2)}},e,this)}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"callServiceAPI",value:(function(){var i=w(v().m(function e(n,r,s){return v().w(function(o){for(;;)switch(o.n){case 0:s?this.callApiWithFiles(n,r,s):this.callAPIWithText(n,r);case 1:return o.a(2)}},e,this)}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"callAPI",value:(function(){var i=w(v().m(function e(n,r){var s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.connectSettings){u.n=1;break}throw new Error(qe);case 1:o=la.processMessages(r.messageToElements.map(function(c){var d=wt(c,1),h=d[0];return h}),this.maxMessages,this.totalMessagesMaxCharLength),this.connectSettings.websocket&&(!this.connectSettings.handler||this.connectSettings.url!==ct.URL)?(l=ie({messages:o},this.rawBody),n[T]&&(s=this.getServiceIOByType(n[T][0]))!=null&&s.connect?this.callApiWithFiles(r,o,n[T]):Pn.sendWebsocket(this,l,r,!1)):this.callServiceAPI(r,o,n[T]);case 2:return u.a(2)}},e,this)}));function t(e,n){return i.apply(this,arguments)}return t})()},{key:"extractResultData",value:(function(){var i=w(v().m(function e(n){return v().w(function(r){for(;;)switch(r.n){case 0:if(!n.result){r.n=1;break}return r.a(2,_e.handleResponseProperty(n));case 1:if(!Y.validateResponseFormat(n,!!this.stream)){r.n=2;break}return r.a(2,n);case 2:return r.a(2)}},e,this)}));function t(e){return i.apply(this,arguments)}return t})()},{key:"isDirectConnection",value:function(){return!1}},{key:"isWebModel",value:function(){return!1}},{key:"isCustomView",value:function(){return!1}}],[{key:"canSendMessage",value:function(t,e,n){return n?!0:!!(t&&t.trim()!=="")||!!(e&&e.length>0)}},{key:"createCustomFormDataBody",value:function(t,e,n){var r=new FormData;n.forEach(function(l){return r.append("files",l)}),Object.keys(t).forEach(function(l){return r.append(l,String(t[l]))});var s=0;e.slice(0,e.length-1).forEach(function(l){r.append("message".concat(s+=1),JSON.stringify(l))});var o=e[e.length-1];return o[y]&&(delete o[T],r.append("message".concat(s+=1),JSON.stringify(o))),r}}])})(),W=(function(a){function i(t,e,n,r,s){var o;E(this,i);var l;return o=F(this,i,[t,s]),o.insertKeyPlaceholderText="API Key",o.keyHelpUrl="",o.asyncCallInProgress=!1,o.systemMessage="",Object.assign(o.rawBody,(l=t.connect)==null?void 0:l.additionalBodyProps),o._keyVerificationDetails=e,o._buildHeadersFunc=n,r&&o.setApiKeyProperties(r),o.connectSettings=o.buildConnectSettings(o.key||"",t.connect),o}return D(i,a),C(i,[{key:"setApiKeyProperties",value:function(e){this.key=e.key,e.validateKeyProperty&&(this.validateKeyProperty=e.validateKeyProperty)}},{key:"buildConnectSettings",value:function(e,n){var r,s=n!=null?n:{};return(r=s.headers)!==null&&r!==void 0||(s.headers={}),Object.assign(s.headers,this._buildHeadersFunc(e)),s}},{key:"completeConfig",value:function(e,n){e.system_prompt&&(this.systemMessage=e.system_prompt),n&&(this.functionHandler=n),delete e.system_prompt,delete e.key,delete e.function_handler,Object.assign(this.rawBody,e)}},{key:"keyAuthenticated",value:function(e,n){this.connectSettings=this.buildConnectSettings(n,this.connectSettings),this.key=n,e()}},{key:"verifyKey",value:function(e,n){var r=this._keyVerificationDetails,s=r.url,o=r.method,l=r.handleVerificationResult,u=r.createHeaders,c=r.body,d=r.augmentUrl,h=(u==null?void 0:u(e))||this._buildHeadersFunc(e),p=(d==null?void 0:d(e))||s;xe.verifyKey(e,p,h,o,this.keyAuthenticated.bind(this,n.onSuccess),n.onFail,n.onLoad,l,c)}},{key:"isDirectConnection",value:function(){return!0}},{key:"processMessages",value:function(e){return la.getCharacterLimitMessages(e,this.totalMessagesMaxCharLength?this.totalMessagesMaxCharLength-this.systemMessage.length:-1)}},{key:"addSystemMessage",value:function(e){this.systemMessage&&e.unshift(f(f({},P,"system"),"content",this.systemMessage))}},{key:"callDirectServiceServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o,l,u){var c,d;return v().w(function(h){for(;;)switch(h.n){case 0:if(this.connectSettings){h.n=1;break}throw new Error(qe);case 1:if(c=o(this.rawBody,s),d=l?this.stream:!1,!(d&&(R(d)!==Q||!d.simulation)||c.stream)){h.n=2;break}c.stream=!0,l!=null&&l.readable&&(this.stream={readable:!0}),Ce.request(this,c,r),h.n=4;break;case 2:return h.n=3,xe.request(this,c,r,u);case 3:return h.a(2,h.v);case 4:return h.a(2)}},n,this)}));function e(n,r,s,o,l){return t.apply(this,arguments)}return e})()},{key:"callToolFunction",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:return this.asyncCallInProgress=!0,g.n=1,r(s);case 1:if(u=g.v,Array.isArray(u)){g.n=6;break}if(!u[y]){g.n=5;break}return c=f({},y,u[y]),g.n=2,(l=(o=this.deepChat).responseInterceptor)==null?void 0:l.call(o,c);case 2:if(h=g.v,h){g.n=3;break}h=c;case 3:if(d=h,!Array.isArray(d)){g.n=4;break}throw Error("Function tool response interceptor cannot return an array");case 4:return g.a(2,{processedResponse:d});case 5:throw Error(Tt);case 6:return g.n=7,Promise.all(u);case 7:return p=g.v,g.a(2,{responses:p})}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"makeAnotherRequest",value:function(e,n,r){try{return n&&(this.stream?Ce.request(this,e,n):xe.request(this,e,n)),f({},y,r||"")}catch(s){throw this.asyncCallInProgress=!1,s}}},{key:"genereteAPIKeyName",value:function(e){return"".concat(e," API Key")}},{key:"extractStreamResultWToolsGeneric",value:(function(){var t=w(v().m(function n(r,s,o,l,u){var c,d,h;return v().w(function(p){for(;;)switch(p.n){case 0:if(c=s.delta,d=s.finish_reason,d!=="tool_calls"){p.n=1;break}return h={tool_calls:r._streamToolCalls},p.a(2,(r._streamToolCalls=void 0,this.handleToolsGeneric(h,o,r.messages,l,u)));case 1:c!=null&&c.tool_calls&&(r._streamToolCalls?c.tool_calls.forEach(function(g,m){r._streamToolCalls&&(r._streamToolCalls[m].function.arguments+=g.function.arguments)}):r._streamToolCalls=c.tool_calls);case 2:return p.a(2,f({},y,(c==null?void 0:c.content)||""))}},n,this)}));function e(n,r,s,o,l){return t.apply(this,arguments)}return e})()},{key:"handleToolsGeneric",value:(function(){var t=w(v().m(function n(r,s,o,l,u){var c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(!(!r.tool_calls||!l||!s)){m.n=1;break}throw Error(vt);case 1:return c=L(l),d=r.tool_calls.map(function(b){return{name:b.function.name,arguments:b.function.arguments}}),m.n=2,this.callToolFunction(s,d);case 2:if(h=m.v,p=h.responses,g=h.processedResponse,!g){m.n=3;break}return m.a(2,g);case 3:if(u&&(c.messages=c.messages.slice(c.messages.length-1),u.message&&c.messages.unshift(f(f({},P,"system"),"content",u.message))),c.messages.push(f(f({tool_calls:r.tool_calls},P,rt),"content",null)),!(!p.find(function(b){var k=b.response;return typeof k!="string"})&&d.length===p.length)){m.n=4;break}return m.a(2,(p.forEach(function(b,k){var A,I=(A=r.tool_calls)==null?void 0:A[k];c==null||c.messages.push(f(f(f(f({},P,"tool"),"tool_call_id",I==null?void 0:I.id),"name",I==null?void 0:I.function.name),"content",b.response))}),this.makeAnotherRequest(c,o)));case 4:throw Error(Tt);case 5:return m.a(2)}},n,this)}));function e(n,r,s,o,l){return t.apply(this,arguments)}return e})()},{key:"updateSessionId",value:function(e){this.messages&&this.messages.messageToElements.length>0&&(this.messages.messageToElements[this.messages.messageToElements.length-1][0]._sessionId=e)}}],[{key:"getRoleViaUser",value:function(e){return e===Z?Z:rt}},{key:"getRoleViaAI",value:function(e){return e===me?rt:Z}},{key:"getImageContent",value:function(e){return e.filter(function(n){return n.type===le}).map(function(n){return f(f({},z,ze),ze,{url:n[N]||""})}).filter(function(n){return n[ze].url.length>0})}},{key:"getTextWImagesContent",value:function(e){if(e[T]&&e[T].length>0){var n=this.getImageContent(e[T]);return e[y]&&e[y].trim().length>0&&n.unshift(f(f({},z,y),y,e[y])),n.length>0?n:e[y]||""}return e[y]||""}},{key:"getTextWFilesContent",value:function(e,n){if(e[T]&&e[T].length>0){var r=n(e[T]);return e[y]&&e[y].trim().length>0&&r.unshift(f(f({},z,y),y,e[y])),r}return e[y]||""}}])})(tr),bu=(function(){function a(){E(this,a)}return C(a,null,[{key:"waitForPropertiesToBeUpdatedBeforeRender",value:function(t){t._propUpdated_=!1,setTimeout(function(){t._propUpdated_?a.waitForPropertiesToBeUpdatedBeforeRender(t):(t._waitingToRender_=!1,t.onRender())})}},{key:"attemptRender",value:function(t){t._propUpdated_=!0,t._waitingToRender_||(t._waitingToRender_=!0,a.waitForPropertiesToBeUpdatedBeforeRender(t))}}])})(),Ur=(function(a){function i(){var t;return E(this,i),t=F(this,i),t._waitingToRender_=!1,t._propUpdated_=!1,Object.keys(i._attributeToProperty_).forEach(function(e){var n=i._attributeToProperty_[e];t.constructPropertyAccessors(n),t.hasOwnProperty(e)||t.constructPropertyAccessors(n,e)}),t}return D(i,a),C(i,[{key:"constructPropertyAccessors",value:function(e,n){var r;Object.defineProperty(this,n||e,{get:function(){return r},set:function(o){r=o,n?this[e]=o:bu.attemptRender(this)}})}},{key:"attributeChangedCallback",value:function(e,n,r){if(n!==r){var s=i._attributes_[e](r),o=i._attributeToProperty_[e];this[o]=s}}},{key:"onRender",value:function(){}}],[{key:"observedAttributes",get:function(){return Object.keys(i._attributes_)||[]}}])})(Ar(HTMLElement));Ur._attributes_={},Ur._attributeToProperty_={};var _u=Ur,ku=`<?xml version="1.0" standalone="no"?>
<svg version="1.1"
	xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
	xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"
	viewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">
		<path d="
			M669.727,273.516c-22.891-2.476-46.15-3.895-69.727-4.248c-103.025,0.457-209.823,25.517-310.913,73.536
			c-75.058,37.122-148.173,89.529-211.67,154.174C46.232,529.978,6.431,577.76,0,628.74c0.76,44.162,48.153,98.67,77.417,131.764
			c59.543,62.106,130.754,113.013,211.67,154.174c2.75,1.335,5.51,2.654,8.276,3.955l-75.072,131.102l102.005,60.286l551.416-960.033
			l-98.186-60.008L669.727,273.516z M902.563,338.995l-74.927,129.857c34.47,44.782,54.932,100.006,54.932,159.888
			c0,149.257-126.522,270.264-282.642,270.264c-6.749,0-13.29-0.728-19.922-1.172l-49.585,85.84c22.868,2.449,45.99,4.233,69.58,4.541
			c103.123-0.463,209.861-25.812,310.84-73.535c75.058-37.122,148.246-89.529,211.743-154.174
			c31.186-32.999,70.985-80.782,77.417-131.764c-0.76-44.161-48.153-98.669-77.417-131.763
			c-59.543-62.106-130.827-113.013-211.743-154.175C908.108,341.478,905.312,340.287,902.563,338.995L902.563,338.995z
			M599.927,358.478c6.846,0,13.638,0.274,20.361,0.732l-58.081,100.561c-81.514,16.526-142.676,85.88-142.676,168.897
			c0,20.854,3.841,40.819,10.913,59.325c0.008,0.021-0.008,0.053,0,0.074l-58.228,100.854
			c-34.551-44.823-54.932-100.229-54.932-160.182C317.285,479.484,443.808,358.477,599.927,358.478L599.927,358.478z M768.896,570.513
			L638.013,797.271c81.076-16.837,141.797-85.875,141.797-168.603C779.81,608.194,775.724,588.729,768.896,570.513L768.896,570.513z"
			/>
</svg>
`,Su=`<?xml version="1.0" standalone="no"?>
<svg version="1.1"
	xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
	xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"
	viewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">
		<path id="path6686" inkscape:connector-curvature="0" d="M779.843,599.925c0,95.331-80.664,172.612-180.169,172.612
			c-99.504,0-180.168-77.281-180.168-172.612c0-95.332,80.664-172.612,180.168-172.612
			C699.179,427.312,779.843,504.594,779.843,599.925z M600,240.521c-103.025,0.457-209.814,25.538-310.904,73.557
			c-75.058,37.122-148.206,89.496-211.702,154.141C46.208,501.218,6.431,549,0,599.981c0.76,44.161,48.13,98.669,77.394,131.763
			c59.543,62.106,130.786,113.018,211.702,154.179c94.271,45.751,198.616,72.092,310.904,73.557
			c103.123-0.464,209.888-25.834,310.866-73.557c75.058-37.122,148.243-89.534,211.74-154.179
			c31.185-32.999,70.962-80.782,77.394-131.763c-0.76-44.161-48.13-98.671-77.394-131.764
			c-59.543-62.106-130.824-112.979-211.74-154.141C816.644,268.36,712.042,242.2,600,240.521z M599.924,329.769
			c156.119,0,282.675,120.994,282.675,270.251c0,149.256-126.556,270.25-282.675,270.25S317.249,749.275,317.249,600.02
			C317.249,450.763,443.805,329.769,599.924,329.769L599.924,329.769z"/>
</svg>
`,lt=(function(){function a(){E(this,a)}return C(a,null,[{key:"createSVGElement",value:function(t){return new DOMParser().parseFromString(t,"image/svg+xml").documentElement}}])})(),ii=(function(){function a(){E(this,a)}return C(a,null,[{key:"changeVisibility",value:function(t,e,n,r){r.target.id===a.VISIBLE_ICON_ID?(e[M].display="none",n[M].display="block",t.type="password"):(e[M].display="block",n[M].display="none",t.type=y)}},{key:"createIconElement",value:function(t,e){var n=lt.createSVGElement(t);return n.id=e,n[S].add("visibility-icon"),n}},{key:"create",value:function(t){var e=B();e.id="visibility-icon-container";var n=a.createIconElement(Su,a.VISIBLE_ICON_ID);n[M].display="none",e.appendChild(n);var r=a.createIconElement(ku,"not-visible-icon");return e.appendChild(r),e.onclick=a.changeVisibility.bind(this,t,n,r),e}}])})();ii.VISIBLE_ICON_ID="visible-icon";var wu=ii,Eu=(function(){function a(){E(this,a)}return C(a,null,[{key:"createCautionText",value:function(){var t=B("a");return t[S].add("insert-key-input-help-text"),t.innerText="Please exercise CAUTION when inserting your API key outside of deepchat.dev or localhost!!",t}},{key:"createHelpLink",value:function(t){var e=B("a");return e[S].add("insert-key-input-help-text"),e.href=t,e.innerText="Find more info here",e.target="_blank",e}},{key:"createFailText",value:function(){var t=B();return t.id="insert-key-input-invalid-text",t[M].display="none",t}},{key:"createHelpTextContainer",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=B();n.id="insert-key-help-text-container";var r=B();r.id="insert-key-help-text-contents";var s=a.createFailText();if(r.appendChild(s),t){var o=a.createHelpLink(t);r.appendChild(o)}if(e===!0){var l=a.createCautionText();r.appendChild(l)}return n.appendChild(r),{helpTextContainerElement:n,failTextElement:s}}},{key:"onFail",value:function(t,e,n,r){t[S].replace("insert-key-input-valid","insert-key-input-invalid"),n.innerText=r,n[M].display="block",e.innerText="Start",t[S].remove("loading")}},{key:"onLoad",value:function(t,e){t[S].add("loading"),e.innerHTML='<div id="loading-key"></div>'}},{key:"verifyKey",value:function(t,e,n){var r=t.value.trim();n.verifyKey(r,e)}},{key:"addVerificationEvents",value:function(t,e,n,r,s){var o={onSuccess:r,onFail:a.onFail.bind(this,t,e,n),onLoad:a.onLoad.bind(this,t,e)},l=a.verifyKey.bind(this,t,o,s);e.onclick=l,t.onkeydown=function(u){!t[S].contains("loading")&&u.key===Ae.ENTER&&l()}}},{key:"createStartButton",value:function(){var t=B();return t.id="start-button",t.innerText="Start",t}},{key:"onInputFocus",value:function(t){t.target[S].replace("insert-key-input-invalid","insert-key-input-valid")}},{key:"createInput",value:function(t){var e=B();e.id="insert-key-input-container";var n=B("input");return n.id="insert-key-input",n.placeholder=t||"API Key",n.type="password",n[S].add("insert-key-input-valid"),n.onfocus=a.onInputFocus,e.appendChild(n),e}},{key:"createContents",value:function(t,e){var n,r=B();r.id="insert-key-contents";var s=a.createInput(e.insertKeyPlaceholderText),o=s.children[0],l=wu.create(o);s.appendChild(l),r.appendChild(s);var u=a.createStartButton(),c=a.createHelpTextContainer(e.keyHelpUrl,(n=e.deepChat._insertKeyViewStyles)==null?void 0:n.displayCautionText),d=c.helpTextContainerElement,h=c.failTextElement;return r.appendChild(u),r.appendChild(d),a.addVerificationEvents(o,u,h,t,e),r}},{key:"createElements",value:function(t,e){var n=B();n.id="insert-key-view";var r=a.createContents(t,e);return n.appendChild(r),n}},{key:"render",value:function(t,e,n){var r=a.createElements(e,n);t.replaceChildren(r)}}])})(),kn=(function(){function a(){E(this,a)}return C(a,null,[{key:"enableButtons",value:function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;window.webLLM?(t&&(t[ae]=!1),e&&(e[ae]=!1)):n<ca.MODULE_SEARCH_LIMIT_S*4&&setTimeout(function(){return a.enableButtons(t,e,n+1)},250)}},{key:"setUpInitial",value:function(t,e,n,r){var s=(e==null?void 0:e.downloadClass)||a.DOWNLOAD_BUTTON_CLASS,o=(e==null?void 0:e.uploadClass)||a.UPLOAD_BUTTON_CLASS,l=(e==null?void 0:e.fileInputClass)||a.FILE_INPUT_CLASS;return setTimeout(function(){var u=n==null?void 0:n.getElementsByClassName(s)[0],c=n==null?void 0:n.getElementsByClassName(l)[0],d=n==null?void 0:n.getElementsByClassName(o)[0];u&&(u.onclick=function(){return t()}),c&&(c.onchange=function(){c[T]&&c[T].length>0&&t(c[T])}),d&&(d.onclick=function(){return c[de]()}),(u||d)&&a.enableButtons(u,d)}),(e==null?void 0:e.initialHtml)||`<div>
        Download or upload a web model that will run entirely on your browser: <br/> 
        <button disabled class="`.concat(s,` deep-chat-button deep-chat-web-model-button">Download</button>
        `).concat(r?"":'<input type="file" class="'.concat(l,`" hidden multiple />
          <button disabled class="`).concat(o,' deep-chat-button deep-chat-web-model-button">Upload</button>'),`
      </div>`)}},{key:"exportFile",value:function(t){for(var e=B("a"),n=4,r=function(l){setTimeout(function(){for(var u=l*n,c=u;c<Math.min(u+n,t.length);c+=1){var d=URL.createObjectURL(t[c]);e.href=d,e.download=t[c].name,document.body.appendChild(e),e[de](),URL.revokeObjectURL(d)}},500*l)},s=0;s<t.length/n;s+=1)r(s)}},{key:"setUpAfterLoad",value:function(t,e,n,r){var s=(e==null?void 0:e.exportFilesClass)||a.EXPORT_BUTTON_CLASS;return setTimeout(function(){var o=n==null?void 0:n.getElementsByClassName(s)[0];o&&(o.onclick=function(){return a.exportFile(t)})}),(e==null?void 0:e.afterLoadHtml)||`<div>
        Model loaded successfully and has been cached for future requests.
        `.concat(r?"":'<br/> <button style="margin-top: 5px" class="'.concat(s,' deep-chat-button">Export</button>'),`
      </div>`)}}])})();kn.DOWNLOAD_BUTTON_CLASS="deep-chat-download-button",kn.UPLOAD_BUTTON_CLASS="deep-chat-upload-button",kn.FILE_INPUT_CLASS="deep-chat-file-input",kn.EXPORT_BUTTON_CLASS="deep-chat-export-button";var Wa=kn,Ga={model_list:[{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f32_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f32_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f32_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:9109.03,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:6749.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:4618.52,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-13b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-13b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-13b-chat-hf/Llama-2-13b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:11814.09,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-70b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-70b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-70b-chat-hf/Llama-2-70b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:43729.05,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f16_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f16_1-ctx2k-webgpu.wasm",vram_required_MB:2972.09,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f32_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f32_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f32_1-ctx2k-webgpu.wasm",vram_required_MB:3928.09,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f16_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:2041.09,low_resource_required:!0,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f32_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f32_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f32_1-ctx1k-webgpu.wasm",vram_required_MB:2558.09,low_resource_required:!0},{model_url:"https://huggingface.co/mlc-ai/WizardMath-7B-V1.1-q4f16_1-MLC/resolve/main/",local_id:"WizardMath-7B-V1.1-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Mistral-7B-Instruct-v0.2-q4f16_1-MLC/resolve/main/",local_id:"Mistral-7B-Instruct-v0.2-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/OpenHermes-2.5-Mistral-7B-q4f16_1-MLC/resolve/main/",local_id:"OpenHermes-2.5-Mistral-7B-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/NeuralHermes-2.5-Mistral-7B-q4f16_1-MLC/resolve/main/",local_id:"NeuralHermes-2.5-Mistral-7B-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q0f16-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q0f16",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q0f16-ctx2k-webgpu.wasm",vram_required_MB:5063.52,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q0f32-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q0f32",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q0f32-ctx2k-webgpu.wasm",vram_required_MB:5394.53,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q4f16_1-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:899.11,low_resource_required:!0,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q4f32_1-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q4f32_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q4f32_1-ctx1k-webgpu.wasm",vram_required_MB:992.11,low_resource_required:!0}],use_web_worker:!0},Lt=(function(a){function i(t){var e;E(this,i);var n,r;return e=F(this,i,[t]),e._isModelLoaded=!1,e._isModelLoading=!1,e._loadOnFirstMessage=!1,e._webModel={},e.permittedErrorPrefixes=[i.MULTIPLE_MODELS_ERROR,i.WEB_LLM_NOT_FOUND_ERROR,i.GENERIC_ERROR],e._conversationHistory=[],R(t.webModel)=="object"&&(e._webModel=t.webModel),(n=e._webModel.load)!=null&&n.clearCache&&i.clearAllCache(),e.findModelInWindow(t),e.canSendMessage=e.canSubmit.bind(zt(e)),e._chatEl=(r=t.shadowRoot)==null?void 0:r.children[0],t.history&&i.setUpHistory(e._conversationHistory,t.history),e}return D(i,a),C(i,[{key:"setUpMessages",value:function(e){var n=this;this._messages=e,this._removeIntro=function(){e.removeIntroductoryMessage(),n._removeIntro=void 0}}},{key:"findModelInWindow",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s;window.webLLM?this.configureInit(this.shouldAddIntroMessage(e.introMessage)):r>i.MODULE_SEARCH_LIMIT_S?((s=this._messages)==null||s.addNewErrorMessage(ye,i.WEB_LLM_NOT_FOUND_ERROR),console[_]("The deep-chat-web-llm module has not been attached to the window object. Please see the following guide:"),console[_]("https://deepchat.dev/examples/externalModules")):setTimeout(function(){return n.findModelInWindow(e,r+1)},1e3)}},{key:"shouldAddIntroMessage",value:function(e){var n;return!e&&this._webModel&&((n=this._webModel.introMessage)==null?void 0:n.displayed)!==!1}},{key:"scrollToTop",value:function(e){var n=this,r;((r=this._webModel.introMessage)==null?void 0:r.autoScroll)!==!1&&setTimeout(function(){var s,o;(s=n._messages)!=null&&s.elementRef&&oe.scrollToTop((o=n._messages)==null?void 0:o.elementRef)},e)}},{key:"getIntroMessage",value:function(e){if(!(!this.shouldAddIntroMessage(e)||!this._chatEl)){var n=Wa.setUpInitial(this.init.bind(this),this._webModel.introMessage,this._chatEl,!!this._webModel.worker);return this.scrollToTop(1),f(f(f({},P,me),"html",n),"sendUpdate",!1)}}},{key:"configureInit",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(s=this._webModel.load,!s){o.n=2;break}if(!s.onInit){o.n=1;break}return this.init(),o.a(2);case 1:if(!s.onMessage){o.n=2;break}return this._loadOnFirstMessage=!0,o.a(2);case 2:r||this.init();case 3:return o.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"init",value:(function(){var t=w(v().m(function n(r){var s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:if((s=this._messages)==null||s.removeError(),o=this.attemptToCreateChat(),l=o,!l){u.n=1;break}return u.n=1,this.loadModel(o,r);case 1:return u.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"attemptToCreateChat",value:function(){var e;if(i.chat){(e=this._messages)==null||e.addNewErrorMessage(ye,i.MULTIPLE_MODELS_ERROR),console[_](i.MULTIPLE_MODELS_ERROR);return}if(!(this._isModelLoaded||this._isModelLoading)){var n=this._webModel.worker;return Ga.use_web_worker&&n?new window.webLLM.ChatWorkerClient(n):new window.webLLM.ChatModule}}},{key:"getConfig",value:function(){var e,n=i.DEFAULT_MODEL;this._webModel.model&&(n=this._webModel.model);var r=L(Ga);if(this._webModel.urls){var s=r.model_list.find(function(o){return o.local_id=n});s&&(this._webModel.urls.model&&(s.model_url=this._webModel.urls.model),this._webModel.urls.wasm&&(s.model_lib_url=this._webModel.urls.wasm))}return(e=this._webModel.load)!=null&&e.skipCache&&(r.use_cache=!1),{model:n,appConfig:r}}},{key:"loadModel",value:(function(){var t=w(v().m(function n(r,s){var o=this,l,u,c,d,h,p,g,m,b,k,A,I,x,U,j,J;return v().w(function(G){for(;;)switch(G.p=G.n){case 0:return this.scrollToTop(),i.chat=r,this._isModelLoading=!0,m=((l=this._webModel.introMessage)==null?void 0:l.displayed)===!1,b=function(se){var ne;(ne=o._messages)==null||ne.addNewMessage({html:"<div>".concat(se[y],"</div>"),overwrite:!0,sendUpdate:!1}),m&&(setTimeout(function(){return oe.scrollToBottom(o._messages)}),m=!1)},i.chat.setInitProgressCallback(b),G.p=1,A=this.getConfig(),I=A.model,x=A.appConfig,U={},this._webModel.instruction&&(U.conv_config={system:this._webModel.instruction}),this._conversationHistory.length>0&&(U.conversation_history=this._conversationHistory),G.n=2,i.chat.reload(I,U,x,s);case 2:k=G.v,G.n=4;break;case 3:return G.p=3,J=G.v,G.a(2,this.unloadChat(J));case 4:(c=(u=this.deepChat)._validationHandler)==null||c.call(u),(d=this._webModel.introMessage)!=null&&d.removeAfterLoad?this._webModel.introMessage.displayed===!1?(p=this._messages)==null||p.removeLastMessage():(g=this._removeIntro)==null||g.call(this):(j=Wa.setUpAfterLoad(k,this._webModel.introMessage,this._chatEl,!!this._webModel.worker),(h=this._messages)==null||h.addNewMessage({html:j,overwrite:!0,sendUpdate:!1})),this._isModelLoaded=!0,this._isModelLoading=!1;case 5:return G.a(2)}},n,this,[[1,3]])}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"unloadChat",value:(function(){var t=w(v().m(function n(r){var s,o;return v().w(function(l){for(;;)switch(l.n){case 0:if((s=this._messages)==null||s.addNewErrorMessage(ye,i.GENERIC_ERROR),console[_](r),this._isModelLoaded=!1,this._isModelLoading=!1,o=i.chat,!o){l.n=2;break}return l.n=1,i.chat.unload();case 1:i.chat=void 0;case 2:return l.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"immediateResp",value:(function(){var t=w(v().m(function n(r,s,o){var l,u,c,d,h;return v().w(function(p){for(;;)switch(p.n){case 0:return c=f,d={},h=y,p.n=1,o.generate(s,void 0,0);case 1:return l=c(d,h,p.v),p.n=2,i.processResponse(this.deepChat,r,l);case 2:u=p.v,u&&u.forEach(function(g){return r.addNewMessage(g)}),this.completionsHandlers.onFinish();case 3:return p.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"streamResp",value:(function(){var t=w(v().m(function n(r,s,o){var l=this,u;return v().w(function(c){for(;;)switch(c.n){case 0:return this.streamHandlers.onAbort=function(){o.interruptGenerate()},this.streamHandlers.onOpen(),u=new ot(r),c.n=1,o.generate(s,(function(){var d=w(v().m(function h(p,g){var m;return v().w(function(b){for(;;)switch(b.n){case 0:return b.n=1,i.processResponse(l.deepChat,r,f({},y,g));case 1:m=b.v,m&&u.upsertStreamedMessage(f(f({},y,m[0][y]),"overwrite",!0));case 2:return b.a(2)}},h)}));return function(h,p){return d.apply(this,arguments)}})());case 1:u.finaliseStreamedMessage(),this.streamHandlers.onClose();case 2:return c.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"generateRespByType",value:(function(){var t=w(v().m(function n(r,s,o,l){var u,c;return v().w(function(d){for(;;)switch(d.p=d.n){case 0:if(d.p=0,!o){d.n=2;break}return d.n=1,this.streamResp(r,s,l);case 1:d.n=3;break;case 2:return d.n=3,this.immediateResp(r,s,l);case 3:d.n=5;break;case 4:d.p=4,c=d.v,(u=this._messages)==null||u.addNewErrorMessage(ye),console.log(c);case 5:return d.a(2)}},n,this,[[0,4]])}));function e(n,r,s,o){return t.apply(this,arguments)}return e})()},{key:"generateResp",value:(function(){var t=w(v().m(function n(r,s,o){var l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:return l=s[s.length-1][y],m.n=1,Y.processRequestInterceptor(this.deepChat,{body:f({},y,l)});case 1:u=m.v,c=u.body,d=u.error,h=!!this.stream;try{d?(Y.displayError(r,new Error(d)),(h?this.streamHandlers.onClose:this.completionsHandlers.onFinish)()):!c||!c[y]?(p=po({body:c},!1),console[_](p),g=h?this.streamHandlers.onClose:this.completionsHandlers.onFinish,Y.onInterceptorError(r,p,g)):this.generateRespByType(r,c[y],!!this.stream,o)}catch(b){this.unloadChat(b)}case 2:return m.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o,l;return v().w(function(u){for(;;)switch(u.n){case 0:if(this._isModelLoaded){u.n=3;break}if(!this._loadOnFirstMessage){u.n=2;break}return u.n=1,this.init();case 1:u.n=3;break;case 2:return u.a(2);case 3:!i.chat||this._isModelLoading||((o=this._webModel.introMessage)!=null&&o.removeAfterMessage&&((l=this._removeIntro)==null||l.call(this)),r.addLoadingMessage(),this.generateResp(r,s,i.chat));case 4:return u.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"canSubmit",value:function(e){return!(e!=null&&e.trim())||this._isModelLoading?!1:this._loadOnFirstMessage?!0:!!this._isModelLoaded}},{key:"isWebModel",value:function(){return!0}}],[{key:"setUpHistory",value:function(e,n){n.forEach(function(r,s){if(r[P]===Z&&r[y]){var o=n[s+1];o!=null&&o[y]&&o[P]!==Z&&e.push([r[y],o[y]])}})}},{key:"processResponse",value:(function(){var t=w(v().m(function n(r,s,o){var l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:return m.n=1,(l=r.responseInterceptor)==null?void 0:l.call(r,o);case 1:if(g=m.v,g){m.n=2;break}g=o;case 2:if(c=g,!((u=r.connect)!=null&&u.stream&&Array.isArray(c)&&c.length>1)){m.n=3;break}return console[_](Ps),m.a(2);case 3:if(d=Array.isArray(c)?c:[c],h=d.find(function(b){return typeof b[_]=="string"}),!h){m.n=4;break}return Y.displayError(s,new Error(h[_])),m.a(2);case 4:if(!d.find(function(b){return!b||!b[y]})){m.n=5;break}return p=fo(o,!!r.responseInterceptor,c),Y.displayError(s,new Error(p)),m.a(2);case 5:return m.a(2,d)}},n)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"clearAllCache",value:function(){i.clearCache("webllm/model"),i.clearCache("webllm/wasm")}},{key:"clearCache",value:function(e){caches.open(e).then(function(n){n.keys().then(function(r){r.forEach(function(s){n.delete(s)})})})}}])})(tr);Lt.GENERIC_ERROR="Error, please check the [troubleshooting](".concat(ue,"webModel#troubleshooting) section of documentation for help."),Lt.MULTIPLE_MODELS_ERROR="Cannot run multiple web models",Lt.WEB_LLM_NOT_FOUND_ERROR="WebLLM module not found",Lt.DEFAULT_MODEL="Llama-2-7b-chat-hf-q4f32_1",Lt.MODULE_SEARCH_LIMIT_S=5;var ca=Lt,Ee=function(i,t,e,n){return{url:i,method:t,handleVerificationResult:e,augmentUrl:n}},Cu=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},Tu=function(i,t,e,n){var r=i;Array.isArray(r[_])&&r[_][0]==="Error in `parameters`: field required"?e(t):n(we)},Au=function(){return Ee("https://api-inference.huggingface.co/models/gpt2",Te,Tu)},oi=(function(a){function i(t,e,n,r,s,o){var l;return E(this,i),l=F(this,i,[t,Au(),Cu,s,o]),l.insertKeyPlaceholderText="Hugging Face Token",l.keyHelpUrl="https://huggingface.co/settings/tokens",l.permittedErrorPrefixes=[ta],l.url="".concat(i.URL_PREFIX).concat(n),l.textInputPlaceholderText=e,R(r)=="object"&&(r.model&&(l.url="".concat(i.URL_PREFIX).concat(r.model)),r.options&&(l.rawBody.options=r.options),r.parameters&&(l.rawBody.parameters=r.parameters)),l}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n,r){var s,o=L(e),l=n[n.length-1][y];if(l)return(s=o.options)!==null&&s!==void 0||(o.options={}),o.options.wait_for_model=!0,ie({inputs:l},o)}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.connectSettings){u.n=1;break}throw new Error(qe);case 1:l=this.preprocessBody(this.rawBody,s,o),xe.request(this,l,r);case 2:return u.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()}])})(W);oi.URL_PREFIX="https://api-inference.huggingface.co/models/";var xt=oi,da=(function(a){function i(t,e,n,r,s,o){var l;return E(this,i),l=F(this,i,[t,e,n,r,s,o]),l.isTextInputDisabled=!0,l.canSendMessage=i.canSendFile,l}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n,r){return r[0]}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){return v().w(function(l){for(;;)switch(l.n){case 0:if(this.connectSettings){l.n=1;break}throw new Error(qe);case 1:if(o!=null&&o[0]){l.n=2;break}throw new Error(sr);case 2:xe.poll(this,o[0],r,!1);case 3:return l.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()}],[{key:"canSendFile",value:function(e,n){return!!(n!=null&&n[0])}}])})(xt),Mu=(function(a){function i(t){E(this,i);var e,n,r,s=(n=(e=t.directConnection)==null?void 0:e.huggingFace)==null?void 0:n.audioClassification,o=(r=t.directConnection)==null?void 0:r.huggingFace;return F(this,i,[t,"Attach an audio ".concat(ve),"ehcalabres/wav2vec2-lg-xlsr-en-speech-emotion-recognition",s,o,{audio:{}}])}return D(i,a),C(i,[{key:"extractPollResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r.estimated_time){o.n=1;break}return o.a(2,{timeoutMS:(r.estimated_time+1)*1e3});case 1:if(!r[_]){o.n=2;break}throw r[_];case 2:return o.a(2,f({},y,((s=r[0])==null?void 0:s.label)||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(da),Iu=(function(a){function i(t){E(this,i);var e,n,r,s=(n=(e=t.directConnection)==null?void 0:e.huggingFace)==null?void 0:n.imageClassification,o=(r=t.directConnection)==null?void 0:r.huggingFace;return F(this,i,[t,"Attach an image ".concat(ve),"google/vit-base-patch16-224",s,o,{images:{}}])}return D(i,a),C(i,[{key:"extractPollResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r.estimated_time){o.n=1;break}return o.a(2,{timeoutMS:(r.estimated_time+1)*1e3});case 1:if(!r[_]){o.n=2;break}throw r[_];case 2:return o.a(2,f({},y,((s=r[0])==null?void 0:s.label)||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(da),cr=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},Ru=function(i,t,e,n){i.message?n(we):e(t)},dr=function(){return Ee("https://api.stability.ai/v1/engines/list",Se,Ru)},Gt="data:image/png;base64,",hr=(function(a){function i(t,e,n,r,s){var o;return E(this,i),o=F(this,i,[t,e,n,r,s]),o.insertKeyPlaceholderText=o.genereteAPIKeyName("Stability AI"),o.keyHelpUrl="https://platform.stability.ai/docs/getting-started/authentication",o.permittedErrorPrefixes=[xn,"invalid_"],o}return D(i,a),C(i)})(W),Pu=(function(a){function i(t){var e;E(this,i);var n,r=L(t.directConnection),s=r==null?void 0:r.stabilityAI,o={images:{files:{acceptedFormats:".png",maxNumberOfFiles:1}}};e=F(this,i,[t,dr(),cr,s,o]),e.url="https://api.stability.ai/v1/generation/esrgan-v1-x2plus/image-to-image/upscale",e.textInputPlaceholderText="Describe image changes";var l=(n=r==null?void 0:r.stabilityAI)==null?void 0:n.imageToImageUpscale;return R(l)=="object"&&(l.engine_id&&(e.url="https://api.stability.ai/v1/generation/".concat(l.engine_id,"/image-to-image/upscale")),i.cleanConfig(l),Object.assign(e.rawBody,l)),e.canSendMessage=i.canSendFileMessage,e}return D(i,a),C(i,[{key:"createFormDataBody",value:function(e,n){var r=new FormData;return r.append(le,n),Object.keys(e).forEach(function(s){r.append(s,String(e[s]))}),r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l;return v().w(function(u){for(;;)switch(u.n){case 0:if(this.connectSettings){u.n=1;break}throw new Error(qe);case 1:if(o){u.n=2;break}throw new Error(ea);case 2:l=this.createFormDataBody(this.rawBody,o[0]),Y.tempRemoveContentHeader(this.connectSettings,xe.request.bind(this,this,l,r),!1);case 3:return u.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r.message){o.n=1;break}throw r.message;case 1:return s=r.artifacts.map(function(l){return f(f({},N,"".concat(Gt).concat(l.base64)),z,le)}),o.a(2,f({},T,s))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"cleanConfig",value:function(e){delete e.engine_id}},{key:"canSendFileMessage",value:function(e,n){return!!(n!=null&&n[0])}}])})(hr),xu=(function(a){function i(t){var e;E(this,i);var n,r=L(t.directConnection),s=r==null?void 0:r.stabilityAI,o=f({},pe,f({},T,{acceptedFormats:".png",maxNumberOfFiles:2}));e=F(this,i,[t,dr(),cr,s,o]),e.url="https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/image-to-image/masking",e._maskSource="MASK_IMAGE_WHITE",e.textInputPlaceholderText="Describe image changes";var l=(n=r==null?void 0:r.stabilityAI)==null?void 0:n.imageToImageMasking;return R(l)=="object"&&(l.engine_id&&(e.url="https://api.stability.ai/v1/generation/".concat(l.engine_id,"/image-to-image/masking")),l.weight!==void 0&&l.weight!==null&&(e._imageWeight=l.weight),l.mask_source!==void 0&&l.mask_source!==null&&(e._maskSource=l.mask_source),i.cleanConfig(l),Object.assign(e.rawBody,l)),e.canSendMessage=i.canSendFileTextMessage,e}return D(i,a),C(i,[{key:"createFormDataBody",value:function(e,n,r,s){var o=new FormData;return o.append("init_image",n),o.append("mask_source",String(this._maskSource)),o.append("mask_image",r),s&&s!==""&&o.append("text_prompts[0][text]",s),this._imageWeight!==void 0&&this._imageWeight!==null&&o.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(e).forEach(function(l){o.append(l,String(e[l]))}),o.get("weight")===void 0&&o.append("weight",String(1)),o}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l,u,c,d;return v().w(function(h){for(;;)switch(h.n){case 0:if(this.connectSettings){h.n=1;break}throw new Error(qe);case 1:if(!(!o||!o[0]||!o[1])){h.n=2;break}throw new Error(ea);case 2:c=(u=(l=s[s.length-1])==null?void 0:l[y])==null?void 0:u.trim(),d=this.createFormDataBody(this.rawBody,o[0],o[1],c),Y.tempRemoveContentHeader(this.connectSettings,xe.request.bind(this,this,d,r),!1);case 3:return h.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r.message){o.n=1;break}throw r.message;case 1:return s=r.artifacts.map(function(l){return f(f({},N,"".concat(Gt).concat(l.base64)),z,le)}),o.a(2,f({},T,s))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendFileTextMessage",value:function(e,n){return!!(n!=null&&n[0])&&!!(e&&e.trim()!=="")}}])})(hr),Bu=(function(a){function i(t){E(this,i);var e,n,r,s=(n=(e=t.directConnection)==null?void 0:e.huggingFace)==null?void 0:n.audioSpeechRecognition,o=(r=t.directConnection)==null?void 0:r.huggingFace;return F(this,i,[t,"Attach an audio ".concat(ve),"facebook/wav2vec2-large-960h-lv60-self",s,o,{audio:{}}])}return D(i,a),C(i,[{key:"extractPollResultData",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:if(!r.estimated_time){s.n=1;break}return s.a(2,{timeoutMS:(r.estimated_time+1)*1e3});case 1:if(!r[_]){s.n=2;break}throw r[_];case 2:return s.a(2,f({},y,r[y]||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(da),Ou=(function(a){function i(t){E(this,i);var e,n,r,s=(n=(e=t.directConnection)==null?void 0:e.huggingFace)==null?void 0:n.textGeneration,o=(r=t.directConnection)==null?void 0:r.huggingFace;return F(this,i,[t,"Once upon a time","gpt2",s,o])}return D(i,a),C(i,[{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r[_]){o.n=1;break}throw r[_];case 1:return o.a(2,f({},y,((s=r[0])==null?void 0:s.generated_text)||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(xt),Lu=(function(a){function i(t){var e;E(this,i);var n,r,s,o=(r=(n=t.directConnection)==null?void 0:n.huggingFace)==null?void 0:r.questionAnswer,l=(s=t.directConnection)==null?void 0:s.huggingFace;return e=F(this,i,[t,"Ask a question","bert-large-uncased-whole-word-masking-finetuned-squad",o,l]),e.permittedErrorPrefixes=[ta,"Error in"],e._context=o.context,e}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=n[n.length-1][y];if(r)return{inputs:{question:r,context:this._context,options:{wait_for_model:!0}}}}},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:if(!r[_]){s.n=1;break}throw r[_];case 1:return s.a(2,f({},y,r.answer||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(xt),Fu=(function(a){function i(t){E(this,i);var e,n,r,s=(n=(e=t.directConnection)==null?void 0:e.huggingFace)==null?void 0:n.summarization,o=(r=t.directConnection)==null?void 0:r.huggingFace;return F(this,i,[t,"Insert text to summarize","facebook/bart-large-cnn",s,o])}return D(i,a),C(i,[{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r[_]){o.n=1;break}throw r[_];case 1:return o.a(2,f({},y,((s=r[0])==null?void 0:s.summary_text)||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(xt),Du=(function(a){function i(t){var e,n;E(this,i);var r,s,o,l=(s=(r=t.directConnection)==null?void 0:r.huggingFace)==null?void 0:s.conversation,u=(o=t.directConnection)==null?void 0:o.huggingFace;return n=F(this,i,[t,"Ask me anything!","facebook/blenderbot-400M-distill",l,u]),(e=n.maxMessages)!==null&&e!==void 0||(n.maxMessages=-1),n}return D(i,a),C(i,[{key:"processMessagesI",value:function(e){var n=e.filter(function(u){return u[y]}),r=n[n.length-1][y],s=n.slice(0,n.length-1);if(r){var o=s.filter(function(u){return u[P]===Z}).map(function(u){return u[y]}),l=s.filter(function(u){return u[P]===me}).map(function(u){return u[y]});return{past_user_inputs:o,generated_responses:l,mostRecentMessageText:r}}}},{key:"preprocessBody",value:function(e,n){var r,s=L(e),o=this.processMessagesI(n);if(o)return(r=s.options)!==null&&r!==void 0||(s.options={}),s.options.wait_for_model=!0,ie({inputs:f({past_user_inputs:o.past_user_inputs,generated_responses:o.generated_responses},y,o.mostRecentMessageText)},s)}},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:if(!r[_]){s.n=1;break}throw r[_];case 1:return s.a(2,f({},y,r.generated_text||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(xt),Nu=(function(a){function i(t){var e;E(this,i);var n,r=L(t.directConnection),s=r.stabilityAI,o=f({},pe,f({},T,{acceptedFormats:".png",maxNumberOfFiles:1}));e=F(this,i,[t,dr(),cr,s,o]),e.url="https://api.stability.ai/v1/generation/stable-diffusion-v1-6/image-to-image",e.textInputPlaceholderText="Describe image changes";var l=(n=r.stabilityAI)==null?void 0:n.imageToImage;return R(l)=="object"&&(l.engine_id&&(e.url="https://api.stability.ai/v1/generation/".concat(l.engine_id,"/text-to-image")),l.weight!==void 0&&l.weight!==null&&(e._imageWeight=l.weight),i.cleanConfig(l),Object.assign(e.rawBody,l)),e.canSendMessage=i.canSendFileTextMessage,e}return D(i,a),C(i,[{key:"createFormDataBody",value:function(e,n,r){var s=new FormData;return s.append("init_image",n),r&&r!==""&&s.append("text_prompts[0][text]",r),this._imageWeight!==void 0&&this._imageWeight!==null&&s.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(e).forEach(function(o){s.append(o,String(e[o]))}),s.get("weight")===void 0&&s.append("weight",String(1)),s}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l,u,c,d;return v().w(function(h){for(;;)switch(h.n){case 0:if(this.connectSettings){h.n=1;break}throw new Error(qe);case 1:if(o){h.n=2;break}throw new Error(ea);case 2:c=(u=(l=s[s.length-1])==null?void 0:l[y])==null?void 0:u.trim(),d=this.createFormDataBody(this.rawBody,o[0],c),Y.tempRemoveContentHeader(this.connectSettings,xe.request.bind(this,this,d,r),!1);case 3:return h.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r.message){o.n=1;break}throw r.message;case 1:return s=r.artifacts.map(function(l){return f(f({},N,"".concat(Gt).concat(l.base64)),z,le)}),o.a(2,f({},T,s))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendFileTextMessage",value:function(e,n){return!!(n!=null&&n[0])&&!!(e&&e.trim()!=="")}}])})(hr),Uu=(function(a){function i(t){E(this,i);var e,n,r,s=(n=(e=t.directConnection)==null?void 0:e.huggingFace)==null?void 0:n.translation,o=(r=t.directConnection)==null?void 0:r.huggingFace;return F(this,i,[t,"Insert text to translate","Helsinki-NLP/opus-tatoeba-en-ja",s,o])}return D(i,a),C(i,[{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r[_]){o.n=1;break}throw r[_];case 1:return o.a(2,f({},y,((s=r[0])==null?void 0:s.translation_text)||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(xt),ju=(function(a){function i(t){var e;E(this,i);var n,r=L(t.directConnection),s=r.stabilityAI;e=F(this,i,[t,dr(),cr,s]),e.url="https://api.stability.ai/v1/generation/stable-diffusion-v1-6/text-to-image",e.textInputPlaceholderText="Describe an image";var o=(n=r.stabilityAI)==null?void 0:n.textToImage;return R(o)=="object"&&(o.engine_id&&(e.url="https://api.stability.ai/v1/generation/".concat(o.engine_id,"/text-to-image")),o.weight!==void 0&&o.weight!==null&&(e._imageWeight=o.weight),i.cleanConfig(o),Object.assign(e.rawBody,o)),e.canSendMessage=i.canSendTextMessage,e}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=n[n.length-1][y],s=L(e),o=f({},y,r);return this._imageWeight&&(o.weight=this._imageWeight),s.text_prompts=[o],s}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this));case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r.message){o.n=1;break}throw r.message;case 1:return s=r.artifacts.map(function(l){return f(f({},N,"".concat(Gt).concat(l.base64)),z,le)}),o.a(2,f({},T,s))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"cleanConfig",value:function(e){delete e.engine_id,delete e.weight}},{key:"canSendTextMessage",value:function(e){return!!(e&&e.trim()!=="")}}])})(hr),Hu=(function(a){function i(t){var e;E(this,i);var n,r,s,o=(r=(n=t.directConnection)==null?void 0:n.huggingFace)==null?void 0:r.fillMask,l=(s=t.directConnection)==null?void 0:s.huggingFace;return e=F(this,i,[t,"The goal of life is [MASK].","bert-base-uncased",o,l]),e.permittedErrorPrefixes=[ta,"No mask_token"],e}return D(i,a),C(i,[{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r[_]){o.n=1;break}throw r[_];case 1:return o.a(2,f({},y,((s=r[0])==null?void 0:s.sequence)||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(xt),ha=function(i){return f(f({},te,fe),ke,"".concat(Be).concat(i))},qu=function(i,t,e,n){var r=i;r[_]?r[_].message===ir?n(we):n(He):e(t)},pa=function(){return Ee("https://open.bigmodel.cn/api/paas/v4/models",Se,qu)},zu=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u=L(t.directConnection),c=u.bigModel;r=F(this,i,[t,pa(),ha,c]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("BigModel"),r.keyHelpUrl="https://open.bigmodel.cn/usercenter/apikeys",r.url="https://open.bigmodel.cn/api/paas/v4/audio/speech",r.permittedErrorPrefixes=[ke,Oe];var d=(s=u.bigModel)==null?void 0:s.textToSpeech;return R(d)===Q&&(r.cleanConfig(d),Object.assign(r.rawBody,d)),(e=(o=r.rawBody).model)!==null&&e!==void 0||(o.model="cogtts"),(n=(l=r.rawBody).voice)!==null&&n!==void 0||(l.voice="tongtong"),r}return D(i,a),C(i,[{key:"cleanConfig",value:function(e){delete e.key}},{key:"preprocessBody",value:function(e,n){var r=L(e),s=n[n.length-1];return r.input=(s==null?void 0:s[y])||"",r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this)))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o;return v().w(function(l){for(;;)if(l.n===0)return s=new Blob([r],f({},z,"audio/mpeg")),o=URL.createObjectURL(s),l.a(2,f({},T,[f(f({},N,o),z,ee)]))},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),fa=function(i){return f(f({},te,fe),ke,"".concat(Be).concat(i))},Wu=function(i,t,e,n){var r=i;r[_]?r[_].message===ir?n(we):n(He):e(t)},ma=function(){return Ee("https://api.together.xyz/v1/models",Se,Wu)},Gu=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u=L(t.directConnection),c=u.together;r=F(this,i,[t,ma(),fa,c]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Together AI"),r.keyHelpUrl="https://api.together.xyz/settings/api-keys",r.url="https://api.together.xyz/v1/audio/speech",r.permittedErrorPrefixes=[Qe,Oe];var d=(s=u.together)==null?void 0:s.textToSpeech;return R(d)===Q&&r.completeConfig(d),(e=(o=r.rawBody).model)!==null&&e!==void 0||(o.model="cartesia/sonic"),(n=(l=r.rawBody).voice)!==null&&n!==void 0||(l.voice="laidback woman"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=n[n.length-1];return r.input=(s==null?void 0:s[y])||"",r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this)))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o;return v().w(function(l){for(;;)if(l.n===0)return s=new Blob([r],f({},z,"audio/mpeg")),o=URL.createObjectURL(s),l.a(2,f({},T,[f(f({},N,o),z,ee)]))},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Ge="https://api.openai.com/v1/",Kt="https://platform.openai.com/account/api-keys",jr="input_text",Ka="input_image",Va="output_text",Cr="image_generation_call",li="function_call_output",Jt="response",Vt=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},ui=function(i,t,e,n){var r=i;r[_]?r[_].code==="invalid_api_key"?n(we):n(He):e(t)},$t=function(){return Ee("".concat(Ge,"models"),Se,ui)},ht=(function(){var a=w(v().m(function i(t,e,n){var r,s,o,l,u,c,d,h,p,g,m,b,k=arguments;return v().w(function(A){for(;;)switch(A.n){case 0:return r=k.length>3&&k[3]!==void 0?k[3]:!0,s=t.connectSettings,o=t.deepChat,l=t.completionsHandlers,u=t.messages,s.method=n,c={body:e,headers:s.headers},A.n=1,Y.processRequestInterceptor(o,c);case 1:if(d=A.v,h=d.body,p=d.headers,g=d.error,m=l.onFinish,!(g&&u)){A.n=2;break}return A.a(2,Y.onInterceptorError(u,g,m));case 2:return A.n=3,Y.fetch(t,p,r,h).then(function(I){return Y.processResponseByType(I)});case 3:if(b=A.v,!b[_]){A.n=4;break}throw b[_].message;case 4:return A.a(2,b)}},i)}));return function(t,e,n){return a.apply(this,arguments)}})(),Hr=(function(){function a(){E(this,a)}return C(a,null,[{key:"storeFiles",value:(function(){var i=w(v().m(function e(n,r,s,o){var l,u,c,d,h;return v().w(function(p){for(;;)switch(p.p=p.n){case 0:if(l=n.connectSettings.headers,l){p.n=1;break}return p.a(2);case 1:return n.url=o,u=l[te],delete l[te],c=s.map((function(){var g=w(v().m(function m(b){var k;return v().w(function(A){for(;;)if(A.n===0)return k=new FormData,A.a(2,(k.append("purpose","assistants"),k.append("file",b),new Promise(function(I){I(ht(n,k,Te,!1))})))},m)}));return function(m){return g.apply(this,arguments)}})()),p.p=2,p.n=3,Promise.all(c);case 3:return d=p.v.map(function(g){return{id:g.id,name:g.filename}}),p.a(2,(l[te]=u,d));case 4:throw p.p=4,h=p.v,l[te]=u,Y.displayError(r,h),n.completionsHandlers.onFinish(),h;case 5:return p.a(2)}},e,null,[[2,4]])}));function t(e,n,r,s){return i.apply(this,arguments)}return t})()},{key:"getType",value:function(t,e){var n=t[e].path;return!n||n.endsWith("png")?le:Ct}},{key:"getFiles",value:(function(){var i=w(v().m(function e(n,r,s,o){var l,u;return v().w(function(c){for(;;)switch(c.n){case 0:return l=r.map(function(d){var h=d.fileId;return n.url="".concat(s).concat(h).concat(o),new Promise(function(p){p(ht(n,void 0,"GET",!1))})}),c.n=1,Promise.all(l);case 1:return u=c.v.map(function(d,h){return new Promise(function(p){var g=new FileReader;g.readAsDataURL(d),g.onload=function(m){p(f(f(f({},N,m.target.result),"name",r[h].name),z,a.getType(r,h)))}})}),c.n=2,Promise.all(u);case 2:return c.a(2,c.v)}},e)}));function t(e,n,r,s){return i.apply(this,arguments)}return t})()},{key:"getFileName",value:function(t){var e=t.split("/");return e[e.length-1]}},{key:"getFilesAndNewText",value:(function(){var i=w(v().m(function e(n,r,s,o,l){var u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(h=s.getFilesPrefix,p=s.getFilesPostfix,g=r.length>0,!g){m.n=2;break}return m.n=1,a.getFiles(n,r,h,p);case 1:d=m.v,(u=l==null?void 0:l[y])!=null&&u.value&&d.forEach(function(b,k){var A;if(b[N]){var I=r[k].path;(A=l==null?void 0:l[y])!=null&&A.value&&I&&(l[y].value=l[y].value.replace(I,b[N]))}});case 2:return m.a(2,(c=l==null?void 0:l[y])!=null&&c.value?f(f({},y,l[y].value),P,o):f(f({},T,d),P,o))}},e)}));function t(e,n,r,s,o){return i.apply(this,arguments)}return t})()},{key:"getFileDetails",value:function(t,e){var n,r=[];return(n=e==null?void 0:e[y])!=null&&n.value&&t.content.forEach(function(s){var o,l;(l=(o=s[y])==null?void 0:o.annotations)==null||l.forEach(function(u){var c;u[y]&&u[y].startsWith("sandbox:")&&(c=u.file_path)!=null&&c.file_id&&r.push({path:u[y],fileId:u.file_path.file_id,name:a.getFileName(u[y])})})}),e!=null&&e.image_file&&r.push({fileId:e.image_file.file_id}),r}},{key:"getFilesAndText",value:(function(){var i=w(v().m(function e(n,r,s,o){var l;return v().w(function(u){for(;;)switch(u.n){case 0:return l=a.getFileDetails(r,o),u.n=1,a.getFilesAndNewText(n,l,s,r.role,o);case 1:return u.a(2,u.v)}},e)}));function t(e,n,r,s){return i.apply(this,arguments)}return t})()},{key:"parseResult",value:function(t,e){var n=[];if(e)n=t.data;else for(var r=0;r<t.data.length;r+=1){var s=t.data[r];if(s.role===rt)n.push(s);else break}return n.reverse()}},{key:"parseMessages",value:function(t,e,n){var r=[];return e.forEach((function(){var s=w(v().m(function o(l){return v().w(function(u){for(;;)switch(u.n){case 0:l.content.filter(function(c){return!!c[y]||!!c.image_file}).sort(function(c){return c[y]?-1:c.image_file?1:0}).forEach((function(){var c=w(v().m(function d(h){return v().w(function(p){for(;;)switch(p.n){case 0:r.push(a.getFilesAndText(t,l,n,h));case 1:return p.a(2)}},d)}));return function(d){return c.apply(this,arguments)}})());case 1:return u.a(2)}},o)}));return function(o){return s.apply(this,arguments)}})()),Promise.all(r)}},{key:"processStreamMessages",value:(function(){var i=w(v().m(function e(n,r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,a.parseMessages(n,[{content:r,role:rt}],s))},e)}));function t(e,n,r){return i.apply(this,arguments)}return t})()},{key:"processAPIMessages",value:(function(){var i=w(v().m(function e(n,r,s,o){var l;return v().w(function(u){for(;;)if(u.n===0)return l=a.parseResult(r,s),u.a(2,a.parseMessages(n,l,o))},e)}));function t(e,n,r,s){return i.apply(this,arguments)}return t})()}])})();Hr.FILES_WITH_TEXT_ERROR="content with type `text` must have `text` values",Hr.FUNCTION_TOOL_RESP_ERROR="Response must contain an array of strings for each individual function/tool_call, see ".concat(ue,"directConnection/OpenAI/#assistant-functions.");var bt=Hr,ci=(function(a){function i(t,e,n,r,s,o){var l;if(E(this,i),l=F(this,i,[t,r,s,o]),l.insertKeyPlaceholderText=l.genereteAPIKeyName("OpenAI"),l.keyHelpUrl=Kt,l.url="",l.permittedErrorPrefixes=[xn,"Please send text",ua.FAILED_ERROR_MESSAGE],l.shouldFetchHistory=!1,l._searchedForThreadId=!1,l._config={},l._newAssistantDetails={model:"gpt-4"},l._waitingForStreamResponse=!1,l._isSSEStream=!1,l.urlSegments=n,R(e)=="object"){l._config=e;var u=l._config,c=u.new_assistant,d=u.thread_id,h=u.load_thread_history;Object.assign(l._newAssistantDetails,c),d&&(l.sessionId=d),h&&(l.shouldFetchHistory=!0)}return l.maxMessages=1,l._isSSEStream=!!(l.stream&&(R(l.stream)!="object"||!l.stream.simulation)),l}return D(i,a),C(i,[{key:"fetchHistoryFunc",value:(function(){var t=w(v().m(function n(){var r=this,s;return v().w(function(o){for(;;)switch(o.p=o.n){case 0:return setTimeout(function(){return r.deepChat.disableSubmitButton()},2),o.p=1,o.n=2,this.getThreadMessages(this.sessionId,!0);case 2:return s=o.v,o.a(2,(this.deepChat.disableSubmitButton(!1),s));case 3:return o.p=3,o.v,o.a(2,[f({},_,Bs)])}},n,this,[[1,3]])}));function e(){return t.apply(this,arguments)}return e})()},{key:"processMessage",value:function(e,n){var r=this.totalMessagesMaxCharLength||-1,s=la.getCharacterLimitMessages(e,r)[0];if(n&&n.length>0){var o=this.filesToolType;if(typeof this.filesToolType=="function"){var l=this.filesToolType(n.map(function(c){var d=c.name;return d}));l==="code_interpreter"||l==="file_search"||l===pe?o=l:(console[_]('Tool type "'.concat(l,'" is not valid')),console[_]('Expected "code_interpreter" or "file_search" or "images". Going to default to "images"'))}if(o==="file_search")return i.processAttachmentsMessage(s,n,"file_search");if(o==="code_interpreter")return i.processAttachmentsMessage(s,n,"code_interpreter");if(n.find(function(c){var d=c.name;return!Ze.isImageFileExtension(d)}))console[_]("The uploaded files contained a non-image file"),console[_]('Make sure only images can be uploaded or define a "code_interpreter" or "file_search" value in the "files_tool_type" property'),console.warn('Make sure your existing assistant supports these "tools" or specify them in the "new_assistant" property');else{var u=i.processImageMessage(s,n);if(u)return u}}return f({content:s[y]||""},P,Z)}},{key:"createNewThreadMessages",value:function(e,n,r){var s=L(e),o=this.processMessage(n,r);return s.thread={messages:[o]},s}},{key:"callService",value:function(e,n,r){if(this.messages=e,this.sessionId){this.url="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId,"/messages").concat(this.urlSegments.createMessagePostfix);var s=this.processMessage(n,r);xe.request(this,s,e)}else{this.url="".concat(this.urlSegments.threadsPrefix,"/runs").concat(this.urlSegments.threadsPosfix);var o=this.createNewThreadMessages(this.rawBody,n,r);this._isSSEStream?this.createStreamRun(o):xe.request(this,o,e)}}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l,u,c,d,h;return v().w(function(p){for(;;)switch(p.n){case 0:if(this._waitingForStreamResponse=!1,!!this.connectSettings){p.n=1;break}throw new Error(qe);case 1:if(!((l=(u=this.rawBody).assistant_id)!==null&&l!==void 0)){p.n=2;break}p.n=5;break;case 2:if(d=this._config.assistant_id,d){p.n=4;break}return p.n=3,this.createNewAssistant();case 3:d=p.v;case 4:u.assistant_id=d;case 5:if(this._searchedForThreadId||this.searchPreviousMessagesForThreadId(r.messageToElements),!o){p.n=7;break}return p.n=6,bt.storeFiles(this,r,o,this.urlSegments.storeFiles);case 6:h=p.v,p.n=8;break;case 7:h=void 0;case 8:c=h,this.connectSettings.method=Te,this.callService(r,s,c);case 9:return p.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"createNewAssistant",value:(function(){var t=w(v().m(function n(){var r,s;return v().w(function(o){for(;;)switch(o.p=o.n){case 0:return o.p=0,this.url=this.urlSegments.newAssistantUrl,o.n=1,ht(this,L(this._newAssistantDetails),Te);case 1:return r=o.v,o.a(2,(this._config.assistant_id=r.id,this._config.assistant_id));case 2:o.p=2,s=o.v,console[_](s),console[_]("Failed to create a new assistant");case 3:return o.a(2)}},n,this,[[0,2]])}));function e(){return t.apply(this,arguments)}return e})()},{key:"searchPreviousMessagesForThreadId",value:function(e){var n=e.find(function(r){var s=wt(r,1),o=s[0];return o._sessionId});n&&(this.sessionId=n[0]._sessionId),this._searchedForThreadId=!0}},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:if(!(this._waitingForStreamResponse||this._isSSEStream&&this.sessionId)){u.n=2;break}return u.n=1,this.handleStream(r);case 1:return u.a(2,u.v);case 2:if(!r[_]){u.n=3;break}throw r[_].message.startsWith(bt.FILES_WITH_TEXT_ERROR)?Error("Please send text with your file(s)"):r[_].message;case 3:return this.asyncCallInProgress=!0,u.n=4,this.assignThreadAndRun(r);case 4:return o="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId,"/runs/").concat(this.run_id).concat(this.urlSegments.threadsPosfix),l={method:Se,headers:(s=this.connectSettings)==null?void 0:s.headers},u.a(2,(xe.executePollRequest(this,o,l,this.messages),f({},y,"")))}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"assignThreadAndRun",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!this.sessionId){o.n=2;break}return this.url="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId,"/runs").concat(this.urlSegments.threadsPosfix),o.n=1,ht(this,L(this.rawBody),Te);case 1:s=o.v,this.run_id=s.id,o.n=3;break;case 2:this.sessionId=r.thread_id,this.run_id=r.id,this.updateSessionId(this.sessionId);case 3:return o.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"getThreadMessages",value:(function(){var t=w(v().m(function n(r){var s,o,l,u,c=arguments,d;return v().w(function(h){for(;;)switch(h.n){case 0:return s=c.length>1&&c[1]!==void 0?c[1]:!1,this.url="".concat(this.urlSegments.threadsPrefix,"/").concat(r,"/messages?").concat(this.urlSegments.listMessagesPostfix),h.n=1,ht(this,{},Se);case 1:if(u=h.v,d=!s&&this.deepChat.responseInterceptor,!d){h.n=3;break}return h.n=2,(l=(o=this.deepChat).responseInterceptor)==null?void 0:l.call(o,u);case 2:u=h.v;case 3:return h.a(2,bt.processAPIMessages(this,u,s,this.urlSegments))}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"extractPollResultData",value:(function(){var t=w(v().m(function n(r){var s=this,o,l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(l=r.status,u=r.required_action,!(l==="queued"||l==="in_progress")){m.n=1;break}return m.a(2,{timeoutMS:i.POLLING_TIMEOUT_MS});case 1:if(!(l===na&&this.messages)){m.n=3;break}return m.n=2,this.getThreadMessages(r.thread_id);case 2:return c=m.v,d=c.shift(),h=d.text,p=d.files,m.a(2,(setTimeout(function(){c.forEach(function(b){return s.deepChat.addMessage(b)})}),f({text:h,_sessionId:this.sessionId},T,p)));case 3:if(g=(o=u==null?void 0:u.submit_tool_outputs)==null?void 0:o.tool_calls,!(l==="requires_action"&&g)){m.n=5;break}return m.n=4,this.handleTools(g);case 4:return m.a(2,m.v);case 5:throw Error("Thread run status: ".concat(l));case 6:return m.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"handleTools",value:(function(){var t=w(v().m(function n(r){var s,o,l,u,c,d;return v().w(function(h){for(;;)switch(h.n){case 0:if(this._functionHandlerI){h.n=1;break}throw Error(vt);case 1:return s=r.map(function(p){return{name:p.function.name,arguments:p.function.arguments}}),h.n=2,this._functionHandlerI(s);case 2:if(o=h.v,!(!Array.isArray(o)||r.length!==o.length)){h.n=3;break}throw Error(bt.FUNCTION_TOOL_RESP_ERROR);case 3:return h.n=4,Promise.all(o);case 4:if(l=h.v,!l.find(function(p){return typeof p!="string"})){h.n=5;break}throw Error(bt.FUNCTION_TOOL_RESP_ERROR);case 5:if(u=l.map(function(p,g){return{tool_call_id:r[g].id,output:p}}),c="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId),d="/runs/".concat(this.run_id,"/submit_tool_outputs").concat(this.urlSegments.threadsPosfix),this.url="".concat(c).concat(d),!this._isSSEStream){h.n=7;break}return h.n=6,this.createStreamRun({tool_outputs:u});case 6:h.n=8;break;case 7:return h.n=8,ht(this,{tool_outputs:u},Te);case 8:return h.a(2,{timeoutMS:i.POLLING_TIMEOUT_MS})}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"handleStream",value:(function(){var t=w(v().m(function n(r){var s,o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(l=(o=(s=r.required_action)==null?void 0:s.submit_tool_outputs)==null?void 0:o.tool_calls,!(r.status==="requires_action"&&l)){c.n=2;break}return this.run_id=r.id,c.n=1,this.handleTools(l);case 1:return c.a(2,c.v);case 2:if(!this._waitingForStreamResponse){c.n=3;break}return c.a(2,this.parseStreamResult(r));case 3:return this._isSSEStream&&this.sessionId&&(this.asyncCallInProgress=!0,this.url="".concat(this.urlSegments.threadsPrefix,"/").concat(this.sessionId,"/runs").concat(this.urlSegments.threadsPosfix),u=L(this.rawBody),this.createStreamRun(u)),c.a(2,f({},y,""))}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"parseStreamResult",value:(function(){var t=w(v().m(function n(r){var s,o,l,u,c,d,h,p,g,m;return v().w(function(b){for(;;)switch(b.n){case 0:if(!(r.content&&r.content.length>0&&this.messages)){b.n=1;break}if(d=r.content.find(function(k){return k[y]}),!((s=d==null?void 0:d[y])!=null&&s.annotations&&d[y].annotations.length>0)){b.n=1;break}return h=r.content.find(function(k){return!!k[y]})||r.content[0],p=bt.getFilesAndText.bind(this,this,f(f({},P,rt),"content",r.content),this.urlSegments,h),b.a(2,((o=this._messageStream)==null||o.endStreamAfterFileDownloaded(this.messages,p),f({},y,"")));case 1:if(!((l=r.delta)!=null&&l.content)){b.n=4;break}if(!(r.delta.content.length>1)){b.n=3;break}if(g=r.delta.content.find(function(k){return k[y]}),!((u=g==null?void 0:g[y])!=null&&u.annotations&&g[y].annotations.length===0)){b.n=3;break}return b.n=2,bt.processStreamMessages(this,r.delta.content,this.urlSegments);case 2:return m=b.v,b.a(2,f(f({},y,m[0][y]),T,m[1][T]));case 3:return b.a(2,f({},y,(c=r.delta.content[0][y])==null?void 0:c.value));case 4:return b.a(2,(!this.sessionId&&r.thread_id&&(this.sessionId=r.thread_id),f({},y,"")))}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"createStreamRun",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:return r.stream=!0,this._waitingForStreamResponse=!0,s.n=1,Ce.request(this,r,this.messages,!0,!0);case 1:this._messageStream=s.v;case 2:return s.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"processImageMessage",value:function(e,n){var r=n==null?void 0:n.filter(function(s){return Ze.isImageFileExtension(s.name)}).map(function(s){return f(f({},z,"image_file"),"image_file",{file_id:s.id})});if(r&&r.length>0)return e[y]&&e[y].length>0&&r.push(f(f({},z,y),y,e[y])),f({content:r},P,Z)}},{key:"processAttachmentsMessage",value:function(e,n,r){return f({attachments:n.map(function(s){return{tools:[f({},z,r)],file_id:s.id}}),content:[f(f({},z,y),y,e[y])]},P,Z)}}])})(W);ci.POLLING_TIMEOUT_MS=500;var di=ci,Ku=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u,c,d=L(t.directConnection),h=d.openAI,p=(s=d.openAI)==null?void 0:s.assistant,g=i.buildUrlSegments(p);if(r=F(this,i,[t,p,g,$t(),Vt,h]),(e=(o=r.connectSettings).headers)!==null&&e!==void 0||(o.headers={}),(n=(l=r.connectSettings.headers)["OpenAI-Beta"])!==null&&n!==void 0||(l["OpenAI-Beta"]="assistants=v2"),r.shouldFetchHistory&&r.sessionId&&(r.fetchHistory=r.fetchHistoryFunc.bind(zt(r))),R(p)===Q){var m=(c=(u=t.directConnection)==null?void 0:u.openAI)==null?void 0:c.assistant,b=m.function_handler,k=m.files_tool_type;b&&(r._functionHandlerI=b),k&&(r.filesToolType=k)}return r}return D(i,a),C(i,null,[{key:"buildUrlSegments",value:function(e){var n=R(e)=="object"&&e.custom_base_url||Ge;return{threadsPrefix:"".concat(n,"/threads"),threadsPosfix:"",newAssistantUrl:"".concat(n,"/assistants"),createMessagePostfix:"",listMessagesPostfix:"order=desc",storeFiles:"".concat(n,"/").concat(T),getFilesPrefix:"".concat(n,"/").concat(T,"/"),getFilesPostfix:"/content"}}}])})(di),nr="Please define the Azure URL Details. [More Information](".concat(ue,"directConnection/Azure)"),hi=function(i){return f({"api-key":i},te,fe)},pi=function(i){return Ee("".concat(i.endpoint,"/openai/models?api-version=").concat(i.version),Se,ui)},fi=function(i){var t=i.endpoint,e=i.version,n=i.deploymentId;return t&&e&&n},qr=(function(a){function i(t){var e,n;E(this,i);var r,s,o,l,u,c,d,h,p=L(t.directConnection),g=p.azure,m=(r=p.azure)==null?void 0:r.openAI,b=(m==null?void 0:m.urlDetails)||{},k="".concat((s=m==null?void 0:m.urlDetails)==null?void 0:s.endpoint,"/openai/"),A="?api-version=".concat((o=m==null?void 0:m.urlDetails)==null?void 0:o.version),I={threadsPrefix:"".concat(k).concat(i.THREAD_RESOURCE),threadsPosfix:A,newAssistantUrl:"".concat(k).concat(i.NEW_ASSISTANT_RESOURCE).concat(A),createMessagePostfix:A,listMessagesPostfix:"order=desc&api-version=".concat((l=m==null?void 0:m.urlDetails)==null?void 0:l.version),storeFiles:"".concat(k).concat(T).concat(A),getFilesPrefix:"".concat(k).concat(T,"/"),getFilesPostfix:"/content".concat(A)};if(n=F(this,i,[t,m==null?void 0:m.assistant,I,pi(b),hi,g]),n.permittedErrorPrefixes=[nr],n.insertKeyPlaceholderText=n.genereteAPIKeyName("Azure OpenAI"),n.keyHelpUrl="https://learn.microsoft.com/en-us/answers/questions/1193991/how-to-get-the-value-of-openai-api-key",n.isTextInputDisabled=!1,R(m==null?void 0:m.assistant)===Q){var x=(d=(c=(u=t.directConnection)==null?void 0:u.azure)==null?void 0:c.openAI)==null?void 0:d.assistant,U=x.function_handler,j=x.files_tool_type;U&&(n._functionHandlerI=U),j&&(n.filesToolType=j)}return fi(b)?(e=(h=n.connectSettings).headers)!==null&&e!==void 0||(h.headers={}):(n.isTextInputDisabled=!0,n.canSendMessage=function(){return!1},setTimeout(function(){t.addMessage(f({},_,nr))})),n}return D(i,a),C(i)})(di);qr.THREAD_RESOURCE="threads",qr.NEW_ASSISTANT_RESOURCE="assistants";var Vu=qr,$u="sts-session-started",Xu="sts-session-stopped",Pe=(function(){function a(){E(this,a)}return C(a,null,[{key:"addAttributes",value:function(t){t[P]="button",t.setAttribute("tabindex","0")}},{key:"addAriaBusy",value:function(t){t.setAttribute("aria-busy","true")}},{key:"removeAriaBusy",value:function(t){t.removeAttribute("aria-busy")}},{key:"addAriaDisabled",value:function(t){t.setAttribute("aria-".concat(ae),"true")}},{key:"removeAriaDisabled",value:function(t){t.removeAttribute("aria-".concat(ae))}},{key:"removeAriaAttributes",value:function(t){a.removeAriaBusy(t),a.removeAriaDisabled(t)}}])})(),mi=`<?xml version="1.0" encoding="iso-8859-1"?>
<svg height="1.4em" width="1.4em" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 viewBox="0 0 490.9 490.9" xml:space="preserve">
	<g>
		<g>
			<path d="M245.5,322.9c53,0,96.2-43.2,96.2-96.2V96.2c0-53-43.2-96.2-96.2-96.2s-96.2,43.2-96.2,96.2v130.5
				C149.3,279.8,192.5,322.9,245.5,322.9z M173.8,96.2c0-39.5,32.2-71.7,71.7-71.7s71.7,32.2,71.7,71.7v130.5
				c0,39.5-32.2,71.7-71.7,71.7s-71.7-32.2-71.7-71.7V96.2z"/>
			<path d="M94.4,214.5c-6.8,0-12.3,5.5-12.3,12.3c0,85.9,66.7,156.6,151.1,162.8v76.7h-63.9c-6.8,0-12.3,5.5-12.3,12.3
				s5.5,12.3,12.3,12.3h152.3c6.8,0,12.3-5.5,12.3-12.3s-5.5-12.3-12.3-12.3h-63.9v-76.7c84.4-6.3,151.1-76.9,151.1-162.8
				c0-6.8-5.5-12.3-12.3-12.3s-12.3,5.5-12.3,12.3c0,76.6-62.3,138.9-138.9,138.9s-138.9-62.3-138.9-138.9
				C106.6,220,101.2,214.5,94.4,214.5z"/>
		</g>
	</g>
</svg>
`,$n=(function(){function a(){E(this,a)}return C(a,null,[{key:"createTextElement",value:function(t){var e=B();return e[S].add(a.INPUT_BUTTON_INNER_TEXT_CLASS),e.innerText=t,e}},{key:"tryAddSVGElement",value:function(t,e,n,r){n?t.push(lt.createSVGElement(n)):n!==""&&r&&t.push(e)}},{key:"createCustomElements",value:function(t,e,n){var r,s,o=n==null?void 0:n[t],l=(r=o==null?void 0:o[y])==null?void 0:r.content,u=(s=o==null?void 0:o.svg)==null?void 0:s.content,c=[];return a.tryAddSVGElement(c,e,u,l),l&&c.push(a.createTextElement(l)),c.length>0?c:void 0}},{key:"reassignClassBasedOnChildren",value:function(t,e){t[S].remove(a.INPUT_BUTTON_SVG_CLASS,a.INPUT_BUTTON_SVG_TEXT_CLASS),e.find(function(n){return n[S].contains(a.INPUT_BUTTON_INNER_TEXT_CLASS)})?e.length>1&&t[S].add(a.INPUT_BUTTON_SVG_TEXT_CLASS):t[S].add(a.INPUT_BUTTON_SVG_CLASS)}}])})();$n.INPUT_BUTTON_SVG_TEXT_CLASS="input-button-svg-text",$n.INPUT_BUTTON_INNER_TEXT_CLASS="text-button",$n.INPUT_BUTTON_SVG_CLASS="input-button-svg";var mt=$n,Cn=(function(){function a(){E(this,a)}return C(a,null,[{key:"parseSVGTextElements",value:function(t){return f({svg:t.find(function(e){return e.tagName.toLowerCase()==="svg"})},y,t.find(function(e){return e.tagName.toLowerCase()==="div"}))}}])})(),Ue=(function(){function a(){E(this,a)}return C(a,null,[{key:"unsetAllCSS",value:function(t,e){var n,r;e.container&&Me.unsetAllCSSMouseStates(t,e.container);var s=Cn.parseSVGTextElements(Array.from(t.children)),o=s.svg,l=s.text;(n=e.svg)!=null&&n.styles&&o&&Me.unsetAllCSSMouseStates(o,e.svg.styles),(r=e[y])!=null&&r.styles&&l&&Me.unsetAllCSSMouseStates(l,e[y].styles)}},{key:"unsetActionCSS",value:function(t,e){var n,r;e.container&&Me.unsetActivityCSSMouseStates(t,e.container);var s=Cn.parseSVGTextElements(Array.from(t.children)),o=s.svg,l=s.text;(n=e.svg)!=null&&n.styles&&o&&Me.unsetActivityCSSMouseStates(o,e.svg.styles),(r=e[y])!=null&&r.styles&&l&&Me.unsetActivityCSSMouseStates(l,e[y].styles)}},{key:"setElementsCSS",value:function(t,e,n){var r,s,o,l,u;Object.assign(t[M],(r=e.container)==null?void 0:r[n]);var c=Cn.parseSVGTextElements(Array.from(t.children)),d=c.svg,h=c.text;d&&Object.assign(d[M],(o=(s=e.svg)==null?void 0:s.styles)==null?void 0:o[n]),h&&Object.assign(h[M],(u=(l=e[y])==null?void 0:l.styles)==null?void 0:u[n])}},{key:"setElementCssUpToState",value:function(t,e,n){a.setElementsCSS(t,e,O),n!==O&&(a.setElementsCSS(t,e,Ne),n!==Ne&&a.setElementsCSS(t,e,de))}}])})(),Bt=(function(){function a(i,t,e,n,r,s){E(this,a),this._mouseState={state:"default"},this.isCustom=!1,Pe.addAttributes(i),this.elementRef=i,this.svg=lt.createSVGElement(t),this.customStyles=r,this.position=_e.processPosition(e),this._tooltipSettings=n,this.dropupText=s}return C(a,[{key:"buttonMouseLeave",value:function(t){var e;this._mouseState.state=O,((e=this._activeTooltip)==null?void 0:e.element[M].visibility)==="visible"&&this._tooltipSettings&&ut.hide(this._activeTooltip,this._tooltipSettings),t&&(Ue.unsetAllCSS(this.elementRef,t),Ue.setElementsCSS(this.elementRef,t,O))}},{key:"buttonMouseEnter",value:function(t){var e;this._mouseState.state=Ne,this._tooltipSettings&&(this._activeTooltip=ut.display(this.elementRef,this._tooltipSettings,(e=this._activeTooltip)==null?void 0:e.element)),t&&Ue.setElementsCSS(this.elementRef,t,Ne)}},{key:"buttonMouseUp",value:function(t){t&&Ue.unsetActionCSS(this.elementRef,t),this.buttonMouseEnter(t)}},{key:"buttonMouseDown",value:function(t){this._mouseState.state=de,t&&Ue.setElementsCSS(this.elementRef,t,de)}},{key:"setEvents",value:function(t){this.elementRef.onmousedown=this.buttonMouseDown.bind(this,t),this.elementRef.onmouseup=this.buttonMouseUp.bind(this,t),this.elementRef.onmouseenter=this.buttonMouseEnter.bind(this,t),this.elementRef.onmouseleave=this.buttonMouseLeave.bind(this,t)}},{key:"unsetCustomStateStyles",value:function(t){if(this.customStyles)for(var e=0;e<t.length;e+=1){var n=t[e],r=n&&this.customStyles[n];r&&Ue.unsetActionCSS(this.elementRef,r)}}},{key:"reapplyStateStyle",value:function(t,e){if(this.customStyles){e&&this.unsetCustomStateStyles(e);var n=this.customStyles[t];n&&Ue.setElementCssUpToState(this.elementRef,n,this._mouseState.state),this.setEvents(n)}}},{key:"changeElementsByState",value:function(t){var e;(e=this.elementRef).replaceChildren.apply(e,_t(t)),mt.reassignClassBasedOnChildren(this.elementRef,t)}},{key:"buildDefaultIconElement",value:function(t){var e=this.svg.cloneNode(!0);return e.id=t,[e]}},{key:"createInnerElements",value:function(t,e,n){var r=mt.createCustomElements(e,this.svg,n);if(r&&r.length>0){if(this.position===Je){var s=this.svg.cloneNode(!0);s.id=r[0]===this.svg?t:"dropup-menu-item-icon-element-custom",r[0]=s}return r}return this.buildDefaultIconElement(t)}}])})(),vi=(function(a){function i(t){var e;E(this,i);var n,r,s=((r=(n=t==null?void 0:t[O])==null?void 0:n.svg)==null?void 0:r.content)||i.EMPTY_SVG;return e=F(this,i,[B(),s,void 0,void 0,t]),e.isActive=!1,e._innerElements=e.createInnerElementsForStates(e.customStyles),e.changeToDefault(),e}return D(i,a),C(i,[{key:"createInnerElementsForStates",value:function(e){return f(f(f({},O,this.createInnerButtonElements(O,e)),re,this.createInnerButtonElements(re,e)),"unavailable",this.createInnerButtonElements("unavailable",e))}},{key:"createInnerButtonElements",value:function(e,n){return mt.createCustomElements(e,this.svg,n)||[this.svg]}},{key:"changeState",value:function(e){this.changeElementsByState(e),this.elementRef[S].replace(mt.INPUT_BUTTON_SVG_CLASS,"deep-chat-openai-realtime-button")}},{key:"changeToActive",value:function(){this.changeState(this._innerElements[re]),this.reapplyStateStyle(re,["unavailable",O]),this.isActive=!0}},{key:"changeToDefault",value:function(){var e,n,r,s;this.changeState(this._innerElements[O]),(e=this.customStyles)!=null&&e[re]&&Ue.unsetAllCSS(this.elementRef,(n=this.customStyles)==null?void 0:n[re]),(r=this.customStyles)!=null&&r.unavailable&&Ue.unsetAllCSS(this.elementRef,(s=this.customStyles)==null?void 0:s.unavailable),this.reapplyStateStyle(O,[re,"unavailable"]),this.isActive=!1}},{key:"changeToUnavailable",value:function(){var e,n,r,s;this.changeState(this._innerElements.unavailable),(e=this.customStyles)!=null&&e[re]&&Ue.unsetAllCSS(this.elementRef,(n=this.customStyles)==null?void 0:n[re]),(r=this.customStyles)!=null&&r[O]&&Ue.unsetAllCSS(this.elementRef,(s=this.customStyles)==null?void 0:s[O]),this.reapplyStateStyle("unavailable",[O,re]),this.isActive=!1}}])})(Bt);vi.EMPTY_SVG='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"></svg>';var $a=vi,st=(function(){function a(){E(this,a)}return C(a,null,[{key:"setPropertyValueIfDoesNotExist",value:function(t,e,n){var r,s,o=e[0];e.length===1?(r=t[o])!==null&&r!==void 0||(t[o]=n):((s=t[o])!==null&&s!==void 0||(t[o]={}),e.shift(),a.setPropertyValueIfDoesNotExist(t[o],e,n))}},{key:"setPropertyValue",value:function(t,e,n){var r,s=e[0];e.length===1?t[s]=n:((r=t[s])!==null&&r!==void 0||(t[s]={}),e.shift(),a.setPropertyValue(t[s],e,n))}},{key:"getObjectValue",value:function(t,e){var n=e[0],r=t[n];return r===void 0||e.length===1?r:a.getObjectValue(r,e.slice(1))}},{key:"overwritePropertyObjectFromAnother",value:function(t,e,n){var r=a.getObjectValue(e,n);if(r){var s=ie(ie({},r),a.getObjectValue(t,n)||{});a.setPropertyValue(t,n,s)}}},{key:"isJson",value:function(t){try{return JSON.stringify(t),!0}catch(e){return!1}}},{key:"assignPropertyFromOneToAnother",value:function(t,e,n){var r;(r=e[t])!==null&&r!==void 0||(e[t]={}),Object.assign(e[t],n==null?void 0:n[t])}}])})(),gi=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M5.92 24.096q0 1.088 0.928 1.728 0.512 0.288 1.088 0.288 0.448 0 0.896-0.224l16.16-8.064q0.48-0.256 0.8-0.736t0.288-1.088-0.288-1.056-0.8-0.736l-16.16-8.064q-0.448-0.224-0.896-0.224-0.544 0-1.088 0.288-0.928 0.608-0.928 1.728v16.16z"></path>
</svg>`,zr=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
<path d="M5.92 24.096q0 0.832 0.576 1.408t1.44 0.608h16.128q0.832 0 1.44-0.608t0.576-1.408v-16.16q0-0.832-0.576-1.44t-1.44-0.576h-16.128q-0.832 0-1.44 0.576t-0.576 1.44v16.16z"></path>
</svg>`,Sn=(function(a){function i(t){var e,n;E(this,i);var r,s,o,l,u,c=L(t.directConnection),d=i.getKey(t);n=F(this,i,[t,$t(),Vt,{key:d}]),n.insertKeyPlaceholderText=n.genereteAPIKeyName("OpenAI"),n.keyHelpUrl=Kt,n._microphoneButton=null,n._toggleButton=null,n._errorElement=null,n._loadingElement=null,n._pc=null,n._mediaStream=null,n._isMuted=!1;var h=(r=c.openAI)==null?void 0:r.realtime;if(R(h)===Q){n._avatarConfig=h.avatar,n._ephemeralKey=h.ephemeralKey,n._errorConfig=h[_],n._loadingConfig=h.loading,Object.assign(n.rawBody,h.config);var p=(o=(s=t.directConnection)==null?void 0:s.openAI)==null?void 0:o.realtime,g=p.config||{},m=g.function_handler;m&&(n._functionHandlerI=m),n._events=h.events,p.methods=n.generateMethods(),n.setInputAudioTranscribe(t,(l=p.config)==null?void 0:l.input_audio_transcription)}return(e=(u=n.rawBody).model)!==null&&e!==void 0||(u.model="gpt-4o-realtime-preview-2025-06-03"),n._avatarConfig=i.buildAvatarConfig(h),n._buttonsConfig=i.buildButtonsConfig(h),n._avatarEl=i.createAvatar(n._avatarConfig),n._containerEl=n.createContainer(),n._deepChat=t,n}return D(i,a),C(i,[{key:"setInputAudioTranscribe",value:function(e,n){if(n){var r="whisper-1";R(n)=="object"?this.rawBody.input_audio_transcription={model:n.model||r,language:n.language,prompt:n.prompt}:this.rawBody.input_audio_transcription={model:r}}else e.onMessage&&(console.warn("To get user audio transcription, set `input_audio_transcription` in the `realtime` config."),console.warn("See: ".concat(ue,"directConnection/OpenAI/OpenAIRealtime#OpenAIRealtimeConfig")))}},{key:"setUpView",value:function(e,n){e[M].display="none",n.appendChild(this._containerEl),this.setup()}},{key:"setup",value:(function(){var t=w(v().m(function n(){var r,s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:if(s=(r=this._deepChat.directConnection)==null?void 0:r.openAI,s){u.n=1;break}return u.a(2);case 1:if(o=s==null?void 0:s.realtime,!(R(o)!="object"||!o.autoStart&&!o.autoFetchEphemeralKey)){u.n=2;break}return u.a(2);case 2:l=this.key||s.key,(o.fetchEphemeralKey||l)&&o.autoStart&&(this.changeToUnavailable(),this.displayLoading()),this.fetchEphemeralKey(o.autoStart);case 3:return u.a(2)}},n,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"fetchEphemeralKey",value:(function(){var t=w(v().m(function n(r){var s,o,l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.p=m.n){case 0:if(o=(s=this._deepChat.directConnection)==null?void 0:s.openAI,l=R(o==null?void 0:o.realtime)=="object"?o==null?void 0:o.realtime.fetchEphemeralKey:void 0,u=o==null?void 0:o.realtime,c=this.key||o.key,R(u)!="object"){m.n=8;break}if(this._ephemeralKey){m.n=7;break}if(m.p=1,!l){m.n=3;break}return d=l(),d.then&&(this._retrievingEphemeralKey=d),m.n=2,d;case 2:this._ephemeralKey=m.v,m.n=5;break;case 3:if(h=c,!h){m.n=5;break}return this._retrievingEphemeralKey=this.getEphemeralKey(c),m.n=4,this._retrievingEphemeralKey;case 4:this._ephemeralKey=m.v;case 5:m.n=7;break;case 6:m.p=6,p=m.v,this.displayFailedToRetrieveEphemeralKey(p);case 7:this._ephemeralKey&&(r?this.init(this._ephemeralKey):this.changeToAvailable()),m.n=12;break;case 8:if(!c){m.n=12;break}return m.p=9,this._retrievingEphemeralKey=this.getEphemeralKey(c),m.n=10,this._retrievingEphemeralKey;case 10:this._ephemeralKey=m.v,r&&this.init(this._ephemeralKey),m.n=12;break;case 11:m.p=11,g=m.v,this.displayFailedToRetrieveEphemeralKey(g);case 12:return m.a(2)}},n,this,[[9,11],[1,6]])}));function e(n){return t.apply(this,arguments)}return e})()},{key:"getEphemeralKey",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:return s.n=1,fetch("".concat(Ge,"realtime/sessions"),{method:Te,body:JSON.stringify(this.rawBody),headers:f(f({},te,fe),ke,"".concat(Be).concat(r))});case 1:return s.n=2,s.v.json();case 2:return s.a(2,s.v.client_secret.value)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"generateMethods",value:function(){var e=this;return{updateConfig:function(r){var s;(s=e._dc)==null||s.send(JSON.stringify(f(f({},z,"session.update"),"session",r)))},sendMessage:function(r,s){var o=s||"system",l=[f(f({},z,o==="system"||o===Z?jr:y),"text",r)],u=f(f(f({},P,o),z,"message"),"content",l);e.sendMessage(u)}}}},{key:"createContainer",value:function(){var e=B();return e.id="deep-chat-openai-realtime-container",e.appendChild(this.createAvatarContainer()),e.appendChild(this.createButtonsContainer()),e.appendChild(this.createError()),e}},{key:"createAvatarContainer",value:function(){var e,n,r=B();return r.id="deep-chat-openai-realtime-avatar-container",Object.assign(r[M],(n=(e=this._avatarConfig)==null?void 0:e.styles)==null?void 0:n.container),r.appendChild(this._avatarEl),r}},{key:"createButtonsContainer",value:function(){var e,n=B();n.id="deep-chat-openai-realtime-buttons-container",Object.assign(n[M],(e=this._buttonsConfig)==null?void 0:e.container),this._microphoneButton=this.createMicophoneButton();var r=i.createButtonContainer(this._microphoneButton.elementRef);this._toggleButton=this.createToggleButton();var s=i.createButtonContainer(this._toggleButton.elementRef);return n.appendChild(r),n.appendChild(s),n.appendChild(this.createLoading()),n}},{key:"createMicophoneButton",value:function(){var e=this,n,r=new $a((n=this._buttonsConfig)==null?void 0:n[et]);return r.elementRef[S].add(i.BUTTON_DEFAULT,"deep-chat-openai-realtime-microphone"),oe.assignButtonEvents(r.elementRef,function(){r.isActive?(e.toggleMicorphone(!0),r.elementRef[S].replace(i.MICROPHONE_ACTIVE,i.BUTTON_DEFAULT),r.changeToDefault(),e._isMuted=!1):(e.toggleMicorphone(!1),r.elementRef[S].replace(i.BUTTON_DEFAULT,i.MICROPHONE_ACTIVE),Pe.removeAriaAttributes(r.elementRef),r.changeToActive(),e._isMuted=!0)}),r}},{key:"toggleMicorphone",value:function(e){var n;(n=this._mediaStream)==null||n.getAudioTracks().forEach(function(r){return r.enabled=e})}},{key:"createToggleButton",value:function(){var e=this,n,r=new $a((n=this._buttonsConfig)==null?void 0:n.toggle);return r.elementRef[S].add(i.BUTTON_DEFAULT,"deep-chat-openai-realtime-toggle"),oe.assignButtonEvents(r.elementRef,w(v().m(function s(){var o,l,u,c;return v().w(function(d){for(;;)switch(d.p=d.n){case 0:if(!r.isActive){d.n=1;break}r.changeToDefault(),e.stop(),d.n=9;break;case 1:if(d.p=1,!e._ephemeralKey){d.n=3;break}return e.displayLoading(),d.n=2,e.init(e._ephemeralKey);case 2:d.n=7;break;case 3:if(!e._retrievingEphemeralKey){d.n=6;break}return e.displayLoading(),d.n=4,e._retrievingEphemeralKey;case 4:if(l=d.v,u=(o=e._toggleButton)!=null&&o.isActive,!u){d.n=5;break}return d.n=5,e.init(l);case 5:d.n=7;break;case 6:return e.displayLoading(),d.n=7,e.fetchEphemeralKey(!0);case 7:d.n=9;break;case 8:d.p=8,c=d.v,console[_]("Failed to start conversation:",c),e.displayError(),e.hideLoading();case 9:return d.a(2)}},s,null,[[1,8]])}))),r}},{key:"init",value:(function(){var t=w(v().m(function n(r){var s=this,o,l,u,c,d,h,p,g,m,b,k,A,I;return v().w(function(x){for(;;)switch(x.p=x.n){case 0:return o=new RTCPeerConnection,this._pc=o,l=B(ee),l.autoplay=!0,u=new AudioContext,c=u.createAnalyser(),c.fftSize=256,d=new Uint8Array(c.frequencyBinCount),this._pc.ontrack=(function(){var U=w(v().m(function j(J){var G,he;return v().w(function(se){for(;;)switch(se.n){case 0:if(!J.streams[0]){se.n=2;break}if(l.srcObject=J.streams[0],G=u.createMediaStreamSource(J.streams[0]),he=u.state==="suspended",!he){se.n=1;break}return se.n=1,u.resume();case 1:G.connect(c),s.monitorFrequencies(c,d),se.n=3;break;case 2:console[_]("No streams found in the ontrack event."),s.displayError();case 3:return se.a(2)}},j)}));return function(j){return U.apply(this,arguments)}})(),x.n=1,navigator.mediaDevices.getUserMedia({audio:!0}).then(function(U){var j;o===s._pc&&(s._mediaStream=U,(j=s._pc)==null||j.addTrack(s._mediaStream.getTracks()[0]),s._isMuted&&s.toggleMicorphone(!1))}).catch(function(U){console[_]("Error accessing microphone:",U),s.displayError()});case 1:return this._dc=this._pc.createDataChannel("oai-events"),this._dc.addEventListener("message",(function(){var U=w(v().m(function j(J){var G,he,se,ne,q,Ie,ce,Fe;return v().w(function(be){for(;;)switch(be.p=be.n){case 0:if(ne=JSON.parse(J.data),ne.type!=="session.created"){be.n=1;break}s.removeUnavailable(),s._toggleButton&&(Pe.removeAriaAttributes(s._toggleButton.elementRef),s._toggleButton.changeToActive()),(he=(G=s._events)==null?void 0:G.started)==null||he.call(G),s._deepChat.dispatchEvent(new CustomEvent($u)),s.hideLoading(),be.n=7;break;case 1:if(ne.type!=="response.done"){be.n=6;break}if(q=(se=JSON.parse(J.data).response.output)==null?void 0:se[0],(q==null?void 0:q.type)!==zn){be.n=5;break}return Ie=q.name,ce=q.call_id,be.p=2,be.n=3,s.handleTool(Ie,q.arguments,ce);case 3:be.n=5;break;case 4:be.p=4,Fe=be.v,s.stopOnError(Fe);case 5:be.n=7;break;case 6:ne.type===_?s.stopOnError(ne[_].message):ne.type===Qe?s.stopOnError(ne.message):ne.type==="response.audio_transcript.delta"||(ne.type==="response.audio_transcript.done"?ne.transcript&&Mt.onMessage(s._deepChat,f(f({},P,me),y,ne.transcript),!1):ne.type==="conversation.item.input_audio_transcription.completed"&&ne.transcript&&Mt.onMessage(s._deepChat,f(f({},P,Z),y,ne.transcript),!1));case 7:return be.a(2)}},j,null,[[2,4]])}));return function(j){return U.apply(this,arguments)}})()),x.p=2,x.n=3,this._pc.createOffer();case 3:if(h=x.v,m=o!==this._pc,m){x.n=5;break}return x.n=4,this._pc.setLocalDescription(h);case 4:m=o!==this._pc;case 5:if(!m){x.n=6;break}return x.a(2);case 6:return x.n=7,fetch("".concat(Ge,"realtime"),{method:Te,body:h.sdp,headers:f(f({},ke,"".concat(Be).concat(r)),te,"application/sdp")});case 7:if(p=x.v,o===this._pc){x.n=8;break}return x.a(2);case 8:return b=f,k=f({},z,"answer"),x.n=9,p[y]();case 9:if(g=b(k,"sdp",x.v),A=o!==this._pc,A){x.n=11;break}return x.n=10,this._pc.setRemoteDescription(g);case 10:A=o!==this._pc;case 11:if(!A){x.n=12;break}return x.a(2);case 12:x.n=14;break;case 13:x.p=13,I=x.v,console[_](I),this.displayError();case 14:return x.a(2)}},n,this,[[2,13]])}));function e(n){return t.apply(this,arguments)}return e})()},{key:"monitorFrequencies",value:function(e,n){var r=this,s=(function(o){function l(){return o.apply(this,arguments)}return l.toString=function(){return o.toString()},l})(function(){var o;e.getByteFrequencyData(n);var l=n.reduce(function(p,g){return p+g},0),u=n.length*255,c=l/u*100,d=1,h=d+c/100*(((o=r._avatarConfig)==null?void 0:o.maxScale)-d);r._avatarEl[M].transform="scale(".concat(h,")"),requestAnimationFrame(s)});s()}},{key:"stopOnError",value:function(e){this.stop(),console[_](e),this.displayError()}},{key:"stop",value:function(){var e,n,r;(e=this._mediaStream)==null||e.getTracks().forEach(function(s){return s.stop()}),this._mediaStream=null,this._pc&&(this._pc.close(),this._pc=null,(r=(n=this._events)==null?void 0:n.stopped)==null||r.call(n),this._deepChat.dispatchEvent(new CustomEvent(Xu)),this._dc=void 0)}},{key:"changeToUnavailable",value:function(){this._microphoneButton&&i.changeButtonToUnavailable(this._microphoneButton),this._toggleButton&&i.changeButtonToUnavailable(this._toggleButton)}},{key:"changeToAvailable",value:function(){this._microphoneButton&&i.changeButtonToAvailable(this._microphoneButton),this._toggleButton&&i.changeButtonToAvailable(this._toggleButton)}},{key:"removeUnavailable",value:function(){this._microphoneButton&&i.removeButtonUnavailable(this._microphoneButton),this._toggleButton&&i.removeButtonUnavailable(this._toggleButton)}},{key:"createError",value:function(){var e,n=B();return n.id="deep-chat-openai-realtime-error",Object.assign(n[M],(e=this._errorConfig)==null?void 0:e[M]),this._errorElement=n,n}},{key:"displayFailedToRetrieveEphemeralKey",value:function(e){console[_]("Failed to retrieve ephemeral key"),console[_](e),this.displayError()}},{key:"displayError",value:function(){var e;this._errorElement&&(this._errorElement[M].display="block",this._errorElement.textContent=((e=this._errorConfig)==null?void 0:e[y])||"Error",this.changeToUnavailable()),this.hideLoading()}},{key:"createLoading",value:function(){var e,n,r=B();return r.id="deep-chat-openai-realtime-loading",this._loadingElement=r,(e=this._loadingConfig)!=null&&e[V]&&(this._loadingElement.innerHTML=this._loadingConfig[V]),Object.assign(r[M],(n=this._loadingConfig)==null?void 0:n[M]),r[M].display="none",r}},{key:"displayLoading",value:function(){var e,n,r;this._toggleButton&&(this._toggleButton.changeToActive(),this._toggleButton.elementRef[S].add(i.BUTTON_LOADING),Pe.removeAriaDisabled(this._toggleButton.elementRef),Pe.addAriaBusy(this._toggleButton.elementRef)),(typeof((e=this._loadingConfig)==null?void 0:e.display)!="boolean"||this._loadingConfig.display)&&this._loadingElement&&(this._loadingElement[M].display="block",(n=this._loadingConfig)!=null&&n[V]||(this._loadingElement.textContent=((r=this._loadingConfig)==null?void 0:r[y])||"Loading"))}},{key:"hideLoading",value:function(){this._toggleButton&&(this._toggleButton.elementRef[S].remove(i.BUTTON_LOADING),Pe.removeAriaBusy(this._toggleButton.elementRef)),this._loadingElement&&(this._loadingElement[M].display="none")}},{key:"handleTool",value:(function(){var t=w(v().m(function n(r,s,o){var l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(this._functionHandlerI){c.n=1;break}throw Error(vt);case 1:return c.n=2,this._functionHandlerI({name:r,arguments:s});case 2:if(l=c.v,!(R(l)!="object"||!st.isJson(l))){c.n=3;break}throw Error('The `function_handler` response must be a JSON object, e.g. {response: "My response"}');case 3:u=f(f(f({},z,li),"call_id",o),"output",JSON.stringify(l)),this.sendMessage(u);case 4:return c.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"sendMessage",value:function(e){if(this._dc){var n=JSON.stringify(f(f({},z,"conversation.item.create"),"item",e));this._dc.send(n);var r=f({},z,"response.create");this._dc.send(JSON.stringify(r))}}},{key:"isCustomView",value:function(){return!0}}],[{key:"getKey",value:function(e){var n=e.directConnection.openAI;if(n!=null&&n.key)return n.key;var r=n==null?void 0:n.realtime;if(R(r)=="object"&&(r.ephemeralKey||r.fetchEphemeralKey))return"placeholder"}},{key:"buildAvatarConfig",value:function(e){var n=R(e)=="object"&&e.avatar?L(e.avatar):{};return n.maxScale=n.maxScale&&n.maxScale>=1?n.maxScale:2.5,n}},{key:"buildButtonsConfig",value:function(e){var n,r,s,o,l,u,c,d,h,p,g,m,b,k,A,I,x,U,j,J,G,he,se,ne,q,Ie,ce=R(e)=="object"&&e.buttons?L(e.buttons):{};return(k=(b=(m=ce[et])==null?void 0:m[O])==null?void 0:b[y])!=null&&k.content||((n=ce[et])!==null&&n!==void 0||(ce[et]={}),(r=(A=ce[et])[O])!==null&&r!==void 0||(A[O]={}),(s=(I=ce[et][O]).svg)!==null&&s!==void 0||(I.svg={}),(o=(x=ce[et][O].svg).content)!==null&&o!==void 0||(x.content=mi)),(J=(j=(U=ce.toggle)==null?void 0:U[O])==null?void 0:j[y])!=null&&J.content||((l=ce.toggle)!==null&&l!==void 0||(ce.toggle={}),(u=(G=ce.toggle)[O])!==null&&u!==void 0||(G[O]={}),(c=(he=ce.toggle[O]).svg)!==null&&c!==void 0||(he.svg={}),(d=(se=ce.toggle[O].svg).content)!==null&&d!==void 0||(se.content=gi),(h=(ne=ce.toggle)[re])!==null&&h!==void 0||(ne[re]={}),(p=(q=ce.toggle[re]).svg)!==null&&p!==void 0||(q.svg={}),(g=(Ie=ce.toggle[re].svg).content)!==null&&g!==void 0||(Ie.content=zr)),ce}},{key:"createAvatar",value:function(e){var n,r=B("img");return r.id="deep-chat-openai-realtime-avatar",Object.assign(r[M],(n=e==null?void 0:e.styles)==null?void 0:n[le]),r[N]=(e==null?void 0:e[N])||Lr,r}},{key:"createButtonContainer",value:function(e){var n=B();return n[S].add("deep-chat-openai-realtime-button-container"),n.appendChild(e),n}},{key:"changeButtonToUnavailable",value:function(e){e.elementRef[S].add(i.UNAVAILABLE),Pe.removeAriaBusy(e.elementRef),Pe.addAriaDisabled(e.elementRef),e.changeToUnavailable()}},{key:"changeButtonToAvailable",value:function(e){i.removeButtonUnavailable(e),e.changeToDefault()}},{key:"removeButtonUnavailable",value:function(e){Pe.removeAriaDisabled(e.elementRef),e.elementRef[S].remove(i.UNAVAILABLE)}}])})(W);Sn.BUTTON_DEFAULT="deep-chat-openai-realtime-button-default",Sn.BUTTON_LOADING="deep-chat-openai-realtime-button-loading",Sn.MICROPHONE_ACTIVE="deep-chat-openai-realtime-microphone-active",Sn.UNAVAILABLE="deep-chat-openai-realtime-button-unavailable";var Ju=Sn,Wr=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u=L(t.directConnection),c=u==null?void 0:u.openAI;r=F(this,i,[t,$t(),Vt,c]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("OpenAI"),r.keyHelpUrl=Kt,r.url="".concat(Ge,"audio/speech"),r.permittedErrorPrefixes=[gt];var d=(s=u==null?void 0:u.openAI)==null?void 0:s.textToSpeech;return R(d)===Q&&Object.assign(r.rawBody,d),(e=(o=r.rawBody).model)!==null&&e!==void 0||(o.model=i.DEFAULT_MODEL),(n=(l=r.rawBody).voice)!==null&&n!==void 0||(l.voice=i.DEFAULT_VOIDE),r.textInputPlaceholderText="Insert text to generate audio",r.rawBody.response_format="mp3",r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r,s,o=L(e),l=(s=(r=n[n.length-1])==null?void 0:r[y])==null?void 0:s.trim();return l&&l!==""&&(o.input=l),o}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.url=this.connectSettings.url||this.url,this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this));case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:if(!(r instanceof Blob)){s.n=1;break}return s.a(2,new Promise(function(o){var l=new FileReader;l.readAsDataURL(r),l.onload=function(u){o(f({},T,[f(f({},N,u.target.result),z,ee)]))}}));case 1:if(!r[_]){s.n=2;break}throw r[_].message;case 2:return s.a(2,f({},_,_))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W);Wr.DEFAULT_MODEL="tts-1",Wr.DEFAULT_VOIDE="alloy";var Zu=Wr,Xn=(function(a){function i(t){var e,n;E(this,i);var r,s,o=L(t.directConnection),l=o==null?void 0:o.openAI;n=F(this,i,[t,$t(),Vt,l,{audio:{}}]),n.insertKeyPlaceholderText=n.genereteAPIKeyName("OpenAI"),n.keyHelpUrl=Kt,n.url="",n.permittedErrorPrefixes=[gt],n.textInputPlaceholderText=ra,n._service_url=i.AUDIO_TRANSCRIPTIONS_URL;var u=(r=o==null?void 0:o.openAI)==null?void 0:r[ee];return R(u)=="object"&&(n.processConfig(u),i.cleanConfig(u),Object.assign(n.rawBody,u)),(e=(s=n.rawBody).model)!==null&&e!==void 0||(s.model=i.DEFAULT_MODEL),n.rawBody.response_format="json",n.canSendMessage=i.canSendFileMessage,n}return D(i,a),C(i,[{key:"processConfig",value:function(e){e!=null&&e.type&&e.type==="translation"&&(this._service_url=i.AUDIO_TRANSLATIONS_URL,delete e.language)}},{key:"preprocessBody",value:function(e,n){var r,s,o=L(e),l=(s=(r=n[n.length-1])==null?void 0:r[y])==null?void 0:s.trim();return l&&l!==""&&(o.prompt=l),o}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l,u,c;return v().w(function(d){for(;;)switch(d.n){case 0:if((l=this.connectSettings)!=null&&l.headers){d.n=1;break}throw new Error(qe);case 1:if(o!=null&&o[0]){d.n=2;break}throw new Error(sr);case 2:this.url=this.connectSettings.url||this._service_url,u=this.preprocessBody(this.rawBody,s),c=i.createFormDataBody(u,o[0]),Y.tempRemoveContentHeader(this.connectSettings,xe.request.bind(this,this,c,r),!1);case 3:return d.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:if(!r[_]){s.n=1;break}throw r[_].message;case 1:return s.a(2,f({},y,r[y]))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"canSendFileMessage",value:function(e,n){return!!(n!=null&&n[0])}},{key:"cleanConfig",value:function(e){delete e.type}},{key:"createFormDataBody",value:function(e,n){var r=new FormData;return r.append(ve,n),Object.keys(e).forEach(function(s){r.append(s,String(e[s]))}),r}}])})(W);Xn.AUDIO_TRANSCRIPTIONS_URL="".concat(Ge,"audio/transcriptions"),Xn.AUDIO_TRANSLATIONS_URL="".concat(Ge,"audio/translations"),Xn.DEFAULT_MODEL="whisper-1";var Yu=Xn,Xt="Ocp-Apim-Subscription-Key",yi="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",Qu=function(i,t){return f(f(f({},Xt,t),te,"application/ssml+xml"),"X-Microsoft-OutputFormat",i)},ec=function(i){return f(f({},Xt,i),"Accept",fe)},tc=function(i,t,e,n){i[_]?n(we):e(t)},nc=function(i){return{url:"https://".concat(i,".api.cognitive.microsoft.com/sts/v1.0/issuetoken"),method:Te,createHeaders:function(e){return f({},Xt,"".concat(e))},handleVerificationResult:tc}},rc=function(i){return f(f({},Xt,i),te,fe)},ac=function(i,t,e,n){var r;((r=i[_])==null?void 0:r.code)==="401"?n(we):e(t)},sc=function(i){return{url:"".concat(i,"/language/analyze-text/jobs?api-version=2022-10-01-preview"),method:Te,createHeaders:function(e){return f({},Xt,"".concat(e))},handleVerificationResult:ac}},ic=function(i,t,e,n){i.json().then(function(r){!Array.isArray(r)&&r[_].code===401e3?n(we):e(t)})},oc=function(i){return{url:"https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es",method:Te,createHeaders:function(e){return bi(i,e)},handleVerificationResult:ic}},bi=function(i,t){var e=f(f({},Xt,t),te,fe);return i&&(e["Ocp-Apim-Subscription-Region"]=i),e},lc=(function(a){function i(t,e,n,r,s){var o;return E(this,i),o=F(this,i,[t,sc(n),e,r,s]),o.insertKeyPlaceholderText="Azure Language Subscription Key",o.keyHelpUrl=yi,o.permittedErrorPrefixes=["Access"],o}return D(i,a),C(i)})(W),_i=(function(a){function i(t){var e,n;E(this,i);var r,s,o,l,u=(s=(r=t.directConnection)==null?void 0:r.azure)==null?void 0:s.summarization,c=(o=t.directConnection)==null?void 0:o.azure;return n=F(this,i,[t,rc,u.endpoint,c]),n.permittedErrorPrefixes=[i.ENDPOINT_ERROR_MESSAGE],n.url="",n.textInputPlaceholderText="Insert text to summarize",n.isTextInputDisabled=!1,u.endpoint?((e=(l=n.rawBody).language)!==null&&e!==void 0||(l.language="en"),Object.assign(n.rawBody,u),n.url="".concat(u.endpoint,"/language/analyze-text/jobs?api-version=2022-10-01-preview")):(n.isTextInputDisabled=!0,n.canSendMessage=function(){return!1},setTimeout(function(){t.addMessage(f({},_,i.ENDPOINT_ERROR_MESSAGE))})),n}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=n[n.length-1][y];if(r)return{analysisInput:{documents:[f({id:"1",language:e.language},y,r)]},tasks:[{kind:"ExtractiveSummarization"}]}}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this)),this.messages=r;case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:if(!r[_]){u.n=1;break}throw r[_].message;case 1:return this.messages&&this.completionsHandlers&&(this.asyncCallInProgress=!0,o=r.headers.get("operation-location"),l={method:Se,headers:(s=this.connectSettings)==null?void 0:s.headers},xe.executePollRequest(this,o,l,this.messages)),u.a(2,f({},y,""))}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"extractPollResultData",value:(function(){var t=w(v().m(function n(r){var s,o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(!r[_]){c.n=1;break}throw r[_];case 1:if(!(r.status==="running"||r.status==="notStarted")){c.n=2;break}return c.a(2,{timeoutMS:2e3});case 2:if(!(r.errors.length>0)){c.n=3;break}throw r.errors[0];case 3:if(!(r.tasks.items[0].results.errors.length>0)){c.n=4;break}throw r.tasks.items[0].results.errors[0];case 4:s="",o=qt(r.tasks.items[0].results.documents[0].sentences);try{for(o.s();!(l=o.n()).done;)u=l.value,s+=u[y]}catch(d){o.e(d)}finally{o.f()}return c.a(2,f({},y,s||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(lc);_i.ENDPOINT_ERROR_MESSAGE="Please define the azure endpoint. [More Information](".concat(ue,"directConnection/Azure#Summarization)");var uc=_i,cc=(function(){var a=w(v().m(function i(t,e){var n,r,s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:return n=f(f({},_o,t),ko,fe),l="https://api.assemblyai.com/v2/transcript/",u.n=1,fetch("https://api.assemblyai.com/v2/transcript",{method:Te,body:JSON.stringify({audio_url:e}),headers:n});case 1:return u.n=2,u.v.json();case 2:r=l.concat.call(l,u.v.id);case 3:if(s){u.n=9;break}return u.n=4,fetch(r,{headers:n});case 4:return u.n=5,u.v.json();case 5:if(o=u.v,o.status!==na){u.n=6;break}s=o,u.n=8;break;case 6:if(o.status!==_){u.n=7;break}throw new Error("Transcription failed: ".concat(o[_]));case 7:return u.n=8,new Promise(function(c){return setTimeout(c,3e3)});case 8:u.n=3;break;case 9:return u.a(2,s)}},i)}));return function(t,e){return a.apply(this,arguments)}})(),dc=function(i){return f(f({},ke,i),te,"application/octet-stream")},hc=function(i,t,e,n){var r=i;r[_]?r[_].code==="invalid_api_key"?n(we):n(He):e(t)},pc=function(){return Ee("https://api.assemblyai.com/v2/upload",Te,hc)},fc=(function(a){function i(t){var e;E(this,i);var n,r=(n=t.directConnection)==null?void 0:n.assemblyAI;return e=F(this,i,[t,pc(),dc,r,{audio:{}}]),e.insertKeyPlaceholderText=e.genereteAPIKeyName("AssemblyAI"),e.keyHelpUrl="https://www.assemblyai.com/app/account",e.url="https://api.assemblyai.com/v2/upload",e.isTextInputDisabled=!0,e.textInputPlaceholderText=ra,e.permittedErrorPrefixes=[js,gt],e.canSendMessage=i.canFileSendMessage,e}return D(i,a),C(i,[{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l;return v().w(function(u){for(;;)switch(u.n){case 0:if((l=this.connectSettings)!=null&&l.headers){u.n=1;break}throw new Error(qe);case 1:if(o!=null&&o[0]){u.n=2;break}throw new Error(sr);case 2:xe.request(this,o[0],r,!1);case 3:return u.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(!r[_]){c.n=1;break}throw r[_];case 1:return l=(o=(s=this.connectSettings)==null?void 0:s.headers)==null?void 0:o[ke],c.n=2,cc(l,r.upload_url);case 2:return u=c.v,c.a(2,f({},y,u[y]))}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"canFileSendMessage",value:function(e,n){return!!(n!=null&&n[0])}}])})(W),rr=(function(a){function i(t,e,n,r,s){var o,l,u;E(this,i);var c,d,h=L(t.directConnection),p=e||$t(),g=n||Vt,m=r||h.openAI;u=F(this,i,[t,p,g,m]),u.insertKeyPlaceholderText=u.genereteAPIKeyName("OpenAI"),u.keyHelpUrl="https://platform.openai.com/account/api-keys",u.permittedErrorPrefixes=[xn,"Invalid value"];var b=s||((c=h.openAI)==null?void 0:c.chat);return R(b)===Q&&u.processConfig(b,t),(o=u.maxMessages)!==null&&o!==void 0||(u.maxMessages=-1),(l=(d=u.rawBody).model)!==null&&l!==void 0||(d.model="gpt-4o"),u}return D(i,a),C(i,[{key:"processConfig",value:function(e,n){var r,s,o;this.completeConfig(e,(o=(s=(r=n.directConnection)==null?void 0:r.openAI)==null?void 0:s.chat)==null?void 0:o.function_handler)}}],[{key:"getBaseFileContent",value:function(e){return e.map(function(n){var r,s,o;if(n.type===ee){var l=(r=n[N])==null?void 0:r.split(",")[1],u=((o=(s=n.name)==null?void 0:s.split(".").pop())==null?void 0:o.toLowerCase())||"wav";return f(f({},z,kt),kt,{data:l,format:u})}return n})}},{key:"getBaseContent",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(n&&e[T]&&e[T].length>0){var r=this.getBaseFileContent(e[T]);return e[y]&&e[y].trim().length>0&&r.unshift(f(f({},z,y),y,e[y])),r}return e[y]}}])})(W),mc=(function(a){function i(){var t;return E(this,i),t=F(this,i,arguments),t.url="".concat(Ge,"chat/completions"),t}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:i.getContent(o)},P,W.getRoleViaUser(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(!r[_]){m.n=1;break}throw r[_].message;case 1:if(!((l=(o=r.choices)==null?void 0:o[0])!=null&&l.delta)){m.n=2;break}return m.a(2,this.extractStreamResult(r.choices[0],s));case 2:if(!((c=(u=r.choices)==null?void 0:u[0])!=null&&c.message)){m.n=5;break}if(!r.choices[0].message.tool_calls){m.n=3;break}return m.a(2,this.handleToolsGeneric(r.choices[0].message,this.functionHandler,this.messages,s));case 3:if(!((d=r.choices[0].message)!=null&&d[ee])){m.n=4;break}return p=this.deepChat.textToSpeech,g=R(p)=="object"&&typeof((h=p==null?void 0:p[ee])==null?void 0:h.displayText)=="boolean",m.a(2,f(f({},T,[f(f({},N,"data:audio/wav;base64,".concat(r.choices[0].message[ee].data)),z,ee)]),y,g?r.choices[0].message[ee].transcript:void 0));case 4:return m.a(2,f({},y,r.choices[0].message.content));case 5:return m.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractStreamResult",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.extractStreamResultWToolsGeneric(this,r,this.functionHandler,s))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}],[{key:"getFileContent",value:function(e){return rr.getBaseFileContent(e).map(function(n){return n.type===kt?n:f(f({},z,ze),ze,{url:n[N]})})}},{key:"getContent",value:function(e){if(e[T]&&e[T].length>0){var n=i.getFileContent(e[T]);return e[y]&&e[y].trim().length>0&&n.unshift(f(f({},z,y),y,e[y])),n}return e[y]}}])})(rr),ki=(function(a){function i(t,e,n,r,s){var o;return E(this,i),o=F(this,i,[t,nc(n),e,r,s]),o.insertKeyPlaceholderText="Azure Speech Subscription Key",o.keyHelpUrl=yi,o}return D(i,a),C(i)})(W);ki.REGION_ERROR_PREFIX="Please define a region config property. [More Information](".concat(ue,"directConnection/Azure#");var pr=ki,Si=(function(a){function i(t){var e,n,r,s;E(this,i);var o,l,u,c,d,h,p=(l=(o=t.directConnection)==null?void 0:o.azure)==null?void 0:l.textToSpeech,g=(u=t.directConnection)==null?void 0:u.azure;return s=F(this,i,[t,Qu.bind({},(p==null?void 0:p.outputFormat)||"audio-16khz-128kbitrate-mono-mp3"),p.region,g]),s.permittedErrorPrefixes=[i.REGION_ERROR_MESSAGE],s.isTextInputDisabled=!1,s.url="",p.region?(Object.assign(s.rawBody,p),(e=(c=s.rawBody).lang)!==null&&e!==void 0||(c.lang="en-US"),(n=(d=s.rawBody).name)!==null&&n!==void 0||(d.name="en-US-JennyNeural"),(r=(h=s.rawBody).gender)!==null&&r!==void 0||(h.gender="Female"),s.url="https://".concat(p.region,".tts.speech.microsoft.com/cognitiveservices/v1")):(s.isTextInputDisabled=!0,s.canSendMessage=function(){return!1},setTimeout(function(){t.addMessage(f({},_,i.REGION_ERROR_MESSAGE))})),s}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=n[n.length-1][y];if(r)return"<speak version='1.0' xml:lang='".concat(e.lang,`'>
      <voice xml:lang='`).concat(e.lang,"' xml:gender='").concat(e.gender,"' name='").concat(e.name,`'>
        `).concat(r,`
      </voice>
    </speak>`)}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),void 0,!1);case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)if(s.n===0)return s.a(2,new Promise(function(o){var l=new FileReader;l.readAsDataURL(r),l.onload=function(u){o(f({},T,[f(f({},N,u.target.result),z,ee)]))}}))},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(pr);Si.REGION_ERROR_MESSAGE="".concat(pr.REGION_ERROR_PREFIX,"TextToSpeech)");var vc=Si,wi=(function(a){function i(t){var e;E(this,i);var n,r,s,o=(r=(n=t.directConnection)==null?void 0:n.azure)==null?void 0:r.speechToText,l=(s=t.directConnection)==null?void 0:s.azure,u={audio:f({},T,{acceptedFormats:".wav,.ogg"})};if(e=F(this,i,[t,ec,o.region,l,u]),e.permittedErrorPrefixes=[i.REGION_ERROR_MESSAGE],e.url="",e.isTextInputDisabled=!0,e.textInputPlaceholderText=ra,!o.region)e.isTextInputDisabled=!0,e.canSendMessage=function(){return!1},setTimeout(function(){t.addMessage(f({},_,i.REGION_ERROR_MESSAGE))});else{e.canSendMessage=i.canFileSendMessage;var c=o.lang||"en-US";e.url="https://".concat(o.region,".stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=").concat(c,"&format=detailed"),e.recordAudio=void 0}return e}return D(i,a),C(i,[{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if((l=this.connectSettings)!=null&&l.headers){c.n=1;break}throw new Error(qe);case 1:if(o!=null&&o[0]){c.n=2;break}throw new Error(sr);case 2:(u=this.connectSettings)!=null&&u.headers&&(this.connectSettings.headers[te]=o[0].name.toLocaleLowerCase().endsWith(".wav")?"audio/wav; codecs=audio/pcm; samplerate=16000":"audio/ogg; codecs=opus"),xe.request(this,o[0],r,!1);case 3:return c.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:if(!r[_]){s.n=1;break}throw r[_];case 1:return s.a(2,f({},y,r.DisplayText||""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"canFileSendMessage",value:function(e,n){return!!(n!=null&&n[0])}}])})(pr);wi.REGION_ERROR_MESSAGE="".concat(pr.REGION_ERROR_PREFIX,"SpeechToText)");var gc=wi,yc=(function(a){function i(t){var e;E(this,i);var n,r,s,o=(r=(n=t.directConnection)==null?void 0:n.azure)==null?void 0:r.translation,l=(s=t.directConnection)==null?void 0:s.azure;return e=F(this,i,[t,oc(o.region),bi.bind({},o==null?void 0:o.region),l]),e.insertKeyPlaceholderText="Azure Translate Subscription Key",e.keyHelpUrl="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",e.url="",e.url="https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=".concat(o.language||"es"),e}return D(i,a),C(i,[{key:"preprocessBody",value:function(e){var n=e[e.length-1][y];if(n)return[{Text:n}]}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this));case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!Array.isArray(r)){o.n=1;break}return o.a(2,f({},y,((s=r[0].translations)==null?void 0:s[0][y])||""));case 1:throw r[_];case 2:return o.a(2)}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),bc=(function(a){function i(t){var e,n;E(this,i);var r,s,o=L(t.directConnection),l=o.bigModel;n=F(this,i,[t,pa(),ha,l]),n.insertKeyPlaceholderText=n.genereteAPIKeyName("BigModel"),n.keyHelpUrl="https://open.bigmodel.cn/usercenter/apikeys",n.url="https://open.bigmodel.cn/api/paas/v4/images/generations",n.permittedErrorPrefixes=[ke,Oe];var u=(r=o.bigModel)==null?void 0:r[pe];return R(u)===Q&&(n.cleanConfig(u),Object.assign(n.rawBody,u)),(e=(s=n.rawBody).model)!==null&&e!==void 0||(s.model="cogview-4-250304"),n}return D(i,a),C(i,[{key:"cleanConfig",value:function(e){delete e.key}},{key:"preprocessBody",value:function(e,n){var r=L(e),s=n[n.length-1];return r.prompt=(s==null?void 0:s[y])||"",r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this)))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)if(o.n===0)return s=r.data.map(function(l){return l!=null&&l.url?f(f({},N,l.url),z,le):f(f({},N,""),z,le)}),o.a(2,f({},T,s))},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Ei=function(i){return f(f({},te,fe),ke,"".concat(Be).concat(i))},_c=function(i,t,e,n){var r=i;r[_]?r[_].message===ir?n(we):n(He):e(t)},Ci=function(){return Ee("https://api.groq.com/openai/v1/models",Se,_c)},kc=(function(a){function i(t){var e,n,r,s;E(this,i);var o,l,u,c,d=L(t.directConnection),h=d.groq;s=F(this,i,[t,Ci(),Ei,h]),s.insertKeyPlaceholderText=s.genereteAPIKeyName("Groq"),s.keyHelpUrl="https://console.groq.com/keys",s.url="https://api.groq.com/openai/v1/audio/speech",s.permittedErrorPrefixes=[gt,"property"];var p=(o=d.groq)==null?void 0:o.textToSpeech;return R(p)===Q&&s.completeConfig(p),(e=(l=s.rawBody).model)!==null&&e!==void 0||(l.model="playai-tts"),(n=(u=s.rawBody).voice)!==null&&n!==void 0||(u.voice="Fritz-PlayAI"),(r=(c=s.rawBody).response_format)!==null&&r!==void 0||(c.response_format="mp3"),s}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=n[n.length-1];return r.input=(s==null?void 0:s[y])||"",r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this)))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o,l;return v().w(function(u){for(;;)if(u.n===0)return s=this.rawBody.response_format||"mp3",o=new Blob([r],f({},z,"audio/".concat(s))),l=URL.createObjectURL(o),u.a(2,f({},T,[f(f({},N,l),z,ee)]))},n,this)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Sc=(function(a){function i(t){var e,n;E(this,i);var r,s,o=L(t.directConnection),l=o.together;n=F(this,i,[t,ma(),fa,l]),n.insertKeyPlaceholderText=n.genereteAPIKeyName("Together AI"),n.keyHelpUrl="https://api.together.xyz/settings/api-keys",n.url="https://api.together.xyz/v1/images/generations",n.permittedErrorPrefixes=[Qe,Oe];var u=(r=o.together)==null?void 0:r[pe];return R(u)===Q&&n.completeConfig(u),(e=(s=n.rawBody).model)!==null&&e!==void 0||(s.model="black-forest-labs/FLUX.1-schnell-Free"),n}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=n[n.length-1];return r.prompt=(s==null?void 0:s[y])||"",r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this)))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)if(o.n===0)return s=r.data.map(function(l){return l!=null&&l.url?f(f({},N,l.url),z,le):l!=null&&l.b64_json?f(f({},N,"data:image/png;base64,".concat(l.b64_json)),z,le):f(f({},N,""),z,le)}),o.a(2,f({},T,s))},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Ti=(function(a){function i(t,e,n,r,s){var o;E(this,i);var l,u;o=F(this,i,[t,e,n,r,s]),o.keyHelpUrl=Kt,o.url="".concat(Ge,"responses"),o._functionStreamInProgress=!1,o._useConversation=!1,o._conversationLoadLimit=50;var c=s||((u=(l=t.directConnection)==null?void 0:l.openAI)==null?void 0:u.chat);return R(c)===Q&&c!==!0&&c&&(c.conversation&&(o._useConversation=!0,typeof c.conversation=="string"&&(o._conversationId=c.conversation)),typeof c.conversationLoadLimit=="number"&&(o._conversationLoadLimit=c.conversationLoadLimit),o.cleanConfig(c)),o._conversationId&&(o.fetchHistory=o.fetchHistoryFunc.bind(o)),o}return D(i,a),C(i,[{key:"processConfig",value:function(e,n){Gi(i,"processConfig",this)([e,n])}},{key:"cleanConfig",value:function(e){delete e.conversation,delete e.conversationLoadLimit}},{key:"fetchHistoryFunc",value:(function(){var t=w(v().m(function n(){var r=this,s,o;return v().w(function(l){for(;;)switch(l.p=l.n){case 0:return setTimeout(function(){return r.deepChat.disableSubmitButton()},2),l.p=1,s=this.url,this.url="".concat(Ge,"conversations/").concat(this._conversationId,"/items?limit=").concat(this._conversationLoadLimit),l.n=2,ht(this,{},Se);case 2:return o=l.v,l.a(2,(this.connectSettings.method=Te,this.url=s,this.deepChat.disableSubmitButton(!1),this.processConversationHistory(o)));case 3:return l.p=3,l.v,l.a(2,(this.deepChat.disableSubmitButton(!1),[f({},_,Bs)]))}},n,this,[[1,3]])}));function e(){return t.apply(this,arguments)}return e})()},{key:"processConversationHistory",value:function(e){if(!e.data||!Array.isArray(e.data))return[];var n=[],r=qt(i.filterCompleted(e.data.reverse())),s;try{for(r.s();!(s=r.n()).done;){var o=s.value;if(o.type==="message"&&o.content&&Array.isArray(o.content)){var l=qt(o.content),u;try{for(l.s();!(u=l.n()).done;){var c=u.value;(c.type===jr||c.type===Va)&&c[y]?n.push(f(f({},P,o[P]),y,c[y])):c.type===Ka&&n.push(f(f({},P,o[P]),T,i.generateImageFile(c[ze]||"")))}}catch(d){l.e(d)}finally{l.f()}}else o.type===Cr&&n.push(f(f({},P,me),T,i.generateImageFile(o.result)))}}catch(d){r.e(d)}finally{r.f()}return n}},{key:"preprocessBody",value:function(e,n){var r=L(e);n=this.processMessages(n),n=this._useConversation?[n[n.length-1]]:n;var s=n.map(function(o){return f({content:i.getContent(o)},P,W.getRoleViaUser(o[P]))});return r.input=s,this._conversationId&&(r.conversation=this._conversationId),r}},{key:"createConversation",value:(function(){var t=w(v().m(function n(){var r,s,o;return v().w(function(l){for(;;)switch(l.p=l.n){case 0:return l.p=0,r=this.url,this.url="".concat(Ge,"conversations"),l.n=1,ht(this,{},Te);case 1:return s=l.v,l.a(2,(this.url=r,s.id));case 2:throw l.p=2,o=l.v,console[_]("Failed to create conversation:",o),o;case 3:return l.a(2)}},n,this,[[0,2]])}));function e(){return t.apply(this,arguments)}return e})()},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o,l;return v().w(function(u){for(;;)switch(u.n){case 0:if((o=this.messages)!==null&&o!==void 0||(this.messages=r),l=this._useConversation&&!this._conversationId,!l){u.n=2;break}return u.n=1,this.createConversation();case 1:this._conversationId=u.v;case 2:this._conversationId&&this.updateSessionId(this._conversationId),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 3:return u.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:return l.n=1,this.extractResult(r,s);case 1:return o=l.v,l.a(2,(this._conversationId&&(o._sessionId=this._conversationId),o))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResult",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(!r[_]){m.n=1;break}throw r[_].message;case 1:if(!r.status){m.n=5;break}if(d=i.filterCompleted(r.output),!(d.length>0)){m.n=4;break}return h=(u=(l=(o=d.find(function(b){var k,A;return typeof((A=(k=b.content)==null?void 0:k[0])==null?void 0:A[y])=="string"}))==null?void 0:o.content)==null?void 0:l[0])==null?void 0:u[y],m.n=2,this.handleResponsesFunctionCalls(d,s,h);case 2:if(p=m.v,!p){m.n=3;break}return m.a(2,p);case 3:return g=this.handleFileGenerationResponse(d,h),m.a(2,g||f({},y,h));case 4:return m.a(2,f({},y,""));case 5:return m.a(2,((c=r.item)==null?void 0:c.type)===zn&&r.type?this.handleStreamedResponsesFunctionCall(r,s):r.type==="".concat(Jt,".").concat(Cr,".partial_image")&&r.partial_image_b64?f({},T,[f(f({},N,"".concat(i.IMAGE_BASE64_PREFIX).concat(r.partial_image_b64)),z,le)]):r.delta&&!this._functionStreamInProgress&&r.type==="".concat(Jt,".").concat(Va,".delta")?f({},y,r.delta):f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"handleStreamedResponsesFunctionCall",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:if(r.type!=="".concat(Jt,".output_item.done")){l.n=2;break}if(this._functionStreamInProgress=!1,((o=r.item)==null?void 0:o.type)!==zn){l.n=1;break}return l.a(2,this.handleResponsesFunctionCalls([r.item],s));case 1:l.n=3;break;case 2:r.type==="".concat(Jt,".output_item.added")&&(this._functionStreamInProgress=!0);case 3:return l.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"handleFileGenerationResponse",value:function(e,n){var r=e.find(function(s){return s.type===Cr});return r?f(f({},T,i.generateImageFile(r.result)),y,n):null}},{key:"handleResponsesFunctionCalls",value:(function(){var t=w(v().m(function n(r,s,o){var l,u,c,d,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:if(l=r.filter(function(m){return m.type===zn}),l.length!==0){g.n=1;break}return g.a(2,null);case 1:if(!(!s||!this.functionHandler)){g.n=2;break}throw Error(vt);case 2:return u=l.map(function(m){return{name:m.name,arguments:m.arguments}}),g.n=3,this.callToolFunction(this.functionHandler,u);case 3:if(c=g.v,d=c.responses,h=c.processedResponse,!h){g.n=4;break}return g.a(2,h);case 4:if(p=L(s),!(p.input&&(l.forEach(function(m){return p.input.push(m)}),!d.find(function(m){var b=m.response;return typeof b!="string"})&&u.length===d.length))){g.n=5;break}return g.a(2,(d.forEach(function(m,b){var k=l[b];p.input.push({type:li,call_id:k.call_id,output:m[Jt]})}),this.makeAnotherRequest(p,this.messages,o)));case 5:throw Error(Tt);case 6:return g.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()}],[{key:"getFileContent",value:function(e){return rr.getBaseFileContent(e).map(function(n){return n.type===kt?n:f(f({detail:"auto"},z,Ka),ze,n[N])})}},{key:"getContent",value:function(e){if(e[P]===Z&&e[T]&&e[T].length>0){var n=i.getFileContent(e[T]);return e[y]&&e[y].trim().length>0&&n.unshift(f(f({},z,jr),y,e[y])),n}return e[y]}},{key:"filterCompleted",value:function(e){return(e==null?void 0:e.filter(function(n){return n.status===na}))||[]}},{key:"generateImageFile",value:function(e){return[f(f({},N,"".concat(i.IMAGE_BASE64_PREFIX).concat(e)),z,le)]}}])})(rr);Ti.IMAGE_BASE64_PREFIX="data:image/png;base64,";var Ai=Ti,wc=(function(a){function i(t){var e;E(this,i);var n,r,s,o,l,u,c,d=L(t.directConnection),h=d.azure,p=((r=(n=d.azure)==null?void 0:n.openAI)==null?void 0:r.urlDetails)||{},g=(o=(s=d.azure)==null?void 0:s.openAI)==null?void 0:o.chat;if(e=F(this,i,[t,pi(p),hi,h,g]),e.permittedErrorPrefixes=[nr],e.isTextInputDisabled=!1,R(g)===Q){var m=(c=(u=(l=t.directConnection)==null?void 0:l.azure)==null?void 0:u.openAI)==null?void 0:c.chat,b=m.function_handler;b&&(e.functionHandler=b)}return fi(p)?e.url=i.buildURL(p):(e.isTextInputDisabled=!0,e.canSendMessage=function(){return!1},setTimeout(function(){t.addMessage(f({},_,nr))})),e}return D(i,a),C(i,null,[{key:"buildURL",value:function(e){var n=e.endpoint,r=e.deploymentId,s=e.version;return"".concat(n,"/openai/deployments/").concat(r,"/chat/completions?api-version=").concat(s)}}])})(Ai),Ec=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u,c,d=L(t.directConnection),h=d.bigModel;r=F(this,i,[t,pa(),ha,h]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("BigModel"),r.keyHelpUrl="https://open.bigmodel.cn/usercenter/apikeys",r.url="https://open.bigmodel.cn/api/paas/v4/chat/completions",r.permittedErrorPrefixes=[ke,Oe];var p=(s=d.bigModel)==null?void 0:s.chat;return R(p)===Q&&r.completeConfig(p,(u=(l=(o=t.directConnection)==null?void 0:o.bigModel)==null?void 0:l.chat)==null?void 0:u.function_handler),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(c=r.rawBody).model)!==null&&n!==void 0||(c.model="glm-4.5"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:i.getTextWFilesContent(o,i.getFileContent)},P,W.getRoleViaAI(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:if(!r[_]){l.n=1;break}throw r[_].message;case 1:if(!(r.choices.length>0)){l.n=3;break}if(r.choices[0].delta===void 0){l.n=2;break}return l.a(2,this.extractStreamResult(r.choices[0],s));case 2:if(r.choices[0].message===void 0){l.n=3;break}return o=r.choices[0].message,l.a(2,o.tool_calls?this.handleToolsGeneric({tool_calls:o.tool_calls},this.functionHandler,this.messages,s):f({},y,o.content));case 3:return l.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractStreamResult",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(d=r.delta,h=r.finish_reason,p=(o=this.messages)==null?void 0:o.messageToElements[this.messages.messageToElements.length-2],(p==null?void 0:p[0][P])===me&&((l=p==null?void 0:p[0][y])==null?void 0:l.replace(/\n/g,"").trim().length)===0&&((u=this.messages)==null||u.removeMessage(p[1][y]),(c=this.messages)==null||c.messageToElements.splice(this.messages.messageToElements.length-2,1)),h!=="tool_calls"){m.n=2;break}if(!d.tool_calls){m.n=1;break}return g={tool_calls:d.tool_calls},m.a(2,this.handleToolsGeneric(g,this.functionHandler,this.messages,s));case 1:return m.a(2,f({},y,(d==null?void 0:d.content)||""));case 2:return m.a(2,f({},y,(d==null?void 0:d.content)||""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}],[{key:"getFileContent",value:function(e){return e.map(function(n){return n.type===le?f(f({},z,ze),ze,{url:n[N]||""}):f(f({},z,ve),"file_url",{url:n[N]||""})})}}])})(W),Cc=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l=L(t.directConnection),u=l.together;r=F(this,i,[t,ma(),fa,u]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Together AI"),r.keyHelpUrl="https://api.together.xyz/settings/api-keys",r.url="https://api.together.xyz/v1/chat/completions",r.permittedErrorPrefixes=[Qe,Oe];var c=(s=l.together)==null?void 0:s.chat;return R(c)===Q&&r.completeConfig(c),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(o=r.rawBody).model)!==null&&n!==void 0||(o.model="meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:o[y]||""},P,o[P]===me?rt:o[P])});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){return v().w(function(s){for(;;)switch(s.n){case 0:if(!r[_]){s.n=1;break}throw r[_].message;case 1:if(!(r.choices.length>0)){s.n=3;break}if(r.choices[0].message===void 0){s.n=2;break}return s.a(2,f({},y,r.choices[0].message.content));case 2:if(r.choices[0].delta===void 0){s.n=3;break}return s.a(2,f({},y,r.choices[0].delta.content));case 3:return s.a(2,f({},y,""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Jn=(function(a){function i(t){var e;E(this,i);var n,r=t.directConnection,s=r==null?void 0:r.openAI,o={images:f({},T,{acceptedFormats:".png",maxNumberOfFiles:2})};e=F(this,i,[t,$t(),Vt,s,o]),e.insertKeyPlaceholderText=e.genereteAPIKeyName("OpenAI"),e.keyHelpUrl=Kt,e.url="",e.permittedErrorPrefixes=[xn,"Invalid input image"];var l=(n=r==null?void 0:r.openAI)==null?void 0:n[pe];if(e[je]){var u=R(l)=="object"&&l.size?Number.parseInt(l.size):1024;e[je][T]={dimensions:{width:u,height:u}}}return R(l)===Q&&Object.assign(e.rawBody,l),e.canSendMessage=i.canFileSendMessage,e}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e);return n&&n!==""&&(r.prompt=n),r}},{key:"callApiWithImage",value:function(e,n,r){var s,o,l,u=(o=(s=n[n.length-1])==null?void 0:s[y])==null?void 0:o.trim();if(r[1]||u&&u!==""){this.url=i.IMAGE_EDIT_URL;var c=this.preprocessBody(this.rawBody,u);l=i.createFormDataBody(c,r[0],r[1])}else this.url=i.IMAGE_VARIATIONS_URL,l=i.createFormDataBody(this.rawBody,r[0]);Y.tempRemoveContentHeader(this.connectSettings,xe.request.bind(this,this,l,e),!1)}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if((l=this.connectSettings)!=null&&l.headers){c.n=1;break}throw new Error(qe);case 1:if(!(o!=null&&o[0])){c.n=2;break}this.callApiWithImage(r,s,o),c.n=4;break;case 2:if(this.connectSettings){c.n=3;break}throw new Error(qe);case 3:this.url=i.IMAGE_GENERATION_URL,u=this.preprocessBody(this.rawBody,s[s.length-1][y]),xe.request(this,u,r);case 4:return c.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r[_]){o.n=1;break}throw r[_].message;case 1:return s=r.data.map(function(l){return l.url?f(f({},N,l.url),z,le):f(f({},N,"".concat(Gt).concat(l.b64_json)),z,le)}),o.a(2,f({},T,s))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"canFileSendMessage",value:function(e,n){return!!(n!=null&&n[0])||!!(e&&e.trim()!=="")}},{key:"createFormDataBody",value:function(e,n,r){var s=new FormData;return s.append(le,n),r&&s.append("mask",r),Object.keys(e).forEach(function(o){s.append(o,String(e[o]))}),s}}])})(W);Jn.IMAGE_GENERATION_URL="".concat(Ge,"images/generations"),Jn.IMAGE_VARIATIONS_URL="".concat(Ge,"images/variations"),Jn.IMAGE_EDIT_URL="".concat(Ge,"images/edits");var Tc=Jn,Ac=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},Mc=function(i,t,e,n){var r=i;r[_]?r[_].type===Oe?n(we):n(He):e(t)},Ic=function(){return Ee("https://openrouter.ai/api/v1/key",Se,Mc)},Rc=(function(a){function i(t){var e,n,r,s;E(this,i);var o,l,u,c,d=L(t.directConnection).openRouter;return s=F(this,i,[t,Ic(),Ac,d]),s.insertKeyPlaceholderText=s.genereteAPIKeyName("OpenRouter"),s.keyHelpUrl="https://openrouter.ai/keys",s.url="https://openrouter.ai/api/v1/chat/completions",s.permittedErrorPrefixes=[Qe,Oe],R(d)===Q&&s.completeConfig(d,(l=(o=t.directConnection)==null?void 0:o.openRouter)==null?void 0:l.function_handler),(e=s.maxMessages)!==null&&e!==void 0||(s.maxMessages=-1),(n=(u=s.rawBody).model)!==null&&n!==void 0||(u.model="openai/gpt-4o"),(r=(c=s.rawBody).max_tokens)!==null&&r!==void 0||(c.max_tokens=1e3),s}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(l){return f({content:i.getContent(l)},P,W.getRoleViaUser(l[P]))}),o=[];return this.systemMessage&&o.push(f(f({},P,"system"),"content",this.systemMessage)),o.push.apply(o,_t(s)),r.messages=o,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(!r[_]){m.n=1;break}throw r[_].message;case 1:if(r.object!=="chat.completion.chunk"){m.n=4;break}if(d=(o=r.choices)==null?void 0:o[0],!(d!=null&&d.delta)){m.n=2;break}return m.a(2,this.extractStreamResult(d,s));case 2:if(!((l=r.message)!=null&&l[pe])){m.n=3;break}return h=r.message[pe].map(function(b){return f({},N,b[ze].url)}),m.a(2,f(f({},y,r.message.content||""),T,h));case 3:return m.a(2,f({},y,""));case 4:if(r.object!=="chat.completion"){m.n=6;break}if(p=(u=r.choices)==null?void 0:u[0],!(p!=null&&p.message)){m.n=6;break}if(!p.message.tool_calls){m.n=5;break}return m.a(2,this.handleToolsGeneric({tool_calls:p.message.tool_calls},this.functionHandler,this.messages,s));case 5:return g=((c=p.message[pe])==null?void 0:c.map(function(b){return f({},N,b[ze].url)}))||[],m.a(2,f(f({},y,p.message.content||""),"files",g));case 6:return m.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractStreamResult",value:(function(){var t=w(v().m(function n(r,s){var o,l;return v().w(function(u){for(;;)switch(u.n){case 0:if(o=r.delta,!(o!=null&&o[pe])){u.n=1;break}return l=o[pe].map(function(c){return f({},N,c[ze].url)}),u.a(2,f(f({},y,o.content||""),T,l));case 1:return u.a(2,this.extractStreamResultWToolsGeneric(this,r,this.functionHandler,s))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}],[{key:"getAudioContent",value:function(e){return e.filter(function(n){return n.type===ee}).map(function(n){var r,s,o,l=(r=n[N])==null?void 0:r.split(",")[1],u=(o=(s=n[N])==null?void 0:s.match(/data:audio\/([^;]+)/))==null?void 0:o[1];return f(f({},z,kt),kt,{data:l||"",format:u==="wav"||u==="mp3"?u:"mp3"})}).filter(function(n){return n[kt].data.length>0})}},{key:"getContent",value:function(e){if(e[T]&&e[T].length>0){var n=[].concat(_t(i.getImageContent(e[T])),_t(i.getAudioContent(e[T])));return e[y]&&e[y].trim().length>0&&n.unshift(f(f({},z,y),y,e[y])),n.length>0?n:e[y]||""}return e[y]||""}}])})(W),Pc=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},xc=function(i,t,e,n){i[_]?n(we):e(t)},Bc=function(){return Ee("https://api.perplexity.ai/chat/completions",Te,xc)},Oc=(function(a){function i(t){var e,n,r;E(this,i);var s,o=L(t.directConnection).perplexity;return r=F(this,i,[t,Bc(),Pc,o]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Perplexity"),r.keyHelpUrl="https://www.perplexity.ai/settings/api",r.url="https://api.perplexity.ai/chat/completions",r.permittedErrorPrefixes=[gt,js,"Permission denied"],R(o)===Q&&r.completeConfig(o),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(s=r.rawBody).model)!==null&&n!==void 0||(s.model="sonar"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:o[y]||""},P,W.getRoleViaUser(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r[_]){o.n=1;break}throw r[_].message;case 1:if(!(r.choices&&r.choices.length>0)){o.n=3;break}if(s=r.choices[0],!(s.delta&&s.delta.content)){o.n=2;break}return o.a(2,f({},y,s.delta.content));case 2:if(!(s.message&&s.message.content)){o.n=3;break}return o.a(2,f({},y,s.message.content));case 3:return o.a(2,f({},y,""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Lc=function(i){return f(f({},ke,"Bearer ".concat(i)),te,fe)},Fc=function(i,t,e,n){var r=i;r.detail?n(r.detail):e(t)},Dc=function(){return Ee("http://localhost:3000/api/v1/models",Se,Fc)},Nc=(function(a){function i(t){var e,n,r,s;E(this,i);var o,l,u,c,d=L(t.directConnection).openWebUI;return s=F(this,i,[t,Dc(),Lc,d]),s.insertKeyPlaceholderText="Open WebUI API Key",s.keyHelpUrl="https://docs.openwebui.com/getting-started/api-endpoints/",s.url="http://localhost:3000/api/chat/completions",s.permittedErrorPrefixes=["Error"],R(d)===Q&&(s.completeConfig(d,(l=(o=t.directConnection)==null?void 0:o.openWebUI)==null?void 0:l.function_handler),d[T]&&d[T].length>0&&(s.rawBody[T]=d[T])),(e=s.maxMessages)!==null&&e!==void 0||(s.maxMessages=-1),(n=(u=s.rawBody).model)!==null&&n!==void 0||(u.model="llama3.2"),(r=(c=s.rawBody).stream)!==null&&r!==void 0||(c.stream=!1),s}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:W.getTextWImagesContent(o)},P,W.getRoleViaUser(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{readable:!0});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(!r[_]){c.n=1;break}throw r[_].message;case 1:if(!r[y]){c.n=2;break}return l=r[y].trim(),c.a(2,this.processStreamingResponse(l,s));case 2:if(!(r.choices&&(o=r.choices[0])!=null&&o.message)){c.n=3;break}return u=r.choices[0].message,c.a(2,u.tool_calls?this.handleTools({tool_calls:u.tool_calls},s):f({},y,u.content||""));case 3:return c.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"processStreamingResponse",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p,g,m,b;return v().w(function(k){for(;;)switch(k.p=k.n){case 0:l=r.split(`
`).filter(function(A){return A.trim()!==""}),u="",c=qt(l),k.p=1,c.s();case 2:if((d=c.n()).done){k.n=8;break}if(h=d.value,p=h.trim(),p.startsWith("data: ")&&(p=p.substring(6)),p==="[DONE]"){k.n=7;break}if(k.p=3,g=JSON.parse(p),!(g.choices&&(o=g.choices[0])!=null&&o.delta)){k.n=5;break}if(m=g.choices[0].delta,!m.tool_calls){k.n=4;break}return k.a(2,this.handleTools({tool_calls:m.tool_calls},s));case 4:m.content&&(u+=m.content);case 5:k.n=7;break;case 6:return k.p=6,k.v,k.a(3,7);case 7:k.n=2;break;case 8:k.n=10;break;case 9:k.p=9,b=k.v,c.e(b);case 10:return k.p=10,c.f(),k.f(10);case 11:return k.a(2,f({},y,u))}},n,this,[[3,6],[1,9,10,11]])}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"handleTools",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d;return v().w(function(h){for(;;)switch(h.n){case 0:if(!(!r.tool_calls||!s||!this.functionHandler)){h.n=1;break}throw Error(vt);case 1:return o=L(s),l=r.tool_calls.map(function(p){return{name:p.function.name,arguments:p.function.arguments}}),h.n=2,this.callToolFunction(this.functionHandler,l);case 2:if(u=h.v,c=u.responses,d=u.processedResponse,!d){h.n=3;break}return h.a(2,d);case 3:if(o.messages.push(f(f({tool_calls:r.tool_calls},P,rt),"content","")),!(!c.find(function(p){var g=p.response;return typeof g!="string"})&&l.length===c.length)){h.n=4;break}return h.a(2,(c.forEach(function(p,g){var m,b=(m=r.tool_calls)==null?void 0:m[g];o==null||o.messages.push(f(f(f({},P,"tool"),"tool_name",b==null?void 0:b.function.name),"content",p.response))}),this.makeAnotherRequest(o,this.messages)));case 4:throw Error(Tt);case 5:return h.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}])})(W),Uc=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},jc=function(i,t,e,n){var r=i;r[_]?r[_].type===Oe?n(we):n(He):e(t)},Hc=function(){return Ee("https://api.deepseek.com/models",Se,jc)},qc=(function(a){function i(t){var e,n,r,s,o;E(this,i);var l,u,c,d=L(t.directConnection).deepSeek;return o=F(this,i,[t,Hc(),Uc,d]),o.insertKeyPlaceholderText=o.genereteAPIKeyName("DeepSeek"),o.keyHelpUrl="https://platform.deepseek.com/api_keys",o.url="https://api.deepseek.com/v1/chat/completions",o.permittedErrorPrefixes=[Qe,Oe],R(d)===Q&&o.completeConfig(d),(e=o.maxMessages)!==null&&e!==void 0||(o.maxMessages=-1),(n=(l=o.rawBody).model)!==null&&n!==void 0||(l.model="deepseek-chat"),(r=(u=o.rawBody).temperature)!==null&&r!==void 0||(u.temperature=1),(s=(c=o.rawBody).max_tokens)!==null&&s!==void 0||(c.max_tokens=4096),o}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:o[y]||""},P,W.getRoleViaUser(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r[_]){o.n=1;break}throw r[_].message;case 1:if(!(r.choices&&r.choices.length>0)){o.n=3;break}if(s=r.choices[0],!(s.delta&&s.delta.content)){o.n=2;break}return o.a(2,f({},y,s.delta.content));case 2:if(!(s.message&&s.message.content)){o.n=3;break}return o.a(2,f({},y,s.message.content));case 3:return o.a(2,f({},y,""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),zc=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},Wc=function(i,t,e,n){var r;((r=i.base_resp)==null?void 0:r.status_code)===1004?n(we):e(t)},Gc=function(){return Ee("https://api.minimax.io/v1/files/delete",Te,Wc)},Kc=(function(a){function i(t){var e,n,r;E(this,i);var s,o=L(t.directConnection).miniMax;return r=F(this,i,[t,Gc(),zc,o]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("MiniMax"),r.keyHelpUrl="https://www.minimaxi.com",r.url="https://api.minimax.io/v1/text/chatcompletion_v2",r.permittedErrorPrefixes=[Qe,Oe,"insufficient balance"],R(o)===Q&&r.completeConfig(o),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(s=r.rawBody).model)!==null&&n!==void 0||(s.model="MiniMax-M1"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:o[y]||""},P,W.getRoleViaUser(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o;return v().w(function(l){for(;;)switch(l.n){case 0:if(!r[_]){l.n=1;break}throw r[_].message;case 1:if(!(r.choices&&r.choices.length>0)){l.n=3;break}if(o=r.choices[0],!(o.delta&&o.delta.content)){l.n=2;break}return l.a(2,f({},y,o.delta.content));case 2:if(!(o.message&&o.message.content)){l.n=3;break}return l.a(2,f({},y,o.message.content));case 3:if(!(typeof((s=r.base_resp)==null?void 0:s.status_code)=="number"&&r.base_resp.status_code>0)){l.n=4;break}throw r.base_resp.status_msg;case 4:return l.a(2,f({},y,""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Vc=function(i){return f(f(f({},ke,"".concat(Be).concat(i)),te,fe),"accept",fe)},$c=function(i,t,e,n){i.detail?n(we):e(t)},Xc=function(){return Ee("https://api.mistral.ai/v1/models",Se,$c)},Jc=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u=L(t.directConnection).mistral;return r=F(this,i,[t,Xc(),Vc,u]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Mistral"),r.keyHelpUrl="https://console.mistral.ai/api-keys/",r.url="https://api.mistral.ai/v1/chat/completions",r.permittedErrorPrefixes=[gt],R(u)===Q&&r.completeConfig(u,(o=(s=t.directConnection)==null?void 0:s.mistral)==null?void 0:o.function_handler),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(l=r.rawBody).model)!==null&&n!==void 0||(l.model="mistral-small-latest"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f(f({},P,W.getRoleViaAI(o[P])),"content",W.getTextWFilesContent(o,i.getFileContent))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:if(!r.message){l.n=1;break}throw r.message;case 1:if(!r[_]){l.n=2;break}throw r[_].message;case 2:if(!(r.choices&&r.choices.length>0)){l.n=4;break}if(o=r.choices[0],!o.delta){l.n=3;break}return l.a(2,this.extractStreamResult(o,s));case 3:if(!o.message){l.n=4;break}return l.a(2,o.message.tool_calls?this.handleToolsGeneric({tool_calls:o.message.tool_calls},this.functionHandler,this.messages,s):f({},y,o.message.content||""));case 4:return l.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractStreamResult",value:(function(){var t=w(v().m(function n(r,s){var o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(o=r.delta,l=r.finish_reason,!(l==="tool_calls"&&o!=null&&o.tool_calls)){c.n=1;break}return u={tool_calls:o.tool_calls},c.a(2,this.handleToolsGeneric(u,this.functionHandler,this.messages,s));case 1:return c.a(2,f({},y,(o==null?void 0:o.content)||""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}],[{key:"getFileContent",value:function(e){return e.map(function(n){return n.type===le?f(f({},z,ze),ze,n[N]||""):f(f({},z,y),y,"[Unsupported ".concat(ve," type: ").concat(n.type,"]"))})}}])})(W),Zc=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u,c,d=L(t.directConnection),h=d.groq;r=F(this,i,[t,Ci(),Ei,h]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Groq"),r.keyHelpUrl="https://console.groq.com/keys",r.url="https://api.groq.com/openai/v1/chat/completions",r.permittedErrorPrefixes=[gt,"property"];var p=(s=d.groq)==null?void 0:s.chat;return R(p)===Q&&r.completeConfig(p,(u=(l=(o=t.directConnection)==null?void 0:o.groq)==null?void 0:l.chat)==null?void 0:u.function_handler),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(c=r.rawBody).model)!==null&&n!==void 0||(c.model="llama-3.3-70b-versatile"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:i.getTextWImagesContent(o)},P,o[P]===me?rt:o[P])});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c;return v().w(function(d){for(;;)switch(d.n){case 0:if(!r[_]){d.n=1;break}throw r[_].message;case 1:return d.a(2,(l=(o=r.choices)==null?void 0:o[0])!=null&&l.delta?this.extractStreamResult(r.choices[0],s):(c=(u=r.choices)==null?void 0:u[0])!=null&&c.message?r.choices[0].message.tool_calls?this.handleToolsGeneric(r.choices[0].message,this.functionHandler,this.messages,s,{message:this.systemMessage}):f({},y,r.choices[0].message.content||""):f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractStreamResult",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.extractStreamResultWToolsGeneric(this,r,this.functionHandler,s))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}])})(W),Yc=function(i){return f(f(f({},ke,"".concat(Be).concat(i)),te,fe),"accept",fe)},Qc=function(i,t,e,n){typeof i.message=="string"?n(we):e(t)},ed=function(){return Ee("https://api.cohere.ai/v1/models",Se,Qc)},td=(function(a){function i(t){var e,n,r;E(this,i);var s,o=L(t.directConnection).cohere;if(r=F(this,i,[t,ed(),Yc,o]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Cohere"),r.keyHelpUrl="https://dashboard.cohere.ai/api-keys",r.permittedErrorPrefixes=["invalid"],r.url="https://api.cohere.com/v2/chat",R(o)===Q){var l=_e.processCohere(o);r.canSendMessage=function(){return l},r.cleanConfig(o),Object.assign(r.rawBody,o)}return(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(s=r.rawBody).model)!==null&&n!==void 0||(s.model="command-a-03-2025"),r}return D(i,a),C(i,[{key:"cleanConfig",value:function(e){delete e.key}},{key:"preprocessBody",value:function(e,n){var r=L(e),s=n.filter(function(o){return o[y]});return r.messages=s.map(function(o){return f(f({},P,W.getRoleViaAI(o[P])),"content",o[y])}),r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{readable:!0});case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(typeof r.message!="string"){c.n=1;break}throw r.message;case 1:if(!(this.stream&&r[y])){c.n=2;break}return u=i.parseBundledEvents(r[y]),c.a(2,{text:i.aggregateBundledEventsText(u)});case 2:if(!("message"in r&&(l=(o=(s=r.message)==null?void 0:s.content)==null?void 0:o[0])!=null&&l[y])){c.n=3;break}return c.a(2,f({},y,r.message.content[0][y]));case 3:throw new Error("Invalid response format from Cohere API");case 4:return c.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()}],[{key:"parseBundledEvents",value:function(e){var n=e.trim().split(`
`),r=[],s=qt(n),o;try{for(s.s();!(o=s.n()).done;){var l=o.value;if(l.trim())try{var u=JSON.parse(l);r.push(u)}catch(c){console[_]("Failed to parse line:",l,c)}}}catch(c){s.e(c)}finally{s.f()}return r}},{key:"aggregateBundledEventsText",value:function(e){return e.filter(function(n){var r,s,o;return n.type==="content-delta"&&((o=(s=(r=n.delta)==null?void 0:r.message)==null?void 0:s.content)==null?void 0:o[y])}).map(function(n){var r,s,o;return(o=(s=(r=n.delta)==null?void 0:r.message)==null?void 0:s.content)==null?void 0:o[y]}).join("")}}])})(W),nd=function(){return f({},te,fe)},rd=function(i,t,e,n){var r,s=i;s[_]?s[_].code===403||(r=s[_].message)!=null&&r.includes("API key")?n(we):n(He):e(t)},ad=function(){var i="https://generativelanguage.googleapis.com/v1beta/models?key=";return Ee(i,Se,rd,function(t){return"".concat(i).concat(t)})},sd=(function(a){function i(t){var e,n;E(this,i);var r,s,o=L(t.directConnection).gemini;if(n=F(this,i,[t,ad(),nd,o]),n.insertKeyPlaceholderText=n.genereteAPIKeyName("Gemini"),n.keyHelpUrl="https://aistudio.google.com/app/apikey",n.urlPrefix="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent",n.url="",n.permittedErrorPrefixes=["API_KEY_INVALID"],R(o)===Q){var l=o;l.model&&(n.urlPrefix="https://generativelanguage.googleapis.com/v1beta/models/".concat(l.model,":generateContent")),n.cleanConfig(l),n.completeConfig(l,(s=(r=t.directConnection)==null?void 0:r.gemini)==null?void 0:s.function_handler)}return(e=n.maxMessages)!==null&&e!==void 0||(n.maxMessages=-1),n}return D(i,a),C(i,[{key:"cleanConfig",value:function(e){delete e.model}},{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return i.getContent(o)});return r.contents=s,this.systemMessage&&(r.systemInstruction={parts:[f({},y,this.systemMessage)]}),r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(this.connectSettings){c.n=1;break}throw new Error(qe);case 1:(o=this.messages)!==null&&o!==void 0||(this.messages=r),l=this.preprocessBody(this.rawBody,s),u=this.stream,u&&(R(u)!==Q||!u.simulation)||l.stream?(this.url="".concat(this.urlPrefix.replace(":generateContent",":streamGenerateContent"),"?alt=sse&key=").concat(this.key),Ce.request(this,l,r)):(this.url="".concat(this.urlPrefix,"?key=").concat(this.key),xe.request(this,l,r));case 2:return c.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(!r[_]){m.n=1;break}throw r[_].message||"Gemini API Error";case 1:if(!((u=(l=(o=r.candidates)==null?void 0:o[0])==null?void 0:l.content)!=null&&u.parts)){m.n=3;break}if(d=r.candidates[0].content.parts,h=d.find(function(b){return b.functionCall}),!(h!=null&&h.functionCall)){m.n=2;break}return m.a(2,this.handleTools([h.functionCall],s));case 2:return p=d.find(function(b){return b[y]}),g=d.find(function(b){var k;return((k=b.inlineData)==null?void 0:k.mimeType)==="image/png"}),m.a(2,f(f({},y,(p==null?void 0:p[y])||""),T,(c=g==null?void 0:g.inlineData)!=null&&c.data?[f({},N,"data:image/png;base64,".concat(g.inlineData.data))]:[]));case 3:return m.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"handleTools",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:if(!(!r||!s||!this.functionHandler)){g.n=1;break}throw Error(vt);case 1:return o=L(s),l=r.map(function(m){return{name:m.name,arguments:JSON.stringify(m.args)}}),g.n=2,this.callToolFunction(this.functionHandler,l);case 2:if(u=g.v,c=u.responses,d=u.processedResponse,!d){g.n=3;break}return g.a(2,d);case 3:if(h=f({parts:r.map(function(m){return{functionCall:{name:m.name,args:m.args}}})},P,"model"),o.contents.push(h),!(!c.find(function(m){var b=m.response;return typeof b!="string"})&&l.length===c.length)){g.n=4;break}return p=f({parts:c.map(function(m,b){return{functionResponse:{name:r[b].name,response:{result:m.response}}}})},P,Z),g.a(2,(o.contents.push(p),this.makeAnotherRequest(o,this.messages)));case 4:throw Error(Tt);case 5:return g.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}],[{key:"getContent",value:function(e){var n=[];return e[y]&&e[y].trim().length>0&&n.push(f({},y,e[y])),e[T]&&e[T].length>0&&e[T].forEach(function(r){if(r[N]&&r[N].includes("data:")){var s=r[N].split(","),o=wt(s,2),l=o[0],u=o[1];n.push({inlineData:{mimeType:l.replace("data:","").replace(";base64",""),data:u}})}}),f({parts:n},P,e[P]===Z?Z:"model")}}])})(W),id=function(i){return f(f(f({"x-api-key":i},te,fe),"anthropic-version","2023-06-01"),"anthropic-dangerous-direct-browser-access","true")},od=function(i,t,e,n){var r=i;r[_]?r[_].type===Oe?n(we):n(He):e(t)},ld=function(){return Ee("https://api.anthropic.com/v1/models",Se,od)},ud=(function(a){function i(t){var e,n,r,s;E(this,i);var o,l,u,c,d=L(t.directConnection).claude;return s=F(this,i,[t,ld(),id,d]),s.insertKeyPlaceholderText=s.genereteAPIKeyName("Claude"),s.keyHelpUrl="https://console.anthropic.com/settings/keys",s.url="https://api.anthropic.com/v1/messages",s.permittedErrorPrefixes=[Oe,Qe],s._streamToolCalls=f(f(f(f({},z,"tool_use"),"id",""),"name",""),"input",""),R(d)===Q&&s.completeConfig(d,(l=(o=t.directConnection)==null?void 0:o.claude)==null?void 0:l.function_handler),(e=s.maxMessages)!==null&&e!==void 0||(s.maxMessages=-1),(n=(u=s.rawBody).model)!==null&&n!==void 0||(u.model="claude-sonnet-4-5-20250929"),(r=(c=s.rawBody).max_tokens)!==null&&r!==void 0||(c.max_tokens=4096),s}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:i.getTextWFilesContent(o,i.getFileContent)},P,W.getRoleViaUser(o[P]))});return r.messages=s,this.systemMessage&&(r.system=this.systemMessage),r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d;return v().w(function(h){for(;;)switch(h.n){case 0:if(!r[_]){h.n=1;break}throw r[_].message;case 1:if(!(r.content&&r.content.length>0)){h.n=3;break}if(c=r.content.find(function(p){return p.type==="tool_use"}),!c){h.n=2;break}return h.a(2,this.handleTools([c],s));case 2:if(d=r.content.find(function(p){return p.type===y}),!d){h.n=3;break}return h.a(2,f({},y,d[y]));case 3:if(!(r.type==="content_block_delta"&&r.delta&&r.delta.type==="text_delta")){h.n=4;break}return h.a(2,f({},y,r.delta[y]||""));case 4:if(!(r.type==="content_block_start"&&((o=r.content_block)==null?void 0:o.type)==="tool_use")){h.n=5;break}this._streamToolCalls=r.content_block,this._streamToolCalls.input="",h.n=7;break;case 5:if(!(r.type==="content_block_delta"&&((l=r.delta)==null?void 0:l.type)==="input_json_delta")){h.n=6;break}this._streamToolCalls.input+=r.delta.partial_json||"",h.n=7;break;case 6:if(!(r.type==="message_delta"&&((u=r.delta)==null?void 0:u.stop_reason)==="tool_use")){h.n=7;break}return h.a(2,(this._streamToolCalls.input=JSON.parse(this._streamToolCalls.input),this.handleTools([this._streamToolCalls],s)));case 7:return h.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"handleTools",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d,h,p;return v().w(function(g){for(;;)switch(g.n){case 0:if(!(!r||!s||!this.functionHandler)){g.n=1;break}throw Error(vt);case 1:return o=L(s),l=r.map(function(m){return{name:m.name,arguments:JSON.stringify(m.input)}}),g.n=2,this.callToolFunction(this.functionHandler,l);case 2:if(u=g.v,c=u.responses,d=u.processedResponse,!d){g.n=3;break}return g.a(2,d);case 3:if(h=r.map(function(m){return f(f(f(f({},z,"tool_use"),"id",m.id),"name",m.name),"input",m.input)}),o.messages.push(f(f({},P,"assistant"),"content",h)),!(!c.find(function(m){var b=m.response;return typeof b!="string"})&&l.length===c.length)){g.n=4;break}return p=c.map(function(m,b){return f(f(f({},z,"tool_result"),"tool_use_id",r[b].id),"content",m.response)}),g.a(2,(o.messages.push(f(f({},P,Z),"content",p)),this.makeAnotherRequest(o,this.messages)));case 4:throw Error(Tt);case 5:return g.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}],[{key:"getFileContent",value:function(e){return e.map(function(n){var r,s,o;if(n.type===le){var l=(r=n[N])==null?void 0:r.split(",")[1],u=((o=(s=n[N])==null?void 0:s.match(/data:([^;]+)/))==null?void 0:o[1])||"image/jpeg";return f(f({},z,le),"source",f(f(f({},z,"base64"),"media_type",u),"data",l||""))}return f(f({},z,y),y,"[Unsupported ".concat(ve," type: ").concat(n.type,"]"))})}}])})(W),cd=function(){return{}},dd=function(){},hd=function(){return Ee("",Se,dd)},pd=(function(a){function i(t){var e,n,r,s;E(this,i);var o,l,u,c,d=L(t.directConnection);s=F(this,i,[t,hd(),cd,{key:"placeholder"}]),s.insertKeyPlaceholderText="",s.keyHelpUrl="",s.validateKeyProperty=!1,s.url="http://localhost:11434/api/chat",s.permittedErrorPrefixes=["Error"];var h=d.ollama;return R(h)===Q&&s.completeConfig(h,(l=(o=t.directConnection)==null?void 0:o.ollama)==null?void 0:l.function_handler),(e=s.maxMessages)!==null&&e!==void 0||(s.maxMessages=-1),(n=(u=s.rawBody).model)!==null&&n!==void 0||(u.model="llama3.2"),(r=(c=s.rawBody).stream)!==null&&r!==void 0||(c.stream=!1),s}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){var l=f({content:o[y]||""},P,W.getRoleViaUser(o[P]));if(o[T]&&o[T].length>0){var u=i.getImageData(o[T]);u.length>0&&(l[pe]=u)}return l});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{readable:!0});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o,l,u;return v().w(function(c){for(;;)switch(c.n){case 0:if(!r[_]){c.n=1;break}throw r[_].message;case 1:if(!r[y]){c.n=2;break}return u=JSON.parse(r[y]),c.a(2,(o=u.message)!=null&&o.tool_calls?this.handleTools({tool_calls:u.message.tool_calls},s):f({},y,((l=u.message)==null?void 0:l.content)||""));case 2:return c.a(2,r.message?r.message.tool_calls?this.handleTools({tool_calls:r.message.tool_calls},s):f({},y,r.message.content||""):f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"handleTools",value:(function(){var t=w(v().m(function n(r,s){var o,l,u,c,d;return v().w(function(h){for(;;)switch(h.n){case 0:if(!(!r.tool_calls||!s||!this.functionHandler)){h.n=1;break}throw Error(vt);case 1:return o=L(s),l=r.tool_calls.map(function(p){return{name:p.function.name,arguments:JSON.stringify(p.function.arguments)}}),h.n=2,this.callToolFunction(this.functionHandler,l);case 2:if(u=h.v,c=u.responses,d=u.processedResponse,!d){h.n=3;break}return h.a(2,d);case 3:if(o.messages.push(f(f({tool_calls:r.tool_calls},P,rt),"content","")),!(!c.find(function(p){var g=p.response;return typeof g!="string"})&&l.length===c.length)){h.n=4;break}return h.a(2,(c.forEach(function(p,g){var m,b=(m=r.tool_calls)==null?void 0:m[g];o==null||o.messages.push(f(f(f({},P,"tool"),"tool_name",b==null?void 0:b.function.name),"content",p.response))}),this.makeAnotherRequest(o,this.messages)));case 4:throw Error(Tt);case 5:return h.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}],[{key:"getImageData",value:function(e){return e.filter(function(n){return n.type===le}).map(function(n){var r;return((r=n[N])==null?void 0:r.split(",")[1])||""}).filter(function(n){return n.length>0})}}])})(W),Mi=function(i){return f({Authorization:"".concat(Be).concat(i)},te,fe)},fd=function(i,t,e,n){var r=i;r[_]?r[_].type===Oe||r[_].type===Qe?n(we):n(He):e(t)},Ii=function(){return Ee("https://api.x.ai/v1/models",Se,fd)},Ri=(function(a){function i(t){var e,n;E(this,i);var r,s,o=t.directConnection,l=o==null?void 0:o.x;n=F(this,i,[t,Ii(),Mi,l]),n.insertKeyPlaceholderText=n.genereteAPIKeyName("X"),n.keyHelpUrl="https://console.x.ai/team/default/api-keys",n.url=i.IMAGE_GENERATION_URL,n.permittedErrorPrefixes=[Qe,Oe];var u=(r=o==null?void 0:o.x)==null?void 0:r[pe];return R(u)===Q&&Object.assign(n.rawBody,u),(e=(s=n.rawBody).model)!==null&&e!==void 0||(s.model="grok-2-image"),n}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=n[n.length-1][y],s=L(e);return r&&r!==""&&(s.prompt=r),s}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this));case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s;return v().w(function(o){for(;;)switch(o.n){case 0:if(!r[_]){o.n=1;break}throw r[_].message;case 1:return s=r.data.map(function(l){return l.url?f(f({},N,l.url),z,le):f(f({},N,"".concat(Gt).concat(l.b64_json)),z,le)}),o.a(2,f({},T,s))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W);Ri.IMAGE_GENERATION_URL="https://api.x.ai/v1/images/generations";var md=Ri,vd=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},gd=function(i,t,e,n){var r=i;r[_]?r[_].type===Qe?n(we):n(He):e(t)},yd=function(){return Ee("https://dashscope-intl.aliyuncs.com/compatible-mode/v1/models",Se,gd)},bd=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u=L(t.directConnection).qwen;return r=F(this,i,[t,yd(),vd,u]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Qwen"),r.keyHelpUrl="https://www.alibabacloud.com/help/en/model-studio/get-api-key",r.url="https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions",r.permittedErrorPrefixes=["No static","The model",xn],R(u)===Q&&r.completeConfig(u,(o=(s=t.directConnection)==null?void 0:s.qwen)==null?void 0:o.function_handler),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(l=r.rawBody).model)!==null&&n!==void 0||(l.model="qwen-plus"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:i.getTextWImagesContent(o)},P,W.getRoleViaUser(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:if(!r[_]){l.n=1;break}throw r[_].message;case 1:if(!(r.choices&&r.choices.length>0)){l.n=3;break}if(o=r.choices[0],!o.delta){l.n=2;break}return l.a(2,this.extractStreamResult(o,s));case 2:if(!o.message){l.n=3;break}return l.a(2,o.message.tool_calls?this.handleToolsGeneric({tool_calls:o.message.tool_calls},this.functionHandler,this.messages,s):f({},y,o.message.content||""));case 3:return l.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractStreamResult",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.extractStreamResultWToolsGeneric(this,r,this.functionHandler,s))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}])})(W),_d=function(i){return f(f({},ke,"".concat(Be).concat(i)),te,fe)},kd=function(i,t,e,n){var r=i;r[_]?r[_].type===Oe?n(we):n(He):e(t)},Sd=function(){return Ee("https://api.moonshot.ai/v1/models",Se,kd)},wd=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l,u=L(t.directConnection).kimi;return r=F(this,i,[t,Sd(),_d,u]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Kimi"),r.keyHelpUrl="https://platform.moonshot.ai/console/api-keys",r.url="https://api.moonshot.ai/v1/chat/completions",r.permittedErrorPrefixes=[gt,"Not found"],R(u)===Q&&r.completeConfig(u,(o=(s=t.directConnection)==null?void 0:s.kimi)==null?void 0:o.function_handler),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(l=r.rawBody).model)!==null&&n!==void 0||(l.model="moonshot-v1-8k"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:i.getTextWImagesContent(o)},P,W.getRoleViaUser(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:(o=this.messages)!==null&&o!==void 0||(this.messages=r),this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return l.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r,s){var o;return v().w(function(l){for(;;)switch(l.n){case 0:if(!r[_]){l.n=1;break}throw r[_].message;case 1:if(!(r.choices&&r.choices.length>0)){l.n=3;break}if(o=r.choices[0],!o.delta){l.n=2;break}return l.a(2,this.extractStreamResult(o,s));case 2:if(!o.message){l.n=3;break}return l.a(2,o.message.tool_calls?this.handleToolsGeneric({tool_calls:o.message.tool_calls},this.functionHandler,this.messages,s):f({},y,o.message.content||""));case 3:return l.a(2,f({},y,""))}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractStreamResult",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,this.extractStreamResultWToolsGeneric(this,r,this.functionHandler,s))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()}])})(W),Ed=(function(a){function i(t){var e,n,r;E(this,i);var s,o,l=L(t.directConnection),u=l.x;r=F(this,i,[t,Ii(),Mi,u]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("X"),r.keyHelpUrl="https://console.x.ai/team/default/api-keys",r.url="https://api.x.ai/v1/chat/completions",r.permittedErrorPrefixes=[Qe,Oe];var c=(s=l.x)==null?void 0:s.chat;return R(c)===Q&&r.completeConfig(c),(e=r.maxMessages)!==null&&e!==void 0||(r.maxMessages=-1),(n=(o=r.rawBody).model)!==null&&n!==void 0||(o.model="grok-3-latest"),r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n){var r=L(e),s=this.processMessages(n).map(function(o){return f({content:o[y]||""},P,W.getRoleViaUser(o[P]))});return this.addSystemMessage(s),r.messages=s,r}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)switch(o.n){case 0:this.callDirectServiceServiceAPI(r,s,this.preprocessBody.bind(this),{});case 1:return o.a(2)}},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s,o,l,u,c;return v().w(function(d){for(;;)switch(d.n){case 0:if(!r[_]){d.n=1;break}throw r[_].message;case 1:if(r.object!=="chat.completion.chunk"){d.n=2;break}return c=(s=r.choices)==null?void 0:s[0],d.a(2,(o=c==null?void 0:c.delta)!=null&&o.content?f({},y,c.delta.content):f({},y,""));case 2:return d.a(2,r.object==="chat.completion"&&(u=(l=r.choices)==null?void 0:l[0])!=null&&u.message?f({},y,r.choices[0].message.content||""):f({},y,""))}},n)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Zn=(function(a){return a.BLOCKING="blocking",a.STREAMING="streaming",a})(Zn||{}),Ft=(function(a){return a.MESSAGE="message",a.AGENT_MESSAGE="agent_message",a.WORKFLOW_FINISHED="workflow_finished",a.ERROR="error",a})(Ft||{}),Cd="image/",Td="data:",Ad=function(i,t){return{type:t,transfer_method:"local_file",upload_file_id:i}},Md=function(i){var t=i.trim();if(!t.startsWith(Td))return null;var e=t.replace(/^data:\s*/,"").trim();return e?JSON.parse(e):null};function Id(a,i){return Gr.apply(this,arguments)}function Gr(){return Gr=w(v().m(function a(i,t){var e,n,r,s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:return e=new FormData,e.append(ve,i),e.append(Z,t[Z]),n=t.headers,n[te],r=zi(n,[te].map(Yr)),u.n=1,fetch(t.url,{method:Te,headers:r,body:e});case 1:if(s=u.v,s.ok){u.n=3;break}return u.n=2,s.text();case 2:throw o=u.v,new Error(o);case 3:return u.n=4,s.json();case 4:if(l=u.v,l.id){u.n=5;break}throw new Error("Upload response missing file ID");case 5:return u.a(2,l.id)}},a)})),Gr.apply(this,arguments)}function Rd(a,i){return Kr.apply(this,arguments)}function Kr(){return Kr=w(v().m(function a(i,t){var e;return v().w(function(n){for(;;)switch(n.n){case 0:if(i.length!==0){n.n=1;break}return n.a(2,[]);case 1:return e=i.map((function(){var r=w(v().m(function s(o){var l,u;return v().w(function(c){for(;;)switch(c.n){case 0:return c.n=1,Id(o,t);case 1:return l=c.v,u=o.type.startsWith(Cd)?le:ve,c.a(2,Ad(l,u))}},s)}));return function(s){return r.apply(this,arguments)}})()),n.n=2,Promise.all(e);case 2:return n.a(2,n.v.filter(function(r){return r!==null}))}},a)})),Kr.apply(this,arguments)}function Pd(a,i){return a.conversation_id&&i(a.conversation_id),a.code&&a.message&&!a.answer?f({},_,a.message):f({},y,a.answer||"")}var xd=function(i,t,e){var n,r;switch(!t.conversationIdSet&&i.conversation_id&&(e(i.conversation_id),t.conversationIdSet=!0),i.event){case Ft.MESSAGE:case Ft.AGENT_MESSAGE:t.fullAnswer+=i.answer||"";break;case Ft.WORKFLOW_FINISHED:!t.fullAnswer&&(r=(n=i.data)==null?void 0:n.outputs)!=null&&r.answer&&(t.fullAnswer=i.data.outputs.answer);break;case Ft.ERROR:t.errorMessage=i.message||Ft.ERROR;break}};function Bd(a,i){return Vr.apply(this,arguments)}function Vr(){return Vr=w(v().m(function a(i,t){var e,n,r,s,o,l;return v().w(function(u){for(;;)switch(u.n){case 0:return e={fullAnswer:"",conversationIdSet:!1,errorMessage:""},u.n=1,i.text();case 1:n=u.v.split(/\r?\n\r?\n/),r=qt(n);try{for(r.s();!(s=r.n()).done;)o=s.value,l=Md(o),l&&xd(l,e,t)}catch(c){r.e(c)}finally{r.f()}return u.a(2,e.errorMessage?f({},_,e.errorMessage):f({},y,e.fullAnswer))}},a)})),Vr.apply(this,arguments)}var Od=function(i){return f(f({},te,fe),ke,"".concat(Be).concat(i))},Ld=function(i,t,e,n){var r=i;r[_]?r[_].message===ir?n(we):n(He):"user_input_form"in i||"opening_statement"in i||"file_upload"in i?e(t):n(He)},Fd=function(i){return Ee("".concat(i,"/parameters"),Se,Ld)},Dd=(function(a){function i(t){var e,n,r;E(this,i);var s,o=L(t.directConnection),l=o==null?void 0:o.dify,u=(e=(s=t.connect)==null?void 0:s.url)!==null&&e!==void 0?e:"https://api.dify.ai/v1";return r=F(this,i,[t,Fd(u),Od,l]),r.insertKeyPlaceholderText=r.genereteAPIKeyName("Dify"),r.keyHelpUrl="https://docs.dify.ai/en/use-dify/publish/developing-with-apis",r.permittedErrorPrefixes=[Oe],r._conversationId="",r._user=Z,r._inputs={},r.url="".concat(u,"/chat-messages"),r._uploadUrl="".concat(u,"/").concat(T,"/upload"),R(l)===Q&&(l[Z]&&(r._user=l[Z]),l.inputs&&(r._inputs=l.inputs),r.completeConfig(l)),(n=r.maxMessages)!==null&&n!==void 0||(r.maxMessages=-1),r._mode=r.stream?Zn.STREAMING:Zn.BLOCKING,r}return D(i,a),C(i,[{key:"preprocessBody",value:function(e,n,r){var s=this.processMessages(n),o=s[s.length-1],l=(o==null?void 0:o[y])||" ",u=f({inputs:this._inputs,query:l,response_mode:this._mode},Z,this._user);return this._conversationId&&(u.conversation_id=this._conversationId),r&&r.length>0&&(u[T]=r),u}},{key:"callServiceAPI",value:(function(){var t=w(v().m(function n(r,s,o){var l,u=this,c,d;return v().w(function(h){for(;;)switch(h.n){case 0:if((l=this.messages)!==null&&l!==void 0||(this.messages=r),c=[],d=o&&o.length>0,!d){h.n=2;break}return h.n=1,Rd(o,f(f({url:this._uploadUrl},Z,this._user),"headers",this.connectSettings.headers));case 1:c=h.v;case 2:this.callDirectServiceServiceAPI(r,s,function(p,g){return u.preprocessBody(p,g,c)});case 3:return h.a(2)}},n,this)}));function e(n,r,s){return t.apply(this,arguments)}return e})()},{key:"extractResultData",value:(function(){var t=w(v().m(function n(r){var s=this,o;return v().w(function(l){for(;;)if(l.n===0)return o=function(c){s._conversationId=c},l.a(2,this._mode===Zn.BLOCKING&&!this.stream?Pd(r,o):Bd(r,o))},n,this)}));function e(n){return t.apply(this,arguments)}return e})()}])})(W),Nd=(function(){function a(){E(this,a)}return C(a,null,[{key:"create",value:function(t){var e=t.directConnection,n=t.connect,r=t.demo,s=t.webModel;if(s)return new ca(t);if(e){if(e.openAI)return e.openAI[pe]?new Tc(t):e.openAI.speechToText?new Yu(t):e.openAI.textToSpeech?new Zu(t):e.openAI.assistant?new Ku(t):e.openAI.realtime?new Ju(t):e.openAI.completions?new mc(t):new Ai(t);if(e.assemblyAI)return new fc(t);if(e.cohere)return new td(t);if(e.huggingFace)return e.huggingFace.textGeneration?new Ou(t):e.huggingFace.summarization?new Fu(t):e.huggingFace.translation?new Uu(t):e.huggingFace.fillMask?new Hu(t):e.huggingFace.questionAnswer?new Lu(t):e.huggingFace.audioSpeechRecognition?new Bu(t):e.huggingFace.audioClassification?new Mu(t):e.huggingFace.imageClassification?new Iu(t):new Du(t);if(e.azure){if(e.azure.openAI){if(e.azure.openAI.chat)return new wc(t);if(e.azure.openAI.assistant)return new Vu(t)}if(e.azure.speechToText)return new gc(t);if(e.azure.textToSpeech)return new vc(t);if(e.azure.summarization)return new uc(t);if(e.azure.translation)return new yc(t)}if(e.stabilityAI)return e.stabilityAI.imageToImage?new Nu(t):e.stabilityAI.imageToImageUpscale?new Pu(t):e.stabilityAI.imageToImageMasking?new xu(t):new ju(t);if(e.mistral)return new Jc(t);if(e.gemini)return new sd(t);if(e.claude)return new ud(t);if(e.deepSeek)return new qc(t);if(e.miniMax)return new Kc(t);if(e.openRouter)return new Rc(t);if(e.kimi)return new wd(t);if(e.x)return e.x[pe]?new md(t):new Ed(t);if(e.qwen)return new bd(t);if(e.together)return e.together[pe]?new Sc(t):e.together.textToSpeech?new Gu(t):new Cc(t);if(e.bigModel)return e.bigModel[pe]?new bc(t):e.bigModel.textToSpeech?new zu(t):new Ec(t);if(e.groq)return e.groq.textToSpeech?new kc(t):new Zc(t);if(e.perplexity)return new Oc(t);if(e.ollama)return new pd(t);if(e.openWebUI)return new Nc(t);if(e.dify)return new Dd(t)}return n&&Object.keys(n).length>0&&!r?new tr(t):new tr(t,void 0,r||!0)}}])})(),Pi=C(function a(){E(this,a)});Pi.attibutes={string:function(i){return i},number:function(i){return parseFloat(i)},boolean:function(i){return i==="true"},object:function(i){return JSON.parse(i)},array:function(i){return JSON.parse(i)},function:function(i){return new Function("return ".concat(i))()}};var Ud=Pi;function $(a){return function(i,t){Object.defineProperty(i,t,{});var e=i.constructor,n=t.toLocaleLowerCase();e._attributes_[n]=Ud.attibutes[a],e._attributeToProperty_[n]=t}}var jd="deep-chat-downwards-mode",Hd="deep-chat-upwards-mode",Zt="submit-button",Un="loading-button",Yt="disabled-button",Xa="text-input-container-start-adjustment",Ja="text-input-container-end-adjustment",Za="text-input-container-start-small-adjustment",Ya="text-input-container-end-small-adjustment",qd=(function(){function a(i){E(this,a),this._isDisplayed=!1,this._elementRef=this.createIntroPanelWithChild(i),this._isDisplayed=!0}return C(a,[{key:"createIntroPanelWithChild",value:function(t){var e=a.createIntroPanel();return t[M].display==="none"&&(t[M].display="block"),e.appendChild(t),e}},{key:"hide",value:function(){this._isDisplayed&&(this._elementRef[M].display="none",this._isDisplayed=!1)}},{key:"display",value:function(){this._isDisplayed||(this._elementRef[M].display="",this._isDisplayed=!0)}}],[{key:"createIntroPanel",value:function(){var t=B();return t[S].add("intro-panel"),Object.assign(t[M]),t}}])})(),zd=`<?xml version="1.0" encoding="iso-8859-1"?>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 viewBox="50 30 420 450" xml:space="preserve">
<g filter="brightness(0) saturate(100%) invert(16%) sepia(0%) saturate(1942%) hue-rotate(215deg) brightness(99%) contrast(93%)">
	<g>
		<path d="M447.933,103.629c-0.034-3.076-1.224-6.09-3.485-8.352L352.683,3.511c-0.004-0.004-0.007-0.005-0.011-0.008
			C350.505,1.338,347.511,0,344.206,0H89.278C75.361,0,64.04,11.32,64.04,25.237v461.525c0,13.916,11.32,25.237,25.237,25.237
			h333.444c13.916,0,25.237-11.32,25.237-25.237V103.753C447.96,103.709,447.937,103.672,447.933,103.629z M356.194,40.931
			l50.834,50.834h-49.572c-0.695,0-1.262-0.567-1.262-1.262V40.931z M423.983,486.763c0,0.695-0.566,1.261-1.261,1.261H89.278
			c-0.695,0-1.261-0.566-1.261-1.261V25.237c0-0.695,0.566-1.261,1.261-1.261h242.94v66.527c0,13.916,11.322,25.239,25.239,25.239
			h66.527V486.763z"/>
	</g>
</g>
<g>
	<g>
		<path d="M362.088,164.014H149.912c-6.62,0-11.988,5.367-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175
			c6.62,0,11.988-5.368,11.988-11.988C374.076,169.381,368.707,164.014,362.088,164.014z"/>
	</g>
</g>
<g>
	<g>
		<path d="M362.088,236.353H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175
			c6.62,0,11.988-5.368,11.988-11.988C374.076,241.721,368.707,236.353,362.088,236.353z"/>
	</g>
</g>
<g>
	<g>
		<path d="M362.088,308.691H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988h212.175
			c6.62,0,11.988-5.367,11.988-11.988C374.076,314.06,368.707,308.691,362.088,308.691z"/>
	</g>
</g>
<g>
	<g>
		<path d="M256,381.031H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988H256
			c6.62,0,11.988-5.367,11.988-11.988C267.988,386.398,262.62,381.031,256,381.031z"/>
	</g>
</g>
</svg>`,Yn=(function(){function a(){E(this,a)}return C(a,null,[{key:"createImage",value:function(t,e){var n=new Image;return n[N]=t[N],e&&Ze.scrollDownOnImageLoad(n[N],e),Ze.processContent(le,n,n[N],t.name)}},{key:"createImageMessage",value:function(t,e,n,r){var s=t.createNewMessageElement("",n),o=r?t.scrollToFirstElement.bind(t,n,r):void 0,l=a.createImage(e,o);return s.bubbleElement.appendChild(l),s.bubbleElement[S].add(a.IMAGE_BUBBLE_CLASS),{type:le,elements:s}}},{key:"createAudioElement",value:function(t,e){var n=B(ee);return n[N]=t[N],n[S].add("audio-player"),n.controls=!0,Ye.IS_SAFARI&&(n[S].add("audio-player-safari"),n[S].add(e===Z?"audio-player-safari-end":"audio-player-safari-start")),n}},{key:"autoPlayAudio",value:function(t){t.addEventListener("loadeddata",function(){t.play().catch(function(e){console.warn("Auto-play failed:",e)})})}},{key:"createNewAudioMessage",value:function(t,e,n,r){var s=a.createAudioElement(e,n),o=t.createMessageElementsOnOrientation("",n,r);return o.bubbleElement.appendChild(s),o.bubbleElement[S].add(a.AUDIO_BUBBLE_CLASS),{type:ee,elements:o,audioElement:s}}},{key:"createAnyFile",value:function(t){var e=B();e[S].add("any-file-message-contents");var n=B();n[S].add("any-file-message-icon-container");var r=lt.createSVGElement(zd);r[S].add("any-file-message-icon"),n.appendChild(r);var s=B();return s[S].add("any-file-message-text"),s.textContent=t.name||ve,e.appendChild(n),e.appendChild(s),Ze.processContent(Ct,e,t[N],s.textContent)}},{key:"createNewAnyFileMessage",value:function(t,e,n,r){var s=t.createMessageElementsOnOrientation("",n,r),o=a.createAnyFile(e);return s.bubbleElement[S].add(a.ANY_FILE_BUBBLE_CLASS),s.bubbleElement.appendChild(o),{type:ve,elements:s}}},{key:"createMessages",value:function(t,e,n,r){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return e.map(function(o,l){var u;if(o.ref&&(o=Ze.removeFileRef(o)),Ze.isAudioFile(o)){var c=a.createNewAudioMessage(t,o,n,s),d=(u=t.textToSpeech)==null?void 0:u.audio;return d&&(d.autoPlay&&a.autoPlayAudio(c.audioElement),typeof d.displayAudio=="boolean"&&!d.displayAudio)?void 0:c}return Ze.isImageFile(o)?a.createImageMessage(t,o,n,!s&&r&&l===0):a.createNewAnyFileMessage(t,o,n,s)}).filter(function(o){return o!==void 0})}},{key:"addMessages",value:function(t,e,n,r,s){a.createMessages(t,e,n,r,s).filter(function(o){return o!==void 0}).forEach(function(o){var l=o.type,u=o.elements;Ze.addMessage(t,u,l,n,s)})}}])})();Yn.IMAGE_BUBBLE_CLASS="image-message",Yn.AUDIO_BUBBLE_CLASS="audio-message",Yn.ANY_FILE_BUBBLE_CLASS="any-file-message";var xi=Yn,Wd=(function(){function a(){E(this,a)}return C(a,null,[{key:"removeElements",value:function(t,e){if(e){var n=t.findIndex(function(r){return r===e});t.splice(n,1),e==null||e.outerContainer.remove()}}},{key:"removeFilesMessages",value:function(t,e){var n;(n=e[1][T])==null||n.forEach(function(r){a.removeElements(t.messageElementRefs,r)}),delete e[0][T],delete e[1][T]}},{key:"removeTextHTMLMessage",value:function(t,e,n){var r=e[1][n];a.removeElements(t.messageElementRefs,r),delete e[0][n],delete e[1][n]}},{key:"updateHTMLMessage",value:function(t,e,n){var r,s,o;if(e[1][V])ft.overwriteElements(t,n,e[1][V]);else{var l=ft.create(t,n,e[0][P]),u=((s=e[1][T])==null?void 0:s[((r=e[1][T])==null?void 0:r.length)-1])||e[1][y],c=u.outerContainer.nextSibling;(o=c==null?void 0:c.parentElement)==null||o.insertBefore(l.outerContainer,c),t.messageElementRefs.splice(t.messageElementRefs.length-1,1);var d=t.messageElementRefs.findIndex(function(h){return h===u});t.messageElementRefs.splice(d+1,0,l),e[1][V]=l}e[0][V]=n}},{key:"updateFileMessages",value:function(t,e,n){var r,s,o=e[0][P],l=xi.createMessages(t,n,o,!1),u=e[1][V],c=((s=e[1][T])==null?void 0:s[((r=e[1][T])==null?void 0:r.length)-1])||e[1][y],d=u||c,h=t.messageElementRefs.findIndex(function(g){return g===d});c&&(h+=1);var p=(u==null?void 0:u.outerContainer)||(c==null?void 0:c.outerContainer.nextSibling);l.forEach(function(g,m){var b=g.type,k=g.elements,A;Ze.setElementProps(t,k,b,o),(A=p.parentElement)==null||A.insertBefore(k.outerContainer,p),t.messageElementRefs.splice(t.messageElementRefs.length-1,1),t.messageElementRefs.splice(h+m,0,k)}),a.removeFilesMessages(t,e),e[1][T]=l.map(function(g){var m=g.elements;return m}),e[0][T]=n}},{key:"updateTextMessage",value:function(t,e,n){var r,s;if(e[1][y])t.renderText(e[1][y].bubbleElement,n,e[0][P]);else{var o=t.createElements(n,e[0][P]),l=((r=e[1][T])==null?void 0:r[0])||e[1][V];(s=l.outerContainer.parentElement)==null||s.insertBefore(o.outerContainer,l.outerContainer);var u=t.messageElementRefs.findIndex(function(c){return c===l});t.messageElementRefs.splice(u,0,o),e[1][y]=o}e[0][y]=n}},{key:"isElementActive",value:function(t){var e,n;return $r.isActiveElement((e=t[y])==null?void 0:e.bubbleElement[S])||$r.isActiveElement((n=t[V])==null?void 0:n.bubbleElement[S])}},{key:"update",value:function(t,e,n){var r=t.messageToElements[n];if(r){if(a.isElementActive(r[1]))return console[_]("Cannot update a message that is being streamed");e[y]&&a.updateTextMessage(t,r,e[y]),e[T]?a.updateFileMessages(t,r,e[T]):a.removeFilesMessages(t,r),e[V]&&a.updateHTMLMessage(t,r,e[V]),!e[y]&&r[1][y]&&a.removeTextHTMLMessage(t,r,y),!e[V]&&r[1][V]&&a.removeTextHTMLMessage(t,r,V);var s=t.messageElementRefs,o=t.avatar,l=t.name;ge.classifyRoleMessages(s),ge.resetAllRoleElements(s,o,l)}else console[_]("Message index not found. Please use the `getMessages` method to find the correct index")}}])})(),Gd=(function(){function a(){E(this,a)}return C(a,null,[{key:"getText",value:function(t,e){var n,r;if(!t.directConnection&&!t.connect&&!t.webModel&&!t.demo)return"Connect to any API using the [connect](".concat(ue,"connect#connect-1) property or a popular service via [directConnection](").concat(ue,`directConnection/#directConnection).
 Host AI entirely on your browser via a [webModel](`).concat(ue,`webModel).
 To get started checkout the [Start](https://deepchat.dev/start) page and live code [examples](https://deepchat.dev/examples/frameworks).
 To remove this message set the [demo](`).concat(ue,"modes#demo) property to true.");if(t.directConnection){if(!e.isDirectConnection())return`Please define a valid service inside
          the [directConnection](`.concat(ue,"directConnection/#directConnection) object.");var s=(n=t.directConnection.openAI)==null?void 0:n.chat;if(R(s)=="object"&&(r=s.tools)!=null&&r.find(function(o){return o.type==="function"})&&!s.function_handler)return"Please define the `function_handler` property inside the openAI [chat](".concat(ue,"directConnection/openAI#Chat) object.")}else if(t.connect&&!t.connect.url&&!t.connect.handler)return"Please define a `url` or a `handler` property inside the [connect](".concat(ue,"connect#connect-1) object.");return null}}])})(),$r=(function(a){function i(t,e,n){var r;E(this,i);var s,o;r=F(this,i,[t]);var l=e.permittedErrorPrefixes,u=e.demo;r._errorMessageOverrides=(s=t.errorMessages)==null?void 0:s.overrides,r._onClearMessages=Mt.onClearMessages.bind(r,t),r._onError=Mt.onError.bind(r,t),r._isLoadingMessageAllowed=i.getDefaultDisplayLoadingMessage(t,e),R(t.displayLoadingBubble)=="object"&&t.displayLoadingBubble.toggle&&(t.displayLoadingBubble.toggle=r.setLoadingToggle.bind(r)),r._permittedErrorPrefixes=l,r.addSetupMessageIfNeeded(t,e)||r.populateIntroPanel(n),u&&r.prepareDemo(_e.processDemo(u),t.loadHistory),r.addIntroductoryMessages(t,e);var c=new ua(t,r,e);return r._displayServiceErrorMessages=(o=t.errorMessages)==null?void 0:o.displayServiceErrorMessages,t.getMessages=function(){return ge.deepCloneMessagesWithReferences(r.messageToElements.map(function(d){var h=wt(d,1),p=h[0];return p}))},t.clearMessages=r.clearMessages.bind(r,e),t.refreshMessages=r.refreshTextMessages.bind(r,t.remarkable),t.scrollToBottom=oe.scrollToBottom.bind(r,r),t.addMessage=function(d,h){r.addAnyMessage(ie(ie({},d),{},{sendUpdate:!!h}),!h)},t.updateMessage=function(d,h){return Wd.update(r,d,h)},e.isWebModel()&&e.setUpMessages(r),t.textToSpeech&&Wn.processConfig(t.textToSpeech,function(d){r.textToSpeech=d}),r.elementRef.onscroll=w(v().m(function d(){var h,p;return v().w(function(g){for(;;)switch(g.n){case 0:t.loadHistory&&c.loadHistoryOnScroll(t.loadHistory),(h=r.scrollButton)==null||h.updateScroll(),(p=r.browserStorage)!=null&&p.trackScrollHeight&&r.browserStorage.addScrollHeight(r.elementRef.scrollTop);case 1:return g.a(2)}},d)})),r}return D(i,a),C(i,[{key:"setLoadingToggle",value:function(e){var n=this.messageElementRefs[this.messageElementRefs.length-1],r=nt.isLoadingMessage(n);if(!e&&r)this.removeLastMessage(),delete this._activeLoadingConfig;else{if(this._activeLoadingConfig&&r){var s=Le.getTargetWrapper(n.bubbleElement);if(s)return this._activeLoadingConfig=e||{},this.updateLoadingMessage(s);this.removeLastMessage()}this._activeLoadingConfig=e||{},this.addLoadingMessage(!0)}}},{key:"prepareDemo",value:function(e,n){var r;if(R(e)=="object"){if(!n&&e.displayLoading){var s=e.displayLoading.history;s!=null&&s.small&&St.addMessage(this,!1),s!=null&&s.full&&St.addMessage(this)}e.displayErrors&&(e.displayErrors[O]&&this.addNewErrorMessage("",""),e.displayErrors.service&&this.addNewErrorMessage(ye,""),e.displayErrors.speechToText&&this.addNewErrorMessage("speechToText","")),(r=e.displayLoading)!=null&&r.message&&this.addLoadingMessage(),e.response&&(this.customDemoResponse=e.response)}}},{key:"addSetupMessageIfNeeded",value:function(e,n){var r=Gd.getText(e,n);if(r){var s=this.createAndAppendNewMessageElement(r,me);this.applyCustomStyles(s,me,!1)}return!!r}},{key:"addIntroductoryMessages",value:function(e,n){var r=this;e!=null&&e.shadowRoot&&(this._introMessage=e.introMessage);var s=this._introMessage;n!=null&&n.isWebModel()&&(s!=null||(s=n.getIntroMessage(s)));var o=!(e!=null&&e.history)&&!!(e!=null&&e.loadHistory||n!=null&&n.fetchHistory);s&&(Array.isArray(s)?s.forEach(function(l,u){if(u!==0){var c=r.messageElementRefs[r.messageElementRefs.length-1].innerContainer;ge.hideRoleElements(c,r.avatar,r.name)}r.addIntroductoryMessage(l,o)}):this.addIntroductoryMessage(s,o))}},{key:"addIntroductoryMessage",value:function(e,n){var r,s;return e!=null&&e[y]?s=this.createAndAppendNewMessageElement(e[y],me):e!=null&&e[V]&&(s=ft.add(this,e[V],me)),s&&(this.applyCustomStyles(s,me,!1,(r=this.messageStyles)==null?void 0:r.intro),s.outerContainer[S].add(nt.INTRO_CLASS),n&&(s.outerContainer[M].display="none")),s}},{key:"removeIntroductoryMessage",value:function(){var e=this.messageElementRefs[0];e.outerContainer[S].contains(nt.INTRO_CLASS)&&(e.outerContainer.remove(),this.messageElementRefs.shift())}},{key:"addAnyMessage",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e[_]?this.addNewErrorMessage(ye,e[_],r):this.addNewMessage(e,n,r)}},{key:"tryAddTextMessage",value:function(e,n,r){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;e[y]!==void 0&&r[y]!==null&&(this.addNewTextMessage(e[y],e[P],n,o),!s&&this.textToSpeech&&e[P]!==Z&&Wn.speak(e[y],this.textToSpeech))}},{key:"tryAddFileMessages",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e[T]&&Array.isArray(e[T])&&xi.addMessages(this,e[T],e[P],n,r)}},{key:"tryAddHTMLMessage",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e[V]!==void 0&&e[V]!==null){var s=ft.add(this,e[V],e[P],n,r);!r&&Ht.isElementTemporary(s)&&delete e[V]}}},{key:"addNewMessage",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o,l,u,c;e[P]!==Z&&((o=this._hiddenAttachments)==null||o.removeHiddenFiles());var d=i.createMessageContent(e),h=(u=(l=this.textToSpeech)==null?void 0:l.audio)==null?void 0:u.displayText;typeof h=="boolean"&&!h&&delete d[y];var p=oe.isScrollbarAtBottomOfElement(this.elementRef),g={status:e.overwrite};return s?(this.tryAddFileMessages(d,p,s),this.tryAddHTMLMessage(d,g,s),this.tryAddTextMessage(d,g,e,r,s)):(this.tryAddTextMessage(d,g,e,r,s),this.tryAddHTMLMessage(d,g,s),this.tryAddFileMessages(d,p,s)),this.isValidMessageContent(d)&&!s&&(this.updateStateOnMessage(d,e.overwrite,e.sendUpdate,r),g.status||setTimeout(function(){return n.scrollToFirstElement(d[P],p)}),r||(c=this.browserStorage)==null||c.addMessages(this.messageToElements.map(function(m){var b=wt(m,1),k=b[0];return k})),this.scrollButton&&d[P]!==Z&&this.tryUpdateHiddenMessageCount(r,e)),this._activeLoadingConfig&&this.addLoadingMessage(!1),d}},{key:"tryUpdateHiddenMessageCount",value:function(e,n){var r=this;(!e||n.sendUpdate!==void 0)&&setTimeout(function(){var s,o;return(o=(s=r.scrollButton)==null?void 0:s.updateHidden)==null?void 0:o.call(s)})}},{key:"isValidMessageContent",value:function(e){return e[y]||e[V]||e[T]&&e[T].length>0}},{key:"updateStateOnMessage",value:function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!n){var o=ge.generateMessageBody(e,this.messageElementRefs);this.messageToElements.push([e,o])}r&&this.sendClientUpdate(e,s)}},{key:"removeMessageOnError",value:function(){var e=this.messageElementRefs[this.messageElementRefs.length-1],n=e==null?void 0:e.bubbleElement;(n!=null&&n[S].contains(ot.MESSAGE_CLASS)&&n.textContent===""||i.isTemporaryElement(e))&&this.removeLastMessage()}},{key:"addNewErrorMessage",value:function(e,n){var r=this,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o,l,u,c,d,h;(o=this._hiddenAttachments)==null||o.readdHiddenFiles(),this.removeMessageOnError();var p=this.getPermittedMessage(n)||((l=this._errorMessageOverrides)==null?void 0:l[e])||((u=this._errorMessageOverrides)==null?void 0:u[O])||"Error, please try again.",g=this.createMessageElementsOnOrientation(p,_,s);ge.hideRoleElements(g.innerContainer,this.avatar,this.name);var m=g.bubbleElement,b=g.outerContainer;m[S].add(er),this.renderText(m,p);var k=Gn.extractParticularSharedStyles(["fontSize","fontFamily"],(c=this.messageStyles)==null?void 0:c[O]);Gn.applyCustomStylesToElements(g,!1,k),Gn.applyCustomStylesToElements(g,!1,(d=this.messageStyles)==null?void 0:d[_]),s||this.appendOuterContainerElemet(b),this.textToSpeech&&Wn.speak(p,this.textToSpeech),(h=this._onError)==null||h.call(this,p),setTimeout(function(){return oe.scrollToBottom(r)})}},{key:"getPermittedMessage",value:function(e){if(e)for(var n=i.extractErrorMessages(e),r=0;r<n.length;r+=1){var s=n[r];if(typeof s=="string"){if(this._displayServiceErrorMessages)return s;if(this._permittedErrorPrefixes){var o=i.checkPermittedErrorPrefixes(this._permittedErrorPrefixes,s);if(o)return o}}}}},{key:"removeError",value:function(){this.isLastMessageError()&&ge.getLastMessageElement(this.elementRef).remove()}},{key:"addDefaultLoadingMessage",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:me,r=this.createMessageElements("",n),s=r.bubbleElement;r.bubbleElement[S].add(dt.DOTS_CONTAINER_CLASS);var o=B();return o[S].add("loading-message-dots"),s.appendChild(o),dt.setDots(s,e),r}},{key:"addLoadingMessage",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n,r,s,o,l,u;if(!(nt.isLoadingMessage(this.messageElementRefs[this.messageElementRefs.length-1])||!this._activeLoadingConfig&&!e&&!this._isLoadingMessageAllowed)){var c=((n=this._activeLoadingConfig)==null?void 0:n[P])||me,d=((r=this._activeLoadingConfig)==null?void 0:r[M])||((o=(s=this.messageStyles)==null?void 0:s.loading)==null?void 0:o.message),h=d==null?void 0:d[V],p=h?ft.createElements(this,h,c,!1):this.addDefaultLoadingMessage(d,c);this.appendOuterContainerElemet(p.outerContainer),p.bubbleElement[S].add(dt.BUBBLE_CLASS),this.applyCustomStyles(p,c,!1,d==null?void 0:d.styles),(u=(l=this.avatar)==null?void 0:l.getAvatarContainer(p.innerContainer))==null||u[S].add("loading-avatar-container"),!this.focusMode&&oe.isScrollbarAtBottomOfElement(this.elementRef)&&oe.scrollToBottom(this)}}},{key:"updateLoadingMessage",value:function(e){var n,r=(n=this._activeLoadingConfig)==null?void 0:n[M],s=r==null?void 0:r[V];e.innerHTML=s||""}},{key:"populateIntroPanel",value:function(e){e&&(this._introPanel=new qd(e),Le.apply(this,this._introPanel._elementRef),this.elementRef.appendChild(this._introPanel._elementRef))}},{key:"addMultipleFiles",value:(function(){var t=w(v().m(function n(r,s){return v().w(function(o){for(;;)if(o.n===0)return o.a(2,(this._hiddenAttachments=s,Promise.all((r||[]).map(function(l){return new Promise(function(u){if(!l.type||l.type===Ct){var c=l[ve].name||ve;u({name:c,type:Ct,ref:l[ve]})}else{var d=new FileReader;d.readAsDataURL(l[ve]),d.onload=function(){var h=l[ve].name;u(f(f(f(f({},N,d.result),"name",h),"type",l.type),"ref",l[ve]))}}})}))))},n,this)}));function e(n,r){return t.apply(this,arguments)}return e})()},{key:"clearMessages",value:function(e,n){var r,s,o,l,u,c=[];this.messageElementRefs.forEach(function(h){i.isActiveElement(h.bubbleElement[S])?c.push(h):h.outerContainer.remove()}),Array.from(this.elementRef.children).forEach(function(h){var p,g=(p=h.children[0])==null?void 0:p.children[0];g!=null&&g[S].contains(er)&&h.remove()}),this.messageElementRefs=c;var d=this.messageToElements.filter(function(h){return h[1][y]&&i.isActiveElement(h[1][y].bubbleElement[S])||h[1][V]&&i.isActiveElement(h[1][V].bubbleElement[S])});(r=this.messageToElements).splice.apply(r,[0,this.messageToElements.length].concat(_t(d))),n!==!1&&((s=this._introPanel)!=null&&s._elementRef&&this._introPanel.display(),this.addIntroductoryMessages()),(o=this.browserStorage)==null||o.clear(),(l=this.scrollButton)==null||l.clearHidden(),(u=this._onClearMessages)==null||u.call(this),delete e.sessionId}}],[{key:"getDefaultDisplayLoadingMessage",value:function(e,n){var r;return R(e.displayLoadingBubble)=="object"&&e.displayLoadingBubble.toggle?!1:n.websocket?R(e.displayLoadingBubble)===Q?!1:!!e.displayLoadingBubble:(r=R(e.displayLoadingBubble)===Q||e.displayLoadingBubble)!==null&&r!==void 0?r:!0}},{key:"checkPermittedErrorPrefixes",value:function(e,n){for(var r=0;r<e.length;r+=1)if(n.startsWith(e[r]))return n}},{key:"extractErrorMessages",value:function(e){return Array.isArray(e)?e:e instanceof Error?[e.message]:typeof e=="string"?[e]:R(e)=="object"&&e[_]?[e[_]]:[]}},{key:"isActiveElement",value:function(e){return e?e.contains(dt.BUBBLE_CLASS)||e.contains(St.CLASS)||e.contains(ot.MESSAGE_CLASS):!1}}])})(nt),Kd=(function(){function a(){E(this,a)}return C(a,null,[{key:"adjustInputPadding",value:function(t,e){e[Wt].length>0&&t[S].add("text-input-inner-start-adjustment"),e[tt].length>0&&t[S].add("text-input-inner-end-adjustment")}},{key:"adjustForOutsideButton",value:function(t,e,n){n[Re].length===0&&n[De].length>0?(t[0][S].add(Za),e[S].add(Za)):n[De].length===0&&n[Re].length>0&&(t[3][S].add(Ya),e[S].add(Ya))}},{key:"adjustOutsideSubmit",value:function(t,e,n){if(!(n[Wt].length>0||n[tt].length>0)){if(n[Re].length===0&&n[De].length>0)return t[0][S].add(Xa),e[S].add(Xa),n[De].map(function(r){return r.button.elementRef[S].add("submit-button-enlarged")});if(n[De].length===0&&n[Re].length>0)return t[3][S].add(Ja),e[S].add(Ja),n[Re].map(function(r){return r.button.elementRef[S].add("submit-button-enlarged")})}}},{key:"set",value:function(t,e,n,r){a.adjustOutsideSubmit(e,n,r)||a.adjustForOutsideButton(e,n,r),a.adjustInputPadding(t,r)}}])})(),ar=(function(){function a(){E(this,a)}return C(a,null,[{key:"create",value:function(){return Array.from({length:4}).map(function(t,e){var n=B();return n[S].add("input-button-container"),(e===0||e===3)&&n[S].add("outer-button-container"),(e===1||e===2)&&n[S].add("inner-button-container"),n})}},{key:"add",value:function(t,e){t.insertBefore(e[1],t.firstChild),t.insertBefore(e[0],t.firstChild),t.appendChild(e[2]),t.appendChild(e[3])}},{key:"getContainerIndex",value:function(t){return t===De?0:t===Wt?1:t===tt?2:3}},{key:"addButton",value:function(t,e,n){e[S].add(n);var r=a.getContainerIndex(n);t[r].appendChild(e),r===3&&e[S].add(Re)}}])})(),Qa=["camera","gifs","images","audio","mixedFiles","submit","microphone"],Vd=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" fill="none">
  <rect x="2.5" y="2.5" width="17" height="17" rx="2" stroke="#000000" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,wn=(function(){function a(){E(this,a)}return C(a,null,[{key:"addHighlightEvents",value:function(t,e){e.addEventListener("mouseenter",function(n){t.highlightedItem=n.target}),e.addEventListener("mouseleave",function(){t.highlightedItem=void 0})}},{key:"addItemEvents",value:function(t,e,n,r){or.add(e,r),e.addEventListener(de,function(){n[de]()}),a.addHighlightEvents(t,e)}},{key:"createItemText",value:function(t,e){var n=B();return Object.assign(n[M],e),n[S].add(a.TEXT_CLASS),n.textContent=t||"File",n}},{key:"createItemIcon",value:function(t,e){var n=B();return Object.assign(n[M],e),n[S].add(a.ICON_CLASS),n.appendChild(t),n}},{key:"populateItem",value:function(t,e,n){var r=t.elementRef,s=t.dropupText,o=t.svg,l=t.customStyles,u=r.children[0],c=l&&Object.values(l).find(function(d){var h;return((h=d.svg)==null?void 0:h.content)===""});u[S].contains(mt.INPUT_BUTTON_INNER_TEXT_CLASS)?(c||e.appendChild(a.createItemIcon(o,n==null?void 0:n.iconContainer)),e.appendChild(a.createItemText(u.textContent,n==null?void 0:n[y]))):(c||e.appendChild(a.createItemIcon(r.children[0],n==null?void 0:n.iconContainer)),e.appendChild(a.createItemText(s,n==null?void 0:n[y])))}},{key:"createItem",value:function(t,e,n){var r,s=B();Object.assign(s[M],(r=n==null?void 0:n.item)==null?void 0:r[O]),a.populateItem(e,s,n),s[S].add(a.MENU_ITEM_CLASS),s.tabIndex=0;var o=e.elementRef;if(e.isCustom)e.setDropupItem(t,s);else{var l=Me.processStateful((n==null?void 0:n.item)||{});a.addItemEvents(t,s,o,l)}return s}}])})();wn.MENU_ITEM_CLASS="dropup-menu-item",wn.CUSTOM_BUTTON_ITEM_CLASS="dropup-menu-item-custom-button",wn.TEXT_CLASS="dropup-menu-item-text",wn.ICON_CLASS="dropup-menu-item-icon";var it=wn,Dt=(function(a){function i(t,e,n,r){var s;E(this,i);var o,l,u,c,d,h,p=((c=(u=(l=(o=t==null?void 0:t.styles)==null?void 0:o.button)==null?void 0:l[O])==null?void 0:u[y])==null?void 0:c.content)||"Custom ".concat(e),g=Vd,m=ut.tryCreateConfig("Custom ".concat(e),t==null?void 0:t.tooltip);return s=F(this,i,[i.createButtonElement(),g,t==null?void 0:t.position,m,((d=t==null?void 0:t.styles)==null?void 0:d.button)||m&&{},p]),s._state=O,s.isCustom=!0,s._innerElements=s.createInnerElementsForStates(s.customStyles),s._menuStyles=r,s._onClick=t.onClick,s._dropupStyles=(h=t.styles)==null?void 0:h.dropup,s.setSetState(t),s.addClickListener(n),s.changeState(t.initialState,!0),s}return D(i,a),C(i,[{key:"createInnerElementsForStates",value:function(e){var n="custom-icon",r=this.createInnerElements(n,O,e);return f(f(f({},O,r),re,this.genStateInnerElements(n,re,r,e)),ae,this.genStateInnerElements(n,ae,r,e))}},{key:"setSetState",value:function(e){var n=this;e.setState=function(r){r===O&&n.changeToDefault(),r===re&&n.changeToActive(),r===ae&&n.changeToDisabled()}}},{key:"addClickListener",value:function(e){var n=this;oe.assignButtonEvents(this.elementRef,function(){var r,s=(r=n._onClick)==null?void 0:r.call(n,n._state);e==null||e(),(s===O||s===re||s===ae)&&n.changeState(s)})}},{key:"changeState",value:function(e,n){e===ae?this.changeToDisabled(n):e===re?this.changeToActive(n):this.changeToDefault(n)}},{key:"applyDropupContentStyles",value:function(e){var n=Array.from(this.elementRef.children);if(e!=null&&e[y]){var r=n.find(function(o){return o[S].contains(it.TEXT_CLASS)});r&&Object.assign(r[M],e[y])}if(e!=null&&e.iconContainer){var s=n.find(function(o){return o[S].contains(it.ICON_CLASS)});s&&Object.assign(s[M],e.iconContainer)}}},{key:"resetDropupItem",value:function(e){var n,r,s;this.elementRef=Le.replaceElementWithNewClone(this.elementRef,this._originalElementRef),this.elementRef.innerHTML="",((n=e==null?void 0:e.svg)==null?void 0:n.content)===""||this.elementRef.appendChild(it.createItemIcon(this.svg,(r=this._menuStyles)==null?void 0:r.iconContainer)),this.elementRef.appendChild(it.createItemText(this.dropupText,(s=this._menuStyles)==null?void 0:s[y]))}},{key:"assignDropupItemStyle",value:function(e,n){var r;this.elementRef.parentElement&&this._originalElementRef&&this.resetDropupItem(n),it.addHighlightEvents(this._menu,this.elementRef),this.applyDropupContentStyles(e),Object.assign(this.elementRef[M],(r=e==null?void 0:e.item)==null?void 0:r[O]);var s=Me.processStateful((e==null?void 0:e.item)||{});or.add(this.elementRef,s),this.addClickListener()}},{key:"changeToDefault",value:function(e){var n,r,s,o,l,u;!e&&this._state===O||(this.elementRef[S].contains(it.MENU_ITEM_CLASS)?this.assignDropupItemStyle((n=this._dropupStyles)==null?void 0:n[O],(r=this.customStyles)==null?void 0:r[O]):(this.changeElementsByState(this._innerElements[O]),(s=this.customStyles)!=null&&s[re]&&Ue.unsetAllCSS(this.elementRef,(o=this.customStyles)==null?void 0:o[re]),(l=this.customStyles)!=null&&l[ae]&&Ue.unsetAllCSS(this.elementRef,(u=this.customStyles)==null?void 0:u[ae]),this.reapplyStateStyle(O,[re,ae])),this.elementRef[S].remove(i.DISABLED_CONTAINER_CLASS,i.ACTIVE_CONTAINER_CLASS),this.elementRef[S].add(i.DEFAULT_CONTAINER_CLASS),Pe.removeAriaDisabled(this.elementRef),this._state=O)}},{key:"changeToActive",value:function(e){var n,r;!e&&this._state===re||(this.elementRef[S].contains(it.MENU_ITEM_CLASS)?this.assignDropupItemStyle((n=this._dropupStyles)==null?void 0:n[re],(r=this.customStyles)==null?void 0:r[re]):(this.changeElementsByState(this._innerElements[re]),this.reapplyStateStyle(re,[ae,O])),this.elementRef[S].remove(i.DISABLED_CONTAINER_CLASS,i.DEFAULT_CONTAINER_CLASS),this.elementRef[S].add(i.ACTIVE_CONTAINER_CLASS),Pe.removeAriaDisabled(this.elementRef),this._state=re)}},{key:"changeToDisabled",value:function(e){var n,r,s,o,l,u;!e&&this._state===ae||(this.elementRef[S].contains(it.MENU_ITEM_CLASS)?this.assignDropupItemStyle((n=this._dropupStyles)==null?void 0:n[ae],(r=this.customStyles)==null?void 0:r[ae]):(this.changeElementsByState(this._innerElements[ae]),(s=this.customStyles)!=null&&s[re]&&Ue.unsetAllCSS(this.elementRef,(o=this.customStyles)==null?void 0:o[re]),(l=this.customStyles)!=null&&l[O]&&Ue.unsetAllCSS(this.elementRef,(u=this.customStyles)==null?void 0:u[O]),this.reapplyStateStyle(ae,[O,re])),this.elementRef[S].remove(i.ACTIVE_CONTAINER_CLASS,i.DEFAULT_CONTAINER_CLASS),this.elementRef[S].add(i.DISABLED_CONTAINER_CLASS),Pe.addAriaDisabled(this.elementRef),this._state=ae)}},{key:"setDropupItem",value:function(e,n){this._menu=e,this.elementRef=n,this._originalElementRef=n.cloneNode(!0),this.changeState(this._state,!0)}},{key:"genStateInnerElements",value:function(e,n,r,s){var o,l,u,c,d=this.createInnerElements(e,n,s),h=(l=(o=s==null?void 0:s[n])==null?void 0:o.svg)==null?void 0:l.content,p=(c=(u=s==null?void 0:s[n])==null?void 0:u[y])==null?void 0:c.content;if(h===void 0||p===void 0){var g=Cn.parseSVGTextElements(r),m=g.svg,b=g[y],k=Cn.parseSVGTextElements(d),A=k.svg,I=k[y],x=[];i.addToInnerElements(x,h,m,A),i.addToInnerElements(x,p,b,I),d=x}return d}}],[{key:"createButtonElement",value:function(){var e=B();return e[S].add("input-button",i.BUTTON_CLASS),e}},{key:"addToInnerElements",value:function(e,n,r,s){n===void 0&&r?e.push(r.cloneNode(!0)):s&&e.push(s)}},{key:"add",value:function(e,n){var r=e.customButtons,s=e.focusInput,o=e.dropupStyles;r==null||r.forEach(function(l,u){var c={button:new i(l,u+1,s,o==null?void 0:o.menu)};n["".concat(i.INDICATOR_PREFIX).concat(u+1)]=c})}}])})(Bt);Dt.INDICATOR_PREFIX="custom",Dt.BUTTON_CLASS="custom-button",Dt.DISABLED_CONTAINER_CLASS="custom-button-container-disabled",Dt.DEFAULT_CONTAINER_CLASS="custom-button-container-default",Dt.ACTIVE_CONTAINER_CLASS="custom-button-container-active";var Tn=Dt,$d=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M16 0c-8.836 0-16 7.163-16 16s7.163 16 16 16c8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 30.032c-7.72 0-14-6.312-14-14.032s6.28-14 14-14 14 6.28 14 14-6.28 14.032-14 14.032zM23 15h-6v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1v6h-6c-0.552 0-1 0.448-1 1s0.448 1 1 1h6v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6h6c0.552 0 1-0.448 1-1s-0.448-1-1-1z"></path>
</svg>`,es=(function(){function a(){E(this,a)}return C(a,null,[{key:"focusItemWhenOnEdge",value:function(t,e){var n=t.elementRef,r=e?n.children[0]:n.children[n.children.length-1];a.focusSiblingItem(t,r,e,!0)}},{key:"focusSiblingItem",value:function(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=r?e:e[n?"nextSibling":"previousSibling"];s?(e.dispatchEvent(new MouseEvent("mouseleave")),s.dispatchEvent(new MouseEvent("mouseenter")),s.focus()):(e.dispatchEvent(new MouseEvent("mouseleave")),a.focusItemWhenOnEdge(t,n))}}])})(),Xd=(function(){function a(i,t){var e=this;E(this,a);var n;this._isOpen=!0,this._styles=t,this.elementRef=a.createElement((n=this._styles)==null?void 0:n.container),this.close(),setTimeout(function(){return e.addWindowEvents(i)})}return C(a,[{key:"open",value:function(){this.elementRef[M].display="block",this._isOpen=!0}},{key:"close",value:function(){this._isOpen&&(this.elementRef[M].display="none",this._isOpen=!1)}},{key:"toggle",value:function(){this._isOpen?this.close():this.open()}},{key:"addItem",value:function(t){var e=it.createItem(this,t,this._styles);this.elementRef.appendChild(e)}},{key:"addWindowEvents",value:function(t){this.clickEvent=this.windowClick.bind(this,t),window.addEventListener(de,this.clickEvent),this.keyDownEvent=this.windowKeyDown.bind(this,t),window.addEventListener("keydown",this.keyDownEvent)}},{key:"windowClick",value:function(t,e){var n;!t.isConnected&&this.clickEvent?window.removeEventListener(de,this.clickEvent):t.parentElement!==((n=e.target.shadowRoot)==null?void 0:n.children[0])&&this.close()}},{key:"windowKeyDown",value:function(t,e){var n,r,s;!t.isConnected&&this.keyDownEvent?window.removeEventListener("keydown",this.keyDownEvent):this._isOpen&&(e.key===Ae.ESCAPE?(this.close(),(n=this.highlightedItem)==null||n.dispatchEvent(new MouseEvent("mouseleave"))):e.key===Ae.ENTER?((r=this.highlightedItem)==null||r[de](),(s=this.highlightedItem)==null||s.dispatchEvent(new MouseEvent("mouseleave"))):e.key===Ae.ARROW_DOWN?es.focusSiblingItem(this,this.highlightedItem||this.elementRef.children[this.elementRef.children.length-1],!0):e.key===Ae.ARROW_UP&&es.focusSiblingItem(this,this.highlightedItem||this.elementRef.children[0],!1))}}],[{key:"createElement",value:function(t){var e=B();return e.id=Je,Object.assign(e[M],t),e}}])})(),Bi=(function(a){function i(t,e){var n;E(this,i);var r,s,o=ut.tryCreateConfig("Options",(r=e==null?void 0:e.button)==null?void 0:r.tooltip);n=F(this,i,[i.createButtonElement(),$d,void 0,o,{styles:(s=e==null?void 0:e.button)==null?void 0:s.styles}]);var l=n.createInnerElementsForStates(n.customStyles);return n._menu=new Xd(t,e==null?void 0:e.menu),n.addClickEvent(),n.buttonContainer=i.createButtonContainer(),n.changeElementsByState(l.styles),n.buttonContainer.appendChild(n.elementRef),n.elementRef[S].add(i.BUTTON_ICON_CLASS),n.buttonContainer.appendChild(n._menu.elementRef),n.reapplyStateStyle("styles"),n.addContainerEvents(t),n}return D(i,a),C(i,[{key:"createInnerElementsForStates",value:function(e){return{styles:this.createInnerElements("dropup-icon","styles",e)}}},{key:"addClickEvent",value:function(){var e=this;this.elementRef.onclick=this._menu.toggle.bind(this._menu),this.elementRef.onkeydown=function(n){n.key===Ae.ENTER&&setTimeout(function(){e._menu.toggle();var r=e._menu.elementRef.children[0];r.focus(),r.dispatchEvent(new MouseEvent("mouseenter"))})}}},{key:"addItem",value:function(e){this._menu.addItem(e)}},{key:"addContainerEvents",value:function(e){var n=this;e.addEventListener(de,function(r){var s=r.target[S];!s.contains(i.BUTTON_ICON_CLASS)&&!s.contains(Tn.DISABLED_CONTAINER_CLASS)&&n._menu.close()})}}],[{key:"createButtonElement",value:function(){var e=B();return e[S].add("input-button"),e}},{key:"createButtonContainer",value:function(){var e=B();return e.id="dropup-container",e}},{key:"getPosition",value:function(e,n){var r,s;return(r=n==null?void 0:n.button)!=null&&r.position?_e.processPosition((s=n==null?void 0:n.button)==null?void 0:s.position):e[De].length>0&&e[Re].length===0?Re:De}}])})(Bt);Bi.BUTTON_ICON_CLASS="dropup-button";var ts=Bi,Jd=(function(){function a(){E(this,a)}return C(a,null,[{key:"addToDropup",value:function(t,e,n,r){var s=new ts(n,r);Qa.forEach(function(l){var u=e[Je].findIndex(function(d){return d.buttonType===l}),c=e[Je][u];c&&(s.addItem(c.button),e[Je].splice(u,1))}),e[Je].forEach(function(l){var u=l.button;return s.addItem(u)});var o=ts.getPosition(e,r);ar.addButton(t,s.buttonContainer,o),e[o].push({})}},{key:"addToSideContainer",value:function(t,e){[Wt,tt,De,Re].forEach(function(n){var r=n;e[r].forEach(function(s){ar.addButton(t,s.button.elementRef,r)})})}},{key:"setPosition",value:function(t,e,n){var r=ie(ie({},t[e]),{},{buttonType:e});n.push(r),delete t[e]}},{key:"createPositionsToButtonsObj",value:function(){return f(f(f(f(f({},Je,[]),De,[]),Wt,[]),tt,[]),Re,[])}},{key:"generatePositionToButtons",value:function(t){var e=a.createPositionsToButtonsObj();Object.keys(t).forEach(function(r){var s,o=(s=t[r])==null?void 0:s.button.position;o&&a.setPosition(t,r,e[o])}),e[tt].length===0&&t.submit&&a.setPosition(t,"submit",e[tt]),e[Re].length===0&&(t.submit?a.setPosition(t,"submit",e[Re]):t.microphone?a.setPosition(t,et,e[Re]):t.camera?a.setPosition(t,je,e[Re]):t["".concat(Tn.INDICATOR_PREFIX,"1")]&&a.setPosition(t,"".concat(Tn.INDICATOR_PREFIX,"1"),e[Re])),t.submit&&a.setPosition(t,"submit",e[De].length===0?e[De]:e[tt]),t.microphone&&a.setPosition(t,et,e[De].length===0?e[De]:e[tt]);var n=Object.keys(t);return n.length>1||e[Je].length>0?(Qa.forEach(function(r){t[r]&&e[Je].push(ie(ie({},t[r]),{},{buttonType:r}))}),n.forEach(function(r){var s=r;s.startsWith(Tn.INDICATOR_PREFIX)&&t[s]&&e[Je].push(ie(ie({},t[s]),{},{customType:s}))})):n.length===1&&a.setPosition(t,n[0],e[Re].length===0?e[Re]:e[De]),e}},{key:"addButtons",value:function(t,e,n,r){var s=a.generatePositionToButtons(e);return a.addToSideContainer(t,s),s[Je].length>0&&a.addToDropup(t,s,n,r),s}}])})(),Zd=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M20 10.9696L11.9628 18.5497C10.9782 19.4783 9.64274 20 8.25028 20C6.85782 20 5.52239 19.4783 4.53777 18.5497C3.55315 17.6211 3 16.3616 3 15.0483C3 13.7351 3.55315 12.4756 4.53777 11.547L12.575 3.96687C13.2314 3.34779 14.1217 3 15.05 3C15.9783 3 16.8686 3.34779 17.525 3.96687C18.1814 4.58595 18.5502 5.4256 18.5502 6.30111C18.5502 7.17662 18.1814 8.01628 17.525 8.63535L9.47904 16.2154C9.15083 16.525 8.70569 16.6989 8.24154 16.6989C7.77738 16.6989 7.33224 16.525 7.00403 16.2154C6.67583 15.9059 6.49144 15.4861 6.49144 15.0483C6.49144 14.6106 6.67583 14.1907 7.00403 13.8812L14.429 6.88674" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,Yd=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path d="M20,15.2928932 L20,5.5 C20,4.67157288 19.3284271,4 18.5,4 L5.5,4 C4.67157288,4 4,4.67157288 4,5.5 L4,12.2928932 L7.14644661,9.14644661 C7.34170876,8.95118446 7.65829124,8.95118446 7.85355339,9.14644661 L13.5,14.7928932 L16.1464466,12.1464466 C16.3417088,11.9511845 16.6582912,11.9511845 16.8535534,12.1464466 L20,15.2928932 Z M20,16.7071068 L16.5,13.2071068 L13.8535534,15.8535534 C13.6582912,16.0488155 13.3417088,16.0488155 13.1464466,15.8535534 L7.5,10.2071068 L4,13.7071068 L4,18.5 C4,19.3284271 4.67157288,20 5.5,20 L18.5,20 C19.3284271,20 20,19.3284271 20,18.5 L20,16.7071068 Z M3,5.5 C3,4.11928813 4.11928813,3 5.5,3 L18.5,3 C19.8807119,3 21,4.11928813 21,5.5 L21,18.5 C21,19.8807119 19.8807119,21 18.5,21 L5.5,21 C4.11928813,21 3,19.8807119 3,18.5 L3,5.5 Z M15,6 L17,6 C17.5522847,6 18,6.44771525 18,7 L18,9 C18,9.55228475 17.5522847,10 17,10 L15,10 C14.4477153,10 14,9.55228475 14,9 L14,7 C14,6.44771525 14.4477153,6 15,6 Z M15,7 L15,9 L17,9 L17,7 L15,7 Z"/>
</svg>
`,Qd=`<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-49.49 -49.49 593.87 593.87" stroke-width="3.95908" transform="rotate(0)">
  <g stroke-width="0"></g>
  <g stroke-linecap="round" stroke-linejoin="round" stroke-width="0.98977"></g>
  <g>
    <g>
      <g>
        <path d="M163.205,76.413v293.301c-3.434-3.058-7.241-5.867-11.486-8.339c-21.38-12.452-49.663-15.298-77.567-7.846 c-49.038,13.096-80.904,54.519-71.038,92.337c4.019,15.404,14.188,28.221,29.404,37.087c13.553,7.894,29.87,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.447-4.087c42.74-11.406,72.411-44.344,72.807-77.654h0.011v-0.162c0.002-0.166,0-0.331,0-0.496V187.072 l290.971-67.3v178.082c-3.433-3.055-7.238-5.863-11.481-8.334c-21.385-12.452-49.654-15.308-77.567-7.846 c-49.038,13.087-80.904,54.519-71.038,92.356c4.019,15.385,14.183,28.212,29.404,37.067c13.548,7.894,29.875,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.452-4.087c42.74-11.413,72.411-44.346,72.804-77.654h0.004v-0.065c0.003-0.236,0.001-0.469,0-0.704V0 L163.205,76.413z M104.999,471.779c-22.543,6.038-45.942,3.846-62.572-5.846c-10.587-6.163-17.591-14.817-20.255-25.038 c-7.144-27.375,18.452-58.029,57.062-68.346c8.409-2.25,16.938-3.346,25.188-3.346c13.87,0,26.962,3.115,37.389,9.192 c10.587,6.163,17.591,14.817,20.255,25.029c0.809,3.102,1.142,6.248,1.139,9.4v0.321h0.014 C162.99,437.714,139.082,462.678,104.999,471.779z M182.898,166.853V92.067l290.971-67.298v74.784L182.898,166.853z M415.677,399.923c-22.558,6.038-45.942,3.837-62.587-5.846c-10.587-6.163-17.587-14.817-20.25-25.019 c-7.144-27.385,18.452-58.058,57.058-68.365c8.414-2.25,16.942-3.346,25.192-3.346c13.875,0,26.962,3.115,37.385,9.192 c10.596,6.163,17.596,14.817,20.26,25.029v0.01c0.796,3.05,1.124,6.144,1.135,9.244v0.468h0.02 C473.668,365.851,449.763,390.814,415.677,399.923z">
        </path>
      </g>
    </g>
  </g>
</svg>`,eh=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 5.9266752 5.6408391" height="21.31971" width="22.4">
  <g>
    <path d="m 5.2564627,1.548212 c -3.1136005,-0.4796804 -1.5568006,-0.2398402 0,0 z M 2.0001198,2.0922063 c 0.1556781,0 0.2657489,0.020893 0.3917849,0.080366 0.081154,0.038347 0.1153492,0.134065 0.076377,0.2138602 -0.038973,0.07979 -0.1363527,0.1134129 -0.2175069,0.075091 -0.078199,-0.036919 -0.1407455,-0.048792 -0.250655,-0.048792 -0.2260486,0 -0.3921482,0.2042182 -0.3921482,0.4801409 0,0.2761822 0.1663188,0.4810688 0.3921482,0.4810688 0.1117901,0 0.2064255,-0.046133 0.255659,-0.1284198 l 0.00162,-0.00389 V 3.0534032 l -0.098011,1.75e-4 c -0.081844,0 -0.1495979,-0.059305 -0.1612403,-0.1365887 l -0.00175,-0.023683 c 0,-0.08047 0.060311,-0.1470874 0.1389194,-0.1585331 l 0.024085,-0.00195 h 0.2612303 c 0.081842,0 0.149598,0.059305 0.1612404,0.1365891 l 0.00175,0.023683 -3.398e-4,0.3968809 v 0 l -0.00168,0.014211 v 0 l -0.00553,0.023034 v 0 l -0.00532,0.014145 c -0.098178,0.22826 -0.3236506,0.3528713 -0.5706303,0.3528713 -0.4240855,0 -0.7181621,-0.3622714 -0.7181621,-0.8016063 0,-0.4391857 0.2940275,-0.8006848 0.7181621,-0.8006848 z m 1.2034759,0.031275 c 0.081843,0 0.1495977,0.059305 0.1612403,0.1365891 l 0.00175,0.023683 v 1.2211775 c 0,0.088516 -0.07298,0.1602721 -0.1630073,0.1602721 -0.081841,0 -0.1495972,-0.059305 -0.1612397,-0.1365892 L 3.040589,3.5049308 V 2.2837527 c 0,-0.088516 0.07298,-0.1602721 0.1630067,-0.1602714 z m 0.7813442,0 0.5209469,0.00195 c 0.090025,3.048e-4 0.1627543,0.072306 0.1624458,0.1608234 -2.809e-4,0.08047 -0.06083,0.1468798 -0.1394772,0.158066 l -0.024092,0.00195 -0.3575326,-0.0013 v 0.4497782 l 0.2928918,2.27e-4 c 0.081842,0 0.1495979,0.059305 0.1612403,0.136589 l 0.00175,0.023683 c 0,0.080469 -0.06031,0.1470871 -0.1389193,0.1585393 l -0.024092,0.00195 -0.2928919,-2.336e-4 1.563e-4,0.2860316 c 0,0.080471 -0.06031,0.1470873 -0.1389193,0.1585395 l -0.024085,0.00195 c -0.081843,0 -0.1495979,-0.059305 -0.1612403,-0.1365826 l -0.00175,-0.023691 V 2.2841354 c 2.798e-4,-0.08047 0.060829,-0.1468797 0.1394758,-0.1580594 z"/>
    <path d="m 5.0894191,1.0943261 c 0,-0.21918999 -0.177687,-0.39686999 -0.396876,-0.39686999 h -3.43959 c -0.2191879,0 -0.391262,0.1777519 -0.3968759,0.39686999 l -0.027082,3.4379266 c 0.040152,0.2939927 0.4235456,0.409415 0.4235456,0.409415 l 3.4785583,-0.00851 c 0,0 0.3008506,-0.1402998 0.3236271,-0.4201576 0.042911,-0.5272495 0.034693,-1.6106146 0.034693,-3.4186761 z m -4.49792494,0 c 0,-0.36530999 0.29614504,-0.66145999 0.66145894,-0.66145999 h 3.43959 c 0.365314,0 0.66146,0.29615 0.66146,0.66145999 v 3.43959 c 0,0.36532 -0.296146,0.66146 -0.66146,0.66146 h -3.43959 c -0.3653139,0 -0.66145894,-0.29614 -0.66145894,-0.66146 z"/>
  </g>
</svg>
`,th=f(f(f(f({},pe,{id:"upload-images-icon",svgString:Yd,dropupText:"Image"}),Ut,{id:"upload-gifs-icon",svgString:eh,dropupText:"GIF"}),ee,{id:"upload-audio-icon",svgString:Qd,dropupText:"Audio"}),"mixedFiles",{id:"upload-mixed-files-icon",svgString:Zd,dropupText:"File"}),Oi=(function(a){function i(t){var e;E(this,i),(t==null?void 0:t.position)===Je&&(t.position=Re);var n=ut.tryCreateConfig("Microphone",t==null?void 0:t.tooltip);return e=F(this,i,[i.createMicrophoneElement(),mi,t==null?void 0:t.position,n,t]),e.isActive=!1,e._innerElements=e.createInnerElementsForStates(e.customStyles),e.changeToDefault(),e}return D(i,a),C(i,[{key:"createInnerElementsForStates",value:function(e){var n="microphone-icon";return f(f(f(f({},O,this.createInnerElements(n,O,e)),re,this.createInnerElements(n,re,e)),"unsupported",this.createInnerElements(n,"unsupported",e)),"commandMode",this.createInnerElements(n,"commandMode",e))}},{key:"changeToActive",value:function(){this.changeElementsByState(this._innerElements[re]),this.toggleIconFilter(re),this.reapplyStateStyle(re,[O,"commandMode"]),this.isActive=!0}},{key:"changeToDefault",value:function(){this.changeElementsByState(this._innerElements[O]),this.toggleIconFilter(O),this.reapplyStateStyle(O,[re,"commandMode"]),this.isActive=!1}},{key:"changeToCommandMode",value:function(){this.changeElementsByState(this._innerElements.commandMode),this.toggleIconFilter("command"),this.reapplyStateStyle("commandMode",[re])}},{key:"changeToUnsupported",value:function(){this.changeElementsByState(this._innerElements.unsupported),this.elementRef[S].add("unsupported-microphone"),this.reapplyStateStyle("unsupported",[re])}},{key:"toggleIconFilter",value:function(e){var n=this.elementRef.children[0];if(n.tagName.toLocaleLowerCase()==="svg")switch(e){case O:n[S].remove("active-microphone-icon","command-microphone-icon"),n[S].add("default-microphone-icon");break;case re:n[S].remove("default-microphone-icon","command-microphone-icon"),n[S].add("active-microphone-icon");break;case"command":n[S].remove("active-microphone-icon","default-microphone-icon"),n[S].add("command-microphone-icon");break}}}],[{key:"createMicrophoneElement",value:function(){var e=B();return e.id="microphone-button",e[S].add("input-button"),e}}])})(Bt);function nh(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var jn={},Qt={},en={},tn={},nn={},ns;function fr(){if(ns)return nn;ns=1,Object.defineProperty(nn,"__esModule",{value:!0}),nn.Text=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"capitalize",value:function(e){return e.replace(i.FIRST_CHAR_REGEX,function(n){return n.toUpperCase()})}},{key:"lineBreak",value:function(e){return e.replace(i.DOUBLE_LINE,"<p></p>").replace(i.ONE_LINE,"<br>")}},{key:"isCharDefined",value:function(e){return e!==void 0&&e!=="Â "&&e!==" "&&e!==`
`&&e!==""}},{key:"breakupIntoWordsArr",value:function(e){return e.split(/(\W+)/)}}])})();return nn.Text=a,a.FIRST_CHAR_REGEX=/\S/,a.DOUBLE_LINE=/\n\n/g,a.ONE_LINE=/\n/g,nn}var rs;function Li(){if(rs)return tn;rs=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.Translate=void 0;var a=fr(),i=(function(){function t(){E(this,t)}return C(t,null,[{key:"translate",value:function(n,r){for(var s=a.Text.breakupIntoWordsArr(n),o=0;o<s.length;o+=1)r[s[o]]&&(s[o]=r[s[o]]);return s.join("")}}])})();return tn.Translate=i,tn}var as;function rh(){if(as)return en;as=1,Object.defineProperty(en,"__esModule",{value:!0}),en.WebSpeechTranscript=void 0;var a=Li(),i=(function(){function t(){E(this,t)}return C(t,null,[{key:"extract",value:function(n,r,s){for(var o="",l=n.resultIndex;l<n.results.length;++l){var u=n.results[l][0].transcript;s&&(u=a.Translate.translate(u,s)),n.results[l].isFinal?r+=u:o+=u}return{interimTranscript:o,finalTranscript:r,newText:o||r}}},{key:"extractSafari",value:function(n,r,s){for(var o="",l=n.resultIndex;l<n.results.length;++l){var u=n.results[l][0].transcript;s&&(u=a.Translate.translate(u,s)),o+=u}return{interimTranscript:"",finalTranscript:o,newText:o}}}])})();return en.WebSpeechTranscript=i,en}var rn={},ss;function va(){if(ss)return rn;ss=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.Browser=void 0;var a=C(function i(){E(this,i)});return rn.Browser=a,a.IS_SAFARI=function(){return a._IS_SAFARI===void 0&&(a._IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),a._IS_SAFARI},rn}var an={},sn={},is;function ah(){if(is)return sn;is=1,Object.defineProperty(sn,"__esModule",{value:!0}),sn.EventListeners=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"getElementIfFocusedOnAvailable",value:function(e,n){return Array.isArray(e)?e.find(function(r){return n===r}):n===e?e:void 0}},{key:"keyDownWindow",value:function(e){var n=this;e.element&&i.getElementIfFocusedOnAvailable(e.element,document.activeElement)&&(i.KEY_DOWN_TIMEOUT!==null&&clearTimeout(i.KEY_DOWN_TIMEOUT),i.KEY_DOWN_TIMEOUT=setTimeout(function(){i.KEY_DOWN_TIMEOUT=null,n.resetRecording(e)},500))}},{key:"mouseDownWindow",value:function(e,n){this.mouseDownElement=i.getElementIfFocusedOnAvailable(e,n.target)}},{key:"mouseUpWindow",value:function(e){this.mouseDownElement&&this.resetRecording(e),this.mouseDownElement=void 0}},{key:"add",value:function(e,n){var r=(n==null?void 0:n.insertInCursorLocation)===void 0||(n==null?void 0:n.insertInCursorLocation);n!=null&&n.element&&r&&(e.mouseDownEvent=i.mouseDownWindow.bind(e,n.element),document.addEventListener("mousedown",e.mouseDownEvent),e.mouseUpEvent=i.mouseUpWindow.bind(e,n),document.addEventListener("mouseup",e.mouseUpEvent),e.keyDownEvent=i.keyDownWindow.bind(e,n),document.addEventListener("keydown",e.keyDownEvent))}},{key:"remove",value:function(e){document.removeEventListener("mousedown",e.mouseDownEvent),document.removeEventListener("mouseup",e.mouseUpEvent),document.removeEventListener("keydown",e.keyDownEvent)}}])})();return sn.EventListeners=a,a.KEY_DOWN_TIMEOUT=null,sn}var on={},os;function sh(){if(os)return on;os=1,Object.defineProperty(on,"__esModule",{value:!0}),on.PreResultUtils=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"process",value:function(e,n,r,s,o){var l=s==null?void 0:s(n,r);return l?(setTimeout(function(){l.restart?e.resetRecording(o):l.stop&&e.stop()}),(l.stop||l.restart)&&l.removeNewText):!1}}])})();return on.PreResultUtils=a,on}var ln={},un={},ls;function Fi(){if(ls)return un;ls=1,Object.defineProperty(un,"__esModule",{value:!0}),un.AutoScroll=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"changeStateIfNeeded",value:function(e,n){n&&!e.isCursorAtEnd&&(e.endPadding="",e.scrollingSpan.innerHTML="&nbsp;")}},{key:"scrollGeneric",value:function(e,n){e.isCursorAtEnd?n.scrollTop=n.scrollHeight:e.scrollingSpan.scrollIntoView({block:"nearest"})}},{key:"scrollSafariPrimitiveToEnd",value:function(e){e.scrollLeft=e.scrollWidth,e.scrollTop=e.scrollHeight}},{key:"isElementOverflown",value:function(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}},{key:"isRequired",value:function(e,n){return e&&i.isElementOverflown(n)}}])})();return un.AutoScroll=a,un}var cn={},us;function mr(){if(us)return cn;us=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.Elements=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"isPrimitiveElement",value:function(e){return e.tagName==="INPUT"||e.tagName==="TEXTAREA"}},{key:"createInterimSpan",value:function(){var e=document.createElement("span");return e.style.color="grey",e.style.pointerEvents="none",e}},{key:"createGenericSpan",value:function(){var e=document.createElement("span");return e.style.pointerEvents="none",e}},{key:"appendSpans",value:function(e,n){if(e.spansPopulated=!0,e.insertInCursorLocation&&document.activeElement===n){var r=window.getSelection();if(r!=null&&r.focusNode){var s=r.getRangeAt(0);s.insertNode(e.scrollingSpan),s.insertNode(e.interimSpan),s.insertNode(e.finalSpan),s.collapse(!1),r.removeAllRanges(),r.addRange(s);return}}n.appendChild(e.finalSpan),n.appendChild(e.interimSpan),n.appendChild(e.scrollingSpan)}},{key:"applyCustomColors",value:function(e,n){n.interim&&(e.interimSpan.style.color=n.interim),n.final&&(e.finalSpan.style.color=n.final)}},{key:"isInsideShadowDOM",value:function(e){return e.getRootNode()instanceof ShadowRoot}}])})();return cn.Elements=a,cn}var dn={},cs;function vr(){if(cs)return dn;cs=1,Object.defineProperty(dn,"__esModule",{value:!0}),dn.Cursor=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"setOffsetForGeneric",value:function(e,n){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=0,o=0;o<e.childNodes.length;o+=1){var l=e.childNodes[o];if(l.childNodes.length>0){var u=i.setOffsetForGeneric(l,n,r);if(u===-1)return-1;r+=u}else if(l.textContent!==null){if(r+l.textContent.length>n){var c=document.createRange();c.setStart(l,n-r),c.collapse(!0);var d=window.getSelection();return d==null||d.removeAllRanges(),d==null||d.addRange(c),e.focus(),-1}r+=l.textContent.length,s+=l.textContent.length}}return s}},{key:"focusEndOfGeneric",value:function(e){var n=document.createRange();n.selectNodeContents(e),n.collapse(!1);var r=window.getSelection();r&&(r.removeAllRanges(),r.addRange(n))}},{key:"setOffsetForSafariGeneric",value:function(e,n){var r=window.getSelection();if(r){var s=i.getGenericElementCursorOffset(e,r,!0);i.setOffsetForGeneric(e,s+n)}}},{key:"setOffsetForPrimitive",value:function(e,n,r){r&&e.blur(),e.setSelectionRange(n,n),e.focus()}},{key:"getGenericElementCursorOffset",value:function(e,n,r){var s=0;if(n.rangeCount>0){var o=n.getRangeAt(0),l=o.cloneRange();l.selectNodeContents(e),r?l.setEnd(o.startContainer,o.startOffset):l.setEnd(o.endContainer,o.endOffset),s=l.toString().length}return s}}])})();return dn.Cursor=a,dn}var ds;function Di(){if(ds)return ln;ds=1,Object.defineProperty(ln,"__esModule",{value:!0}),ln.CommandUtils=void 0;var a=Fi(),i=mr(),t=va(),e=vr(),n=fr(),r=(function(){function s(){E(this,s)}return C(s,null,[{key:"processCommand",value:function(l,u){return(!u||!u.caseSensitive)&&(l=l.toLowerCase()),(u==null?void 0:u.substrings)===!1?n.Text.breakupIntoWordsArr(l):l}},{key:"process",value:function(l){var u;return((u=l.settings)===null||u===void 0?void 0:u.caseSensitive)===!0?l:Object.keys(l).reduce(function(c,d){var h=l[d];return c[d]=typeof h=="string"?s.processCommand(h,l.settings):h,c},{})}},{key:"toggleCommandModeOn",value:function(l){var u;l.isWaitingForCommand=!0,(u=l.onCommandModeTrigger)===null||u===void 0||u.call(l,!0)}},{key:"toggleCommandModeOff",value:function(l){var u;l.isWaitingForCommand&&((u=l.onCommandModeTrigger)===null||u===void 0||u.call(l,!1),l.isWaitingForCommand=!1)}},{key:"setText",value:function(l,u,c,d){s.toggleCommandModeOff(l),i.Elements.isPrimitiveElement(d)?(d.value=c,l.isTargetInShadow||e.Cursor.setOffsetForPrimitive(d,c.length,!0),t.Browser.IS_SAFARI()&&l.autoScroll&&a.AutoScroll.scrollSafariPrimitiveToEnd(d)):(d.textContent=c,l.isTargetInShadow||e.Cursor.focusEndOfGeneric(d),setTimeout(function(){return a.AutoScroll.scrollGeneric(l,d)})),l.resetRecording(u)}},{key:"checkIfMatchesSubstring",value:function(l,u){return u.includes(l)}},{key:"checkIfMatchesWord",value:function(l,u,c){for(var d=l,h=c.length-1;h>=0;h-=1){for(var p=h,g=d.length-1;c[p]===d[g]&&g>=0;)p-=1,g-=1;if(g<0)return!0}return!1}},{key:"execCommand",value:function(l,u,c,d,h){var p,g,m,b=l.commands;if(!(!b||!d||!c)){var k=((p=b.settings)===null||p===void 0?void 0:p.caseSensitive)===!0?u:u.toLowerCase(),A=n.Text.breakupIntoWordsArr(k),I=((g=b.settings)===null||g===void 0?void 0:g.substrings)===!1?s.checkIfMatchesWord:s.checkIfMatchesSubstring;if(b.commandMode&&I(b.commandMode,k,A))return l.setInterimColorToFinal(),setTimeout(function(){return s.toggleCommandModeOn(l)}),{doNotProcessTranscription:!1};if(!(b.commandMode&&!l.isWaitingForCommand)){if(b.stop&&I(b.stop,k,A))return s.toggleCommandModeOff(l),setTimeout(function(){return l.stop()}),{doNotProcessTranscription:!1};if(b.pause&&I(b.pause,k,A))return s.toggleCommandModeOff(l),l.setInterimColorToFinal(),setTimeout(function(){var x;l.isPaused=!0,(x=l.onPauseTrigger)===null||x===void 0||x.call(l,!0)}),{doNotProcessTranscription:!1};if(b.resume&&I(b.resume,k,A))return l.isPaused=!1,(m=l.onPauseTrigger)===null||m===void 0||m.call(l,!1),s.toggleCommandModeOff(l),l.resetRecording(c),{doNotProcessTranscription:!0};if(b.reset&&I(b.reset,k,A))return h!==void 0&&s.setText(l,c,h,d),{doNotProcessTranscription:!0};if(b.removeAllText&&I(b.removeAllText,k,A))return s.setText(l,c,"",d),{doNotProcessTranscription:!0}}}}}])})();return ln.CommandUtils=r,ln}var hn={},hs;function ih(){if(hs)return hn;hs=1,Object.defineProperty(hn,"__esModule",{value:!0}),hn.Highlight=void 0;var a=mr(),i=vr(),t=(function(){function e(){E(this,e)}return C(e,null,[{key:"setStateForPrimitive",value:function(r,s){var o,l;s.selectionStart!==null&&(o=s.selectionStart),s.selectionEnd!==null&&(l=s.selectionEnd),r.isHighlighted=o!==l}},{key:"setStateForGeneric",value:function(r,s){var o=window.getSelection();if(o!=null&&o.focusNode){var l=i.Cursor.getGenericElementCursorOffset(s,o,!0),u=i.Cursor.getGenericElementCursorOffset(s,o,!1);r.isHighlighted=l!==u}}},{key:"setState",value:function(r,s){document.activeElement===s&&(a.Elements.isPrimitiveElement(s)?e.setStateForPrimitive(r,s):e.setStateForGeneric(r,s))}},{key:"removeForGeneric",value:function(r,s){var o=window.getSelection();if(o){var l=i.Cursor.getGenericElementCursorOffset(s,o,!0);o.deleteFromDocument(),i.Cursor.setOffsetForGeneric(s,l),r.isHighlighted=!1}}},{key:"removeForPrimitive",value:function(r,s){var o=s.selectionStart,l=s.selectionEnd,u=s.value;if(o&&l){var c=u.substring(0,o)+u.substring(l);s.value=c,i.Cursor.setOffsetForPrimitive(s,o,r.autoScroll)}r.isHighlighted=!1}}])})();return hn.Highlight=t,hn}var pn={},ps;function oh(){if(ps)return pn;ps=1,Object.defineProperty(pn,"__esModule",{value:!0}),pn.Padding=void 0;var a=mr(),i=vr(),t=fr(),e=(function(){function n(){E(this,n)}return C(n,null,[{key:"setStateForPrimitiveElement",value:function(s,o){if(document.activeElement===o&&o.selectionStart!==null){var l=o.selectionStart,u=o.value[l-1],c=o.selectionEnd===null?l:o.selectionEnd,d=o.value[c];t.Text.isCharDefined(u)&&(s.startPadding=" ",s.numberOfSpacesBeforeNewText=1),t.Text.isCharDefined(d)&&(s.endPadding=" ",s.numberOfSpacesAfterNewText=1),s.isCursorAtEnd=o.value.length===c;return}var h=o.value[o.value.length-1];t.Text.isCharDefined(h)&&(s.startPadding=" ",s.numberOfSpacesBeforeNewText=1),s.isCursorAtEnd=!0}},{key:"setStateForGenericElement",value:function(s,o){var l,u,c;if(document.activeElement===o){var d=window.getSelection();if(d!=null&&d.focusNode){var h=i.Cursor.getGenericElementCursorOffset(o,d,!0),p=(l=o.textContent)===null||l===void 0?void 0:l[h-1],g=i.Cursor.getGenericElementCursorOffset(o,d,!1),m=(u=o.textContent)===null||u===void 0?void 0:u[g];t.Text.isCharDefined(p)&&(s.startPadding=" "),t.Text.isCharDefined(m)&&(s.endPadding=" "),s.isCursorAtEnd=((c=o.textContent)===null||c===void 0?void 0:c.length)===g;return}}var b=o.innerText.charAt(o.innerText.length-1);t.Text.isCharDefined(b)&&(s.startPadding=" "),s.isCursorAtEnd=!0}},{key:"setState",value:function(s,o){a.Elements.isPrimitiveElement(o)?n.setStateForPrimitiveElement(s,o):n.setStateForGenericElement(s,o)}},{key:"adjustStateAfterRecodingPrimitiveElement",value:function(s,o){if(s.primitiveTextRecorded=!0,s.insertInCursorLocation&&document.activeElement===o&&(o.selectionEnd!==null&&(s.endPadding=s.endPadding+o.value.slice(o.selectionEnd)),o.selectionStart!==null)){s.startPadding=o.value.slice(0,o.selectionStart)+s.startPadding;return}s.startPadding=o.value+s.startPadding}},{key:"adjustSateForNoTextPrimitiveElement",value:function(s){s.numberOfSpacesBeforeNewText===1&&(s.startPadding=s.startPadding.substring(0,s.startPadding.length-1),s.numberOfSpacesBeforeNewText=0),s.numberOfSpacesAfterNewText===1&&(s.endPadding=s.endPadding.substring(1),s.numberOfSpacesAfterNewText=0)}}])})();return pn.Padding=e,pn}var fs;function Ni(){if(fs)return an;fs=1,Object.defineProperty(an,"__esModule",{value:!0}),an.Speech=void 0;var a=ah(),i=sh(),t=Di(),e=Fi(),n=ih(),r=mr(),s=oh(),o=va(),l=vr(),u=fr(),c=(function(){function d(){E(this,d),this.finalTranscript="",this.interimSpan=r.Elements.createInterimSpan(),this.finalSpan=r.Elements.createGenericSpan(),this.scrollingSpan=r.Elements.createGenericSpan(),this.isCursorAtEnd=!1,this.spansPopulated=!1,this.startPadding="",this.endPadding="",this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.recognizing=!1,this._displayInterimResults=!0,this.insertInCursorLocation=!0,this.autoScroll=!0,this.isRestarting=!1,this.isPaused=!1,this.isWaitingForCommand=!1,this.isTargetInShadow=!1,this.cannotBeStopped=!1,this.resetState()}return C(d,[{key:"prepareBeforeStart",value:function(p){var g,m;if(p!=null&&p.element)if(a.EventListeners.add(this,p),Array.isArray(p.element)){var b=p.element.find(function(k){return k===document.activeElement})||p.element[0];if(!b)return;this.prepare(b)}else this.prepare(p.element);(p==null?void 0:p.displayInterimResults)!==void 0&&(this._displayInterimResults=p.displayInterimResults),p!=null&&p.textColor&&(this._finalTextColor=(g=p==null?void 0:p.textColor)===null||g===void 0?void 0:g.final,r.Elements.applyCustomColors(this,p.textColor)),(p==null?void 0:p.insertInCursorLocation)!==void 0&&(this.insertInCursorLocation=p.insertInCursorLocation),(p==null?void 0:p.autoScroll)!==void 0&&(this.autoScroll=p.autoScroll),this._onResult=p==null?void 0:p.onResult,this._onPreResult=p==null?void 0:p.onPreResult,this._onStart=p==null?void 0:p.onStart,this._onStop=p==null?void 0:p.onStop,this._onError=p==null?void 0:p.onError,this.onCommandModeTrigger=p==null?void 0:p.onCommandModeTrigger,this.onPauseTrigger=p==null?void 0:p.onPauseTrigger,this._options=p,!((m=this._options)===null||m===void 0)&&m.commands&&(this.commands=t.CommandUtils.process(this._options.commands))}},{key:"prepare",value:function(p){s.Padding.setState(this,p),n.Highlight.setState(this,p),this.isTargetInShadow=r.Elements.isInsideShadowDOM(p),r.Elements.isPrimitiveElement(p)?(this._primitiveElement=p,this._originalText=this._primitiveElement.value):(this._genericElement=p,this._originalText=this._genericElement.textContent)}},{key:"resetRecording",value:function(p){this.isRestarting=!0,this.stop(!0),this.resetState(!0),this.start(p,!0)}},{key:"updateElements",value:function(p,g,m){var b,k=u.Text.capitalize(g);if(!(this.finalTranscript===k&&p==="")){i.PreResultUtils.process(this,m,p==="",this._onPreResult,this._options)&&(p="",m="");var A=this.commands&&t.CommandUtils.execCommand(this,m,this._options,this._primitiveElement||this._genericElement,this._originalText);if(A){if(A.doNotProcessTranscription)return;p="",m=""}if(!(this.isPaused||this.isWaitingForCommand)){(b=this._onResult)===null||b===void 0||b.call(this,m,p===""),this.finalTranscript=k,this._displayInterimResults||(p="");var I=this.finalTranscript===""&&p==="";this._primitiveElement?this.updatePrimitiveElement(this._primitiveElement,p,I):this._genericElement&&this.updateGenericElement(this._genericElement,p,I)}}}},{key:"updatePrimitiveElement",value:function(p,g,m){this.isHighlighted&&n.Highlight.removeForPrimitive(this,p),this.primitiveTextRecorded||s.Padding.adjustStateAfterRecodingPrimitiveElement(this,p),m&&s.Padding.adjustSateForNoTextPrimitiveElement(this);var b=this.startPadding+this.finalTranscript+g;if(p.value=b+this.endPadding,!this.isTargetInShadow){var k=b.length+this.numberOfSpacesAfterNewText;l.Cursor.setOffsetForPrimitive(p,k,this.autoScroll)}this.autoScroll&&o.Browser.IS_SAFARI()&&this.isCursorAtEnd&&e.AutoScroll.scrollSafariPrimitiveToEnd(p)}},{key:"updateGenericElement",value:function(p,g,m){this.isHighlighted&&n.Highlight.removeForGeneric(this,p),this.spansPopulated||r.Elements.appendSpans(this,p);var b=(m?"":this.startPadding)+u.Text.lineBreak(this.finalTranscript);this.finalSpan.innerHTML=b;var k=e.AutoScroll.isRequired(this.autoScroll,p);e.AutoScroll.changeStateIfNeeded(this,k);var A=u.Text.lineBreak(g)+(m?"":this.endPadding);this.interimSpan.innerHTML=A,o.Browser.IS_SAFARI()&&this.insertInCursorLocation&&l.Cursor.setOffsetForSafariGeneric(p,b.length+A.length),k&&e.AutoScroll.scrollGeneric(this,p),m&&(this.scrollingSpan.innerHTML="")}},{key:"finalise",value:function(p){this._genericElement&&(p?(this.finalSpan=r.Elements.createGenericSpan(),this.setInterimColorToFinal(),this.interimSpan=r.Elements.createInterimSpan(),this.scrollingSpan=r.Elements.createGenericSpan()):this._genericElement.textContent=this._genericElement.textContent,this.spansPopulated=!1),a.EventListeners.remove(this)}},{key:"setInterimColorToFinal",value:function(){this.interimSpan.style.color=this._finalTextColor||"black"}},{key:"resetState",value:function(p){this._primitiveElement=void 0,this._genericElement=void 0,this.finalTranscript="",this.finalSpan.innerHTML="",this.interimSpan.innerHTML="",this.scrollingSpan.innerHTML="",this.startPadding="",this.endPadding="",this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,p||(this.stopTimeout=void 0)}},{key:"setStateOnStart",value:function(){var p;this.recognizing=!0,this.isRestarting?this.isRestarting=!1:(p=this._onStart)===null||p===void 0||p.call(this)}},{key:"setStateOnStop",value:function(){var p;this.recognizing=!1,this.isRestarting||(p=this._onStop)===null||p===void 0||p.call(this)}},{key:"setStateOnError",value:function(p){var g;(g=this._onError)===null||g===void 0||g.call(this,p),this.recognizing=!1}}])})();return an.Speech=c,an}var ms;function lh(){if(ms)return Qt;ms=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.WebSpeech=void 0;var a=rh(),i=va(),t=Ni(),e=(function(n){function r(){return E(this,r),F(this,r)}return D(r,n),C(r,[{key:"start",value:function(o){var l;this._extractText===void 0&&(this._extractText=i.Browser.IS_SAFARI()?a.WebSpeechTranscript.extractSafari:a.WebSpeechTranscript.extract),this.validate()&&(this.prepareBeforeStart(o),this.instantiateService(o),(l=this._service)===null||l===void 0||l.start(),this._translations=o==null?void 0:o.translations)}},{key:"validate",value:function(){return r.getAPI()?!0:(this.error("Speech Recognition is unsupported"),!1)}},{key:"instantiateService",value:function(o){var l,u,c=r.getAPI();this._service=new c,this._service.continuous=!0,this._service.interimResults=(l=o==null?void 0:o.displayInterimResults)!==null&&l!==void 0?l:!0,this._service.lang=((u=o==null?void 0:o.language)===null||u===void 0?void 0:u.trim())||"en-US",this.setEvents()}},{key:"setEvents",value:function(){var o=this;this._service&&(this._service.onstart=function(){o.setStateOnStart()},this._service.onerror=function(l){i.Browser.IS_SAFARI()&&l.message==="Another request is started"||l.error==="aborted"&&o.isRestarting||l.error!=="no-speech"&&o.error(l.message||l.error)},this._service.onaudioend=function(){o.setStateOnStop()},this._service.onend=function(){o._stopping=!1},this._service.onresult=function(l){if(R(l.results)>"u"&&o._service)o._service.onend=null,o._service.stop();else if(o._extractText&&!o._stopping){var u=o._extractText(l,o.finalTranscript,o._translations),c=u.interimTranscript,d=u.finalTranscript,h=u.newText;o.updateElements(c,d,h)}})}},{key:"stop",value:function(o){var l;this._stopping=!0,(l=this._service)===null||l===void 0||l.stop(),this.finalise(o)}},{key:"error",value:function(o){console.error(o),this.setStateOnError(o),this.stop()}}],[{key:"getAPI",value:function(){return window.webkitSpeechRecognition||window.SpeechRecognition}}])})(t.Speech);return Qt.WebSpeech=e,Qt}var fn={},vs;function uh(){if(vs)return fn;vs=1,Object.defineProperty(fn,"__esModule",{value:!0}),fn.GlobalState=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"doubleClickDetector",value:function(){return i.doubleClickPending?!0:(i.doubleClickPending=!0,setTimeout(function(){i.doubleClickPending=!1},300),!1)}}])})();return fn.GlobalState=a,a.doubleClickPending=!1,fn}var mn={},vn={},gs;function ch(){if(gs)return vn;gs=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.PreventConnectionStop=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"applyPrevention",value:function(e){clearTimeout(e._manualConnectionStopPrevention),e.cannotBeStopped=!0,e._manualConnectionStopPrevention=setTimeout(function(){e.cannotBeStopped=!1},800)}},{key:"clearPrevention",value:function(e){clearTimeout(e._manualConnectionStopPrevention),e.cannotBeStopped=!1}}])})();return vn.PreventConnectionStop=a,vn}var gn={},Hn={},ys;function dh(){return ys||(ys=1,Object.defineProperty(Hn,"__esModule",{value:!0}),Hn.README_URL=void 0,Hn.README_URL="https://github.com/OvidijusParsiunas/speech-to-element"),Hn}var bs;function hh(){if(bs)return gn;bs=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.AzureSpeechConfig=void 0;var a=dh(),i=(function(){function t(){E(this,t)}return C(t,null,[{key:"validateOptions",value:function(n,r){return r?!r.subscriptionKey&&!r.token&&!r.retrieveToken?(n("Please define a 'subscriptionKey', 'token' or 'retrieveToken' property - more info: ".concat(a.README_URL)),!1):r.region?!0:(n("Please define a 'region' property - more info: ".concat(a.README_URL)),!1):(n("Please provide subscription details - more info: ".concat(a.README_URL)),!1)}},{key:"getNewSpeechConfig",value:(function(){var e=w(v().m(function r(s,o){return v().w(function(l){for(;;)switch(l.n){case 0:if(!o.region){l.n=1;break}return l.a(2,o.subscriptionKey?s.fromSubscription(o.subscriptionKey.trim(),o.region.trim()):o.token?s.fromAuthorizationToken(o.token.trim(),o.region.trim()):o.retrieveToken?o.retrieveToken().then(function(u){return o.region?s.fromAuthorizationToken((u==null?void 0:u.trim())||"",o.region.trim()):null}).catch(function(u){return console.error(u),null}):null);case 1:return l.a(2)}},r)}));function n(r,s){return e.apply(this,arguments)}return n})()},{key:"process",value:function(n,r){r.endpointId&&(n.endpointId=r.endpointId.trim()),r.language&&(n.speechRecognitionLanguage=r.language.trim())}},{key:"get",value:(function(){var e=w(v().m(function r(s,o){var l;return v().w(function(u){for(;;)switch(u.n){case 0:return u.n=1,t.getNewSpeechConfig(s,o);case 1:return l=u.v,u.a(2,(l&&t.process(l,o),l))}},r)}));function n(r,s){return e.apply(this,arguments)}return n})()}])})();return gn.AzureSpeechConfig=i,gn}var yn={},_s;function ph(){if(_s)return yn;_s=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.StopTimeout=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"set",value:function(e){e.stopTimeout=setTimeout(function(){return e.stop()},e.stopTimeoutMS)}},{key:"reset",value:function(e,n){e.stopTimeoutMS=n||i.DEFAULT_MS,i.stop(e),i.set(e)}},{key:"stop",value:function(e){e.stopTimeout&&clearTimeout(e.stopTimeout)}}])})();return yn.StopTimeout=a,a.DEFAULT_MS=2e4,yn}var bn={},ks;function fh(){if(ks)return bn;ks=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.AzureAudioConfig=void 0;var a=(function(){function i(){E(this,i)}return C(i,null,[{key:"get",value:function(e,n){return n?e.fromMicrophoneInput(n):e.fromDefaultMicrophoneInput()}}])})();return bn.AzureAudioConfig=a,bn}var _n={},Ss;function mh(){if(Ss)return _n;Ss=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.AzureTranscript=void 0;var a=Li(),i=(function(){function t(){E(this,t)}return C(t,null,[{key:"extract",value:function(n,r,s,o){return o&&(n=a.Translate.translate(n,o)),s?{interimTranscript:"",finalTranscript:r+n,newText:n}:{interimTranscript:n,finalTranscript:r,newText:n}}}])})();return _n.AzureTranscript=i,_n}var ws;function vh(){if(ws)return mn;ws=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.Azure=void 0;var a=ch(),i=hh(),t=ph(),e=fh(),n=mh(),r=Ni(),s=(function(o){function l(){var u;return E(this,l),u=F(this,l,arguments),u._newTextPadding="",u}return D(l,o),C(l,[{key:"start",value:function(c,d){this._newTextPadding="",this.stopTimeout===void 0&&t.StopTimeout.reset(this,c==null?void 0:c.stopAfterSilenceMs),this.prepareBeforeStart(c),this.startAsync(c),d||a.PreventConnectionStop.applyPrevention(this)}},{key:"startAsync",value:(function(){var u=w(v().m(function d(h){var p,g;return v().w(function(m){for(;;)switch(m.n){case 0:if(g=this.validate(h),!g){m.n=2;break}return m.n=1,this.instantiateService(h);case 1:this._translations=h==null?void 0:h.translations,(p=this._service)===null||p===void 0||p.startContinuousRecognitionAsync(function(){},this.error);case 2:return m.a(2)}},d,this)}));function c(d){return u.apply(this,arguments)}return c})()},{key:"validate",value:function(c){return l.getAPI()?i.AzureSpeechConfig.validateOptions(this.error.bind(this),c):(this.moduleNotFound(),!1)}},{key:"instantiateService",value:(function(){var u=w(v().m(function d(h){var p,g,m,b,k,A,I,x,U;return v().w(function(j){for(;;)switch(j.n){case 0:return p=l.getAPI(),g=e.AzureAudioConfig.get(p.AudioConfig,h.deviceId),j.n=1,i.AzureSpeechConfig.get(p.SpeechConfig,h);case 1:m=j.v,m?(h.autoLanguage&&h.autoLanguage.languages.length>0?(k=h.autoLanguage,A=k.type,I=k.languages,x=I.slice(0,A==="Continuous"?10:4),U=p.AutoDetectSourceLanguageConfig.fromLanguages(x),A==="Continuous"&&(U.mode=1),b=p.SpeechRecognizer.FromConfig(m,U,g)):b=new p.SpeechRecognizer(m,g),this.setEvents(b),this._service=b,h.retrieveToken&&this.retrieveTokenInterval(h.retrieveToken)):this.error("Unable to contact Azure server");case 2:return j.a(2)}},d,this)}));function c(d){return u.apply(this,arguments)}return c})()},{key:"setEvents",value:function(c){c.recognizing=this.onRecognizing.bind(this),c.recognized=this.onRecognized.bind(this),c.sessionStarted=this.onSessionStarted.bind(this),c.canceled=this.onCanceled.bind(this),c.sessionStopped=this.onSessionStopped.bind(this)}},{key:"onRecognizing",value:function(c,d){if(!this._stopping){var h=n.AzureTranscript.extract(this._newTextPadding+d.result.text,this.finalTranscript,!1,this._translations),p=h.interimTranscript,g=h.finalTranscript,m=h.newText;t.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(p,g,m)}}},{key:"onRecognized",value:function(c,d){var h=d.result;switch(h.reason){case window.SpeechSDK.ResultReason.Canceled:break;case window.SpeechSDK.ResultReason.RecognizedSpeech:if(h.text&&!this._stopping){var p=n.AzureTranscript.extract(this._newTextPadding+h.text,this.finalTranscript,!0,this._translations),g=p.interimTranscript,m=p.finalTranscript,b=p.newText;t.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(g,m,b),m!==""&&(this._newTextPadding=" ")}break}}},{key:"onCanceled",value:function(c,d){d.reason===window.SpeechSDK.CancellationReason.Error&&this.error(d.errorDetails)}},{key:"onSessionStarted",value:function(){a.PreventConnectionStop.clearPrevention(this),this.setStateOnStart()}},{key:"onSessionStopped",value:function(){this._retrieveTokenInterval||clearInterval(this._retrieveTokenInterval),this._stopping=!1,this.setStateOnStop()}},{key:"retrieveTokenInterval",value:function(c){var d=this;this._retrieveTokenInterval=setInterval(function(){c==null||c().then(function(h){d._service&&(d._service.authorizationToken=(h==null?void 0:h.trim())||"")}).catch(function(h){d.error(h)})},1e4)}},{key:"stop",value:function(c){var d;!c&&this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),this._stopping=!0,(d=this._service)===null||d===void 0||d.stopContinuousRecognitionAsync(),t.StopTimeout.stop(this),this.finalise(c)}},{key:"moduleNotFound",value:function(){console.error("speech recognition module not found:"),console.error(`please install the 'microsoft-cognitiveservices-speech-sdk' npm package or add a script tag: <script src="https://aka.ms/csspeech/jsbrowserpackageraw"><\/script>`),this.setStateOnError("speech recognition module not found")}},{key:"error",value:function(c){this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),console.error(c),this.setStateOnError(c),this.stop()}}],[{key:"getAPI",value:function(){return window.SpeechSDK}}])})(r.Speech);return mn.Azure=s,mn}var Es;function gh(){if(Es)return jn;Es=1,Object.defineProperty(jn,"__esModule",{value:!0});var a=lh(),i=Di(),t=uh(),e=vh(),n=(function(){function r(){E(this,r)}return C(r,null,[{key:"toggle",value:function(o,l){var u,c,d=o.toLocaleLowerCase().trim();!((u=t.GlobalState.service)===null||u===void 0)&&u.recognizing?this.stop():d==="webspeech"?r.startWebSpeech(l):d==="azure"?r.startAzure(l):(console.error("service not found - must be either 'webspeech' or 'azure'"),(c=l==null?void 0:l.onError)===null||c===void 0||c.call(l,"service not found - must be either 'webspeech' or 'azure'"))}},{key:"startWebSpeech",value:function(o){r.stop()||(t.GlobalState.service=new a.WebSpeech,t.GlobalState.service.start(o))}},{key:"isWebSpeechSupported",value:function(){return!!a.WebSpeech.getAPI()}},{key:"startAzure",value:function(o){var l;r.stop()||!((l=t.GlobalState.service)===null||l===void 0)&&l.cannotBeStopped||(t.GlobalState.service=new e.Azure,t.GlobalState.service.start(o))}},{key:"stop",value:function(){var o;return t.GlobalState.doubleClickDetector()?!0:(!((o=t.GlobalState.service)===null||o===void 0)&&o.recognizing&&t.GlobalState.service.stop(),!1)}},{key:"endCommandMode",value:function(){t.GlobalState.service&&i.CommandUtils.toggleCommandModeOff(t.GlobalState.service)}}])})();return jn.default=n,jn}var yh=gh(),Qn=nh(yh),bh=(function(){function a(i,t){E(this,a),this._silenceMS=2e3,this._stop=!0,typeof t=="boolean"&&t===!1&&(this._stop=!1),typeof i=="number"&&(this._silenceMS=i)}return C(a,[{key:"setSilenceTimeout",value:function(t,e){var n=this;this._silenceTimeout=setTimeout(function(){var r;(r=t.submit)==null||r.call(t),Qn.stop(),n._stop||setTimeout(e,ga.MICROPHONE_RESET_TIMEOUT_MS)},this._silenceMS)}},{key:"clearSilenceTimeout",value:function(){this._silenceTimeout&&clearTimeout(this._silenceTimeout)}},{key:"resetSilenceTimeout",value:function(t,e){this.clearSilenceTimeout(),this.setSilenceTimeout(t,e)}},{key:"onPause",value:function(t,e,n){t?this.resetSilenceTimeout(e,n):this.clearSilenceTimeout()}}])})(),Ui=(function(a){function i(t,e,n){var r;E(this,i);var s=R(t.speechToText)=="object"?t.speechToText:{};r=F(this,i,[s==null?void 0:s.button]);var o=r.processConfiguration(e,t.speechToText),l=o.serviceName,u=o.processedConfig;if(r._addErrorMessage=n,l==="webspeech"&&!Qn.isWebSpeechSupported())r.changeToUnsupported();else{var c=!t.textInput||!t.textInput[ae];oe.assignButtonEvents(r.elementRef,r.buttonClick.bind(r,e,c,l,u))}return setTimeout(function(){r._validationHandler=t._validationHandler}),r}return D(i,a),C(i,[{key:"processConfiguration",value:function(e,n){var r,s,o,l,u,c,d=R(n)=="object"?n:{},h=R(d.webSpeech)=="object"?d.webSpeech:{},p=d.azure||{},g=ie(ie({displayInterimResults:(r=d.displayInterimResults)!==null&&r!==void 0?r:void 0,textColor:(s=d.textColor)!==null&&s!==void 0?s:void 0,translations:(o=d.translations)!==null&&o!==void 0?o:void 0,commands:(l=d.commands)!==null&&l!==void 0?l:void 0,events:(u=d.events)!==null&&u!==void 0?u:void 0},h),p),m=(c=d.commands)==null?void 0:c.submit;return m&&(g.onPreResult=function(b){return b.toLowerCase().includes(m)?(setTimeout(function(){var k;return(k=e.submit)==null?void 0:k.call(e)}),Qn.endCommandMode(),{restart:!0,removeNewText:!0}):null}),d.submitAfterSilence&&(this._silenceSubmit=new bh(d.submitAfterSilence,d.stopAfterSubmit)),{serviceName:i.getServiceName(d),processedConfig:g}}},{key:"buttonClick",value:function(e,n,r,s){var o=this,l=s==null?void 0:s.events;e.removePlaceholderStyle(),Qn.toggle(r,ie({insertInCursorLocation:!1,element:n?e.inputElementRef:void 0,onError:function(){var c;o.onError(),(c=o._silenceSubmit)==null||c.clearSilenceTimeout()},onStart:function(){var c;o.changeToActive(),(c=l==null?void 0:l.onStart)==null||c.call(l)},onStop:function(){var c,d,h;(c=o._validationHandler)==null||c.call(o),(d=o._silenceSubmit)==null||d.clearSilenceTimeout(),o.changeToDefault(),(h=l==null?void 0:l.onStop)==null||h.call(l)},onPauseTrigger:function(c){var d,h;(d=o._silenceSubmit)==null||d.onPause(c,e,o.elementRef.onclick),(h=l==null?void 0:l.onPauseTrigger)==null||h.call(l,c)},onPreResult:function(c,d){var h;(h=l==null?void 0:l.onPreResult)==null||h.call(l,c,d)},onResult:function(c,d){var h,p,g;d&&((h=o._validationHandler)==null||h.call(o)),(p=o._silenceSubmit)==null||p.resetSilenceTimeout(e,o.elementRef.onclick),(g=l==null?void 0:l.onResult)==null||g.call(l,c,d)},onCommandModeTrigger:function(c){var d;o.onCommandModeTrigger(c),(d=l==null?void 0:l.onCommandModeTrigger)==null||d.call(l,c)}},s))}},{key:"onCommandModeTrigger",value:function(e){e?this.changeToCommandMode():this.changeToActive()}},{key:"onError",value:function(){this._addErrorMessage("speechToText","speech input error")}}],[{key:"getServiceName",value:function(e){return e.azure?"azure":"webspeech"}},{key:"toggleSpeechAfterSubmit",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;e[de](),n||setTimeout(function(){return e[de]()},i.MICROPHONE_RESET_TIMEOUT_MS)}}])})(Oi);Ui.MICROPHONE_RESET_TIMEOUT_MS=300;var ga=Ui,ya=(function(){function a(i,t,e,n,r){var s=this;E(this,a),this._attachments=[],this._fileCountLimit=99,this._acceptedFormat="",this._hiddenAttachments=new Set,e.maxNumberOfFiles&&(this._fileCountLimit=e.maxNumberOfFiles),this._toggleContainerDisplay=n,this._fileAttachmentsContainerRef=r,e.acceptedFormats&&(this._acceptedFormat=e.acceptedFormats),setTimeout(function(){s._validationHandler=i._validationHandler,s._onInput=t.onInput})}return C(a,[{key:"attemptAddFile",value:function(t,e){var n;return a.isFileTypeValid(t,this._acceptedFormat)?(this.addAttachmentBasedOnType(t,e,!0),(n=this._onInput)==null||n.call(this,!0),!0):!1}},{key:"addAttachmentBasedOnType",value:function(t,e,n){var r=a.getTypeFromBlob(t);if(r===le){var s=a.createImageAttachment(e);this.addFileAttachment(t,le,s,n)}else if(r===ee){var o=Xr.createAudioAttachment(e);this.addFileAttachment(t,ee,o,n)}else{var l=a.createAnyFileAttachment(t.name);this.addFileAttachment(t,Ct,l,n)}}},{key:"addFileAttachment",value:function(t,e,n,r){var s,o=a.createContainer(n);if(this._attachments.length>=this._fileCountLimit){var l=this._attachments[this._attachments.length-1].removeButton;l==null||l[de]();var u=this._fileAttachmentsContainerRef.children;this._fileAttachmentsContainerRef.insertBefore(o,u[0])}else this._fileAttachmentsContainerRef.appendChild(o);var c={file:t,attachmentContainerElement:o,fileType:e};return r&&(c.removeButton=this.createRemoveAttachmentButton(c),o.appendChild(c.removeButton)),this._toggleContainerDisplay(!0),this._attachments.push(c),this._fileAttachmentsContainerRef.scrollTop=this._fileAttachmentsContainerRef.scrollHeight,(s=this._validationHandler)==null||s.call(this),c}},{key:"createRemoveAttachmentButton",value:function(t){var e=B();e[S].add("remove-file-attachment-button"),e.onclick=this.removeAttachment.bind(this,t);var n=B();return n[S].add("x-icon"),n.innerText="Ã—",e.appendChild(n),e}},{key:"removeAttachment",value:function(t,e){var n,r,s=this._attachments.findIndex(function(l){return l===t});if(!(s<0)){(n=this._onInput)==null||n.call(this,!!(e!=null&&e.isTrusted));var o=this._attachments[s].attachmentContainerElement;this._attachments.splice(s,1),Xr.stopAttachmentPlayback(o),o.remove(),this._toggleContainerDisplay(!1),(r=this._validationHandler)==null||r.call(this)}}},{key:"getFiles",value:function(){return Array.from(this._attachments).map(function(t){return f(f({},ve,t[ve]),"type",t.fileType)})}},{key:"hideAttachments",value:function(){var t=this;this._hiddenAttachments.clear(),this._attachments.forEach(function(e){setTimeout(function(){var n;return(n=e.removeButton)==null?void 0:n[de]()}),t._hiddenAttachments.add(e)})}},{key:"removeAttachments",value:function(){this._attachments.forEach(function(t){setTimeout(function(){var e;return(e=t.removeButton)==null?void 0:e[de]()})}),this._hiddenAttachments.clear()}},{key:"readdAttachments",value:function(){var t=this,e;Array.from(this._hiddenAttachments).forEach(function(n){t._fileAttachmentsContainerRef.appendChild(n.attachmentContainerElement),t._attachments.push(n)}),(e=this._onInput)==null||e.call(this,!1),this._hiddenAttachments.clear()}}],[{key:"isFileTypeValid",value:function(t,e){if(e==="")return!0;for(var n=e.split(","),r=0;r<n.length;r++){var s=n[r].trim();if(t.type===s)return!0;if(s.startsWith(".")){var o=s.slice(1);if(t.name.endsWith(o))return!0}else if(t.name.endsWith(s)||s.endsWith("/*")&&t.type.startsWith(s.slice(0,-2)))return!0}return!1}},{key:"getTypeFromBlob",value:function(t){var e=t.type;return e.startsWith(le)?le:e.startsWith(ee)?ee:Ct}},{key:"createImageAttachment",value:function(t){var e=new Image;return e[N]=t,e[S].add("image-attachment"),e}},{key:"createAnyFileAttachment",value:function(t){var e=B();e[S].add("border-bound-attachment"),Ye.IS_SAFARI&&e[S].add("border-bound-attachment-safari");var n=B();n[S].add("any-file-attachment-text");var r=B();return r[S].add("file-attachment-text-container"),r.appendChild(n),n.textContent=t,e.appendChild(r),e}},{key:"createContainer",value:function(t){var e=B();return e[S].add("file-attachment"),e.appendChild(t),e}}])})(),ji=(function(a){function i(t,e,n,r,s){return E(this,i),F(this,i,[t,e,n,r,s])}return D(i,a),C(i,[{key:"createTimer",value:function(e,n){var r=this,s=0,o=n!==void 0&&n<i.TIMER_LIMIT_S?n:i.TIMER_LIMIT_S;return setInterval(function(){var l;s+=1,s===o&&((l=r.stopPlaceholderCallback)==null||l.call(r),r.clearTimer()),s===600&&e[S].add("audio-placeholder-text-4-digits");var u=Math.floor(s/60),c=(s%60).toString().padStart(2,"0");e.textContent="".concat(u,":").concat(c)},1e3)}},{key:"createPlaceholderAudioAttachment",value:function(e){var n=i.createAudioContainer(),r=B();r[S].add("audio-placeholder-text-3-digits");var s=B();s[S].add("file-attachment-text-container","audio-placeholder-text-3-digits-container"),s.appendChild(r);var o=lt.createSVGElement(zr);return o[S].add("attachment-icon","stop-icon","not-removable-attachment-icon"),r.textContent="0:00",this._activePlaceholderTimer=this.createTimer(r,e),n.appendChild(s),this.addPlaceholderAudioAttachmentEvents(n,o,s),n}},{key:"addPlaceholderAudioAttachmentEvents",value:function(e,n,r){var s=this,o=function(){return e.replaceChildren(n)};e.addEventListener("mouseenter",o);var l=function(){return e.replaceChildren(r)};e.addEventListener("mouseleave",l);var u=function(){var d;return(d=s.stopPlaceholderCallback)==null?void 0:d.call(s)};e.addEventListener(de,u)}},{key:"addPlaceholderAttachment",value:function(e,n){var r=this.createPlaceholderAudioAttachment(n);this._activePlaceholderAttachment=this.addFileAttachment(new File([],""),ee,r,!1),this.stopPlaceholderCallback=e}},{key:"completePlaceholderAttachment",value:function(e,n){var r=this._activePlaceholderAttachment;r&&(r[ve]=e,i.addAudioElements(r.attachmentContainerElement.children[0],n),r.removeButton=this.createRemoveAttachmentButton(r),r.attachmentContainerElement.appendChild(r.removeButton),this._activePlaceholderAttachment=void 0,this.clearTimer())}},{key:"removePlaceholderAttachment",value:function(){this._activePlaceholderAttachment&&(this.removeAttachment(this._activePlaceholderAttachment),this._activePlaceholderAttachment=void 0,this.clearTimer())}},{key:"clearTimer",value:function(){this._activePlaceholderTimer!==void 0&&(clearInterval(this._activePlaceholderTimer),this._activePlaceholderTimer=void 0,this.stopPlaceholderCallback=void 0)}}],[{key:"createAudioContainer",value:function(){var e=B();return e[S].add("border-bound-attachment","audio-attachment-icon-container"),Ye.IS_SAFARI&&e[S].add("border-bound-attachment-safari"),e}},{key:"addAudioElements",value:function(e,n){var r=e.parentElement?oe.cloneElement(e):e,s=B(ee);s[N]=n;var o=lt.createSVGElement(gi);o[S].add("attachment-icon","play-icon");var l=lt.createSVGElement(zr);l[S].add("attachment-icon","stop-icon"),r.replaceChildren(o),s.onplay=function(){r.replaceChildren(l)},s.onpause=function(){r.replaceChildren(o),s.currentTime=0},s.onended=function(){r.replaceChildren(o)},oe.assignButtonEvents(r,function(){s.paused?s.play():s.pause()})}},{key:"createAudioAttachment",value:function(e){var n=i.createAudioContainer();return i.addAudioElements(n,e),n}},{key:"stopAttachmentPlayback",value:function(e){var n,r,s;(s=(r=(n=e.children[0])==null?void 0:n.children)==null?void 0:r[0])!=null&&s[S].contains("stop-icon")&&e.children[0][de]()}}])})(ya);ji.TIMER_LIMIT_S=5999;var Xr=ji,_h=(function(){function a(){E(this,a)}return C(a,null,[{key:"create",value:function(t,e,n,r,s,o){return o===ee?new Xr(t,e,n,r,s):new ya(t,e,n,r,s)}}])})(),ba=(function(){function a(i,t,e){E(this,a),this._fileAttachmentsTypes=[],this.elementRef=this.createAttachmentContainer();var n=R(e)=="object"&&!!e.displayFileAttachmentContainer;this.toggleContainerDisplay(n),i.appendChild(this.elementRef),t&&Object.assign(this.elementRef[M],t)}return C(a,[{key:"addType",value:function(t,e,n,r){var s=_h.create(t,e,n,this.toggleContainerDisplay.bind(this),this.elementRef,r);return this._fileAttachmentsTypes.push(s),s}},{key:"createAttachmentContainer",value:function(){var t=B();return t.id="file-attachment-container",t}},{key:"toggleContainerDisplay",value:function(t){t?this.elementRef[M].display="block":this.elementRef.children.length===0&&(this.elementRef[M].display="none")}},{key:"getAllFileData",value:function(){var t=this._fileAttachmentsTypes.map(function(e){return e.getFiles()}).flat();return t.length>0?t:void 0}},{key:"completePlaceholders",value:(function(){var i=w(v().m(function e(){return v().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,Promise.all(this._fileAttachmentsTypes.map((function(){var r=w(v().m(function s(o){var l;return v().w(function(u){for(;;)if(u.n===0)return u.a(2,(l=o.stopPlaceholderCallback)==null?void 0:l.call(o))},s)}));return function(s){return r.apply(this,arguments)}})()));case 1:return n.a(2)}},e,this)}));function t(){return i.apply(this,arguments)}return t})()},{key:"addFilesToAnyType",value:function(t){a.addFilesToType(t,this._fileAttachmentsTypes)}},{key:"hideFiles",value:function(){this._fileAttachmentsTypes.forEach(function(t){return t.hideAttachments()}),this.elementRef.replaceChildren(),this.toggleContainerDisplay(!1)}},{key:"removeHiddenFiles",value:function(){this._fileAttachmentsTypes.forEach(function(t){return t.removeAttachments()})}},{key:"readdHiddenFiles",value:function(){this._fileAttachmentsTypes.forEach(function(t){return t.readdAttachments()}),this.toggleContainerDisplay(!0)}},{key:"getNumberOfTypes",value:function(){return this._fileAttachmentsTypes.length}}],[{key:"addFilesToType",value:function(t,e){t.forEach(function(n){var r=new FileReader;r.readAsDataURL(n),r.onload=function(s){for(var o=0;o<e.length&&!e[o].attemptAddFile(n,s.target.result);o+=1);}})}}])})(),Hi=(function(){function a(i,t,e){E(this,a),this._isOpen=!1,this._contentRef=a.createModalContent(t,e==null?void 0:e.backgroundColor),this._buttonPanel=a.createButtonPanel(e==null?void 0:e.backgroundColor),this._elementRef=a.createContainer(this._contentRef,e),this._elementRef.appendChild(this._buttonPanel),i.appendChild(this._elementRef),this._backgroundPanelRef=a.createDarkBackgroundPanel(),i.appendChild(this._backgroundPanelRef),this.addWindowEvents(i)}return C(a,[{key:"isOpen",value:function(){return this._isOpen}},{key:"addButtons",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(function(s){Pe.addAttributes(s),t._buttonPanel.appendChild(s)})}},{key:"close",value:function(){var t=this;this._elementRef[S].remove("show-modal"),this._elementRef[S].add("hide-modal"),this._backgroundPanelRef[S].remove("show-modal-background"),this._backgroundPanelRef[S].add("hide-modal-background"),this._isOpen=!1,setTimeout(function(){t._elementRef[M].display="none",t._backgroundPanelRef[M].display="none"},a.MODAL_CLOSE_TIMEOUT_MS)}},{key:"displayModalElements",value:function(){this._elementRef[M].display="flex",this._elementRef[S].remove("hide-modal"),this._elementRef[S].add("show-modal"),this._backgroundPanelRef[M].display="block",this._backgroundPanelRef[S].remove("hide-modal-background"),this._backgroundPanelRef[S].add("show-modal-background"),this._isOpen=!0}},{key:"openTextModal",value:function(t){this._contentRef.innerHTML=t,this.displayModalElements()}},{key:"addCloseButton",value:function(t,e,n){var r=this,s=e?a.createSVGButton(t):a.createTextButton(t);return this.addButtons(s),oe.assignButtonEvents(s,function(){r.close(),setTimeout(function(){n==null||n()},140)}),s}},{key:"addWindowEvents",value:function(t){this.keyDownEvent=this.windowKeyDown.bind(this,t),window.addEventListener("keydown",this.keyDownEvent)}},{key:"windowKeyDown",value:function(t,e){var n,r;!t.isConnected&&this.keyDownEvent?window.removeEventListener("keydown",this.keyDownEvent):this._isOpen&&(e.key===Ae.ESCAPE?(this.close(),(n=this.extensionCloseCallback)==null||n.call(this)):e.key===Ae.ENTER&&(this.close(),(r=this.extensionCloseCallback)==null||r.call(this)))}}],[{key:"createContainer",value:function(t,e){var n=B();return n[S].add("modal"),n.appendChild(t),e&&delete e.backgroundColor,Object.assign(n[M],e),n}},{key:"createModalContent",value:function(t,e){var n,r=B();return(n=r[S]).add.apply(n,_t(t)),e&&(r[M].backgroundColor=e),B().appendChild(r),r}},{key:"createButtonPanel",value:function(t){var e=B();return e[S].add("modal-button-panel"),t&&(e[M].backgroundColor=t),e}},{key:"createDarkBackgroundPanel",value:function(){var t=B();return t.id="modal-background-panel",t}},{key:"createTextButton",value:function(t){var e=B();return e[S].add("modal-button"),e.textContent=t,e}},{key:"createSVGButton",value:function(t){var e=B();e[S].add("modal-button","modal-svg-button");var n=lt.createSVGElement(t);return n[S].add("modal-svg-button-icon"),e.appendChild(n),e}},{key:"createTextModalFunc",value:function(t,e,n){var r;if(R(e)=="object"&&(r=e[T])!=null&&r.infoModal){var s=new a(t,["modal-content"],e[T].infoModal.containerStyle);return s.addCloseButton("OK",!1,n),s.openTextModal.bind(s,e.infoModalTextMarkUp||"")}}}])})();Hi.MODAL_CLOSE_TIMEOUT_MS=190;var En=Hi,kh=(function(a){function i(t,e,n,r,s,o){var l;E(this,i);var u,c,d,h,p,g,m,b,k,A,I=_e.processPosition((u=n==null?void 0:n.button)==null?void 0:u.position),x=((h=(d=(c=n==null?void 0:n.button)==null?void 0:c.styles)==null?void 0:d[y])==null?void 0:h.content)||o,U=ut.tryCreateConfig("Upload File",(p=n==null?void 0:n.button)==null?void 0:p.tooltip);l=F(this,i,[i.createButtonElement(),s,I,U,n.button,x]);var j=l.createInnerElementsForStates(r,l.customStyles);return l._inputElement=i.createInputElement((g=n==null?void 0:n[T])==null?void 0:g.acceptedFormats),l.addClickEvent(t,n),l.changeElementsByState(j.styles),l.reapplyStateStyle("styles"),l._fileAttachmentsType=e,l._openModalOnce=((b=(m=n[T])==null?void 0:m.infoModal)==null?void 0:b.openModalOnce)===!1||(A=(k=n[T])==null?void 0:k.infoModal)==null?void 0:A.openModalOnce,l}return D(i,a),C(i,[{key:"createInnerElementsForStates",value:function(e,n){return{styles:this.createInnerElements(e,"styles",n)}}},{key:"triggerImportPrompt",value:function(e){e.onchange=this.import.bind(this,e),e[de]()}},{key:"import",value:function(e){ba.addFilesToType(Array.from(e[T]||[]),[this._fileAttachmentsType]),e.value=""}},{key:"addClickEvent",value:function(e,n){var r=this.triggerImportPrompt.bind(this,this._inputElement),s=En.createTextModalFunc(e,n,r);this.elementRef.onclick=this[de].bind(this,s)}},{key:"click",value:function(e){e&&(this._openModalOnce===void 0||this._openModalOnce===!0)?(e(),this._openModalOnce===!0&&(this._openModalOnce=!1)):this.triggerImportPrompt(this._inputElement)}}],[{key:"createInputElement",value:function(e){var n=B("input");return n.type=ve,n.accept=e||"",n.hidden=!0,n.multiple=!0,n}},{key:"createButtonElement",value:function(){var e=B();return e[S].add("input-button"),e}}])})(Bt),Cs=(function(){function a(){E(this,a)}return C(a,null,[{key:"create",value:function(t,e,n){var r=a.createElement(n);a.addEvents(r,t,e),t.appendChild(r)}},{key:"createElement",value:function(t){var e=B();return e.id="drag-and-drop",R(t)===Q&&Object.assign(e[M],t),e}},{key:"addEvents",value:function(t,e,n){e.ondragenter=function(r){r.preventDefault(),a.display(t)},t.ondragleave=function(r){r.preventDefault(),a.hide(t)},t.ondragover=function(r){r.preventDefault()},t.ondrop=function(r){r.preventDefault(),a.uploadFile(n,r),a.hide(t)}}},{key:"uploadFile",value:function(t,e){var n,r=(n=e.dataTransfer)==null?void 0:n[T];r&&t.addFilesToAnyType(Array.from(r))}},{key:"display",value:function(t){t[M].display="block"}},{key:"hide",value:function(t){t[M].display="none"}},{key:"isEnabled",value:function(t,e){return e!==void 0&&e===!1?!1:!!e||t.getNumberOfTypes()>0}}])})(),Sh=(function(){function a(){E(this,a)}return C(a,null,[{key:"validate",value:function(t,e,n,r,s,o,l){var u=n.isSubmitProgrammaticallyDisabled?!1:t(r,s,l);return u?e.changeToSubmitIcon():e.changeToDisabledIcon(),o==null||o.addInputText(r||""),u}},{key:"useValidationFunc",value:(function(){var i=w(v().m(function e(n,r,s,o,l,u){var c,d,h;return v().w(function(p){for(;;)switch(p.n){case 0:return c=r.isTextInputEmpty()?"":r.inputElementRef.textContent,p.n=1,s.completePlaceholders();case 1:return d=s.getAllFileData(),h=d==null?void 0:d.map(function(g){return g[ve]}),p.a(2,a.validate(n,o,l,c,h,u))}},e)}));function t(e,n,r,s,o,l){return i.apply(this,arguments)}return t})()},{key:"useValidationFuncProgrammatic",value:(function(){var i=w(v().m(function e(n,r,s,o,l){var u,c;return v().w(function(d){for(;;)if(d.n===0)return c=(u=r[T])==null?void 0:u.map(function(h){return h[ve]}),d.a(2,a.validate(n,s,o,r[y],c,l,!0))},e)}));function t(e,n,r,s,o){return i.apply(this,arguments)}return t})()},{key:"validateWebsocket",value:function(t,e){var n=t.websocket,r=t.connectSettings;return n&&r.url!==ct.URL&&!Pn.canSendMessage(n)?(e.changeToDisabledIcon(),!1):!0}},{key:"attach",value:function(t,e,n,r,s,o){var l=t.validateInput||_e.processValidateInput(t);t._validationHandler=(function(){var u=w(v().m(function c(d){var h;return v().w(function(p){for(;;)switch(p.n){case 0:if(!(s.status.loadingActive||s.status.requestInProgress||!a.validateWebsocket(e,s))){p.n=1;break}return p.a(2,!1);case 1:return h=l||e.canSendMessage,p.a(2,h?d?a.useValidationFuncProgrammatic(h,d,s,e,o):a.useValidationFunc(h,n,r,s,e,o):null)}},c)}));return function(c){return u.apply(this,arguments)}})()}}])})(),qi=(function(){function a(){E(this,a)}return C(a,null,[{key:"getFileName",value:function(t,e){var n=new Date,r=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),o=String(n.getSeconds()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(s,"-").concat(o,".").concat(e)}}])})(),wh=(function(a){function i(t,e){var n;E(this,i);var r,s;return n=F(this,i,[e.button]),n._waitingForBrowserApproval=!1,n._audioType=t,n._extension=((r=e[T])==null?void 0:r.format)||"mp3",n._maxDurationSeconds=(s=e[T])==null?void 0:s.maxDurationSeconds,oe.assignButtonEvents(n.elementRef,n.buttonClick.bind(zt(n))),n}return D(i,a),C(i,[{key:"buttonClick",value:function(){this._waitingForBrowserApproval||(this.isActive?this.stop():(this._waitingForBrowserApproval=!0,this.record()))}},{key:"stop",value:function(){var e=this;return new Promise(function(n){var r,s;e.changeToDefault(),(r=e._mediaRecorder)==null||r.stop(),(s=e._mediaStream)==null||s.getTracks().forEach(function(o){return o.stop()}),setTimeout(function(){n()},10)})}},{key:"record",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0}).then(function(n){e.changeToActive(),e._mediaRecorder=new MediaRecorder(n),e._audioType.addPlaceholderAttachment(e.stop.bind(e),e._maxDurationSeconds),e._mediaStream=n,e._mediaRecorder.addEventListener("dataavailable",function(r){e.createFile(r)}),e._mediaRecorder[pt]()}).catch(function(n){console[_](n),e.stop()}).finally(function(){e._waitingForBrowserApproval=!1})}},{key:"createFile",value:function(e){var n=this,r=new Blob([e.data],{type:"audio/".concat(this._extension)}),s=qi.getFileName(this._newFilePrefix||ee,this._extension),o=new File([r],s,{type:r.type}),l=new FileReader;l.readAsDataURL(o),l.onload=function(u){n._audioType.completePlaceholderAttachment(o,u.target.result)}}}])})(Oi),Eh=`<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="none" stroke-width="1" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
  <line x1="22" y1="2" x2="11" y2="14"></line>
  <polygon points="22 2 15 22 11 14 2 10 22 2"></polygon>
</svg>
`,Ts=(function(){function a(){E(this,a)}return C(a,null,[{key:"resetSubmit",value:function(t,e){e?t.unsetCustomStateStyles(["loading","submit"]):t.unsetCustomStateStyles(["stop","loading","submit"]),t.reapplyStateStyle("submit")}},{key:"overwriteDefaultStyleWithSubmit",value:function(t,e){if(t.submit){var n=L(t[e]||{});st.overwritePropertyObjectFromAnother(n,t.submit,["container",O]),st.overwritePropertyObjectFromAnother(n,t.submit,[y,"styles",O]),st.overwritePropertyObjectFromAnother(n,t.submit,["svg","styles",O]),t[e]=n}}},{key:"setUpDisabledButton",value:function(t){st.setPropertyValueIfDoesNotExist(t,["submit","container",O,"backgroundColor"],""),st.setPropertyValueIfDoesNotExist(t,[ae,"container",O,"backgroundColor"],ro),st.setPropertyValueIfDoesNotExist(t.submit,["svg","styles",O,"filter"],""),st.setPropertyValueIfDoesNotExist(t[ae],["svg","styles",O,"filter"],"brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(5564%) hue-rotate(207deg) brightness(100%) contrast(97%)"),st.setPropertyValueIfDoesNotExist(t[ae],[y,"styles",O,"color"],"grey"),a.overwriteDefaultStyleWithSubmit(t,ae)}},{key:"process",value:function(t){var e=L(t||{});return a.overwriteDefaultStyleWithSubmit(e,"loading"),a.overwriteDefaultStyleWithSubmit(e,"stop"),t!=null&&t.alwaysEnabled||a.setUpDisabledButton(e),e}}])})(),Ch=(function(a){function i(t,e,n,r,s,o){var l;E(this,i);var u=Ts.process(t.submitButtonStyles),c=Eh,d=ut.tryCreateConfig("Submit",u==null?void 0:u.tooltip);return l=F(this,i,[i.createButtonContainerElement(),c,u==null?void 0:u.position,d,u]),l._isSVGLoadingIconOverriden=!1,l.status={requestInProgress:!1,loadingActive:!1},l._messages=n,l._textInput=e,l._fileAttachments=s,l._innerElements=l.createInnerElementsForStates(),l._stopClicked={listener:function(){}},l._serviceIO=r,l._alwaysEnabled=!!(u!=null&&u.alwaysEnabled),t.disableSubmitButton=l.disableSubmitButton.bind(zt(l),r),l.attemptOverwriteLoadingStyle(t),o.microphone&&l.setUpSpeechToText(o.microphone.button,t.speechToText),setTimeout(function(){var h;l._validationHandler=t._validationHandler,l.assignHandlers(l._validationHandler),(h=l._validationHandler)==null||h.call(zt(l))}),l}return D(i,a),C(i,[{key:"createInnerElementsForStates",value:function(){var e=this.createCustomElements(),n=e.submit,r=e.loading,s=e.stop;return f({submit:n,loading:r||[i.createLoadingIconElement()],stop:s||[i.createStopIconElement()]},ae,this.createDisabledIconElement(n))}},{key:"createCustomElements",value:function(){var e=this,n=mt.createCustomElements("submit",this.svg,this.customStyles),r={loading:void 0,stop:void 0};return Object.keys(r).forEach(function(s){var o=s,l=mt.createCustomElements(o,e.svg,e.customStyles);l&&(r[o]=l)}),r.submit=n||this.buildDefaultIconElement("submit-icon"),r}},{key:"createDisabledIconElement",value:function(e){return mt.createCustomElements(ae,this.svg,this.customStyles)||[e[0].cloneNode(!0)]}},{key:"attemptOverwriteLoadingStyle",value:function(e){var n,r,s,o,l,u,c,d,h;if(!((r=(n=this.customStyles)==null?void 0:n.submit)!=null&&r.svg||(l=(o=(s=this.customStyles)==null?void 0:s.loading)==null?void 0:o.svg)!=null&&l.content||(d=(c=(u=this.customStyles)==null?void 0:u.loading)==null?void 0:c[y])!=null&&d.content)&&(e.displayLoadingBubble===void 0||e.displayLoadingBubble===!0)){var p=B("style");p.textContent=`
        .loading-button > * {
          filter: brightness(0) saturate(100%) invert(72%) sepia(0%) saturate(3044%) hue-rotate(322deg) brightness(100%)
            contrast(96%) !important;
        }`,(h=e.shadowRoot)==null||h.appendChild(p),this._isSVGLoadingIconOverriden=!0}}},{key:"assignHandlers",value:function(e){this._serviceIO.completionsHandlers={onFinish:this.resetSubmit.bind(this,e)},this._serviceIO.streamHandlers={onOpen:this.changeToStopIcon.bind(this),onClose:this.resetSubmit.bind(this,e),stopClicked:this._stopClicked};var n=this._serviceIO.stream;R(n)=="object"&&typeof n.simulation=="number"&&(this._serviceIO.streamHandlers.simulationInterim=n.simulation)}},{key:"setUpSpeechToText",value:function(e,n){this._microphoneButton=e,this._stopSTTAfterSubmit=R(n)=="object"?n.stopAfterSubmit:!1}},{key:"resetSubmit",value:function(e){this.status.requestInProgress=!1,this.status.loadingActive=!1,e()}},{key:"submitFromInput",value:(function(){var t=w(v().m(function n(){var r=this,s,o;return v().w(function(l){for(;;)switch(l.n){case 0:return l.n=1,this._fileAttachments.completePlaceholders();case 1:s=this._fileAttachments.getAllFileData(),this._textInput.isTextInputEmpty()?this.attemptSubmit(f(f({},y,""),T,s)):(o=this._textInput.inputElementRef.innerText.trim(),this.attemptSubmit(f(f({},y,o),T,s))),(Ye.IS_SAFARI||Ye.IS_MOBILE)&&setTimeout(function(){return Mn.focusEndOfInput(r._textInput.inputElementRef)});case 2:return l.a(2)}},n,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"programmaticSubmit",value:(function(){var t=w(v().m(function n(r){var s=this,o;return v().w(function(l){for(;;)switch(l.n){case 0:typeof r=="string"&&(r=_e.processSubmitUserMessage(r)),o=f({},y,r[y]),r[T]&&(o[T]=Array.from(r[T]).map(function(u){return{file:u,type:ya.getTypeFromBlob(u)}})),r.custom&&(o.custom=r.custom),setTimeout(function(){return s.attemptSubmit(o,!0)});case 1:return l.a(2)}},n)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"attemptSubmit",value:(function(){var t=w(v().m(function n(r){var s=this,o,l,u,c,d,h,p,g=arguments,m,b,k;return v().w(function(A){for(;;)switch(A.n){case 0:return o=g.length>1&&g[1]!==void 0?g[1]:!1,A.n=1,(l=this._validationHandler)==null?void 0:l.call(this,o?r:void 0);case 1:if(m=A.v,b=!1,m!==b){A.n=2;break}return A.a(2);case 2:if(this.changeToLoadingIcon(),this._textInput.clear(),Ye.IS_MOBILE&&setTimeout(function(){return s._textInput.inputElementRef.focus()}),k=typeof this._messages.focusMode!="boolean"&&(u=this._messages.focusMode)!=null&&u.fade,!k){A.n=3;break}return A.n=3,ni.fadeAnimation(this._messages.elementRef,this._messages.focusMode.fade);case 3:return A.n=4,this.addNewMessage(r);case 4:return this._serviceIO.isWebModel()||this._messages.addLoadingMessage(),h=(c=r[T])==null?void 0:c.map(function(I){return I[ve]}),p=f(f({},y,r[y]===""?void 0:r[y]),T,h),A.n=5,this._serviceIO.callAPI(p,this._messages);case 5:(d=this._fileAttachments)==null||d.hideFiles();case 6:return A.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"addNewMessage",value:(function(){var t=w(v().m(function n(r){var s,o,l,u,c;return v().w(function(d){for(;;)switch(d.n){case 0:if(s=r.text,o=r.files,l=r.custom,u=f(f({},P,Z),"custom",l),s&&(u[y]=s),c=o,!c){d.n=2;break}return d.n=1,this._messages.addMultipleFiles(o,this._fileAttachments);case 1:u[T]=d.v;case 2:this._serviceIO.sessionId&&(u._sessionId=this._serviceIO.sessionId),Object.keys(u).length>0&&this._messages.addNewMessage(u);case 3:return d.a(2)}},n,this)}));function e(n){return t.apply(this,arguments)}return e})()},{key:"stopStream",value:function(){var e,n,r;(n=(e=this._serviceIO.streamHandlers).onAbort)==null||n.call(e),(r=this._stopClicked)==null||r.listener(),this._validationHandler&&this.resetSubmit(this._validationHandler)}},{key:"changeToStopIcon",value:function(){this._serviceIO.websocket||(this.elementRef[S].remove(Un,Yt,Zt),Pe.removeAriaAttributes(this.elementRef),this.changeElementsByState(this._innerElements.stop),this.reapplyStateStyle("stop",["loading","submit"]),oe.assignButtonEvents(this.elementRef,this.stopStream.bind(this)),this.status.loadingActive=!1)}},{key:"changeToLoadingIcon",value:function(){this._serviceIO.websocket||(this._isSVGLoadingIconOverriden||this.changeElementsByState(this._innerElements.loading),this.elementRef[S].remove(Zt,Yt),Pe.removeAriaDisabled(this.elementRef),this.elementRef[S].add(Un),Pe.addAriaBusy(this.elementRef),this.reapplyStateStyle("loading",["submit"]),oe.assignButtonEvents(this.elementRef,function(){}),this.status.requestInProgress=!0,this.status.loadingActive=!0)}},{key:"changeToSubmitIcon",value:function(){var e=this;this.elementRef[S].contains(Zt)||(this.elementRef[S].remove(Un,Yt),Pe.removeAriaAttributes(this.elementRef),this.elementRef[S].add(Zt),this.changeElementsByState(this._innerElements.submit),Ts.resetSubmit(this,this.status.loadingActive),oe.assignButtonEvents(this.elementRef,function(){var n;e.submitFromInput(),(n=e._microphoneButton)!=null&&n.isActive&&ga.toggleSpeechAfterSubmit(e._microphoneButton.elementRef,!!e._stopSTTAfterSubmit),setTimeout(function(){return Mn.focusEndOfInput(e._textInput.inputElementRef)})}))}},{key:"changeToDisabledIcon",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this._alwaysEnabled&&!e?this.changeToSubmitIcon():this.elementRef[S].contains(Yt)||(this.elementRef[S].remove(Un,Zt),Pe.removeAriaBusy(this.elementRef),this.elementRef[S].add(Yt),Pe.addAriaDisabled(this.elementRef),this.changeElementsByState(this._innerElements[ae]),this.reapplyStateStyle(ae,["submit"]),oe.assignButtonEvents(this.elementRef,function(){}))}},{key:"disableSubmitButton",value:function(e,n){var r;e.isSubmitProgrammaticallyDisabled=n!==!1,!(this.status.requestInProgress||this.status.loadingActive)&&(n===!1?(r=this._validationHandler)==null||r.call(this):this.changeToDisabledIcon(!0))}}],[{key:"createButtonContainerElement",value:function(){var e=B();return e[S].add("input-button"),e}},{key:"createLoadingIconElement",value:function(){var e=B();return e[S].add("loading-submit-button"),e}},{key:"createStopIconElement",value:function(){var e=B();return e.id="stop-icon",e}}])})(Bt),Th=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
  <path d="M27.1 14.313V5.396L24.158 8.34c-2.33-2.325-5.033-3.503-8.11-3.503C9.902 4.837 4.901 9.847 4.899 16c.001 6.152 5.003 11.158 11.15 11.16 4.276 0 9.369-2.227 10.836-8.478l.028-.122h-3.23l-.022.068c-1.078 3.242-4.138 5.421-7.613 5.421a8 8 0 0 1-5.691-2.359A7.993 7.993 0 0 1 8 16.001c0-4.438 3.611-8.049 8.05-8.049 2.069 0 3.638.58 5.924 2.573l-3.792 3.789H27.1z"/>
</svg>
`,Ah=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 16q0 3.264 1.28 6.208t3.392 5.12 5.12 3.424 6.208 1.248 6.208-1.248 5.12-3.424 3.392-5.12 1.28-6.208-1.28-6.208-3.392-5.12-5.088-3.392-6.24-1.28q-3.264 0-6.208 1.28t-5.12 3.392-3.392 5.12-1.28 6.208zM4 16q0-3.264 1.6-6.016t4.384-4.352 6.016-1.632 6.016 1.632 4.384 4.352 1.6 6.016-1.6 6.048-4.384 4.352-6.016 1.6-6.016-1.6-4.384-4.352-1.6-6.048z"></path>
</svg>
`,Mh=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
  <path d="M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z"/>
</svg>`,Ih=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M4.89163 13.2687L9.16582 17.5427L18.7085 8" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,Rh=(function(a){function i(t,e,n,r){var s;E(this,i),s=F(this,i,[t,["modal-content","modal-camera-content"],n]),s._stopped=!1,s._format="image/png",s._canvas=B("canvas"),s._canvas[S].add("camera-modal-canvas");var o=s.addButtonsAndTheirEvents(e),l=o.captureButton,u=o.submitButton;return s._captureButton=l,s._submitButton=u,s._captureIcon=s._captureButton.children[0],s._refreshIcon=lt.createSVGElement(Th),s._refreshIcon[S].add("modal-svg-button-icon","modal-svg-refresh-icon"),(r==null?void 0:r.format)==="jpeg"&&(s._format="image/jpeg"),r!=null&&r.dimensions&&(s._dimensions=r.dimensions),s._contentRef.appendChild(s._canvas),s.extensionCloseCallback=s.stop,s}return D(i,a),C(i,[{key:"addButtonsAndTheirEvents",value:function(e){var n=En.createSVGButton(Ah);n[S].add("modal-svg-camera-button"),n.children[0][S].add("modal-svg-camera-icon");var r=this.addCloseButton(Mh,!0);r[S].add("modal-svg-close-button"),r.children[0][S].add("modal-svg-close-icon");var s=En.createSVGButton(Ih);return s[S].add("modal-svg-submit-button"),this.addButtons(n,s),this.addButtonEvents(n,r,s,e),{captureButton:n,submitButton:s}}},{key:"addButtonEvents",value:function(e,n,r,s){var o=this;oe.assignButtonEvents(e,this.capture.bind(this)),oe.assignButtonEvents(n,this.stop.bind(this)),oe.assignButtonEvents(r,function(){var l=o.getFile();l&&ba.addFilesToType([l],[s]),o.stop(),o.close()})}},{key:"stop",value:function(){var e=this;this._mediaStream&&this._mediaStream.getTracks().forEach(function(n){return n.stop()}),this._stopped=!0,setTimeout(function(){e._captureButton.replaceChildren(e._captureIcon),e._captureButton[S].replace("modal-svg-refresh-button","modal-svg-camera-button");var n=e._canvas.getContext("2d");n==null||n.clearRect(0,0,e._canvas.width,e._canvas.height)},En.MODAL_CLOSE_TIMEOUT_MS)}},{key:"start",value:function(){var e=this;this._dataURL=void 0,this._submitButton[S].add("modal-svg-submit-".concat(ae)),this._stopped=!1,navigator.mediaDevices.getUserMedia({video:this._dimensions||!0}).then(function(n){if(e._mediaStream=n,!e.isOpen())return e.stop();var r=B("video");r.srcObject=n,r.play(),requestAnimationFrame(e.updateCanvas.bind(e,r,e._canvas))}).catch(function(n){console[_](n),e.stop(),e.close()})}},{key:"capture",value:function(){this._dataURL?(this._captureButton.replaceChildren(this._captureIcon),this._captureButton[S].replace("modal-svg-refresh-button","modal-svg-camera-button"),this._submitButton[S].add("modal-svg-submit-".concat(ae)),this._dataURL=void 0):(this._captureButton.replaceChildren(this._refreshIcon),this._captureButton[S].replace("modal-svg-camera-button","modal-svg-refresh-button"),this._submitButton[S].remove("modal-svg-submit-".concat(ae)),this._dataURL=this._canvas.toDataURL())}},{key:"getFile",value:function(){if(this._dataURL){for(var e=atob(this._dataURL.split(",")[1]),n=new Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);var s=new Uint8Array(n),o=new Blob([s],{type:this._format}),l=this._format==="image/jpeg"?"jpeg":"png",u=qi.getFileName(this._newFilePrefix||"photo",l);return new File([o],u,{type:o.type})}}},{key:"updateCanvas",value:function(e,n){if(!this._stopped){if(!this._dataURL){n.width=e.videoWidth,n.height=e.videoHeight;var r=n.getContext("2d");r==null||r.drawImage(e,0,0,n.width,n.height)}requestAnimationFrame(this.updateCanvas.bind(this,e,n))}}},{key:"openCameraModal",value:function(e){this.displayModalElements(),e[pt]()}}],[{key:"createCameraModalFunc",value:function(e,n,r,s){var o=new i(e,n,r,s);return o.openCameraModal.bind(o,o)}}])})(En),Ph=`<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M29 7h-4.599l-2.401-4h-12l-2.4 4h-4.6c-1 0-3 1-3 2.969v16.031c0 1.657 1.5 3 2.792 3h26.271c1.313 0 2.938-1.406 2.938-2.968v-16.032c0-1-1-3-3-3zM30 26.032c0 0.395-0.639 0.947-0.937 0.969h-26.265c-0.232-0.019-0.797-0.47-0.797-1v-16.031c0-0.634 0.851-0.953 1-0.969h5.732l2.4-4h9.802l1.785 3.030 0.55 0.97h5.731c0.705 0 0.99 0.921 1 1v16.032zM16 10c-3.866 0-7 3.134-7 7s3.134 7 7 7 7-3.134 7-7-3.134-7-7-7zM16 22c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"></path>
</svg>`,xh=(function(a){function i(t,e,n){var r;E(this,i);var s,o,l,u,c,d,h=_e.processPosition((s=n==null?void 0:n.button)==null?void 0:s.position),p=((u=(l=(o=n==null?void 0:n.button)==null?void 0:o.styles)==null?void 0:l[y])==null?void 0:u.content)||"Photo",g=ut.tryCreateConfig("Camera",(c=n==null?void 0:n.button)==null?void 0:c.tooltip),m=((d=n==null?void 0:n.button)==null?void 0:d.styles)||{};r=F(this,i,[i.createButtonElement(),Ph,h,g,m,p]);var b=r.createInnerElementsForStates(r.customStyles);return n&&r.addClickEvent(t,e,n.modalContainerStyle,n[T]),r.changeElementsByState(b.styles),r.reapplyStateStyle("styles"),r}return D(i,a),C(i,[{key:"createInnerElementsForStates",value:function(e){return{styles:this.createInnerElements("camera-icon","styles",e)}}},{key:"addClickEvent",value:function(e,n,r,s){var o=Rh.createCameraModalFunc(e,n,r,s);oe.assignButtonEvents(this.elementRef,o)}}],[{key:"createButtonElement",value:function(){var e=B();return e[S].add("input-button"),e}}])})(Bt),Bh=(function(){function a(i,t,e,n){E(this,a),this.elementRef=a.createPanelElement(i.inputAreaStyle);var r={},s=this.createFileUploadComponents(i,e,n,r),o=new Us(i,e,s,t.browserStorage);i.speechToText&&!r.microphone&&(r.microphone={button:new ga(i,o,t.addNewErrorMessage.bind(t))});var l=new Ch(i,o,t,e,s,r);o.submit=l.submitFromInput.bind(l),Sh.attach(i,e,o,s,l,t.browserStorage),i.submitUserMessage=l.programmaticSubmit.bind(l),r.submit={button:l},i.customButtons&&Tn.add(i,r),a.addElements(this.elementRef,o,r,n,s,i.dropupStyles),a.assignOnInput(i,e,s,o)}return C(a,[{key:"createFileUploadComponents",value:function(t,e,n,r){var s,o,l,u,c=new ba(this.elementRef,t.attachmentContainerStyle,e.demo);if(a.createUploadButtons(t,e,e.fileTypes||{},c,n,r),(s=e[je])!=null&&s[T]){var d=((o=r[pe])==null?void 0:o.fileType)||c.addType(t,e,e[je][T],pe);r[je]={button:new xh(n,d,e[je])}}if((l=e.recordAudio)!=null&&l[T]){var h=((u=r[ee])==null?void 0:u.fileType)||c.addType(t,e,e.recordAudio[T],ee);r.microphone={button:new wh(h,e.recordAudio)}}return Cs.isEnabled(c,t.dragAndDrop)&&Cs.create(n,c,t.dragAndDrop),c}}],[{key:"createPanelElement",value:function(t){var e=B();return e.id="input",Object.assign(e[M],t),e}},{key:"createUploadButtons",value:function(t,e,n,r,s,o){Object.keys(n).forEach(function(l){var u=l,c=n[u];if(c[T]){var d=r.addType(t,e,c[T],u),h=th[u],p=h.id,g=h.svgString,m=h.dropupText,b=new kh(s,d,c,p,g,m);o[u]={button:b,fileType:d}}})}},{key:"addElements",value:function(t,e,n,r,s,o){oe.addElements(t,e.elementRef);var l=ar.create(),u=Jd.addButtons(l,n,r,o);Kd.set(e.inputElementRef,l,s.elementRef,u),ar.add(t,l)}},{key:"assignOnInput",value:function(t,e,n,r){e.onInput=function(s){setTimeout(function(){var o=n.getAllFileData(),l=r.inputElementRef.innerText.trim(),u=f({},y,l);o&&(u[T]=o.map(function(c){return c[ve]})),Mt.onInput(t,u,s)})}}}])})(),Oh=(function(){function a(){E(this,a)}return C(a,null,[{key:"createElements",value:function(t,e,n){var r=B();r.id="chat-view";var s=!t.focusMode&&t.upwardsMode;r.classList.add(s?Hd:jd);var o=new $r(t,e,n);e.websocket&&Pn.createConnection(e,o);var l=new Bh(t,o,e,r),u=s?o.elementRef.parentElement:o.elementRef;return oe.addElements(r,u,l.elementRef),r}},{key:"render",value:function(t,e,n,r){var s=a.createElements(t,n,r);e.replaceChildren(s),n.isCustomView()&&n.setUpView(s,e)}}])})(),Lh=`#validate-property-key-view{height:100%;position:relative;display:flex;justify-content:center;align-items:center;padding:8px}#loading-validate-key-property{display:inline-block;width:50px;height:50px}#loading-validate-key-property:after{content:" ";display:block;width:38px;height:38px;margin:1px;border-radius:50%;border:5px solid #5fb2ff;border-color:#5fb2ff transparent #5fb2ff transparent;animation:loading-spinner 1.4s linear infinite}#deep-chat-openai-realtime-container{height:100%;width:100%}#deep-chat-openai-realtime-avatar-container{height:60%;width:100%;display:flex;justify-content:center;align-items:center}#deep-chat-openai-realtime-avatar{border-radius:50%;height:110px;border:1px solid rgb(215,215,215);padding:8px;-webkit-user-select:none;user-select:none;margin-top:20px}#deep-chat-openai-realtime-buttons-container{height:40%;display:flex;position:relative}.deep-chat-openai-realtime-button-container{height:100%;width:50%;display:flex;justify-content:center;align-items:center}.deep-chat-openai-realtime-button{width:70px;height:70px;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer}.deep-chat-openai-realtime-button-default{background-color:#e3e3e3}.deep-chat-openai-realtime-button-default:hover{background-color:#d4d4d4}.deep-chat-openai-realtime-button-default:active{background-color:#c5c5c5}.deep-chat-openai-realtime-button-loading{opacity:.7;pointer-events:none}.deep-chat-openai-realtime-microphone-active{background-color:#ffe7e7}.deep-chat-openai-realtime-microphone-active:hover{background-color:#ffdede}.deep-chat-openai-realtime-microphone-active:active{background-color:#ffd2d2}.deep-chat-openai-realtime-microphone>*{height:30px;width:30px}.deep-chat-openai-realtime-microphone-active>*{filter:brightness(0) saturate(100%) invert(35%) sepia(60%) saturate(1360%) hue-rotate(325deg) brightness(95%) contrast(92%)}.deep-chat-openai-realtime-toggle>*{height:32px;width:32px;padding-inline-start:3px;filter:brightness(0) saturate(100%) invert(22%) sepia(0%) saturate(4537%) hue-rotate(208deg) brightness(105%) contrast(91%)}.deep-chat-openai-realtime-button-unavailable{opacity:.45;pointer-events:none}#deep-chat-openai-realtime-error{color:red;position:absolute;top:calc(50% + 40px);inset-inline-start:50%;transform:translate(-50%,-50%);font-size:17px}#deep-chat-openai-realtime-loading{position:absolute;font-size:15px;top:50%;inset-inline-start:50%;transform:translate(-50%,-50%)}#insert-key-view{height:100%;position:relative}#insert-key-contents{text-align:center;position:absolute;inset-block-start:44%;inset-inline-start:50%;transform:translate(-50%,-50%);width:82%;display:flex;max-width:700px}#insert-key-title{margin-bottom:15px}#insert-key-input-container{margin-inline-end:2.7em;width:calc(100% - 80px)}#insert-key-input{padding:.3em 1.7em .3em .3em;border-width:1px;border-style:solid;border-radius:3px;width:100%;font-size:inherit}.insert-key-input-valid{border-color:gray}.insert-key-input-invalid{border-color:red}#visibility-icon-container{position:relative;float:inline-end;cursor:pointer;-webkit-user-select:none;user-select:none}.visibility-icon{filter:brightness(0) saturate(100%) invert(63%) sepia(1%) saturate(9%) hue-rotate(43deg) brightness(98%) contrast(92%);position:absolute;inset-inline-end:-1.7em;inset-block-start:-1.43em}#visible-icon{inset-block-start:-1.4em}.visibility-icon:hover{filter:unset}.visibility-icon>*{pointer-events:none}#start-button{border:1px solid grey;color:#454545;border-radius:4px;width:3em;display:flex;justify-content:center;align-items:center;cursor:pointer;padding:.28em .3em;-webkit-user-select:none;user-select:none;background-color:#fff}#start-button:hover{background-color:#f2f2f2}#start-button:active{background-color:#d2d2d2}#insert-key-help-text-container{width:100%;position:absolute;margin-top:32px;margin-bottom:20px}#insert-key-help-text-contents{width:100%;position:absolute}#insert-key-input-invalid-text{display:block;margin-top:1em;margin-bottom:.5em;color:red}.insert-key-input-help-text{display:block;margin-top:16px}#loading-key{display:inline-block;width:16px;height:16px}#loading-key:after{content:" ";display:block;width:11px;height:11px;margin:1px;border-radius:50%;border:2px solid #0084ff;border-color:#0084ff transparent #0084ff transparent;animation:loading-spinner 1.2s linear infinite}#error-view{color:red;font-size:1.2em;line-height:1.3em;margin-top:-5px;text-align:center;height:100%;display:flex;justify-content:center;align-items:center;padding-inline:8px}@keyframes loading-spinner{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.intro-panel{position:absolute;display:flex;justify-content:center;right:0;bottom:0;left:0;margin:auto;height:fit-content;top:-2.5em}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: a11y-dark
  Author: @ericwbailey
  Maintainer: @ericwbailey

  Based on the Tomorrow Night Eighties theme: https://github.com/isagalaev/highlight.js/blob/master/src/styles/tomorrow-night-eighties.css
*/.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}#messages,.deep-chat-upwards-mode #messages>div{overflow:auto;overflow-anchor:none}.deep-chat-upwards-mode #messages{height:100%;display:flex;flex-direction:column;justify-content:flex-end}.outer-message-container:last-child{margin-bottom:5px}.inner-message-container{display:flex;margin-inline:auto;width:calc(97.5% - 24px);max-width:100%}.message-bubble{margin-top:10px;word-wrap:break-word;width:fit-content;max-width:60%;border-radius:10px;padding:.42em .55em;height:fit-content;line-height:1.26em}.user-message-text{color:#fff;background-color:#0084ff;margin-inline-end:0px;margin-inline-start:auto}.ai-message-text{color:#000;background-color:#e4e6eb;margin-inline-start:0px;margin-inline-end:auto}.deep-chat-last-group-messages-active{height:100%}#scroll-button{position:absolute;top:75%;left:50%;right:50%;transform:translate(-50%,-50%);transition:opacity .1s ease;display:flex;opacity:0;padding:8px;background-color:#fff;border:.5px solid #000000;justify-content:center;align-items:center;white-space:nowrap;cursor:pointer}#scroll-button:hover{background-color:#fafafa}.loading-history-message-full-view{position:absolute;height:70%;width:100%;display:flex;align-items:center}.deep-chat-upwards-mode #messages .loading-history-message-full-view{height:100%}.loading-history-message-small{height:20px;margin-bottom:30px}.loading-history-message-small>div>div{scale:.6}.loading-history-message{margin-top:0;width:100%;max-width:100%;display:flex;justify-content:center;background-color:unset}.loading-history{width:70px}.loading-history div{position:absolute;width:var(--loading-history-width);height:var(--loading-history-height);margin:var(--loading-history-margin);border:var(--loading-history-border);border-radius:50%;animation:loading-spinner 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:var(--loading-history-color) transparent transparent transparent}.loading-history div:nth-child(1){animation-delay:-.45s}.loading-history div:nth-child(2){animation-delay:-.3s}.loading-history div:nth-child(3){animation-delay:-.15s}.html-message{max-width:unset}.error-message-text{margin-inline:auto;background-color:#f4c0c0;color:#474747;text-align:center;max-width:95%;margin-top:14px;margin-bottom:10px}.deep-chat-loading-message-dots-container{width:1em;padding-top:.6em;padding-bottom:.6em;padding-inline-start:1.3em;padding-inline-end:.75em}.loading-message-dots{position:relative;width:.45em;height:.45em;border-radius:5px;background-color:var(--loading-message-color);color:var(--loading-message-color);animation:loading-message-dots 1s infinite linear alternate;animation-delay:.5s}.loading-message-dots:before,.loading-message-dots:after{content:"";display:inline-block;position:absolute;top:0}.loading-message-dots:before{inset-inline-start:-.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--loading-message-color);color:var(--loading-message-color);animation:loading-message-dots 1s infinite alternate;animation-delay:0s}.loading-message-dots:after{inset-inline-start:.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--loading-message-color);color:var(--loading-message-color);animation:loading-message-dots 1s infinite alternate;animation-delay:1s}@keyframes loading-message-dots{0%{background-color:var(--loading-message-color)}50%,to{background-color:var(--loading-message-color-fade)}}.message-bubble>p:first-child,.message-bubble>.partial-render-message>p:first-child,.html-wrapper>p:first-child{margin-top:0}.message-bubble>p:last-child,.message-bubble>.partial-render-message:last-child>p,.html-wrapper>p:last-child{margin-bottom:0}pre{overflow:auto;display:block;word-break:break-all;word-wrap:break-word;border-radius:7px;background:#2b2b2b;color:#f8f8f2;margin-top:.8em;margin-bottom:.8em;padding:.6em;font-size:.9em;line-height:1.5em}.image-message{padding:0;display:flex;background-color:#ddd}.image-message>*,.image-message>*>*{width:100%;border-radius:8px;display:flex}.audio-message{width:60%;max-width:300px;height:2.2em;max-height:54px;padding:0;background-color:unset}.audio-player{width:100%;height:100%}.audio-player-safari{height:fit-content;width:40px}.audio-player-safari-start{float:inline-start}.audio-player-safari-end{float:inline-end}.any-file-message{padding:1px}.any-file-message-contents{display:flex}.any-file-message-icon-container{width:1.3em;min-width:1.3em;position:relative;border-radius:4px;margin-inline-start:6px;margin-inline-end:2px}.any-file-message-icon{background-color:#fff;border-radius:4px;position:absolute;width:1em;height:1.25em;padding:1px;margin-top:auto;margin-bottom:auto;top:0;bottom:0}.any-file-message-text{padding-top:5px;overflow-wrap:anywhere;padding-bottom:5px;padding-inline-end:7px}.message-bubble>a{color:inherit}.start-item-position{margin-inline-end:10px}.end-item-position{margin-inline-start:10px}.role-hidden{display:none}.avatar{padding-top:5px;width:1.5em;height:1.5em;border-radius:1px}.avatar-container{margin-top:9px}.name{margin-top:16px;font-size:15px}#drag-and-drop{position:absolute;display:none;z-index:10;height:calc(100% - 10px);width:calc(100% - 10px);background-color:#70c6ff4d;border:5px dashed #6dafff}#file-attachment-container{position:absolute;height:3.6em;width:calc(80% - 4px);top:-2.5em;border-radius:5px;overflow:auto;text-align:start;background-color:#d7d7d73b;padding-inline-start:4px}.file-attachment{width:2.85em;height:2.85em;display:inline-flex;margin-inline-end:.6em;margin-bottom:.44em;margin-top:4px;position:relative;background-color:#fff;border-radius:5px}.image-attachment{width:100%;height:100%;object-fit:cover;border-radius:5px}.border-bound-attachment{width:calc(100% - 2px);height:calc(100% - 2px);border:1px solid #c3c3c3;border-radius:5px;overflow:hidden}.border-bound-attachment-safari{width:calc(100% - 1px);height:calc(100% - 1px)}.audio-attachment-icon-container{cursor:pointer}.audio-attachment-icon-container:hover{background-color:#f8f8f8}.attachment-icon{inset-inline:0;bottom:0;top:2px;margin:auto;position:absolute;width:25px;-webkit-user-select:none;user-select:none}.not-removable-attachment-icon{top:0;right:0;bottom:0;left:0}.play-icon{filter:brightness(0) saturate(100%) invert(17%) sepia(0%) saturate(1392%) hue-rotate(67deg) brightness(98%) contrast(97%)}.stop-icon{filter:brightness(0) saturate(100%) invert(29%) sepia(90%) saturate(1228%) hue-rotate(198deg) brightness(93%) contrast(98%)}.audio-placeholder-text-3-digits{padding-inline-start:.26rem}.audio-placeholder-text-4-digits{padding-inline-start:.1rem}.any-file-attachment{padding:2px 0}.file-attachment-text-container{position:absolute;width:inherit;display:flex;align-items:center;height:100%;top:-1px}.audio-placeholder-text-3-digits-container{padding-top:1px;cursor:default}.any-file-attachment-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-inline-start:.13em;margin-inline:auto}.remove-file-attachment-button{height:1.25em;width:1.25em;border:1px solid #cfcfcf;border-radius:25px;background-color:#fff;top:-4px;inset-inline-end:-5px;position:absolute;display:flex;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none}.remove-file-attachment-button:hover{background-color:#e4e4e4}.remove-file-attachment-button:active{background-color:#d7d7d7}.x-icon{color:#4e4e4e;top:-.075em;position:relative;font-size:1.05em}.modal{display:none;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:80%;max-width:420px;max-height:80%;margin:auto;top:0;right:0;bottom:0;left:0;z-index:3}.modal-content{border-top:1px solid rgb(217,217,217);border-inline:1px solid rgb(217,217,217);border-start-start-radius:inherit;border-start-end-radius:inherit;background-color:#fff;overflow-y:auto;height:fit-content;max-height:calc(100% - 3.3em);width:100%}.modal-content>p{margin-inline:1em}.modal-content>ul{margin-inline-end:1em}.modal-button-panel{height:3.3em;border:1px solid;border-color:rgb(223,223,223) rgb(217,217,217) rgb(217,217,217);border-end-start-radius:inherit;border-end-end-radius:inherit;background-color:#fff;text-align:center;justify-content:center;display:flex;width:100%}.modal-button{min-width:2.5em;text-align:center;color:#fff;border-radius:5px;padding:.4em .4em .3em;height:1.25em;background-color:#3279b2;inset-block:0;margin-top:auto;margin-bottom:auto;cursor:pointer;-webkit-user-select:none;user-select:none;margin-inline:.31em}.modal-button:hover{background-color:#276da7}.modal-button:active{background-color:#1b5687}.modal-svg-button{padding:0 0 2px;width:2em;height:1.8em}.modal-svg-button-icon{width:100%;height:100%;filter:brightness(0) saturate(100%) invert(100%) sepia(15%) saturate(4%) hue-rotate(346deg) brightness(101%) contrast(102%)}#modal-background-panel{position:absolute;width:100%;height:100%;background-color:#00000042;z-index:2;display:none}.show-modal-background{animation:fadeInBackground .3s ease-in-out}@keyframes fadeInBackground{0%{opacity:0}to{opacity:1}}.show-modal{animation:fadeInModal .3s ease-in-out}@keyframes fadeInModal{0%{opacity:0;scale:.95}to{opacity:1;scale:1}}.hide-modal-background{animation:fadeOutBackground .2s ease-in-out}@keyframes fadeOutBackground{0%{opacity:1}to{opacity:0}}.hide-modal{animation:fadeOutModal .2s ease-in-out}@keyframes fadeOutModal{0%{opacity:1;scale:1}to{opacity:0;scale:.95}}.modal-camera-content{overflow:hidden;text-align:center;border:unset;height:100%;background-color:#2a2a2a;display:flex;justify-content:center}.camera-modal-canvas{max-width:100%;max-height:100%;margin-top:auto;margin-bottom:auto}.modal-svg-submit-button{background-color:green}.modal-svg-submit-button:hover{background-color:#007500}.modal-svg-submit-button:active{background-color:#006500}.modal-svg-submit-disabled{pointer-events:none;background-color:#747474}.modal-svg-close-button{height:1.56em;padding-top:.37em;padding-bottom:0;background-color:#c13e3e}.modal-svg-close-button:hover{background-color:#b43434}.modal-svg-close-button:active{background-color:#972929}.modal-svg-close-icon{width:80%;height:80%}.modal-svg-camera-button{height:1.6em;padding-top:.38em;padding-bottom:0}.modal-svg-camera-icon{height:76%}.modal-svg-refresh-icon{height:105%}.modal-svg-refresh-button{height:1.66em;padding-top:.11em;padding-bottom:.21em}.input-button-container{position:relative;z-index:1}.inside-end{position:absolute;inset-inline-end:calc(10% + .35em);inset-block-end:.85em}.inside-start{position:absolute;inset-inline-start:calc(10% + .35em);inset-block-end:.85em}.outside-start{position:absolute;inset-inline-end:calc(11px - .55em);inset-block-end:.88em}.outside-end{position:absolute;inset-inline-start:calc(11px - .55em);inset-block-end:.88em}#upload-images-icon{position:absolute;pointer-events:none;width:1.45em;height:1.45em;inset-inline-start:.11em;inset-block-end:.08em;filter:brightness(0) saturate(100%) invert(43%) sepia(0%) saturate(740%) hue-rotate(77deg) brightness(99%) contrast(92%)}#upload-gifs-icon{position:absolute;pointer-events:none;width:1.5em;height:1.48em;inset-inline-start:.07em;inset-block-end:.08em;filter:brightness(0) saturate(100%) invert(49%) sepia(0%) saturate(2586%) hue-rotate(12deg) brightness(93%) contrast(90%)}#upload-audio-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.17em;inset-block-end:.2em;filter:brightness(0) saturate(100%) invert(15%) sepia(0%) saturate(337%) hue-rotate(125deg) brightness(91%) contrast(94%);transform:scaleX(.95)}#camera-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.23em;inset-block-end:.2em;filter:brightness(0) saturate(100%) invert(52%) sepia(0%) saturate(161%) hue-rotate(164deg) brightness(91%) contrast(92%);transform:scaleX(.95)}#upload-mixed-files-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.25em;inset-block-end:.2em;filter:brightness(0) saturate(100%) invert(53%) sepia(0%) saturate(36%) hue-rotate(74deg) brightness(98%) contrast(93%);transform:scaleX(.95)}#interim-text{color:gray}#microphone-button{padding-top:.5px}.outer-button-container>#microphone-button{padding-bottom:1px}#microphone-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.25em;inset-block-end:.25em}.default-microphone-icon{filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%)}.active-microphone-icon{filter:brightness(0) saturate(100%) invert(10%) sepia(97%) saturate(7495%) hue-rotate(0deg) brightness(101%) contrast(107%);border-radius:10px}.command-microphone-icon{filter:brightness(0) saturate(100%) invert(42%) sepia(96%) saturate(1067%) hue-rotate(77deg) brightness(99%) contrast(102%)}.unsupported-microphone{display:none}#submit-icon{height:100%;filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%);width:1.21em}#stop-icon{background-color:#acacac;position:absolute;width:.95em;height:.95em;inset-inline-start:.35em;inset-block-end:.35em;border-radius:2px}.submit-button-enlarged{scale:1.1;margin-inline:.3em}.loading-submit-button{position:relative;inset-inline-start:calc(-9990px + .275em);width:.22em;height:.22em;border-radius:5px;background-color:#848484;color:#848484;box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484;animation:loading-submit-button 1.5s infinite linear;inset-block-end:-.75em}@keyframes loading-submit-button{0%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}16.667%{box-shadow:9990px -6px #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}33.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}50%{box-shadow:9990px 0 #848484,calc(9990px + .44em) -6px 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}66.667%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}83.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) -6px 0 0 #848484}to{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}}.tooltip{position:absolute;visibility:hidden;z-index:1;pointer-events:none;padding:5px;padding-inline:7px;background-color:#333;border-radius:5px;width:max-content}.tooltip-text{color:#fff;font-size:13px}.input-button{border-radius:4px;cursor:pointer;margin-bottom:.2em;-webkit-user-select:none;user-select:none}.input-button-svg{width:1.65em;height:1.65em}.input-button-svg-text{padding:1px;height:1.65em;display:flex}.input-button-svg-text>svg{padding:.22rem}.input-button-svg-text>div{margin-inline-start:2px}.input-button:hover,.input-button:focus-visible{background-color:#9c9c9c2e}.input-button:active{background-color:#9c9c9c5e}.input-button:active:not(:hover){background-color:transparent}.loading-button{cursor:auto}.loading-button:hover{background-color:unset}.text-button{filter:unset!important;display:flex;justify-content:center;align-items:center;margin-inline:4px;height:1.6em;width:max-content}#custom-icon{height:100%;width:1.2em}.custom-button-container-default{color:#505050}.custom-button-container-default>.dropup-menu-item-icon{color:unset}.custom-button-container-default>svg{filter:brightness(0) saturate(100%) invert(39%) sepia(1%) saturate(0%) hue-rotate(83deg) brightness(93%) contrast(90%)}.custom-button-container-default>.dropup-menu-item-icon>svg{position:absolute;inset-inline-start:.2em}.custom-button-container-active{background-color:#edf7ff;color:#0285ff}.custom-button-container-active:hover,.custom-button-container-active:focus-visible{background-color:#def0ff}.custom-button-container-active:active{background-color:#d2eaff}.custom-button-container-active>svg{filter:brightness(0) saturate(100%) invert(32%) sepia(34%) saturate(4196%) hue-rotate(196deg) brightness(107%) contrast(104%)}.custom-button-container-disabled{color:#aeaeae;cursor:auto}.custom-button-container-disabled>div{pointer-events:none}.custom-button-container-disabled:hover,.custom-button-container-disabled:focus-visible{background-color:transparent}.custom-button-container-disabled:active{background-color:transparent}.custom-button-container-disabled>svg{filter:brightness(0) saturate(100%) invert(67%) sepia(0%) saturate(818%) hue-rotate(28deg) brightness(102%) contrast(100%)}#text-input-container{background-color:#fff;width:80%;display:flex;border:1px solid #0000001a;border-radius:5px;margin-top:.8em;margin-bottom:.8em;box-shadow:#959da533 0 1px 12px;overflow-y:auto;max-height:200px;position:relative}.text-input-container-start-adjustment{margin-inline-start:1.5em}.text-input-container-end-adjustment{margin-inline-end:1.5em}.text-input-container-start-small-adjustment{margin-inline-start:1.1em}.text-input-container-start-small-adjustment>.outside-start{inset-inline-end:calc(14px - .55em)}.text-input-container-end-small-adjustment{margin-inline-end:1.1em}.text-input-container-end-small-adjustment>.outside-end{inset-inline-start:calc(14px - .55em)}#text-input{text-align:start;outline:none;word-wrap:break-word;line-break:auto}.text-input-styling{padding:.4em .5em;overflow:overlay;width:100%}.text-input-inner-start-adjustment{padding-inline-start:2.2em}.text-input-inner-end-adjustment{padding-inline-end:2em}.text-input-disabled{pointer-events:none;-webkit-user-select:none;user-select:none}[contenteditable]:empty:before{content:attr(deep-chat-placeholder-text);pointer-events:none}[contenteditable][textcolor]:empty:before{color:gray}.outside-end>#dropup-menu,.inside-end>#dropup-menu{inset-inline-end:0px}#dropup-icon{position:absolute;pointer-events:none;width:1.16em;height:1.2em;inset-inline-start:.265em;bottom:.43em;filter:brightness(0) saturate(100%) invert(54%) sepia(0%) saturate(724%) hue-rotate(6deg) brightness(92%) contrast(90%)}.dropup-button>*{pointer-events:none}#dropup-menu{background-color:#fff;position:absolute;transform:translateY(-100%);border-radius:5px;z-index:1;top:-.49em;box-shadow:#0003 -1px 2px 10px,#0000001a 0 2px 4px;cursor:pointer;-webkit-user-select:none;user-select:none}.dropup-menu-item{height:1.4em;padding-inline-start:.35em;padding-inline-end:.84em;padding-top:.28em;padding-bottom:.28em;display:flex;position:relative}.dropup-menu-item:hover,.dropup-menu-item:focus-visible{background-color:#f3f3f3}.dropup-menu-item:active{background-color:#ebebeb}.dropup-menu-item:active:not(:hover){background-color:transparent}.dropup-menu-item:first-child{padding-top:.49em;border-start-start-radius:inherit;border-start-end-radius:inherit}.dropup-menu-item:last-child{padding-bottom:.45em;border-end-start-radius:inherit;border-end-end-radius:inherit}.dropup-menu-item-icon{width:1.39em;position:relative}.dropup-menu-item-icon>svg{bottom:0!important;top:0!important;margin-bottom:auto;margin-top:auto}#dropup-menu-item-icon-element-custom{position:absolute;pointer-events:none;width:1.21em;height:1.21em;inset-inline-start:.28em;filter:brightness(0) saturate(100%) invert(15%) sepia(0%) saturate(337%) hue-rotate(125deg) brightness(91%) contrast(94%)}.dropup-menu-item-text{margin-inline-start:.56em;margin-top:.08em;width:max-content}#input{width:100%;display:inline-flex;text-align:center;margin-inline:auto;margin-top:auto;position:relative;justify-content:center}#chat-view{height:100%;grid-template-columns:100%}.deep-chat-downwards-mode{display:grid}.deep-chat-upwards-mode{display:flex;flex-direction:column}::-webkit-scrollbar{width:9px;height:9px}::-webkit-scrollbar-thumb{background-color:#d0d0d0;border-radius:5px}::-webkit-scrollbar-track{background-color:#f2f2f2}.deep-chat-web-model-button{margin-top:10px;margin-bottom:5px;margin-inline-start:1px}:host{all:initial;display:table-cell}#container{height:inherit;width:inherit;overflow:hidden}`,Fh=Object.defineProperty,X=function(i,t,e,n){for(var r=void 0,s=i.length-1,o;s>=0;s--)(o=i[s])&&(r=o(t,e,r)||r);return r&&Fh(t,e,r),r},K=(function(a){function i(){var t;E(this,i);var e;return t=F(this,i),t.getMessages=function(){return[]},t.submitUserMessage=function(){return console.warn(Ma("submitUserMessage"))},t.addMessage=function(){return console.warn(Ma("addMessage"))},t.updateMessage=function(){},t.clearMessages=function(){},t.focusInput=function(){return Mn.focusFromParentElement(t._elementRef)},t.refreshMessages=function(){},t.scrollToBottom=function(){},t.disableSubmitButton=function(){},t.setPlaceholderText=function(){},t._hasBeenRendered=!1,t._auxiliaryStyleApplied=!1,t._elementRef=B(),t._elementRef.id="container",t.attachShadow({mode:"open"}).appendChild(t._elementRef),(e=t.shadowRoot)==null||e.appendChild(ut.buildElement()),_r.apply(Lh,t.shadowRoot),setTimeout(function(){t._hasBeenRendered||t.onRender()},20),t}return D(i,a),C(i,[{key:"changeToChatView",value:function(){this._activeService&&(this._activeService.validateKeyProperty=!1),this.onRender()}},{key:"onRender",value:function(){var e;Os.attemptAppendStyleSheetToHead(this.style),_e.processConnect(this),(!this._activeService||this._activeService.demo)&&(this._activeService=Nd.create(this)),this.auxiliaryStyle&&!this._auxiliaryStyleApplied&&(_r.apply(this.auxiliaryStyle,this.shadowRoot),this._auxiliaryStyleApplied=!0),_r.applyDefaultStyleToComponent(this.style,this.chatStyle),_e.checkForContainerStyles(this,this._elementRef),this._activeService.key&&this._activeService.validateKeyProperty?io.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):!(this._activeService instanceof W)||this._activeService.key?((e=this._childElement)!==null&&e!==void 0||(this._childElement=this.children[0]),Oh.render(this,this._elementRef,this._activeService,this._childElement)):this._activeService instanceof W&&Eu.render(this._elementRef,this.changeToChatView.bind(this),this._activeService),this._hasBeenRendered||Mt.onRender(this),this._hasBeenRendered=!0}},{key:"disconnectedCallback",value:function(){ca.chat=void 0}}])})(_u);X([$("object")],K.prototype,"connect");X([$("object")],K.prototype,"directConnection");X([$("object")],K.prototype,"webModel");X([$("object")],K.prototype,"requestBodyLimits");X([$("function")],K.prototype,"requestInterceptor");X([$("function")],K.prototype,"responseInterceptor");X([$("function")],K.prototype,"validateInput");X([$("function")],K.prototype,"loadHistory");X([$("object")],K.prototype,"chatStyle");X([$("object")],K.prototype,"attachmentContainerStyle");X([$("object")],K.prototype,"dropupStyles");X([$("object")],K.prototype,"inputAreaStyle");X([$("object")],K.prototype,"textInput");X([$("object")],K.prototype,"defaultInput");X([$("object")],K.prototype,"submitButtonStyles");X([$("object")],K.prototype,"customButtons");X([$("string")],K.prototype,"auxiliaryStyle");X([$("array")],K.prototype,"history");X([$("object")],K.prototype,"browserStorage");X([$("object")],K.prototype,"introMessage");X([$("object")],K.prototype,"avatars");X([$("object")],K.prototype,"names");X([$("object")],K.prototype,"displayLoadingBubble");X([$("object")],K.prototype,"errorMessages");X([$("object")],K.prototype,"messageStyles");X([$("object")],K.prototype,"textToSpeech");X([$("object")],K.prototype,"speechToText");X([$("object")],K.prototype,"images");X([$("object")],K.prototype,"gifs");X([$("object")],K.prototype,"camera");X([$("object")],K.prototype,"audio");X([$("object")],K.prototype,"microphone");X([$("object")],K.prototype,"mixedFiles");X([$("object")],K.prototype,"dragAndDrop");X([$("object")],K.prototype,"htmlWrappers");X([$("object")],K.prototype,"htmlClassUtilities");X([$("object")],K.prototype,"remarkable");X([$("object")],K.prototype,"focusMode");X([$("boolean")],K.prototype,"upwardsMode");X([$("object")],K.prototype,"scrollButton");X([$("object")],K.prototype,"hiddenMessages");X([$("number")],K.prototype,"maxVisibleMessages");X([$("function")],K.prototype,"onMessage");X([$("function")],K.prototype,"onClearMessages");X([$("function")],K.prototype,"onComponentRender");X([$("function")],K.prototype,"onInput");X([$("function")],K.prototype,"onError");X([$("object")],K.prototype,"demo");X([$("object")],K.prototype,"_insertKeyViewStyles");customElements.define("deep-chat",K);
